(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();function T2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Of={exports:{}},Yo={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ny;function wS(){if(ny)return Yo;ny=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(i,r,l){var u=null;if(l!==void 0&&(u=""+l),r.key!==void 0&&(u=""+r.key),"key"in r){l={};for(var d in r)d!=="key"&&(l[d]=r[d])}else l=r;return r=l.ref,{$$typeof:t,type:i,key:u,ref:r!==void 0?r:null,props:l}}return Yo.Fragment=e,Yo.jsx=n,Yo.jsxs=n,Yo}var iy;function jS(){return iy||(iy=1,Of.exports=wS()),Of.exports}var o=jS(),Df={exports:{}},$e={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sy;function RS(){if(sy)return $e;sy=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),C=Symbol.iterator;function x(P){return P===null||typeof P!="object"?null:(P=C&&P[C]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k=Object.assign,E={};function _(P,K,ae){this.props=P,this.context=K,this.refs=E,this.updater=ae||S}_.prototype.isReactComponent={},_.prototype.setState=function(P,K){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,K,"setState")},_.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function O(){}O.prototype=_.prototype;function A(P,K,ae){this.props=P,this.context=K,this.refs=E,this.updater=ae||S}var w=A.prototype=new O;w.constructor=A,k(w,_.prototype),w.isPureReactComponent=!0;var j=Array.isArray;function R(){}var N={H:null,A:null,T:null,S:null},L=Object.prototype.hasOwnProperty;function F(P,K,ae){var le=ae.ref;return{$$typeof:t,type:P,key:K,ref:le!==void 0?le:null,props:ae}}function D(P,K){return F(P.type,K,P.props)}function I(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function B(P){var K={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(ae){return K[ae]})}var G=/\/+/g;function Z(P,K){return typeof P=="object"&&P!==null&&P.key!=null?B(""+P.key):K.toString(36)}function ue(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(R,R):(P.status="pending",P.then(function(K){P.status==="pending"&&(P.status="fulfilled",P.value=K)},function(K){P.status==="pending"&&(P.status="rejected",P.reason=K)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function q(P,K,ae,le,Te){var ce=typeof P;(ce==="undefined"||ce==="boolean")&&(P=null);var _e=!1;if(P===null)_e=!0;else switch(ce){case"bigint":case"string":case"number":_e=!0;break;case"object":switch(P.$$typeof){case t:case e:_e=!0;break;case p:return _e=P._init,q(_e(P._payload),K,ae,le,Te)}}if(_e)return Te=Te(P),_e=le===""?"."+Z(P,0):le,j(Te)?(ae="",_e!=null&&(ae=_e.replace(G,"$&/")+"/"),q(Te,K,ae,"",function(be){return be})):Te!=null&&(I(Te)&&(Te=D(Te,ae+(Te.key==null||P&&P.key===Te.key?"":(""+Te.key).replace(G,"$&/")+"/")+_e)),K.push(Te)),1;_e=0;var V=le===""?".":le+":";if(j(P))for(var ve=0;ve<P.length;ve++)le=P[ve],ce=V+Z(le,ve),_e+=q(le,K,ae,ce,Te);else if(ve=x(P),typeof ve=="function")for(P=ve.call(P),ve=0;!(le=P.next()).done;)le=le.value,ce=V+Z(le,ve++),_e+=q(le,K,ae,ce,Te);else if(ce==="object"){if(typeof P.then=="function")return q(ue(P),K,ae,le,Te);throw K=String(P),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return _e}function ee(P,K,ae){if(P==null)return P;var le=[],Te=0;return q(P,le,"","",function(ce){return K.call(ae,ce,Te++)}),le}function re(P){if(P._status===-1){var K=P._result;K=K(),K.then(function(ae){(P._status===0||P._status===-1)&&(P._status=1,P._result=ae)},function(ae){(P._status===0||P._status===-1)&&(P._status=2,P._result=ae)}),P._status===-1&&(P._status=0,P._result=K)}if(P._status===1)return P._result.default;throw P._result}var he=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},Se={map:ee,forEach:function(P,K,ae){ee(P,function(){K.apply(this,arguments)},ae)},count:function(P){var K=0;return ee(P,function(){K++}),K},toArray:function(P){return ee(P,function(K){return K})||[]},only:function(P){if(!I(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return $e.Activity=v,$e.Children=Se,$e.Component=_,$e.Fragment=n,$e.Profiler=r,$e.PureComponent=A,$e.StrictMode=i,$e.Suspense=f,$e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,$e.__COMPILER_RUNTIME={__proto__:null,c:function(P){return N.H.useMemoCache(P)}},$e.cache=function(P){return function(){return P.apply(null,arguments)}},$e.cacheSignal=function(){return null},$e.cloneElement=function(P,K,ae){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var le=k({},P.props),Te=P.key;if(K!=null)for(ce in K.key!==void 0&&(Te=""+K.key),K)!L.call(K,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&K.ref===void 0||(le[ce]=K[ce]);var ce=arguments.length-2;if(ce===1)le.children=ae;else if(1<ce){for(var _e=Array(ce),V=0;V<ce;V++)_e[V]=arguments[V+2];le.children=_e}return F(P.type,Te,le)},$e.createContext=function(P){return P={$$typeof:u,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:l,_context:P},P},$e.createElement=function(P,K,ae){var le,Te={},ce=null;if(K!=null)for(le in K.key!==void 0&&(ce=""+K.key),K)L.call(K,le)&&le!=="key"&&le!=="__self"&&le!=="__source"&&(Te[le]=K[le]);var _e=arguments.length-2;if(_e===1)Te.children=ae;else if(1<_e){for(var V=Array(_e),ve=0;ve<_e;ve++)V[ve]=arguments[ve+2];Te.children=V}if(P&&P.defaultProps)for(le in _e=P.defaultProps,_e)Te[le]===void 0&&(Te[le]=_e[le]);return F(P,ce,Te)},$e.createRef=function(){return{current:null}},$e.forwardRef=function(P){return{$$typeof:d,render:P}},$e.isValidElement=I,$e.lazy=function(P){return{$$typeof:p,_payload:{_status:-1,_result:P},_init:re}},$e.memo=function(P,K){return{$$typeof:m,type:P,compare:K===void 0?null:K}},$e.startTransition=function(P){var K=N.T,ae={};N.T=ae;try{var le=P(),Te=N.S;Te!==null&&Te(ae,le),typeof le=="object"&&le!==null&&typeof le.then=="function"&&le.then(R,he)}catch(ce){he(ce)}finally{K!==null&&ae.types!==null&&(K.types=ae.types),N.T=K}},$e.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},$e.use=function(P){return N.H.use(P)},$e.useActionState=function(P,K,ae){return N.H.useActionState(P,K,ae)},$e.useCallback=function(P,K){return N.H.useCallback(P,K)},$e.useContext=function(P){return N.H.useContext(P)},$e.useDebugValue=function(){},$e.useDeferredValue=function(P,K){return N.H.useDeferredValue(P,K)},$e.useEffect=function(P,K){return N.H.useEffect(P,K)},$e.useEffectEvent=function(P){return N.H.useEffectEvent(P)},$e.useId=function(){return N.H.useId()},$e.useImperativeHandle=function(P,K,ae){return N.H.useImperativeHandle(P,K,ae)},$e.useInsertionEffect=function(P,K){return N.H.useInsertionEffect(P,K)},$e.useLayoutEffect=function(P,K){return N.H.useLayoutEffect(P,K)},$e.useMemo=function(P,K){return N.H.useMemo(P,K)},$e.useOptimistic=function(P,K){return N.H.useOptimistic(P,K)},$e.useReducer=function(P,K,ae){return N.H.useReducer(P,K,ae)},$e.useRef=function(P){return N.H.useRef(P)},$e.useState=function(P){return N.H.useState(P)},$e.useSyncExternalStore=function(P,K,ae){return N.H.useSyncExternalStore(P,K,ae)},$e.useTransition=function(){return N.H.useTransition()},$e.version="19.2.1",$e}var ay;function vp(){return ay||(ay=1,Df.exports=RS()),Df.exports}var b=vp();const Ou=T2(b);var Lf={exports:{}},Jo={},Pf={exports:{}},If={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ry;function NS(){return ry||(ry=1,(function(t){function e(q,ee){var re=q.length;q.push(ee);e:for(;0<re;){var he=re-1>>>1,Se=q[he];if(0<r(Se,ee))q[he]=ee,q[re]=Se,re=he;else break e}}function n(q){return q.length===0?null:q[0]}function i(q){if(q.length===0)return null;var ee=q[0],re=q.pop();if(re!==ee){q[0]=re;e:for(var he=0,Se=q.length,P=Se>>>1;he<P;){var K=2*(he+1)-1,ae=q[K],le=K+1,Te=q[le];if(0>r(ae,re))le<Se&&0>r(Te,ae)?(q[he]=Te,q[le]=re,he=le):(q[he]=ae,q[K]=re,he=K);else if(le<Se&&0>r(Te,re))q[he]=Te,q[le]=re,he=le;else break e}}return ee}function r(q,ee){var re=q.sortIndex-ee.sortIndex;return re!==0?re:q.id-ee.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var u=Date,d=u.now();t.unstable_now=function(){return u.now()-d}}var f=[],m=[],p=1,v=null,C=3,x=!1,S=!1,k=!1,E=!1,_=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function w(q){for(var ee=n(m);ee!==null;){if(ee.callback===null)i(m);else if(ee.startTime<=q)i(m),ee.sortIndex=ee.expirationTime,e(f,ee);else break;ee=n(m)}}function j(q){if(k=!1,w(q),!S)if(n(f)!==null)S=!0,R||(R=!0,B());else{var ee=n(m);ee!==null&&ue(j,ee.startTime-q)}}var R=!1,N=-1,L=5,F=-1;function D(){return E?!0:!(t.unstable_now()-F<L)}function I(){if(E=!1,R){var q=t.unstable_now();F=q;var ee=!0;try{e:{S=!1,k&&(k=!1,O(N),N=-1),x=!0;var re=C;try{t:{for(w(q),v=n(f);v!==null&&!(v.expirationTime>q&&D());){var he=v.callback;if(typeof he=="function"){v.callback=null,C=v.priorityLevel;var Se=he(v.expirationTime<=q);if(q=t.unstable_now(),typeof Se=="function"){v.callback=Se,w(q),ee=!0;break t}v===n(f)&&i(f),w(q)}else i(f);v=n(f)}if(v!==null)ee=!0;else{var P=n(m);P!==null&&ue(j,P.startTime-q),ee=!1}}break e}finally{v=null,C=re,x=!1}ee=void 0}}finally{ee?B():R=!1}}}var B;if(typeof A=="function")B=function(){A(I)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,Z=G.port2;G.port1.onmessage=I,B=function(){Z.postMessage(null)}}else B=function(){_(I,0)};function ue(q,ee){N=_(function(){q(t.unstable_now())},ee)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return C},t.unstable_next=function(q){switch(C){case 1:case 2:case 3:var ee=3;break;default:ee=C}var re=C;C=ee;try{return q()}finally{C=re}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(q,ee){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var re=C;C=q;try{return ee()}finally{C=re}},t.unstable_scheduleCallback=function(q,ee,re){var he=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?he+re:he):re=he,q){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=re+Se,q={id:p++,callback:ee,priorityLevel:q,startTime:re,expirationTime:Se,sortIndex:-1},re>he?(q.sortIndex=re,e(m,q),n(f)===null&&q===n(m)&&(k?(O(N),N=-1):k=!0,ue(j,re-he))):(q.sortIndex=Se,e(f,q),S||x||(S=!0,R||(R=!0,B()))),q},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(q){var ee=C;return function(){var re=C;C=ee;try{return q.apply(this,arguments)}finally{C=re}}}})(If)),If}var oy;function _S(){return oy||(oy=1,Pf.exports=NS()),Pf.exports}var Uf={exports:{}},An={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ly;function AS(){if(ly)return An;ly=1;var t=vp();function e(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)m+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(f,m,p){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:v==null?null:""+v,children:f,containerInfo:m,implementation:p}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return An.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,An.createPortal=function(f,m){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return l(f,m,null,p)},An.flushSync=function(f){var m=u.T,p=i.p;try{if(u.T=null,i.p=2,f)return f()}finally{u.T=m,i.p=p,i.d.f()}},An.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,i.d.C(f,m))},An.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},An.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var p=m.as,v=d(p,m.crossOrigin),C=typeof m.integrity=="string"?m.integrity:void 0,x=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;p==="style"?i.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:C,fetchPriority:x}):p==="script"&&i.d.X(f,{crossOrigin:v,integrity:C,fetchPriority:x,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},An.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var p=d(m.as,m.crossOrigin);i.d.M(f,{crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&i.d.M(f)},An.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var p=m.as,v=d(p,m.crossOrigin);i.d.L(f,p,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},An.preloadModule=function(f,m){if(typeof f=="string")if(m){var p=d(m.as,m.crossOrigin);i.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else i.d.m(f)},An.requestFormReset=function(f){i.d.r(f)},An.unstable_batchedUpdates=function(f,m){return f(m)},An.useFormState=function(f,m,p){return u.H.useFormState(f,m,p)},An.useFormStatus=function(){return u.H.useHostTransitionStatus()},An.version="19.2.1",An}var cy;function E2(){if(cy)return Uf.exports;cy=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Uf.exports=AS(),Uf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uy;function MS(){if(uy)return Jo;uy=1;var t=_S(),e=vp(),n=E2();function i(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function l(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function u(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function f(s){if(l(s)!==s)throw Error(i(188))}function m(s){var a=s.alternate;if(!a){if(a=l(s),a===null)throw Error(i(188));return a!==s?null:s}for(var c=s,h=a;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(h=g.return,h!==null){c=h;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return f(g),s;if(y===h)return f(g),a;y=y.sibling}throw Error(i(188))}if(c.return!==h.return)c=g,h=y;else{for(var T=!1,M=g.child;M;){if(M===c){T=!0,c=g,h=y;break}if(M===h){T=!0,h=g,c=y;break}M=M.sibling}if(!T){for(M=y.child;M;){if(M===c){T=!0,c=y,h=g;break}if(M===h){T=!0,h=y,c=g;break}M=M.sibling}if(!T)throw Error(i(189))}}if(c.alternate!==h)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var v=Object.assign,C=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),A=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),I=Symbol.iterator;function B(s){return s===null||typeof s!="object"?null:(s=I&&s[I]||s["@@iterator"],typeof s=="function"?s:null)}var G=Symbol.for("react.client.reference");function Z(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===G?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case k:return"Fragment";case _:return"Profiler";case E:return"StrictMode";case j:return"Suspense";case R:return"SuspenseList";case F:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case S:return"Portal";case A:return s.displayName||"Context";case O:return(s._context.displayName||"Context")+".Consumer";case w:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case N:return a=s.displayName||null,a!==null?a:Z(s.type)||"Memo";case L:a=s._payload,s=s._init;try{return Z(s(a))}catch{}}return null}var ue=Array.isArray,q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},he=[],Se=-1;function P(s){return{current:s}}function K(s){0>Se||(s.current=he[Se],he[Se]=null,Se--)}function ae(s,a){Se++,he[Se]=s.current,s.current=a}var le=P(null),Te=P(null),ce=P(null),_e=P(null);function V(s,a){switch(ae(ce,a),ae(Te,s),ae(le,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?E1(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=E1(a),s=w1(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}K(le),ae(le,s)}function ve(){K(le),K(Te),K(ce)}function be(s){s.memoizedState!==null&&ae(_e,s);var a=le.current,c=w1(a,s.type);a!==c&&(ae(Te,s),ae(le,c))}function Ue(s){Te.current===s&&(K(le),K(Te)),_e.current===s&&(K(_e),Go._currentValue=re)}var et,At;function mt(s){if(et===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);et=a&&a[1]||"",At=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+et+s+At}var Dt=!1;function Q(s,a){if(!s||Dt)return"";Dt=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(a){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(ne){var X=ne}Reflect.construct(s,[],me)}else{try{me.call()}catch(ne){X=ne}s.call(me.prototype)}}else{try{throw Error()}catch(ne){X=ne}(me=s())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(ne){if(ne&&X&&typeof ne.stack=="string")return[ne.stack,X.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=h.DetermineComponentFrameRoot(),T=y[0],M=y[1];if(T&&M){var z=T.split(`
`),Y=M.split(`
`);for(g=h=0;h<z.length&&!z[h].includes("DetermineComponentFrameRoot");)h++;for(;g<Y.length&&!Y[g].includes("DetermineComponentFrameRoot");)g++;if(h===z.length||g===Y.length)for(h=z.length-1,g=Y.length-1;1<=h&&0<=g&&z[h]!==Y[g];)g--;for(;1<=h&&0<=g;h--,g--)if(z[h]!==Y[g]){if(h!==1||g!==1)do if(h--,g--,0>g||z[h]!==Y[g]){var oe=`
`+z[h].replace(" at new "," at ");return s.displayName&&oe.includes("<anonymous>")&&(oe=oe.replace("<anonymous>",s.displayName)),oe}while(1<=h&&0<=g);break}}}finally{Dt=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?mt(c):""}function Ee(s,a){switch(s.tag){case 26:case 27:case 5:return mt(s.type);case 16:return mt("Lazy");case 13:return s.child!==a&&a!==null?mt("Suspense Fallback"):mt("Suspense");case 19:return mt("SuspenseList");case 0:case 15:return Q(s.type,!1);case 11:return Q(s.type.render,!1);case 1:return Q(s.type,!0);case 31:return mt("Activity");default:return""}}function se(s){try{var a="",c=null;do a+=Ee(s,c),c=s,s=s.return;while(s);return a}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var fe=Object.prototype.hasOwnProperty,Ae=t.unstable_scheduleCallback,He=t.unstable_cancelCallback,Me=t.unstable_shouldYield,Be=t.unstable_requestPaint,Je=t.unstable_now,xe=t.unstable_getCurrentPriorityLevel,Ne=t.unstable_ImmediatePriority,Ke=t.unstable_UserBlockingPriority,ft=t.unstable_NormalPriority,zt=t.unstable_LowPriority,dn=t.unstable_IdlePriority,hn=t.log,Os=t.unstable_setDisableYieldValue,fi=null,nn=null;function Ln(s){if(typeof hn=="function"&&Os(s),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(fi,s)}catch{}}var qt=Math.clz32?Math.clz32:Tt,Ve=Math.log,pt=Math.LN2;function Tt(s){return s>>>=0,s===0?32:31-(Ve(s)/pt|0)|0}var Bt=256,ii=262144,Lt=4194304;function Fe(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function rt(s,a,c){var h=s.pendingLanes;if(h===0)return 0;var g=0,y=s.suspendedLanes,T=s.pingedLanes;s=s.warmLanes;var M=h&134217727;return M!==0?(h=M&~y,h!==0?g=Fe(h):(T&=M,T!==0?g=Fe(T):c||(c=M&~s,c!==0&&(g=Fe(c))))):(M=h&~y,M!==0?g=Fe(M):T!==0?g=Fe(T):c||(c=h&~s,c!==0&&(g=Fe(c)))),g===0?0:a!==0&&a!==g&&(a&y)===0&&(y=g&-g,c=a&-a,y>=c||y===32&&(c&4194048)!==0)?a:g}function fn(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function qn(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Il(){var s=Lt;return Lt<<=1,(Lt&62914560)===0&&(Lt=4194304),s}function ao(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function va(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Sd(s,a,c,h,g,y){var T=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var M=s.entanglements,z=s.expirationTimes,Y=s.hiddenUpdates;for(c=T&~c;0<c;){var oe=31-qt(c),me=1<<oe;M[oe]=0,z[oe]=-1;var X=Y[oe];if(X!==null)for(Y[oe]=null,oe=0;oe<X.length;oe++){var ne=X[oe];ne!==null&&(ne.lane&=-536870913)}c&=~me}h!==0&&Ul(s,h,0),y!==0&&g===0&&s.tag!==0&&(s.suspendedLanes|=y&~(T&~a))}function Ul(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var h=31-qt(a);s.entangledLanes|=a,s.entanglements[h]=s.entanglements[h]|1073741824|c&261930}function ke(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var h=31-qt(c),g=1<<h;g&a|s[h]&a&&(s[h]|=a),c&=~g}}function we(s,a){var c=a&-a;return c=(c&42)!==0?1:Le(c),(c&(s.suspendedLanes|a))!==0?0:c}function Le(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function yt(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Wt(){var s=ee.p;return s!==0?s:(s=window.event,s===void 0?32:Z1(s.type))}function mi(s,a){var c=ee.p;try{return ee.p=s,a()}finally{ee.p=c}}var mn=Math.random().toString(36).slice(2),Ft="__reactFiber$"+mn,sn="__reactProps$"+mn,Tn="__reactContainer$"+mn,Zt="__reactEvents$"+mn,kd="__reactListeners$"+mn,g4="__reactHandles$"+mn,hg="__reactResources$"+mn,ro="__reactMarker$"+mn;function Td(s){delete s[Ft],delete s[sn],delete s[Zt],delete s[kd],delete s[g4]}function Ya(s){var a=s[Ft];if(a)return a;for(var c=s.parentNode;c;){if(a=c[Tn]||c[Ft]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=O1(s);s!==null;){if(c=s[Ft])return c;s=O1(s)}return a}s=c,c=s.parentNode}return null}function Ja(s){if(s=s[Ft]||s[Tn]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function oo(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(i(33))}function Qa(s){var a=s[hg];return a||(a=s[hg]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function bn(s){s[ro]=!0}var fg=new Set,mg={};function ya(s,a){Xa(s,a),Xa(s+"Capture",a)}function Xa(s,a){for(mg[s]=a,s=0;s<a.length;s++)fg.add(a[s])}var v4=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),pg={},gg={};function y4(s){return fe.call(gg,s)?!0:fe.call(pg,s)?!1:v4.test(s)?gg[s]=!0:(pg[s]=!0,!1)}function Bl(s,a,c){if(y4(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var h=a.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function Fl(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function as(s,a,c,h){if(h===null)s.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+h)}}function pi(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function vg(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function b4(s,a,c){var h=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,y=h.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return g.call(this)},set:function(T){c=""+T,y.call(this,T)}}),Object.defineProperty(s,a,{enumerable:h.enumerable}),{getValue:function(){return c},setValue:function(T){c=""+T},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Ed(s){if(!s._valueTracker){var a=vg(s)?"checked":"value";s._valueTracker=b4(s,a,""+s[a])}}function yg(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),h="";return s&&(h=vg(s)?s.checked?"true":"false":s.value),s=h,s!==c?(a.setValue(s),!0):!1}function zl(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var C4=/[\n"\\]/g;function gi(s){return s.replace(C4,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function wd(s,a,c,h,g,y,T,M){s.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?s.type=T:s.removeAttribute("type"),a!=null?T==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+pi(a)):s.value!==""+pi(a)&&(s.value=""+pi(a)):T!=="submit"&&T!=="reset"||s.removeAttribute("value"),a!=null?jd(s,T,pi(a)):c!=null?jd(s,T,pi(c)):h!=null&&s.removeAttribute("value"),g==null&&y!=null&&(s.defaultChecked=!!y),g!=null&&(s.checked=g&&typeof g!="function"&&typeof g!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?s.name=""+pi(M):s.removeAttribute("name")}function bg(s,a,c,h,g,y,T,M){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(s.type=y),a!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||a!=null)){Ed(s);return}c=c!=null?""+pi(c):"",a=a!=null?""+pi(a):c,M||a===s.value||(s.value=a),s.defaultValue=a}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,s.checked=M?s.checked:!!h,s.defaultChecked=!!h,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(s.name=T),Ed(s)}function jd(s,a,c){a==="number"&&zl(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function er(s,a,c,h){if(s=s.options,a){a={};for(var g=0;g<c.length;g++)a["$"+c[g]]=!0;for(c=0;c<s.length;c++)g=a.hasOwnProperty("$"+s[c].value),s[c].selected!==g&&(s[c].selected=g),g&&h&&(s[c].defaultSelected=!0)}else{for(c=""+pi(c),a=null,g=0;g<s.length;g++){if(s[g].value===c){s[g].selected=!0,h&&(s[g].defaultSelected=!0);return}a!==null||s[g].disabled||(a=s[g])}a!==null&&(a.selected=!0)}}function Cg(s,a,c){if(a!=null&&(a=""+pi(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+pi(c):""}function xg(s,a,c,h){if(a==null){if(h!=null){if(c!=null)throw Error(i(92));if(ue(h)){if(1<h.length)throw Error(i(93));h=h[0]}c=h}c==null&&(c=""),a=c}c=pi(a),s.defaultValue=c,h=s.textContent,h===c&&h!==""&&h!==null&&(s.value=h),Ed(s)}function tr(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var x4=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Sg(s,a,c){var h=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?h?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":h?s.setProperty(a,c):typeof c!="number"||c===0||x4.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function kg(s,a,c){if(a!=null&&typeof a!="object")throw Error(i(62));if(s=s.style,c!=null){for(var h in c)!c.hasOwnProperty(h)||a!=null&&a.hasOwnProperty(h)||(h.indexOf("--")===0?s.setProperty(h,""):h==="float"?s.cssFloat="":s[h]="");for(var g in a)h=a[g],a.hasOwnProperty(g)&&c[g]!==h&&Sg(s,g,h)}else for(var y in a)a.hasOwnProperty(y)&&Sg(s,y,a[y])}function Rd(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var S4=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),k4=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ql(s){return k4.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function rs(){}var Nd=null;function _d(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var nr=null,ir=null;function Tg(s){var a=Ja(s);if(a&&(s=a.stateNode)){var c=s[sn]||null;e:switch(s=a.stateNode,a.type){case"input":if(wd(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+gi(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var h=c[a];if(h!==s&&h.form===s.form){var g=h[sn]||null;if(!g)throw Error(i(90));wd(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(a=0;a<c.length;a++)h=c[a],h.form===s.form&&yg(h)}break e;case"textarea":Cg(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&er(s,!!c.multiple,a,!1)}}}var Ad=!1;function Eg(s,a,c){if(Ad)return s(a,c);Ad=!0;try{var h=s(a);return h}finally{if(Ad=!1,(nr!==null||ir!==null)&&(Nc(),nr&&(a=nr,s=ir,ir=nr=null,Tg(a),s)))for(a=0;a<s.length;a++)Tg(s[a])}}function lo(s,a){var c=s.stateNode;if(c===null)return null;var h=c[sn]||null;if(h===null)return null;c=h[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(s=s.type,h=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!h;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(i(231,a,typeof c));return c}var os=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Md=!1;if(os)try{var co={};Object.defineProperty(co,"passive",{get:function(){Md=!0}}),window.addEventListener("test",co,co),window.removeEventListener("test",co,co)}catch{Md=!1}var Ds=null,Od=null,Vl=null;function wg(){if(Vl)return Vl;var s,a=Od,c=a.length,h,g="value"in Ds?Ds.value:Ds.textContent,y=g.length;for(s=0;s<c&&a[s]===g[s];s++);var T=c-s;for(h=1;h<=T&&a[c-h]===g[y-h];h++);return Vl=g.slice(s,1<h?1-h:void 0)}function Hl(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function $l(){return!0}function jg(){return!1}function Vn(s){function a(c,h,g,y,T){this._reactName=c,this._targetInst=g,this.type=h,this.nativeEvent=y,this.target=T,this.currentTarget=null;for(var M in s)s.hasOwnProperty(M)&&(c=s[M],this[M]=c?c(y):y[M]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?$l:jg,this.isPropagationStopped=jg,this}return v(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=$l)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=$l)},persist:function(){},isPersistent:$l}),a}var ba={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gl=Vn(ba),uo=v({},ba,{view:0,detail:0}),T4=Vn(uo),Dd,Ld,ho,Kl=v({},uo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Id,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ho&&(ho&&s.type==="mousemove"?(Dd=s.screenX-ho.screenX,Ld=s.screenY-ho.screenY):Ld=Dd=0,ho=s),Dd)},movementY:function(s){return"movementY"in s?s.movementY:Ld}}),Rg=Vn(Kl),E4=v({},Kl,{dataTransfer:0}),w4=Vn(E4),j4=v({},uo,{relatedTarget:0}),Pd=Vn(j4),R4=v({},ba,{animationName:0,elapsedTime:0,pseudoElement:0}),N4=Vn(R4),_4=v({},ba,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),A4=Vn(_4),M4=v({},ba,{data:0}),Ng=Vn(M4),O4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},D4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},L4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function P4(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=L4[s])?!!a[s]:!1}function Id(){return P4}var I4=v({},uo,{key:function(s){if(s.key){var a=O4[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Hl(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?D4[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Id,charCode:function(s){return s.type==="keypress"?Hl(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Hl(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),U4=Vn(I4),B4=v({},Kl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_g=Vn(B4),F4=v({},uo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Id}),z4=Vn(F4),q4=v({},ba,{propertyName:0,elapsedTime:0,pseudoElement:0}),V4=Vn(q4),H4=v({},Kl,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),$4=Vn(H4),G4=v({},ba,{newState:0,oldState:0}),K4=Vn(G4),W4=[9,13,27,32],Ud=os&&"CompositionEvent"in window,fo=null;os&&"documentMode"in document&&(fo=document.documentMode);var Z4=os&&"TextEvent"in window&&!fo,Ag=os&&(!Ud||fo&&8<fo&&11>=fo),Mg=" ",Og=!1;function Dg(s,a){switch(s){case"keyup":return W4.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Lg(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var sr=!1;function Y4(s,a){switch(s){case"compositionend":return Lg(a);case"keypress":return a.which!==32?null:(Og=!0,Mg);case"textInput":return s=a.data,s===Mg&&Og?null:s;default:return null}}function J4(s,a){if(sr)return s==="compositionend"||!Ud&&Dg(s,a)?(s=wg(),Vl=Od=Ds=null,sr=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ag&&a.locale!=="ko"?null:a.data;default:return null}}var Q4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pg(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!Q4[s.type]:a==="textarea"}function Ig(s,a,c,h){nr?ir?ir.push(h):ir=[h]:nr=h,a=Pc(a,"onChange"),0<a.length&&(c=new Gl("onChange","change",null,c,h),s.push({event:c,listeners:a}))}var mo=null,po=null;function X4(s){b1(s,0)}function Wl(s){var a=oo(s);if(yg(a))return s}function Ug(s,a){if(s==="change")return a}var Bg=!1;if(os){var Bd;if(os){var Fd="oninput"in document;if(!Fd){var Fg=document.createElement("div");Fg.setAttribute("oninput","return;"),Fd=typeof Fg.oninput=="function"}Bd=Fd}else Bd=!1;Bg=Bd&&(!document.documentMode||9<document.documentMode)}function zg(){mo&&(mo.detachEvent("onpropertychange",qg),po=mo=null)}function qg(s){if(s.propertyName==="value"&&Wl(po)){var a=[];Ig(a,po,s,_d(s)),Eg(X4,a)}}function ex(s,a,c){s==="focusin"?(zg(),mo=a,po=c,mo.attachEvent("onpropertychange",qg)):s==="focusout"&&zg()}function tx(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Wl(po)}function nx(s,a){if(s==="click")return Wl(a)}function ix(s,a){if(s==="input"||s==="change")return Wl(a)}function sx(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var si=typeof Object.is=="function"?Object.is:sx;function go(s,a){if(si(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),h=Object.keys(a);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var g=c[h];if(!fe.call(a,g)||!si(s[g],a[g]))return!1}return!0}function Vg(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Hg(s,a){var c=Vg(s);s=0;for(var h;c;){if(c.nodeType===3){if(h=s+c.textContent.length,s<=a&&h>=a)return{node:c,offset:a-s};s=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Vg(c)}}function $g(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?$g(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function Gg(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=zl(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=zl(s.document)}return a}function zd(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var ax=os&&"documentMode"in document&&11>=document.documentMode,ar=null,qd=null,vo=null,Vd=!1;function Kg(s,a,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Vd||ar==null||ar!==zl(h)||(h=ar,"selectionStart"in h&&zd(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),vo&&go(vo,h)||(vo=h,h=Pc(qd,"onSelect"),0<h.length&&(a=new Gl("onSelect","select",null,a,c),s.push({event:a,listeners:h}),a.target=ar)))}function Ca(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var rr={animationend:Ca("Animation","AnimationEnd"),animationiteration:Ca("Animation","AnimationIteration"),animationstart:Ca("Animation","AnimationStart"),transitionrun:Ca("Transition","TransitionRun"),transitionstart:Ca("Transition","TransitionStart"),transitioncancel:Ca("Transition","TransitionCancel"),transitionend:Ca("Transition","TransitionEnd")},Hd={},Wg={};os&&(Wg=document.createElement("div").style,"AnimationEvent"in window||(delete rr.animationend.animation,delete rr.animationiteration.animation,delete rr.animationstart.animation),"TransitionEvent"in window||delete rr.transitionend.transition);function xa(s){if(Hd[s])return Hd[s];if(!rr[s])return s;var a=rr[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in Wg)return Hd[s]=a[c];return s}var Zg=xa("animationend"),Yg=xa("animationiteration"),Jg=xa("animationstart"),rx=xa("transitionrun"),ox=xa("transitionstart"),lx=xa("transitioncancel"),Qg=xa("transitionend"),Xg=new Map,$d="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");$d.push("scrollEnd");function Ai(s,a){Xg.set(s,a),ya(a,[s])}var Zl=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},vi=[],or=0,Gd=0;function Yl(){for(var s=or,a=Gd=or=0;a<s;){var c=vi[a];vi[a++]=null;var h=vi[a];vi[a++]=null;var g=vi[a];vi[a++]=null;var y=vi[a];if(vi[a++]=null,h!==null&&g!==null){var T=h.pending;T===null?g.next=g:(g.next=T.next,T.next=g),h.pending=g}y!==0&&e0(c,g,y)}}function Jl(s,a,c,h){vi[or++]=s,vi[or++]=a,vi[or++]=c,vi[or++]=h,Gd|=h,s.lanes|=h,s=s.alternate,s!==null&&(s.lanes|=h)}function Kd(s,a,c,h){return Jl(s,a,c,h),Ql(s)}function Sa(s,a){return Jl(s,null,null,a),Ql(s)}function e0(s,a,c){s.lanes|=c;var h=s.alternate;h!==null&&(h.lanes|=c);for(var g=!1,y=s.return;y!==null;)y.childLanes|=c,h=y.alternate,h!==null&&(h.childLanes|=c),y.tag===22&&(s=y.stateNode,s===null||s._visibility&1||(g=!0)),s=y,y=y.return;return s.tag===3?(y=s.stateNode,g&&a!==null&&(g=31-qt(c),s=y.hiddenUpdates,h=s[g],h===null?s[g]=[a]:h.push(a),a.lane=c|536870912),y):null}function Ql(s){if(50<Bo)throw Bo=0,nf=null,Error(i(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var lr={};function cx(s,a,c,h){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ai(s,a,c,h){return new cx(s,a,c,h)}function Wd(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ls(s,a){var c=s.alternate;return c===null?(c=ai(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function t0(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Xl(s,a,c,h,g,y){var T=0;if(h=s,typeof s=="function")Wd(s)&&(T=1);else if(typeof s=="string")T=mS(s,c,le.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case F:return s=ai(31,c,a,g),s.elementType=F,s.lanes=y,s;case k:return ka(c.children,g,y,a);case E:T=8,g|=24;break;case _:return s=ai(12,c,a,g|2),s.elementType=_,s.lanes=y,s;case j:return s=ai(13,c,a,g),s.elementType=j,s.lanes=y,s;case R:return s=ai(19,c,a,g),s.elementType=R,s.lanes=y,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case A:T=10;break e;case O:T=9;break e;case w:T=11;break e;case N:T=14;break e;case L:T=16,h=null;break e}T=29,c=Error(i(130,s===null?"null":typeof s,"")),h=null}return a=ai(T,c,a,g),a.elementType=s,a.type=h,a.lanes=y,a}function ka(s,a,c,h){return s=ai(7,s,h,a),s.lanes=c,s}function Zd(s,a,c){return s=ai(6,s,null,a),s.lanes=c,s}function n0(s){var a=ai(18,null,null,0);return a.stateNode=s,a}function Yd(s,a,c){return a=ai(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var i0=new WeakMap;function yi(s,a){if(typeof s=="object"&&s!==null){var c=i0.get(s);return c!==void 0?c:(a={value:s,source:a,stack:se(a)},i0.set(s,a),a)}return{value:s,source:a,stack:se(a)}}var cr=[],ur=0,ec=null,yo=0,bi=[],Ci=0,Ls=null,Gi=1,Ki="";function cs(s,a){cr[ur++]=yo,cr[ur++]=ec,ec=s,yo=a}function s0(s,a,c){bi[Ci++]=Gi,bi[Ci++]=Ki,bi[Ci++]=Ls,Ls=s;var h=Gi;s=Ki;var g=32-qt(h)-1;h&=~(1<<g),c+=1;var y=32-qt(a)+g;if(30<y){var T=g-g%5;y=(h&(1<<T)-1).toString(32),h>>=T,g-=T,Gi=1<<32-qt(a)+g|c<<g|h,Ki=y+s}else Gi=1<<y|c<<g|h,Ki=s}function Jd(s){s.return!==null&&(cs(s,1),s0(s,1,0))}function Qd(s){for(;s===ec;)ec=cr[--ur],cr[ur]=null,yo=cr[--ur],cr[ur]=null;for(;s===Ls;)Ls=bi[--Ci],bi[Ci]=null,Ki=bi[--Ci],bi[Ci]=null,Gi=bi[--Ci],bi[Ci]=null}function a0(s,a){bi[Ci++]=Gi,bi[Ci++]=Ki,bi[Ci++]=Ls,Gi=a.id,Ki=a.overflow,Ls=s}var En=null,Mt=null,dt=!1,Ps=null,xi=!1,Xd=Error(i(519));function Is(s){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw bo(yi(a,s)),Xd}function r0(s){var a=s.stateNode,c=s.type,h=s.memoizedProps;switch(a[Ft]=s,a[sn]=h,c){case"dialog":nt("cancel",a),nt("close",a);break;case"iframe":case"object":case"embed":nt("load",a);break;case"video":case"audio":for(c=0;c<zo.length;c++)nt(zo[c],a);break;case"source":nt("error",a);break;case"img":case"image":case"link":nt("error",a),nt("load",a);break;case"details":nt("toggle",a);break;case"input":nt("invalid",a),bg(a,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":nt("invalid",a);break;case"textarea":nt("invalid",a),xg(a,h.value,h.defaultValue,h.children)}c=h.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||h.suppressHydrationWarning===!0||k1(a.textContent,c)?(h.popover!=null&&(nt("beforetoggle",a),nt("toggle",a)),h.onScroll!=null&&nt("scroll",a),h.onScrollEnd!=null&&nt("scrollend",a),h.onClick!=null&&(a.onclick=rs),a=!0):a=!1,a||Is(s,!0)}function o0(s){for(En=s.return;En;)switch(En.tag){case 5:case 31:case 13:xi=!1;return;case 27:case 3:xi=!0;return;default:En=En.return}}function dr(s){if(s!==En)return!1;if(!dt)return o0(s),dt=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||yf(s.type,s.memoizedProps)),c=!c),c&&Mt&&Is(s),o0(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));Mt=M1(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));Mt=M1(s)}else a===27?(a=Mt,Js(s.type)?(s=kf,kf=null,Mt=s):Mt=a):Mt=En?ki(s.stateNode.nextSibling):null;return!0}function Ta(){Mt=En=null,dt=!1}function eh(){var s=Ps;return s!==null&&(Kn===null?Kn=s:Kn.push.apply(Kn,s),Ps=null),s}function bo(s){Ps===null?Ps=[s]:Ps.push(s)}var th=P(null),Ea=null,us=null;function Us(s,a,c){ae(th,a._currentValue),a._currentValue=c}function ds(s){s._currentValue=th.current,K(th)}function nh(s,a,c){for(;s!==null;){var h=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,h!==null&&(h.childLanes|=a)):h!==null&&(h.childLanes&a)!==a&&(h.childLanes|=a),s===c)break;s=s.return}}function ih(s,a,c,h){var g=s.child;for(g!==null&&(g.return=s);g!==null;){var y=g.dependencies;if(y!==null){var T=g.child;y=y.firstContext;e:for(;y!==null;){var M=y;y=g;for(var z=0;z<a.length;z++)if(M.context===a[z]){y.lanes|=c,M=y.alternate,M!==null&&(M.lanes|=c),nh(y.return,c,s),h||(T=null);break e}y=M.next}}else if(g.tag===18){if(T=g.return,T===null)throw Error(i(341));T.lanes|=c,y=T.alternate,y!==null&&(y.lanes|=c),nh(T,c,s),T=null}else T=g.child;if(T!==null)T.return=g;else for(T=g;T!==null;){if(T===s){T=null;break}if(g=T.sibling,g!==null){g.return=T.return,T=g;break}T=T.return}g=T}}function hr(s,a,c,h){s=null;for(var g=a,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var T=g.alternate;if(T===null)throw Error(i(387));if(T=T.memoizedProps,T!==null){var M=g.type;si(g.pendingProps.value,T.value)||(s!==null?s.push(M):s=[M])}}else if(g===_e.current){if(T=g.alternate,T===null)throw Error(i(387));T.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(s!==null?s.push(Go):s=[Go])}g=g.return}s!==null&&ih(a,s,c,h),a.flags|=262144}function tc(s){for(s=s.firstContext;s!==null;){if(!si(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function wa(s){Ea=s,us=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function wn(s){return l0(Ea,s)}function nc(s,a){return Ea===null&&wa(s),l0(s,a)}function l0(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},us===null){if(s===null)throw Error(i(308));us=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else us=us.next=a;return c}var ux=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,h){s.push(h)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},dx=t.unstable_scheduleCallback,hx=t.unstable_NormalPriority,an={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function sh(){return{controller:new ux,data:new Map,refCount:0}}function Co(s){s.refCount--,s.refCount===0&&dx(hx,function(){s.controller.abort()})}var xo=null,ah=0,fr=0,mr=null;function fx(s,a){if(xo===null){var c=xo=[];ah=0,fr=cf(),mr={status:"pending",value:void 0,then:function(h){c.push(h)}}}return ah++,a.then(c0,c0),a}function c0(){if(--ah===0&&xo!==null){mr!==null&&(mr.status="fulfilled");var s=xo;xo=null,fr=0,mr=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function mx(s,a){var c=[],h={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return s.then(function(){h.status="fulfilled",h.value=a;for(var g=0;g<c.length;g++)(0,c[g])(a)},function(g){for(h.status="rejected",h.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),h}var u0=q.S;q.S=function(s,a){Kv=Je(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&fx(s,a),u0!==null&&u0(s,a)};var ja=P(null);function rh(){var s=ja.current;return s!==null?s:Nt.pooledCache}function ic(s,a){a===null?ae(ja,ja.current):ae(ja,a.pool)}function d0(){var s=rh();return s===null?null:{parent:an._currentValue,pool:s}}var pr=Error(i(460)),oh=Error(i(474)),sc=Error(i(542)),ac={then:function(){}};function h0(s){return s=s.status,s==="fulfilled"||s==="rejected"}function f0(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(rs,rs),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,p0(s),s;default:if(typeof a.status=="string")a.then(rs,rs);else{if(s=Nt,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=a,s.status="pending",s.then(function(h){if(a.status==="pending"){var g=a;g.status="fulfilled",g.value=h}},function(h){if(a.status==="pending"){var g=a;g.status="rejected",g.reason=h}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,p0(s),s}throw Na=a,pr}}function Ra(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Na=c,pr):c}}var Na=null;function m0(){if(Na===null)throw Error(i(459));var s=Na;return Na=null,s}function p0(s){if(s===pr||s===sc)throw Error(i(483))}var gr=null,So=0;function rc(s){var a=So;return So+=1,gr===null&&(gr=[]),f0(gr,s,a)}function ko(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function oc(s,a){throw a.$$typeof===C?Error(i(525)):(s=Object.prototype.toString.call(a),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function g0(s){function a($,H){if(s){var W=$.deletions;W===null?($.deletions=[H],$.flags|=16):W.push(H)}}function c($,H){if(!s)return null;for(;H!==null;)a($,H),H=H.sibling;return null}function h($){for(var H=new Map;$!==null;)$.key!==null?H.set($.key,$):H.set($.index,$),$=$.sibling;return H}function g($,H){return $=ls($,H),$.index=0,$.sibling=null,$}function y($,H,W){return $.index=W,s?(W=$.alternate,W!==null?(W=W.index,W<H?($.flags|=67108866,H):W):($.flags|=67108866,H)):($.flags|=1048576,H)}function T($){return s&&$.alternate===null&&($.flags|=67108866),$}function M($,H,W,de){return H===null||H.tag!==6?(H=Zd(W,$.mode,de),H.return=$,H):(H=g(H,W),H.return=$,H)}function z($,H,W,de){var Ie=W.type;return Ie===k?oe($,H,W.props.children,de,W.key):H!==null&&(H.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===L&&Ra(Ie)===H.type)?(H=g(H,W.props),ko(H,W),H.return=$,H):(H=Xl(W.type,W.key,W.props,null,$.mode,de),ko(H,W),H.return=$,H)}function Y($,H,W,de){return H===null||H.tag!==4||H.stateNode.containerInfo!==W.containerInfo||H.stateNode.implementation!==W.implementation?(H=Yd(W,$.mode,de),H.return=$,H):(H=g(H,W.children||[]),H.return=$,H)}function oe($,H,W,de,Ie){return H===null||H.tag!==7?(H=ka(W,$.mode,de,Ie),H.return=$,H):(H=g(H,W),H.return=$,H)}function me($,H,W){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return H=Zd(""+H,$.mode,W),H.return=$,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case x:return W=Xl(H.type,H.key,H.props,null,$.mode,W),ko(W,H),W.return=$,W;case S:return H=Yd(H,$.mode,W),H.return=$,H;case L:return H=Ra(H),me($,H,W)}if(ue(H)||B(H))return H=ka(H,$.mode,W,null),H.return=$,H;if(typeof H.then=="function")return me($,rc(H),W);if(H.$$typeof===A)return me($,nc($,H),W);oc($,H)}return null}function X($,H,W,de){var Ie=H!==null?H.key:null;if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return Ie!==null?null:M($,H,""+W,de);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case x:return W.key===Ie?z($,H,W,de):null;case S:return W.key===Ie?Y($,H,W,de):null;case L:return W=Ra(W),X($,H,W,de)}if(ue(W)||B(W))return Ie!==null?null:oe($,H,W,de,null);if(typeof W.then=="function")return X($,H,rc(W),de);if(W.$$typeof===A)return X($,H,nc($,W),de);oc($,W)}return null}function ne($,H,W,de,Ie){if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return $=$.get(W)||null,M(H,$,""+de,Ie);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case x:return $=$.get(de.key===null?W:de.key)||null,z(H,$,de,Ie);case S:return $=$.get(de.key===null?W:de.key)||null,Y(H,$,de,Ie);case L:return de=Ra(de),ne($,H,W,de,Ie)}if(ue(de)||B(de))return $=$.get(W)||null,oe(H,$,de,Ie,null);if(typeof de.then=="function")return ne($,H,W,rc(de),Ie);if(de.$$typeof===A)return ne($,H,W,nc(H,de),Ie);oc(H,de)}return null}function Oe($,H,W,de){for(var Ie=null,gt=null,De=H,Qe=H=0,lt=null;De!==null&&Qe<W.length;Qe++){De.index>Qe?(lt=De,De=null):lt=De.sibling;var vt=X($,De,W[Qe],de);if(vt===null){De===null&&(De=lt);break}s&&De&&vt.alternate===null&&a($,De),H=y(vt,H,Qe),gt===null?Ie=vt:gt.sibling=vt,gt=vt,De=lt}if(Qe===W.length)return c($,De),dt&&cs($,Qe),Ie;if(De===null){for(;Qe<W.length;Qe++)De=me($,W[Qe],de),De!==null&&(H=y(De,H,Qe),gt===null?Ie=De:gt.sibling=De,gt=De);return dt&&cs($,Qe),Ie}for(De=h(De);Qe<W.length;Qe++)lt=ne(De,$,Qe,W[Qe],de),lt!==null&&(s&&lt.alternate!==null&&De.delete(lt.key===null?Qe:lt.key),H=y(lt,H,Qe),gt===null?Ie=lt:gt.sibling=lt,gt=lt);return s&&De.forEach(function(na){return a($,na)}),dt&&cs($,Qe),Ie}function ze($,H,W,de){if(W==null)throw Error(i(151));for(var Ie=null,gt=null,De=H,Qe=H=0,lt=null,vt=W.next();De!==null&&!vt.done;Qe++,vt=W.next()){De.index>Qe?(lt=De,De=null):lt=De.sibling;var na=X($,De,vt.value,de);if(na===null){De===null&&(De=lt);break}s&&De&&na.alternate===null&&a($,De),H=y(na,H,Qe),gt===null?Ie=na:gt.sibling=na,gt=na,De=lt}if(vt.done)return c($,De),dt&&cs($,Qe),Ie;if(De===null){for(;!vt.done;Qe++,vt=W.next())vt=me($,vt.value,de),vt!==null&&(H=y(vt,H,Qe),gt===null?Ie=vt:gt.sibling=vt,gt=vt);return dt&&cs($,Qe),Ie}for(De=h(De);!vt.done;Qe++,vt=W.next())vt=ne(De,$,Qe,vt.value,de),vt!==null&&(s&&vt.alternate!==null&&De.delete(vt.key===null?Qe:vt.key),H=y(vt,H,Qe),gt===null?Ie=vt:gt.sibling=vt,gt=vt);return s&&De.forEach(function(ES){return a($,ES)}),dt&&cs($,Qe),Ie}function jt($,H,W,de){if(typeof W=="object"&&W!==null&&W.type===k&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case x:e:{for(var Ie=W.key;H!==null;){if(H.key===Ie){if(Ie=W.type,Ie===k){if(H.tag===7){c($,H.sibling),de=g(H,W.props.children),de.return=$,$=de;break e}}else if(H.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===L&&Ra(Ie)===H.type){c($,H.sibling),de=g(H,W.props),ko(de,W),de.return=$,$=de;break e}c($,H);break}else a($,H);H=H.sibling}W.type===k?(de=ka(W.props.children,$.mode,de,W.key),de.return=$,$=de):(de=Xl(W.type,W.key,W.props,null,$.mode,de),ko(de,W),de.return=$,$=de)}return T($);case S:e:{for(Ie=W.key;H!==null;){if(H.key===Ie)if(H.tag===4&&H.stateNode.containerInfo===W.containerInfo&&H.stateNode.implementation===W.implementation){c($,H.sibling),de=g(H,W.children||[]),de.return=$,$=de;break e}else{c($,H);break}else a($,H);H=H.sibling}de=Yd(W,$.mode,de),de.return=$,$=de}return T($);case L:return W=Ra(W),jt($,H,W,de)}if(ue(W))return Oe($,H,W,de);if(B(W)){if(Ie=B(W),typeof Ie!="function")throw Error(i(150));return W=Ie.call(W),ze($,H,W,de)}if(typeof W.then=="function")return jt($,H,rc(W),de);if(W.$$typeof===A)return jt($,H,nc($,W),de);oc($,W)}return typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint"?(W=""+W,H!==null&&H.tag===6?(c($,H.sibling),de=g(H,W),de.return=$,$=de):(c($,H),de=Zd(W,$.mode,de),de.return=$,$=de),T($)):c($,H)}return function($,H,W,de){try{So=0;var Ie=jt($,H,W,de);return gr=null,Ie}catch(De){if(De===pr||De===sc)throw De;var gt=ai(29,De,null,$.mode);return gt.lanes=de,gt.return=$,gt}finally{}}}var _a=g0(!0),v0=g0(!1),Bs=!1;function lh(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ch(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Fs(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function zs(s,a,c){var h=s.updateQueue;if(h===null)return null;if(h=h.shared,(bt&2)!==0){var g=h.pending;return g===null?a.next=a:(a.next=g.next,g.next=a),h.pending=a,a=Ql(s),e0(s,null,c),a}return Jl(s,h,a,c),Ql(s)}function To(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var h=a.lanes;h&=s.pendingLanes,c|=h,a.lanes=c,ke(s,c)}}function uh(s,a){var c=s.updateQueue,h=s.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var T={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?g=y=T:y=y.next=T,c=c.next}while(c!==null);y===null?g=y=a:y=y.next=a}else g=y=a;c={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:h.shared,callbacks:h.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var dh=!1;function Eo(){if(dh){var s=mr;if(s!==null)throw s}}function wo(s,a,c,h){dh=!1;var g=s.updateQueue;Bs=!1;var y=g.firstBaseUpdate,T=g.lastBaseUpdate,M=g.shared.pending;if(M!==null){g.shared.pending=null;var z=M,Y=z.next;z.next=null,T===null?y=Y:T.next=Y,T=z;var oe=s.alternate;oe!==null&&(oe=oe.updateQueue,M=oe.lastBaseUpdate,M!==T&&(M===null?oe.firstBaseUpdate=Y:M.next=Y,oe.lastBaseUpdate=z))}if(y!==null){var me=g.baseState;T=0,oe=Y=z=null,M=y;do{var X=M.lane&-536870913,ne=X!==M.lane;if(ne?(ot&X)===X:(h&X)===X){X!==0&&X===fr&&(dh=!0),oe!==null&&(oe=oe.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var Oe=s,ze=M;X=a;var jt=c;switch(ze.tag){case 1:if(Oe=ze.payload,typeof Oe=="function"){me=Oe.call(jt,me,X);break e}me=Oe;break e;case 3:Oe.flags=Oe.flags&-65537|128;case 0:if(Oe=ze.payload,X=typeof Oe=="function"?Oe.call(jt,me,X):Oe,X==null)break e;me=v({},me,X);break e;case 2:Bs=!0}}X=M.callback,X!==null&&(s.flags|=64,ne&&(s.flags|=8192),ne=g.callbacks,ne===null?g.callbacks=[X]:ne.push(X))}else ne={lane:X,tag:M.tag,payload:M.payload,callback:M.callback,next:null},oe===null?(Y=oe=ne,z=me):oe=oe.next=ne,T|=X;if(M=M.next,M===null){if(M=g.shared.pending,M===null)break;ne=M,M=ne.next,ne.next=null,g.lastBaseUpdate=ne,g.shared.pending=null}}while(!0);oe===null&&(z=me),g.baseState=z,g.firstBaseUpdate=Y,g.lastBaseUpdate=oe,y===null&&(g.shared.lanes=0),Gs|=T,s.lanes=T,s.memoizedState=me}}function y0(s,a){if(typeof s!="function")throw Error(i(191,s));s.call(a)}function b0(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)y0(c[s],a)}var vr=P(null),lc=P(0);function C0(s,a){s=Cs,ae(lc,s),ae(vr,a),Cs=s|a.baseLanes}function hh(){ae(lc,Cs),ae(vr,vr.current)}function fh(){Cs=lc.current,K(vr),K(lc)}var ri=P(null),Si=null;function qs(s){var a=s.alternate;ae(Yt,Yt.current&1),ae(ri,s),Si===null&&(a===null||vr.current!==null||a.memoizedState!==null)&&(Si=s)}function mh(s){ae(Yt,Yt.current),ae(ri,s),Si===null&&(Si=s)}function x0(s){s.tag===22?(ae(Yt,Yt.current),ae(ri,s),Si===null&&(Si=s)):Vs()}function Vs(){ae(Yt,Yt.current),ae(ri,ri.current)}function oi(s){K(ri),Si===s&&(Si=null),K(Yt)}var Yt=P(0);function cc(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||xf(c)||Sf(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var hs=0,We=null,Et=null,rn=null,uc=!1,yr=!1,Aa=!1,dc=0,jo=0,br=null,px=0;function Vt(){throw Error(i(321))}function ph(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!si(s[c],a[c]))return!1;return!0}function gh(s,a,c,h,g,y){return hs=y,We=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,q.H=s===null||s.memoizedState===null?sv:Ah,Aa=!1,y=c(h,g),Aa=!1,yr&&(y=k0(a,c,h,g)),S0(s),y}function S0(s){q.H=_o;var a=Et!==null&&Et.next!==null;if(hs=0,rn=Et=We=null,uc=!1,jo=0,br=null,a)throw Error(i(300));s===null||on||(s=s.dependencies,s!==null&&tc(s)&&(on=!0))}function k0(s,a,c,h){We=s;var g=0;do{if(yr&&(br=null),jo=0,yr=!1,25<=g)throw Error(i(301));if(g+=1,rn=Et=null,s.updateQueue!=null){var y=s.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}q.H=av,y=a(c,h)}while(yr);return y}function gx(){var s=q.H,a=s.useState()[0];return a=typeof a.then=="function"?Ro(a):a,s=s.useState()[0],(Et!==null?Et.memoizedState:null)!==s&&(We.flags|=1024),a}function vh(){var s=dc!==0;return dc=0,s}function yh(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function bh(s){if(uc){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}uc=!1}hs=0,rn=Et=We=null,yr=!1,jo=dc=0,br=null}function Pn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rn===null?We.memoizedState=rn=s:rn=rn.next=s,rn}function Jt(){if(Et===null){var s=We.alternate;s=s!==null?s.memoizedState:null}else s=Et.next;var a=rn===null?We.memoizedState:rn.next;if(a!==null)rn=a,Et=s;else{if(s===null)throw We.alternate===null?Error(i(467)):Error(i(310));Et=s,s={memoizedState:Et.memoizedState,baseState:Et.baseState,baseQueue:Et.baseQueue,queue:Et.queue,next:null},rn===null?We.memoizedState=rn=s:rn=rn.next=s}return rn}function hc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ro(s){var a=jo;return jo+=1,br===null&&(br=[]),s=f0(br,s,a),a=We,(rn===null?a.memoizedState:rn.next)===null&&(a=a.alternate,q.H=a===null||a.memoizedState===null?sv:Ah),s}function fc(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Ro(s);if(s.$$typeof===A)return wn(s)}throw Error(i(438,String(s)))}function Ch(s){var a=null,c=We.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var h=We.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(a={data:h.data.map(function(g){return g.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=hc(),We.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),h=0;h<s;h++)c[h]=D;return a.index++,c}function fs(s,a){return typeof a=="function"?a(s):a}function mc(s){var a=Jt();return xh(a,Et,s)}function xh(s,a,c){var h=s.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=c;var g=s.baseQueue,y=h.pending;if(y!==null){if(g!==null){var T=g.next;g.next=y.next,y.next=T}a.baseQueue=g=y,h.pending=null}if(y=s.baseState,g===null)s.memoizedState=y;else{a=g.next;var M=T=null,z=null,Y=a,oe=!1;do{var me=Y.lane&-536870913;if(me!==Y.lane?(ot&me)===me:(hs&me)===me){var X=Y.revertLane;if(X===0)z!==null&&(z=z.next={lane:0,revertLane:0,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),me===fr&&(oe=!0);else if((hs&X)===X){Y=Y.next,X===fr&&(oe=!0);continue}else me={lane:0,revertLane:Y.revertLane,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},z===null?(M=z=me,T=y):z=z.next=me,We.lanes|=X,Gs|=X;me=Y.action,Aa&&c(y,me),y=Y.hasEagerState?Y.eagerState:c(y,me)}else X={lane:me,revertLane:Y.revertLane,gesture:Y.gesture,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},z===null?(M=z=X,T=y):z=z.next=X,We.lanes|=me,Gs|=me;Y=Y.next}while(Y!==null&&Y!==a);if(z===null?T=y:z.next=M,!si(y,s.memoizedState)&&(on=!0,oe&&(c=mr,c!==null)))throw c;s.memoizedState=y,s.baseState=T,s.baseQueue=z,h.lastRenderedState=y}return g===null&&(h.lanes=0),[s.memoizedState,h.dispatch]}function Sh(s){var a=Jt(),c=a.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=s;var h=c.dispatch,g=c.pending,y=a.memoizedState;if(g!==null){c.pending=null;var T=g=g.next;do y=s(y,T.action),T=T.next;while(T!==g);si(y,a.memoizedState)||(on=!0),a.memoizedState=y,a.baseQueue===null&&(a.baseState=y),c.lastRenderedState=y}return[y,h]}function T0(s,a,c){var h=We,g=Jt(),y=dt;if(y){if(c===void 0)throw Error(i(407));c=c()}else c=a();var T=!si((Et||g).memoizedState,c);if(T&&(g.memoizedState=c,on=!0),g=g.queue,Eh(j0.bind(null,h,g,s),[s]),g.getSnapshot!==a||T||rn!==null&&rn.memoizedState.tag&1){if(h.flags|=2048,Cr(9,{destroy:void 0},w0.bind(null,h,g,c,a),null),Nt===null)throw Error(i(349));y||(hs&127)!==0||E0(h,a,c)}return c}function E0(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=We.updateQueue,a===null?(a=hc(),We.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function w0(s,a,c,h){a.value=c,a.getSnapshot=h,R0(a)&&N0(s)}function j0(s,a,c){return c(function(){R0(a)&&N0(s)})}function R0(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!si(s,c)}catch{return!0}}function N0(s){var a=Sa(s,2);a!==null&&Wn(a,s,2)}function kh(s){var a=Pn();if(typeof s=="function"){var c=s;if(s=c(),Aa){Ln(!0);try{c()}finally{Ln(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:s},a}function _0(s,a,c,h){return s.baseState=c,xh(s,Et,typeof h=="function"?h:fs)}function vx(s,a,c,h,g){if(vc(s))throw Error(i(485));if(s=a.action,s!==null){var y={payload:g,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){y.listeners.push(T)}};q.T!==null?c(!0):y.isTransition=!1,h(y),c=a.pending,c===null?(y.next=a.pending=y,A0(a,y)):(y.next=c.next,a.pending=c.next=y)}}function A0(s,a){var c=a.action,h=a.payload,g=s.state;if(a.isTransition){var y=q.T,T={};q.T=T;try{var M=c(g,h),z=q.S;z!==null&&z(T,M),M0(s,a,M)}catch(Y){Th(s,a,Y)}finally{y!==null&&T.types!==null&&(y.types=T.types),q.T=y}}else try{y=c(g,h),M0(s,a,y)}catch(Y){Th(s,a,Y)}}function M0(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(h){O0(s,a,h)},function(h){return Th(s,a,h)}):O0(s,a,c)}function O0(s,a,c){a.status="fulfilled",a.value=c,D0(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,A0(s,c)))}function Th(s,a,c){var h=s.pending;if(s.pending=null,h!==null){h=h.next;do a.status="rejected",a.reason=c,D0(a),a=a.next;while(a!==h)}s.action=null}function D0(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function L0(s,a){return a}function P0(s,a){if(dt){var c=Nt.formState;if(c!==null){e:{var h=We;if(dt){if(Mt){t:{for(var g=Mt,y=xi;g.nodeType!==8;){if(!y){g=null;break t}if(g=ki(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){Mt=ki(g.nextSibling),h=g.data==="F!";break e}}Is(h)}h=!1}h&&(a=c[0])}}return c=Pn(),c.memoizedState=c.baseState=a,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:L0,lastRenderedState:a},c.queue=h,c=tv.bind(null,We,h),h.dispatch=c,h=kh(!1),y=_h.bind(null,We,!1,h.queue),h=Pn(),g={state:a,dispatch:null,action:s,pending:null},h.queue=g,c=vx.bind(null,We,g,y,c),g.dispatch=c,h.memoizedState=s,[a,c,!1]}function I0(s){var a=Jt();return U0(a,Et,s)}function U0(s,a,c){if(a=xh(s,a,L0)[0],s=mc(fs)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var h=Ro(a)}catch(T){throw T===pr?sc:T}else h=a;a=Jt();var g=a.queue,y=g.dispatch;return c!==a.memoizedState&&(We.flags|=2048,Cr(9,{destroy:void 0},yx.bind(null,g,c),null)),[h,y,s]}function yx(s,a){s.action=a}function B0(s){var a=Jt(),c=Et;if(c!==null)return U0(a,c,s);Jt(),a=a.memoizedState,c=Jt();var h=c.queue.dispatch;return c.memoizedState=s,[a,h,!1]}function Cr(s,a,c,h){return s={tag:s,create:c,deps:h,inst:a,next:null},a=We.updateQueue,a===null&&(a=hc(),We.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(h=c.next,c.next=s,s.next=h,a.lastEffect=s),s}function F0(){return Jt().memoizedState}function pc(s,a,c,h){var g=Pn();We.flags|=s,g.memoizedState=Cr(1|a,{destroy:void 0},c,h===void 0?null:h)}function gc(s,a,c,h){var g=Jt();h=h===void 0?null:h;var y=g.memoizedState.inst;Et!==null&&h!==null&&ph(h,Et.memoizedState.deps)?g.memoizedState=Cr(a,y,c,h):(We.flags|=s,g.memoizedState=Cr(1|a,y,c,h))}function z0(s,a){pc(8390656,8,s,a)}function Eh(s,a){gc(2048,8,s,a)}function bx(s){We.flags|=4;var a=We.updateQueue;if(a===null)a=hc(),We.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function q0(s){var a=Jt().memoizedState;return bx({ref:a,nextImpl:s}),function(){if((bt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function V0(s,a){return gc(4,2,s,a)}function H0(s,a){return gc(4,4,s,a)}function $0(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function G0(s,a,c){c=c!=null?c.concat([s]):null,gc(4,4,$0.bind(null,a,s),c)}function wh(){}function K0(s,a){var c=Jt();a=a===void 0?null:a;var h=c.memoizedState;return a!==null&&ph(a,h[1])?h[0]:(c.memoizedState=[s,a],s)}function W0(s,a){var c=Jt();a=a===void 0?null:a;var h=c.memoizedState;if(a!==null&&ph(a,h[1]))return h[0];if(h=s(),Aa){Ln(!0);try{s()}finally{Ln(!1)}}return c.memoizedState=[h,a],h}function jh(s,a,c){return c===void 0||(hs&1073741824)!==0&&(ot&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=Zv(),We.lanes|=s,Gs|=s,c)}function Z0(s,a,c,h){return si(c,a)?c:vr.current!==null?(s=jh(s,c,h),si(s,a)||(on=!0),s):(hs&42)===0||(hs&1073741824)!==0&&(ot&261930)===0?(on=!0,s.memoizedState=c):(s=Zv(),We.lanes|=s,Gs|=s,a)}function Y0(s,a,c,h,g){var y=ee.p;ee.p=y!==0&&8>y?y:8;var T=q.T,M={};q.T=M,_h(s,!1,a,c);try{var z=g(),Y=q.S;if(Y!==null&&Y(M,z),z!==null&&typeof z=="object"&&typeof z.then=="function"){var oe=mx(z,h);No(s,a,oe,ui(s))}else No(s,a,h,ui(s))}catch(me){No(s,a,{then:function(){},status:"rejected",reason:me},ui())}finally{ee.p=y,T!==null&&M.types!==null&&(T.types=M.types),q.T=T}}function Cx(){}function Rh(s,a,c,h){if(s.tag!==5)throw Error(i(476));var g=J0(s).queue;Y0(s,g,a,re,c===null?Cx:function(){return Q0(s),c(h)})}function J0(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:re},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Q0(s){var a=J0(s);a.next===null&&(a=s.alternate.memoizedState),No(s,a.next.queue,{},ui())}function Nh(){return wn(Go)}function X0(){return Jt().memoizedState}function ev(){return Jt().memoizedState}function xx(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=ui();s=Fs(c);var h=zs(a,s,c);h!==null&&(Wn(h,a,c),To(h,a,c)),a={cache:sh()},s.payload=a;return}a=a.return}}function Sx(s,a,c){var h=ui();c={lane:h,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},vc(s)?nv(a,c):(c=Kd(s,a,c,h),c!==null&&(Wn(c,s,h),iv(c,a,h)))}function tv(s,a,c){var h=ui();No(s,a,c,h)}function No(s,a,c,h){var g={lane:h,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(vc(s))nv(a,g);else{var y=s.alternate;if(s.lanes===0&&(y===null||y.lanes===0)&&(y=a.lastRenderedReducer,y!==null))try{var T=a.lastRenderedState,M=y(T,c);if(g.hasEagerState=!0,g.eagerState=M,si(M,T))return Jl(s,a,g,0),Nt===null&&Yl(),!1}catch{}finally{}if(c=Kd(s,a,g,h),c!==null)return Wn(c,s,h),iv(c,a,h),!0}return!1}function _h(s,a,c,h){if(h={lane:2,revertLane:cf(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},vc(s)){if(a)throw Error(i(479))}else a=Kd(s,c,h,2),a!==null&&Wn(a,s,2)}function vc(s){var a=s.alternate;return s===We||a!==null&&a===We}function nv(s,a){yr=uc=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function iv(s,a,c){if((c&4194048)!==0){var h=a.lanes;h&=s.pendingLanes,c|=h,a.lanes=c,ke(s,c)}}var _o={readContext:wn,use:fc,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useLayoutEffect:Vt,useInsertionEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useSyncExternalStore:Vt,useId:Vt,useHostTransitionStatus:Vt,useFormState:Vt,useActionState:Vt,useOptimistic:Vt,useMemoCache:Vt,useCacheRefresh:Vt};_o.useEffectEvent=Vt;var sv={readContext:wn,use:fc,useCallback:function(s,a){return Pn().memoizedState=[s,a===void 0?null:a],s},useContext:wn,useEffect:z0,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,pc(4194308,4,$0.bind(null,a,s),c)},useLayoutEffect:function(s,a){return pc(4194308,4,s,a)},useInsertionEffect:function(s,a){pc(4,2,s,a)},useMemo:function(s,a){var c=Pn();a=a===void 0?null:a;var h=s();if(Aa){Ln(!0);try{s()}finally{Ln(!1)}}return c.memoizedState=[h,a],h},useReducer:function(s,a,c){var h=Pn();if(c!==void 0){var g=c(a);if(Aa){Ln(!0);try{c(a)}finally{Ln(!1)}}}else g=a;return h.memoizedState=h.baseState=g,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:g},h.queue=s,s=s.dispatch=Sx.bind(null,We,s),[h.memoizedState,s]},useRef:function(s){var a=Pn();return s={current:s},a.memoizedState=s},useState:function(s){s=kh(s);var a=s.queue,c=tv.bind(null,We,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:wh,useDeferredValue:function(s,a){var c=Pn();return jh(c,s,a)},useTransition:function(){var s=kh(!1);return s=Y0.bind(null,We,s.queue,!0,!1),Pn().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var h=We,g=Pn();if(dt){if(c===void 0)throw Error(i(407));c=c()}else{if(c=a(),Nt===null)throw Error(i(349));(ot&127)!==0||E0(h,a,c)}g.memoizedState=c;var y={value:c,getSnapshot:a};return g.queue=y,z0(j0.bind(null,h,y,s),[s]),h.flags|=2048,Cr(9,{destroy:void 0},w0.bind(null,h,y,c,a),null),c},useId:function(){var s=Pn(),a=Nt.identifierPrefix;if(dt){var c=Ki,h=Gi;c=(h&~(1<<32-qt(h)-1)).toString(32)+c,a="_"+a+"R_"+c,c=dc++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=px++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:Nh,useFormState:P0,useActionState:P0,useOptimistic:function(s){var a=Pn();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=_h.bind(null,We,!0,c),c.dispatch=a,[s,a]},useMemoCache:Ch,useCacheRefresh:function(){return Pn().memoizedState=xx.bind(null,We)},useEffectEvent:function(s){var a=Pn(),c={impl:s};return a.memoizedState=c,function(){if((bt&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},Ah={readContext:wn,use:fc,useCallback:K0,useContext:wn,useEffect:Eh,useImperativeHandle:G0,useInsertionEffect:V0,useLayoutEffect:H0,useMemo:W0,useReducer:mc,useRef:F0,useState:function(){return mc(fs)},useDebugValue:wh,useDeferredValue:function(s,a){var c=Jt();return Z0(c,Et.memoizedState,s,a)},useTransition:function(){var s=mc(fs)[0],a=Jt().memoizedState;return[typeof s=="boolean"?s:Ro(s),a]},useSyncExternalStore:T0,useId:X0,useHostTransitionStatus:Nh,useFormState:I0,useActionState:I0,useOptimistic:function(s,a){var c=Jt();return _0(c,Et,s,a)},useMemoCache:Ch,useCacheRefresh:ev};Ah.useEffectEvent=q0;var av={readContext:wn,use:fc,useCallback:K0,useContext:wn,useEffect:Eh,useImperativeHandle:G0,useInsertionEffect:V0,useLayoutEffect:H0,useMemo:W0,useReducer:Sh,useRef:F0,useState:function(){return Sh(fs)},useDebugValue:wh,useDeferredValue:function(s,a){var c=Jt();return Et===null?jh(c,s,a):Z0(c,Et.memoizedState,s,a)},useTransition:function(){var s=Sh(fs)[0],a=Jt().memoizedState;return[typeof s=="boolean"?s:Ro(s),a]},useSyncExternalStore:T0,useId:X0,useHostTransitionStatus:Nh,useFormState:B0,useActionState:B0,useOptimistic:function(s,a){var c=Jt();return Et!==null?_0(c,Et,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:Ch,useCacheRefresh:ev};av.useEffectEvent=q0;function Mh(s,a,c,h){a=s.memoizedState,c=c(h,a),c=c==null?a:v({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Oh={enqueueSetState:function(s,a,c){s=s._reactInternals;var h=ui(),g=Fs(h);g.payload=a,c!=null&&(g.callback=c),a=zs(s,g,h),a!==null&&(Wn(a,s,h),To(a,s,h))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var h=ui(),g=Fs(h);g.tag=1,g.payload=a,c!=null&&(g.callback=c),a=zs(s,g,h),a!==null&&(Wn(a,s,h),To(a,s,h))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=ui(),h=Fs(c);h.tag=2,a!=null&&(h.callback=a),a=zs(s,h,c),a!==null&&(Wn(a,s,c),To(a,s,c))}};function rv(s,a,c,h,g,y,T){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(h,y,T):a.prototype&&a.prototype.isPureReactComponent?!go(c,h)||!go(g,y):!0}function ov(s,a,c,h){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,h),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,h),a.state!==s&&Oh.enqueueReplaceState(a,a.state,null)}function Ma(s,a){var c=a;if("ref"in a){c={};for(var h in a)h!=="ref"&&(c[h]=a[h])}if(s=s.defaultProps){c===a&&(c=v({},c));for(var g in s)c[g]===void 0&&(c[g]=s[g])}return c}function lv(s){Zl(s)}function cv(s){console.error(s)}function uv(s){Zl(s)}function yc(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(h){setTimeout(function(){throw h})}}function dv(s,a,c){try{var h=s.onCaughtError;h(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Dh(s,a,c){return c=Fs(c),c.tag=3,c.payload={element:null},c.callback=function(){yc(s,a)},c}function hv(s){return s=Fs(s),s.tag=3,s}function fv(s,a,c,h){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var y=h.value;s.payload=function(){return g(y)},s.callback=function(){dv(a,c,h)}}var T=c.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(s.callback=function(){dv(a,c,h),typeof g!="function"&&(Ks===null?Ks=new Set([this]):Ks.add(this));var M=h.stack;this.componentDidCatch(h.value,{componentStack:M!==null?M:""})})}function kx(s,a,c,h,g){if(c.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(a=c.alternate,a!==null&&hr(a,c,g,!0),c=ri.current,c!==null){switch(c.tag){case 31:case 13:return Si===null?_c():c.alternate===null&&Ht===0&&(Ht=3),c.flags&=-257,c.flags|=65536,c.lanes=g,h===ac?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([h]):a.add(h),rf(s,h,g)),!1;case 22:return c.flags|=65536,h===ac?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([h])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([h]):c.add(h)),rf(s,h,g)),!1}throw Error(i(435,c.tag))}return rf(s,h,g),_c(),!1}if(dt)return a=ri.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=g,h!==Xd&&(s=Error(i(422),{cause:h}),bo(yi(s,c)))):(h!==Xd&&(a=Error(i(423),{cause:h}),bo(yi(a,c))),s=s.current.alternate,s.flags|=65536,g&=-g,s.lanes|=g,h=yi(h,c),g=Dh(s.stateNode,h,g),uh(s,g),Ht!==4&&(Ht=2)),!1;var y=Error(i(520),{cause:h});if(y=yi(y,c),Uo===null?Uo=[y]:Uo.push(y),Ht!==4&&(Ht=2),a===null)return!0;h=yi(h,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=g&-g,c.lanes|=s,s=Dh(c.stateNode,h,s),uh(c,s),!1;case 1:if(a=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ks===null||!Ks.has(y))))return c.flags|=65536,g&=-g,c.lanes|=g,g=hv(g),fv(g,s,c,h),uh(c,g),!1}c=c.return}while(c!==null);return!1}var Lh=Error(i(461)),on=!1;function jn(s,a,c,h){a.child=s===null?v0(a,null,c,h):_a(a,s.child,c,h)}function mv(s,a,c,h,g){c=c.render;var y=a.ref;if("ref"in h){var T={};for(var M in h)M!=="ref"&&(T[M]=h[M])}else T=h;return wa(a),h=gh(s,a,c,T,y,g),M=vh(),s!==null&&!on?(yh(s,a,g),ms(s,a,g)):(dt&&M&&Jd(a),a.flags|=1,jn(s,a,h,g),a.child)}function pv(s,a,c,h,g){if(s===null){var y=c.type;return typeof y=="function"&&!Wd(y)&&y.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=y,gv(s,a,y,h,g)):(s=Xl(c.type,null,h,a,a.mode,g),s.ref=a.ref,s.return=a,a.child=s)}if(y=s.child,!Vh(s,g)){var T=y.memoizedProps;if(c=c.compare,c=c!==null?c:go,c(T,h)&&s.ref===a.ref)return ms(s,a,g)}return a.flags|=1,s=ls(y,h),s.ref=a.ref,s.return=a,a.child=s}function gv(s,a,c,h,g){if(s!==null){var y=s.memoizedProps;if(go(y,h)&&s.ref===a.ref)if(on=!1,a.pendingProps=h=y,Vh(s,g))(s.flags&131072)!==0&&(on=!0);else return a.lanes=s.lanes,ms(s,a,g)}return Ph(s,a,c,h,g)}function vv(s,a,c,h){var g=h.children,y=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((a.flags&128)!==0){if(y=y!==null?y.baseLanes|c:c,s!==null){for(h=a.child=s.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;h=g&~y}else h=0,a.child=null;return yv(s,a,y,c,h)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&ic(a,y!==null?y.cachePool:null),y!==null?C0(a,y):hh(),x0(a);else return h=a.lanes=536870912,yv(s,a,y!==null?y.baseLanes|c:c,c,h)}else y!==null?(ic(a,y.cachePool),C0(a,y),Vs(),a.memoizedState=null):(s!==null&&ic(a,null),hh(),Vs());return jn(s,a,g,c),a.child}function Ao(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function yv(s,a,c,h,g){var y=rh();return y=y===null?null:{parent:an._currentValue,pool:y},a.memoizedState={baseLanes:c,cachePool:y},s!==null&&ic(a,null),hh(),x0(a),s!==null&&hr(s,a,h,!0),a.childLanes=g,null}function bc(s,a){return a=xc({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function bv(s,a,c){return _a(a,s.child,null,c),s=bc(a,a.pendingProps),s.flags|=2,oi(a),a.memoizedState=null,s}function Tx(s,a,c){var h=a.pendingProps,g=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(dt){if(h.mode==="hidden")return s=bc(a,h),a.lanes=536870912,Ao(null,s);if(mh(a),(s=Mt)?(s=A1(s,xi),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Ls!==null?{id:Gi,overflow:Ki}:null,retryLane:536870912,hydrationErrors:null},c=n0(s),c.return=a,a.child=c,En=a,Mt=null)):s=null,s===null)throw Is(a);return a.lanes=536870912,null}return bc(a,h)}var y=s.memoizedState;if(y!==null){var T=y.dehydrated;if(mh(a),g)if(a.flags&256)a.flags&=-257,a=bv(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(i(558));else if(on||hr(s,a,c,!1),g=(c&s.childLanes)!==0,on||g){if(h=Nt,h!==null&&(T=we(h,c),T!==0&&T!==y.retryLane))throw y.retryLane=T,Sa(s,T),Wn(h,s,T),Lh;_c(),a=bv(s,a,c)}else s=y.treeContext,Mt=ki(T.nextSibling),En=a,dt=!0,Ps=null,xi=!1,s!==null&&a0(a,s),a=bc(a,h),a.flags|=4096;return a}return s=ls(s.child,{mode:h.mode,children:h.children}),s.ref=a.ref,a.child=s,s.return=a,s}function Cc(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Ph(s,a,c,h,g){return wa(a),c=gh(s,a,c,h,void 0,g),h=vh(),s!==null&&!on?(yh(s,a,g),ms(s,a,g)):(dt&&h&&Jd(a),a.flags|=1,jn(s,a,c,g),a.child)}function Cv(s,a,c,h,g,y){return wa(a),a.updateQueue=null,c=k0(a,h,c,g),S0(s),h=vh(),s!==null&&!on?(yh(s,a,y),ms(s,a,y)):(dt&&h&&Jd(a),a.flags|=1,jn(s,a,c,y),a.child)}function xv(s,a,c,h,g){if(wa(a),a.stateNode===null){var y=lr,T=c.contextType;typeof T=="object"&&T!==null&&(y=wn(T)),y=new c(h,y),a.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Oh,a.stateNode=y,y._reactInternals=a,y=a.stateNode,y.props=h,y.state=a.memoizedState,y.refs={},lh(a),T=c.contextType,y.context=typeof T=="object"&&T!==null?wn(T):lr,y.state=a.memoizedState,T=c.getDerivedStateFromProps,typeof T=="function"&&(Mh(a,c,T,h),y.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(T=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),T!==y.state&&Oh.enqueueReplaceState(y,y.state,null),wo(a,h,y,g),Eo(),y.state=a.memoizedState),typeof y.componentDidMount=="function"&&(a.flags|=4194308),h=!0}else if(s===null){y=a.stateNode;var M=a.memoizedProps,z=Ma(c,M);y.props=z;var Y=y.context,oe=c.contextType;T=lr,typeof oe=="object"&&oe!==null&&(T=wn(oe));var me=c.getDerivedStateFromProps;oe=typeof me=="function"||typeof y.getSnapshotBeforeUpdate=="function",M=a.pendingProps!==M,oe||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(M||Y!==T)&&ov(a,y,h,T),Bs=!1;var X=a.memoizedState;y.state=X,wo(a,h,y,g),Eo(),Y=a.memoizedState,M||X!==Y||Bs?(typeof me=="function"&&(Mh(a,c,me,h),Y=a.memoizedState),(z=Bs||rv(a,c,z,h,X,Y,T))?(oe||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(a.flags|=4194308)):(typeof y.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=h,a.memoizedState=Y),y.props=h,y.state=Y,y.context=T,h=z):(typeof y.componentDidMount=="function"&&(a.flags|=4194308),h=!1)}else{y=a.stateNode,ch(s,a),T=a.memoizedProps,oe=Ma(c,T),y.props=oe,me=a.pendingProps,X=y.context,Y=c.contextType,z=lr,typeof Y=="object"&&Y!==null&&(z=wn(Y)),M=c.getDerivedStateFromProps,(Y=typeof M=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==me||X!==z)&&ov(a,y,h,z),Bs=!1,X=a.memoizedState,y.state=X,wo(a,h,y,g),Eo();var ne=a.memoizedState;T!==me||X!==ne||Bs||s!==null&&s.dependencies!==null&&tc(s.dependencies)?(typeof M=="function"&&(Mh(a,c,M,h),ne=a.memoizedState),(oe=Bs||rv(a,c,oe,h,X,ne,z)||s!==null&&s.dependencies!==null&&tc(s.dependencies))?(Y||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(h,ne,z),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(h,ne,z)),typeof y.componentDidUpdate=="function"&&(a.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===s.memoizedProps&&X===s.memoizedState||(a.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===s.memoizedProps&&X===s.memoizedState||(a.flags|=1024),a.memoizedProps=h,a.memoizedState=ne),y.props=h,y.state=ne,y.context=z,h=oe):(typeof y.componentDidUpdate!="function"||T===s.memoizedProps&&X===s.memoizedState||(a.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===s.memoizedProps&&X===s.memoizedState||(a.flags|=1024),h=!1)}return y=h,Cc(s,a),h=(a.flags&128)!==0,y||h?(y=a.stateNode,c=h&&typeof c.getDerivedStateFromError!="function"?null:y.render(),a.flags|=1,s!==null&&h?(a.child=_a(a,s.child,null,g),a.child=_a(a,null,c,g)):jn(s,a,c,g),a.memoizedState=y.state,s=a.child):s=ms(s,a,g),s}function Sv(s,a,c,h){return Ta(),a.flags|=256,jn(s,a,c,h),a.child}var Ih={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Uh(s){return{baseLanes:s,cachePool:d0()}}function Bh(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=ci),s}function kv(s,a,c){var h=a.pendingProps,g=!1,y=(a.flags&128)!==0,T;if((T=y)||(T=s!==null&&s.memoizedState===null?!1:(Yt.current&2)!==0),T&&(g=!0,a.flags&=-129),T=(a.flags&32)!==0,a.flags&=-33,s===null){if(dt){if(g?qs(a):Vs(),(s=Mt)?(s=A1(s,xi),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Ls!==null?{id:Gi,overflow:Ki}:null,retryLane:536870912,hydrationErrors:null},c=n0(s),c.return=a,a.child=c,En=a,Mt=null)):s=null,s===null)throw Is(a);return Sf(s)?a.lanes=32:a.lanes=536870912,null}var M=h.children;return h=h.fallback,g?(Vs(),g=a.mode,M=xc({mode:"hidden",children:M},g),h=ka(h,g,c,null),M.return=a,h.return=a,M.sibling=h,a.child=M,h=a.child,h.memoizedState=Uh(c),h.childLanes=Bh(s,T,c),a.memoizedState=Ih,Ao(null,h)):(qs(a),Fh(a,M))}var z=s.memoizedState;if(z!==null&&(M=z.dehydrated,M!==null)){if(y)a.flags&256?(qs(a),a.flags&=-257,a=zh(s,a,c)):a.memoizedState!==null?(Vs(),a.child=s.child,a.flags|=128,a=null):(Vs(),M=h.fallback,g=a.mode,h=xc({mode:"visible",children:h.children},g),M=ka(M,g,c,null),M.flags|=2,h.return=a,M.return=a,h.sibling=M,a.child=h,_a(a,s.child,null,c),h=a.child,h.memoizedState=Uh(c),h.childLanes=Bh(s,T,c),a.memoizedState=Ih,a=Ao(null,h));else if(qs(a),Sf(M)){if(T=M.nextSibling&&M.nextSibling.dataset,T)var Y=T.dgst;T=Y,h=Error(i(419)),h.stack="",h.digest=T,bo({value:h,source:null,stack:null}),a=zh(s,a,c)}else if(on||hr(s,a,c,!1),T=(c&s.childLanes)!==0,on||T){if(T=Nt,T!==null&&(h=we(T,c),h!==0&&h!==z.retryLane))throw z.retryLane=h,Sa(s,h),Wn(T,s,h),Lh;xf(M)||_c(),a=zh(s,a,c)}else xf(M)?(a.flags|=192,a.child=s.child,a=null):(s=z.treeContext,Mt=ki(M.nextSibling),En=a,dt=!0,Ps=null,xi=!1,s!==null&&a0(a,s),a=Fh(a,h.children),a.flags|=4096);return a}return g?(Vs(),M=h.fallback,g=a.mode,z=s.child,Y=z.sibling,h=ls(z,{mode:"hidden",children:h.children}),h.subtreeFlags=z.subtreeFlags&65011712,Y!==null?M=ls(Y,M):(M=ka(M,g,c,null),M.flags|=2),M.return=a,h.return=a,h.sibling=M,a.child=h,Ao(null,h),h=a.child,M=s.child.memoizedState,M===null?M=Uh(c):(g=M.cachePool,g!==null?(z=an._currentValue,g=g.parent!==z?{parent:z,pool:z}:g):g=d0(),M={baseLanes:M.baseLanes|c,cachePool:g}),h.memoizedState=M,h.childLanes=Bh(s,T,c),a.memoizedState=Ih,Ao(s.child,h)):(qs(a),c=s.child,s=c.sibling,c=ls(c,{mode:"visible",children:h.children}),c.return=a,c.sibling=null,s!==null&&(T=a.deletions,T===null?(a.deletions=[s],a.flags|=16):T.push(s)),a.child=c,a.memoizedState=null,c)}function Fh(s,a){return a=xc({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function xc(s,a){return s=ai(22,s,null,a),s.lanes=0,s}function zh(s,a,c){return _a(a,s.child,null,c),s=Fh(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Tv(s,a,c){s.lanes|=a;var h=s.alternate;h!==null&&(h.lanes|=a),nh(s.return,a,c)}function qh(s,a,c,h,g,y){var T=s.memoizedState;T===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:g,treeForkCount:y}:(T.isBackwards=a,T.rendering=null,T.renderingStartTime=0,T.last=h,T.tail=c,T.tailMode=g,T.treeForkCount=y)}function Ev(s,a,c){var h=a.pendingProps,g=h.revealOrder,y=h.tail;h=h.children;var T=Yt.current,M=(T&2)!==0;if(M?(T=T&1|2,a.flags|=128):T&=1,ae(Yt,T),jn(s,a,h,c),h=dt?yo:0,!M&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Tv(s,c,a);else if(s.tag===19)Tv(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(g){case"forwards":for(c=a.child,g=null;c!==null;)s=c.alternate,s!==null&&cc(s)===null&&(g=c),c=c.sibling;c=g,c===null?(g=a.child,a.child=null):(g=c.sibling,c.sibling=null),qh(a,!1,g,c,y,h);break;case"backwards":case"unstable_legacy-backwards":for(c=null,g=a.child,a.child=null;g!==null;){if(s=g.alternate,s!==null&&cc(s)===null){a.child=g;break}s=g.sibling,g.sibling=c,c=g,g=s}qh(a,!0,c,null,y,h);break;case"together":qh(a,!1,null,null,void 0,h);break;default:a.memoizedState=null}return a.child}function ms(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Gs|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(hr(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(i(153));if(a.child!==null){for(s=a.child,c=ls(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ls(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Vh(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&tc(s)))}function Ex(s,a,c){switch(a.tag){case 3:V(a,a.stateNode.containerInfo),Us(a,an,s.memoizedState.cache),Ta();break;case 27:case 5:be(a);break;case 4:V(a,a.stateNode.containerInfo);break;case 10:Us(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,mh(a),null;break;case 13:var h=a.memoizedState;if(h!==null)return h.dehydrated!==null?(qs(a),a.flags|=128,null):(c&a.child.childLanes)!==0?kv(s,a,c):(qs(a),s=ms(s,a,c),s!==null?s.sibling:null);qs(a);break;case 19:var g=(s.flags&128)!==0;if(h=(c&a.childLanes)!==0,h||(hr(s,a,c,!1),h=(c&a.childLanes)!==0),g){if(h)return Ev(s,a,c);a.flags|=128}if(g=a.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ae(Yt,Yt.current),h)break;return null;case 22:return a.lanes=0,vv(s,a,c,a.pendingProps);case 24:Us(a,an,s.memoizedState.cache)}return ms(s,a,c)}function wv(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)on=!0;else{if(!Vh(s,c)&&(a.flags&128)===0)return on=!1,Ex(s,a,c);on=(s.flags&131072)!==0}else on=!1,dt&&(a.flags&1048576)!==0&&s0(a,yo,a.index);switch(a.lanes=0,a.tag){case 16:e:{var h=a.pendingProps;if(s=Ra(a.elementType),a.type=s,typeof s=="function")Wd(s)?(h=Ma(s,h),a.tag=1,a=xv(null,a,s,h,c)):(a.tag=0,a=Ph(null,a,s,h,c));else{if(s!=null){var g=s.$$typeof;if(g===w){a.tag=11,a=mv(null,a,s,h,c);break e}else if(g===N){a.tag=14,a=pv(null,a,s,h,c);break e}}throw a=Z(s)||s,Error(i(306,a,""))}}return a;case 0:return Ph(s,a,a.type,a.pendingProps,c);case 1:return h=a.type,g=Ma(h,a.pendingProps),xv(s,a,h,g,c);case 3:e:{if(V(a,a.stateNode.containerInfo),s===null)throw Error(i(387));h=a.pendingProps;var y=a.memoizedState;g=y.element,ch(s,a),wo(a,h,null,c);var T=a.memoizedState;if(h=T.cache,Us(a,an,h),h!==y.cache&&ih(a,[an],c,!0),Eo(),h=T.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:T.cache},a.updateQueue.baseState=y,a.memoizedState=y,a.flags&256){a=Sv(s,a,h,c);break e}else if(h!==g){g=yi(Error(i(424)),a),bo(g),a=Sv(s,a,h,c);break e}else{switch(s=a.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Mt=ki(s.firstChild),En=a,dt=!0,Ps=null,xi=!0,c=v0(a,null,h,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Ta(),h===g){a=ms(s,a,c);break e}jn(s,a,h,c)}a=a.child}return a;case 26:return Cc(s,a),s===null?(c=I1(a.type,null,a.pendingProps,null))?a.memoizedState=c:dt||(c=a.type,s=a.pendingProps,h=Ic(ce.current).createElement(c),h[Ft]=a,h[sn]=s,Rn(h,c,s),bn(h),a.stateNode=h):a.memoizedState=I1(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return be(a),s===null&&dt&&(h=a.stateNode=D1(a.type,a.pendingProps,ce.current),En=a,xi=!0,g=Mt,Js(a.type)?(kf=g,Mt=ki(h.firstChild)):Mt=g),jn(s,a,a.pendingProps.children,c),Cc(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&dt&&((g=h=Mt)&&(h=tS(h,a.type,a.pendingProps,xi),h!==null?(a.stateNode=h,En=a,Mt=ki(h.firstChild),xi=!1,g=!0):g=!1),g||Is(a)),be(a),g=a.type,y=a.pendingProps,T=s!==null?s.memoizedProps:null,h=y.children,yf(g,y)?h=null:T!==null&&yf(g,T)&&(a.flags|=32),a.memoizedState!==null&&(g=gh(s,a,gx,null,null,c),Go._currentValue=g),Cc(s,a),jn(s,a,h,c),a.child;case 6:return s===null&&dt&&((s=c=Mt)&&(c=nS(c,a.pendingProps,xi),c!==null?(a.stateNode=c,En=a,Mt=null,s=!0):s=!1),s||Is(a)),null;case 13:return kv(s,a,c);case 4:return V(a,a.stateNode.containerInfo),h=a.pendingProps,s===null?a.child=_a(a,null,h,c):jn(s,a,h,c),a.child;case 11:return mv(s,a,a.type,a.pendingProps,c);case 7:return jn(s,a,a.pendingProps,c),a.child;case 8:return jn(s,a,a.pendingProps.children,c),a.child;case 12:return jn(s,a,a.pendingProps.children,c),a.child;case 10:return h=a.pendingProps,Us(a,a.type,h.value),jn(s,a,h.children,c),a.child;case 9:return g=a.type._context,h=a.pendingProps.children,wa(a),g=wn(g),h=h(g),a.flags|=1,jn(s,a,h,c),a.child;case 14:return pv(s,a,a.type,a.pendingProps,c);case 15:return gv(s,a,a.type,a.pendingProps,c);case 19:return Ev(s,a,c);case 31:return Tx(s,a,c);case 22:return vv(s,a,c,a.pendingProps);case 24:return wa(a),h=wn(an),s===null?(g=rh(),g===null&&(g=Nt,y=sh(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=c),g=y),a.memoizedState={parent:h,cache:g},lh(a),Us(a,an,g)):((s.lanes&c)!==0&&(ch(s,a),wo(a,null,null,c),Eo()),g=s.memoizedState,y=a.memoizedState,g.parent!==h?(g={parent:h,cache:h},a.memoizedState=g,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=g),Us(a,an,h)):(h=y.cache,Us(a,an,h),h!==g.cache&&ih(a,[an],c,!0))),jn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function ps(s){s.flags|=4}function Hh(s,a,c,h,g){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(g&335544128)===g)if(s.stateNode.complete)s.flags|=8192;else if(Xv())s.flags|=8192;else throw Na=ac,oh}else s.flags&=-16777217}function jv(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!q1(a))if(Xv())s.flags|=8192;else throw Na=ac,oh}function Sc(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?Il():536870912,s.lanes|=a,Tr|=a)}function Mo(s,a){if(!dt)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:h.sibling=null}}function Ot(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,h=0;if(a)for(var g=s.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=s,g=g.sibling;else for(g=s.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=s,g=g.sibling;return s.subtreeFlags|=h,s.childLanes=c,a}function wx(s,a,c){var h=a.pendingProps;switch(Qd(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ot(a),null;case 1:return Ot(a),null;case 3:return c=a.stateNode,h=null,s!==null&&(h=s.memoizedState.cache),a.memoizedState.cache!==h&&(a.flags|=2048),ds(an),ve(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(dr(a)?ps(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,eh())),Ot(a),null;case 26:var g=a.type,y=a.memoizedState;return s===null?(ps(a),y!==null?(Ot(a),jv(a,y)):(Ot(a),Hh(a,g,null,h,c))):y?y!==s.memoizedState?(ps(a),Ot(a),jv(a,y)):(Ot(a),a.flags&=-16777217):(s=s.memoizedProps,s!==h&&ps(a),Ot(a),Hh(a,g,s,h,c)),null;case 27:if(Ue(a),c=ce.current,g=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==h&&ps(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return Ot(a),null}s=le.current,dr(a)?r0(a):(s=D1(g,h,c),a.stateNode=s,ps(a))}return Ot(a),null;case 5:if(Ue(a),g=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==h&&ps(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return Ot(a),null}if(y=le.current,dr(a))r0(a);else{var T=Ic(ce.current);switch(y){case 1:y=T.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:y=T.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":y=T.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":y=T.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":y=T.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof h.is=="string"?T.createElement("select",{is:h.is}):T.createElement("select"),h.multiple?y.multiple=!0:h.size&&(y.size=h.size);break;default:y=typeof h.is=="string"?T.createElement(g,{is:h.is}):T.createElement(g)}}y[Ft]=a,y[sn]=h;e:for(T=a.child;T!==null;){if(T.tag===5||T.tag===6)y.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===a)break e;for(;T.sibling===null;){if(T.return===null||T.return===a)break e;T=T.return}T.sibling.return=T.return,T=T.sibling}a.stateNode=y;e:switch(Rn(y,g,h),g){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&ps(a)}}return Ot(a),Hh(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==h&&ps(a);else{if(typeof h!="string"&&a.stateNode===null)throw Error(i(166));if(s=ce.current,dr(a)){if(s=a.stateNode,c=a.memoizedProps,h=null,g=En,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}s[Ft]=a,s=!!(s.nodeValue===c||h!==null&&h.suppressHydrationWarning===!0||k1(s.nodeValue,c)),s||Is(a,!0)}else s=Ic(s).createTextNode(h),s[Ft]=a,a.stateNode=s}return Ot(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(h=dr(a),c!==null){if(s===null){if(!h)throw Error(i(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(557));s[Ft]=a}else Ta(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ot(a),s=!1}else c=eh(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(oi(a),a):(oi(a),null);if((a.flags&128)!==0)throw Error(i(558))}return Ot(a),null;case 13:if(h=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(g=dr(a),h!==null&&h.dehydrated!==null){if(s===null){if(!g)throw Error(i(318));if(g=a.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Ft]=a}else Ta(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ot(a),g=!1}else g=eh(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=g),g=!0;if(!g)return a.flags&256?(oi(a),a):(oi(a),null)}return oi(a),(a.flags&128)!==0?(a.lanes=c,a):(c=h!==null,s=s!==null&&s.memoizedState!==null,c&&(h=a.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool),y=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),y!==g&&(h.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),Sc(a,a.updateQueue),Ot(a),null);case 4:return ve(),s===null&&ff(a.stateNode.containerInfo),Ot(a),null;case 10:return ds(a.type),Ot(a),null;case 19:if(K(Yt),h=a.memoizedState,h===null)return Ot(a),null;if(g=(a.flags&128)!==0,y=h.rendering,y===null)if(g)Mo(h,!1);else{if(Ht!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(y=cc(s),y!==null){for(a.flags|=128,Mo(h,!1),s=y.updateQueue,a.updateQueue=s,Sc(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)t0(c,s),c=c.sibling;return ae(Yt,Yt.current&1|2),dt&&cs(a,h.treeForkCount),a.child}s=s.sibling}h.tail!==null&&Je()>jc&&(a.flags|=128,g=!0,Mo(h,!1),a.lanes=4194304)}else{if(!g)if(s=cc(y),s!==null){if(a.flags|=128,g=!0,s=s.updateQueue,a.updateQueue=s,Sc(a,s),Mo(h,!0),h.tail===null&&h.tailMode==="hidden"&&!y.alternate&&!dt)return Ot(a),null}else 2*Je()-h.renderingStartTime>jc&&c!==536870912&&(a.flags|=128,g=!0,Mo(h,!1),a.lanes=4194304);h.isBackwards?(y.sibling=a.child,a.child=y):(s=h.last,s!==null?s.sibling=y:a.child=y,h.last=y)}return h.tail!==null?(s=h.tail,h.rendering=s,h.tail=s.sibling,h.renderingStartTime=Je(),s.sibling=null,c=Yt.current,ae(Yt,g?c&1|2:c&1),dt&&cs(a,h.treeForkCount),s):(Ot(a),null);case 22:case 23:return oi(a),fh(),h=a.memoizedState!==null,s!==null?s.memoizedState!==null!==h&&(a.flags|=8192):h&&(a.flags|=8192),h?(c&536870912)!==0&&(a.flags&128)===0&&(Ot(a),a.subtreeFlags&6&&(a.flags|=8192)):Ot(a),c=a.updateQueue,c!==null&&Sc(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),h=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),h!==c&&(a.flags|=2048),s!==null&&K(ja),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ds(an),Ot(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function jx(s,a){switch(Qd(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ds(an),ve(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Ue(a),null;case 31:if(a.memoizedState!==null){if(oi(a),a.alternate===null)throw Error(i(340));Ta()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(oi(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Ta()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return K(Yt),null;case 4:return ve(),null;case 10:return ds(a.type),null;case 22:case 23:return oi(a),fh(),s!==null&&K(ja),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ds(an),null;case 25:return null;default:return null}}function Rv(s,a){switch(Qd(a),a.tag){case 3:ds(an),ve();break;case 26:case 27:case 5:Ue(a);break;case 4:ve();break;case 31:a.memoizedState!==null&&oi(a);break;case 13:oi(a);break;case 19:K(Yt);break;case 10:ds(a.type);break;case 22:case 23:oi(a),fh(),s!==null&&K(ja);break;case 24:ds(an)}}function Oo(s,a){try{var c=a.updateQueue,h=c!==null?c.lastEffect:null;if(h!==null){var g=h.next;c=g;do{if((c.tag&s)===s){h=void 0;var y=c.create,T=c.inst;h=y(),T.destroy=h}c=c.next}while(c!==g)}}catch(M){kt(a,a.return,M)}}function Hs(s,a,c){try{var h=a.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var y=g.next;h=y;do{if((h.tag&s)===s){var T=h.inst,M=T.destroy;if(M!==void 0){T.destroy=void 0,g=a;var z=c,Y=M;try{Y()}catch(oe){kt(g,z,oe)}}}h=h.next}while(h!==y)}}catch(oe){kt(a,a.return,oe)}}function Nv(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{b0(a,c)}catch(h){kt(s,s.return,h)}}}function _v(s,a,c){c.props=Ma(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(h){kt(s,a,h)}}function Do(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var h=s.stateNode;break;case 30:h=s.stateNode;break;default:h=s.stateNode}typeof c=="function"?s.refCleanup=c(h):c.current=h}}catch(g){kt(s,a,g)}}function Wi(s,a){var c=s.ref,h=s.refCleanup;if(c!==null)if(typeof h=="function")try{h()}catch(g){kt(s,a,g)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){kt(s,a,g)}else c.current=null}function Av(s){var a=s.type,c=s.memoizedProps,h=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&h.focus();break e;case"img":c.src?h.src=c.src:c.srcSet&&(h.srcset=c.srcSet)}}catch(g){kt(s,s.return,g)}}function $h(s,a,c){try{var h=s.stateNode;Zx(h,s.type,c,a),h[sn]=a}catch(g){kt(s,s.return,g)}}function Mv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Js(s.type)||s.tag===4}function Gh(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Mv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Js(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Kh(s,a,c){var h=s.tag;if(h===5||h===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=rs));else if(h!==4&&(h===27&&Js(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Kh(s,a,c),s=s.sibling;s!==null;)Kh(s,a,c),s=s.sibling}function kc(s,a,c){var h=s.tag;if(h===5||h===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(h!==4&&(h===27&&Js(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(kc(s,a,c),s=s.sibling;s!==null;)kc(s,a,c),s=s.sibling}function Ov(s){var a=s.stateNode,c=s.memoizedProps;try{for(var h=s.type,g=a.attributes;g.length;)a.removeAttributeNode(g[0]);Rn(a,h,c),a[Ft]=s,a[sn]=c}catch(y){kt(s,s.return,y)}}var gs=!1,ln=!1,Wh=!1,Dv=typeof WeakSet=="function"?WeakSet:Set,Cn=null;function Rx(s,a){if(s=s.containerInfo,gf=Hc,s=Gg(s),zd(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var g=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var T=0,M=-1,z=-1,Y=0,oe=0,me=s,X=null;t:for(;;){for(var ne;me!==c||g!==0&&me.nodeType!==3||(M=T+g),me!==y||h!==0&&me.nodeType!==3||(z=T+h),me.nodeType===3&&(T+=me.nodeValue.length),(ne=me.firstChild)!==null;)X=me,me=ne;for(;;){if(me===s)break t;if(X===c&&++Y===g&&(M=T),X===y&&++oe===h&&(z=T),(ne=me.nextSibling)!==null)break;me=X,X=me.parentNode}me=ne}c=M===-1||z===-1?null:{start:M,end:z}}else c=null}c=c||{start:0,end:0}}else c=null;for(vf={focusedElem:s,selectionRange:c},Hc=!1,Cn=a;Cn!==null;)if(a=Cn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Cn=s;else for(;Cn!==null;){switch(a=Cn,y=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)g=s[c],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&y!==null){s=void 0,c=a,g=y.memoizedProps,y=y.memoizedState,h=c.stateNode;try{var Oe=Ma(c.type,g);s=h.getSnapshotBeforeUpdate(Oe,y),h.__reactInternalSnapshotBeforeUpdate=s}catch(ze){kt(c,c.return,ze)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)Cf(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Cf(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=a.sibling,s!==null){s.return=a.return,Cn=s;break}Cn=a.return}}function Lv(s,a,c){var h=c.flags;switch(c.tag){case 0:case 11:case 15:ys(s,c),h&4&&Oo(5,c);break;case 1:if(ys(s,c),h&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(T){kt(c,c.return,T)}else{var g=Ma(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(g,a,s.__reactInternalSnapshotBeforeUpdate)}catch(T){kt(c,c.return,T)}}h&64&&Nv(c),h&512&&Do(c,c.return);break;case 3:if(ys(s,c),h&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{b0(s,a)}catch(T){kt(c,c.return,T)}}break;case 27:a===null&&h&4&&Ov(c);case 26:case 5:ys(s,c),a===null&&h&4&&Av(c),h&512&&Do(c,c.return);break;case 12:ys(s,c);break;case 31:ys(s,c),h&4&&Uv(s,c);break;case 13:ys(s,c),h&4&&Bv(s,c),h&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=Ix.bind(null,c),iS(s,c))));break;case 22:if(h=c.memoizedState!==null||gs,!h){a=a!==null&&a.memoizedState!==null||ln,g=gs;var y=ln;gs=h,(ln=a)&&!y?bs(s,c,(c.subtreeFlags&8772)!==0):ys(s,c),gs=g,ln=y}break;case 30:break;default:ys(s,c)}}function Pv(s){var a=s.alternate;a!==null&&(s.alternate=null,Pv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Td(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Pt=null,Hn=!1;function vs(s,a,c){for(c=c.child;c!==null;)Iv(s,a,c),c=c.sibling}function Iv(s,a,c){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(fi,c)}catch{}switch(c.tag){case 26:ln||Wi(c,a),vs(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:ln||Wi(c,a);var h=Pt,g=Hn;Js(c.type)&&(Pt=c.stateNode,Hn=!1),vs(s,a,c),Vo(c.stateNode),Pt=h,Hn=g;break;case 5:ln||Wi(c,a);case 6:if(h=Pt,g=Hn,Pt=null,vs(s,a,c),Pt=h,Hn=g,Pt!==null)if(Hn)try{(Pt.nodeType===9?Pt.body:Pt.nodeName==="HTML"?Pt.ownerDocument.body:Pt).removeChild(c.stateNode)}catch(y){kt(c,a,y)}else try{Pt.removeChild(c.stateNode)}catch(y){kt(c,a,y)}break;case 18:Pt!==null&&(Hn?(s=Pt,N1(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Mr(s)):N1(Pt,c.stateNode));break;case 4:h=Pt,g=Hn,Pt=c.stateNode.containerInfo,Hn=!0,vs(s,a,c),Pt=h,Hn=g;break;case 0:case 11:case 14:case 15:Hs(2,c,a),ln||Hs(4,c,a),vs(s,a,c);break;case 1:ln||(Wi(c,a),h=c.stateNode,typeof h.componentWillUnmount=="function"&&_v(c,a,h)),vs(s,a,c);break;case 21:vs(s,a,c);break;case 22:ln=(h=ln)||c.memoizedState!==null,vs(s,a,c),ln=h;break;default:vs(s,a,c)}}function Uv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Mr(s)}catch(c){kt(a,a.return,c)}}}function Bv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Mr(s)}catch(c){kt(a,a.return,c)}}function Nx(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new Dv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new Dv),a;default:throw Error(i(435,s.tag))}}function Tc(s,a){var c=Nx(s);a.forEach(function(h){if(!c.has(h)){c.add(h);var g=Ux.bind(null,s,h);h.then(g,g)}})}function $n(s,a){var c=a.deletions;if(c!==null)for(var h=0;h<c.length;h++){var g=c[h],y=s,T=a,M=T;e:for(;M!==null;){switch(M.tag){case 27:if(Js(M.type)){Pt=M.stateNode,Hn=!1;break e}break;case 5:Pt=M.stateNode,Hn=!1;break e;case 3:case 4:Pt=M.stateNode.containerInfo,Hn=!0;break e}M=M.return}if(Pt===null)throw Error(i(160));Iv(y,T,g),Pt=null,Hn=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Fv(a,s),a=a.sibling}var Mi=null;function Fv(s,a){var c=s.alternate,h=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:$n(a,s),Gn(s),h&4&&(Hs(3,s,s.return),Oo(3,s),Hs(5,s,s.return));break;case 1:$n(a,s),Gn(s),h&512&&(ln||c===null||Wi(c,c.return)),h&64&&gs&&(s=s.updateQueue,s!==null&&(h=s.callbacks,h!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?h:c.concat(h))));break;case 26:var g=Mi;if($n(a,s),Gn(s),h&512&&(ln||c===null||Wi(c,c.return)),h&4){var y=c!==null?c.memoizedState:null;if(h=s.memoizedState,c===null)if(h===null)if(s.stateNode===null){e:{h=s.type,c=s.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":y=g.getElementsByTagName("title")[0],(!y||y[ro]||y[Ft]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(h),g.head.insertBefore(y,g.querySelector("head > title"))),Rn(y,h,c),y[Ft]=s,bn(y),h=y;break e;case"link":var T=F1("link","href",g).get(h+(c.href||""));if(T){for(var M=0;M<T.length;M++)if(y=T[M],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){T.splice(M,1);break t}}y=g.createElement(h),Rn(y,h,c),g.head.appendChild(y);break;case"meta":if(T=F1("meta","content",g).get(h+(c.content||""))){for(M=0;M<T.length;M++)if(y=T[M],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){T.splice(M,1);break t}}y=g.createElement(h),Rn(y,h,c),g.head.appendChild(y);break;default:throw Error(i(468,h))}y[Ft]=s,bn(y),h=y}s.stateNode=h}else z1(g,s.type,s.stateNode);else s.stateNode=B1(g,h,s.memoizedProps);else y!==h?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,h===null?z1(g,s.type,s.stateNode):B1(g,h,s.memoizedProps)):h===null&&s.stateNode!==null&&$h(s,s.memoizedProps,c.memoizedProps)}break;case 27:$n(a,s),Gn(s),h&512&&(ln||c===null||Wi(c,c.return)),c!==null&&h&4&&$h(s,s.memoizedProps,c.memoizedProps);break;case 5:if($n(a,s),Gn(s),h&512&&(ln||c===null||Wi(c,c.return)),s.flags&32){g=s.stateNode;try{tr(g,"")}catch(Oe){kt(s,s.return,Oe)}}h&4&&s.stateNode!=null&&(g=s.memoizedProps,$h(s,g,c!==null?c.memoizedProps:g)),h&1024&&(Wh=!0);break;case 6:if($n(a,s),Gn(s),h&4){if(s.stateNode===null)throw Error(i(162));h=s.memoizedProps,c=s.stateNode;try{c.nodeValue=h}catch(Oe){kt(s,s.return,Oe)}}break;case 3:if(Fc=null,g=Mi,Mi=Uc(a.containerInfo),$n(a,s),Mi=g,Gn(s),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Mr(a.containerInfo)}catch(Oe){kt(s,s.return,Oe)}Wh&&(Wh=!1,zv(s));break;case 4:h=Mi,Mi=Uc(s.stateNode.containerInfo),$n(a,s),Gn(s),Mi=h;break;case 12:$n(a,s),Gn(s);break;case 31:$n(a,s),Gn(s),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Tc(s,h)));break;case 13:$n(a,s),Gn(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(wc=Je()),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Tc(s,h)));break;case 22:g=s.memoizedState!==null;var z=c!==null&&c.memoizedState!==null,Y=gs,oe=ln;if(gs=Y||g,ln=oe||z,$n(a,s),ln=oe,gs=Y,Gn(s),h&8192)e:for(a=s.stateNode,a._visibility=g?a._visibility&-2:a._visibility|1,g&&(c===null||z||gs||ln||Oa(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){z=c=a;try{if(y=z.stateNode,g)T=y.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{M=z.stateNode;var me=z.memoizedProps.style,X=me!=null&&me.hasOwnProperty("display")?me.display:null;M.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(Oe){kt(z,z.return,Oe)}}}else if(a.tag===6){if(c===null){z=a;try{z.stateNode.nodeValue=g?"":z.memoizedProps}catch(Oe){kt(z,z.return,Oe)}}}else if(a.tag===18){if(c===null){z=a;try{var ne=z.stateNode;g?_1(ne,!0):_1(z.stateNode,!1)}catch(Oe){kt(z,z.return,Oe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}h&4&&(h=s.updateQueue,h!==null&&(c=h.retryQueue,c!==null&&(h.retryQueue=null,Tc(s,c))));break;case 19:$n(a,s),Gn(s),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Tc(s,h)));break;case 30:break;case 21:break;default:$n(a,s),Gn(s)}}function Gn(s){var a=s.flags;if(a&2){try{for(var c,h=s.return;h!==null;){if(Mv(h)){c=h;break}h=h.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var g=c.stateNode,y=Gh(s);kc(s,y,g);break;case 5:var T=c.stateNode;c.flags&32&&(tr(T,""),c.flags&=-33);var M=Gh(s);kc(s,M,T);break;case 3:case 4:var z=c.stateNode.containerInfo,Y=Gh(s);Kh(s,Y,z);break;default:throw Error(i(161))}}catch(oe){kt(s,s.return,oe)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function zv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;zv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function ys(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Lv(s,a.alternate,a),a=a.sibling}function Oa(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Hs(4,a,a.return),Oa(a);break;case 1:Wi(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&_v(a,a.return,c),Oa(a);break;case 27:Vo(a.stateNode);case 26:case 5:Wi(a,a.return),Oa(a);break;case 22:a.memoizedState===null&&Oa(a);break;case 30:Oa(a);break;default:Oa(a)}s=s.sibling}}function bs(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var h=a.alternate,g=s,y=a,T=y.flags;switch(y.tag){case 0:case 11:case 15:bs(g,y,c),Oo(4,y);break;case 1:if(bs(g,y,c),h=y,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Y){kt(h,h.return,Y)}if(h=y,g=h.updateQueue,g!==null){var M=h.stateNode;try{var z=g.shared.hiddenCallbacks;if(z!==null)for(g.shared.hiddenCallbacks=null,g=0;g<z.length;g++)y0(z[g],M)}catch(Y){kt(h,h.return,Y)}}c&&T&64&&Nv(y),Do(y,y.return);break;case 27:Ov(y);case 26:case 5:bs(g,y,c),c&&h===null&&T&4&&Av(y),Do(y,y.return);break;case 12:bs(g,y,c);break;case 31:bs(g,y,c),c&&T&4&&Uv(g,y);break;case 13:bs(g,y,c),c&&T&4&&Bv(g,y);break;case 22:y.memoizedState===null&&bs(g,y,c),Do(y,y.return);break;case 30:break;default:bs(g,y,c)}a=a.sibling}}function Zh(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Co(c))}function Yh(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Co(s))}function Oi(s,a,c,h){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)qv(s,a,c,h),a=a.sibling}function qv(s,a,c,h){var g=a.flags;switch(a.tag){case 0:case 11:case 15:Oi(s,a,c,h),g&2048&&Oo(9,a);break;case 1:Oi(s,a,c,h);break;case 3:Oi(s,a,c,h),g&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Co(s)));break;case 12:if(g&2048){Oi(s,a,c,h),s=a.stateNode;try{var y=a.memoizedProps,T=y.id,M=y.onPostCommit;typeof M=="function"&&M(T,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(z){kt(a,a.return,z)}}else Oi(s,a,c,h);break;case 31:Oi(s,a,c,h);break;case 13:Oi(s,a,c,h);break;case 23:break;case 22:y=a.stateNode,T=a.alternate,a.memoizedState!==null?y._visibility&2?Oi(s,a,c,h):Lo(s,a):y._visibility&2?Oi(s,a,c,h):(y._visibility|=2,xr(s,a,c,h,(a.subtreeFlags&10256)!==0||!1)),g&2048&&Zh(T,a);break;case 24:Oi(s,a,c,h),g&2048&&Yh(a.alternate,a);break;default:Oi(s,a,c,h)}}function xr(s,a,c,h,g){for(g=g&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var y=s,T=a,M=c,z=h,Y=T.flags;switch(T.tag){case 0:case 11:case 15:xr(y,T,M,z,g),Oo(8,T);break;case 23:break;case 22:var oe=T.stateNode;T.memoizedState!==null?oe._visibility&2?xr(y,T,M,z,g):Lo(y,T):(oe._visibility|=2,xr(y,T,M,z,g)),g&&Y&2048&&Zh(T.alternate,T);break;case 24:xr(y,T,M,z,g),g&&Y&2048&&Yh(T.alternate,T);break;default:xr(y,T,M,z,g)}a=a.sibling}}function Lo(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,h=a,g=h.flags;switch(h.tag){case 22:Lo(c,h),g&2048&&Zh(h.alternate,h);break;case 24:Lo(c,h),g&2048&&Yh(h.alternate,h);break;default:Lo(c,h)}a=a.sibling}}var Po=8192;function Sr(s,a,c){if(s.subtreeFlags&Po)for(s=s.child;s!==null;)Vv(s,a,c),s=s.sibling}function Vv(s,a,c){switch(s.tag){case 26:Sr(s,a,c),s.flags&Po&&s.memoizedState!==null&&pS(c,Mi,s.memoizedState,s.memoizedProps);break;case 5:Sr(s,a,c);break;case 3:case 4:var h=Mi;Mi=Uc(s.stateNode.containerInfo),Sr(s,a,c),Mi=h;break;case 22:s.memoizedState===null&&(h=s.alternate,h!==null&&h.memoizedState!==null?(h=Po,Po=16777216,Sr(s,a,c),Po=h):Sr(s,a,c));break;default:Sr(s,a,c)}}function Hv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function Io(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];Cn=h,Gv(h,s)}Hv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)$v(s),s=s.sibling}function $v(s){switch(s.tag){case 0:case 11:case 15:Io(s),s.flags&2048&&Hs(9,s,s.return);break;case 3:Io(s);break;case 12:Io(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,Ec(s)):Io(s);break;default:Io(s)}}function Ec(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];Cn=h,Gv(h,s)}Hv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Hs(8,a,a.return),Ec(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,Ec(a));break;default:Ec(a)}s=s.sibling}}function Gv(s,a){for(;Cn!==null;){var c=Cn;switch(c.tag){case 0:case 11:case 15:Hs(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var h=c.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Co(c.memoizedState.cache)}if(h=c.child,h!==null)h.return=c,Cn=h;else e:for(c=s;Cn!==null;){h=Cn;var g=h.sibling,y=h.return;if(Pv(h),h===c){Cn=null;break e}if(g!==null){g.return=y,Cn=g;break e}Cn=y}}}var _x={getCacheForType:function(s){var a=wn(an),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return wn(an).controller.signal}},Ax=typeof WeakMap=="function"?WeakMap:Map,bt=0,Nt=null,tt=null,ot=0,St=0,li=null,$s=!1,kr=!1,Jh=!1,Cs=0,Ht=0,Gs=0,Da=0,Qh=0,ci=0,Tr=0,Uo=null,Kn=null,Xh=!1,wc=0,Kv=0,jc=1/0,Rc=null,Ks=null,pn=0,Ws=null,Er=null,xs=0,ef=0,tf=null,Wv=null,Bo=0,nf=null;function ui(){return(bt&2)!==0&&ot!==0?ot&-ot:q.T!==null?cf():Wt()}function Zv(){if(ci===0)if((ot&536870912)===0||dt){var s=ii;ii<<=1,(ii&3932160)===0&&(ii=262144),ci=s}else ci=536870912;return s=ri.current,s!==null&&(s.flags|=32),ci}function Wn(s,a,c){(s===Nt&&(St===2||St===9)||s.cancelPendingCommit!==null)&&(wr(s,0),Zs(s,ot,ci,!1)),va(s,c),((bt&2)===0||s!==Nt)&&(s===Nt&&((bt&2)===0&&(Da|=c),Ht===4&&Zs(s,ot,ci,!1)),Zi(s))}function Yv(s,a,c){if((bt&6)!==0)throw Error(i(327));var h=!c&&(a&127)===0&&(a&s.expiredLanes)===0||fn(s,a),g=h?Dx(s,a):af(s,a,!0),y=h;do{if(g===0){kr&&!h&&Zs(s,a,0,!1);break}else{if(c=s.current.alternate,y&&!Mx(c)){g=af(s,a,!1),y=!1;continue}if(g===2){if(y=a,s.errorRecoveryDisabledLanes&y)var T=0;else T=s.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){a=T;e:{var M=s;g=Uo;var z=M.current.memoizedState.isDehydrated;if(z&&(wr(M,T).flags|=256),T=af(M,T,!1),T!==2){if(Jh&&!z){M.errorRecoveryDisabledLanes|=y,Da|=y,g=4;break e}y=Kn,Kn=g,y!==null&&(Kn===null?Kn=y:Kn.push.apply(Kn,y))}g=T}if(y=!1,g!==2)continue}}if(g===1){wr(s,0),Zs(s,a,0,!0);break}e:{switch(h=s,y=g,y){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:Zs(h,a,ci,!$s);break e;case 2:Kn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(g=wc+300-Je(),10<g)){if(Zs(h,a,ci,!$s),rt(h,0,!0)!==0)break e;xs=a,h.timeoutHandle=j1(Jv.bind(null,h,c,Kn,Rc,Xh,a,ci,Da,Tr,$s,y,"Throttled",-0,0),g);break e}Jv(h,c,Kn,Rc,Xh,a,ci,Da,Tr,$s,y,null,-0,0)}}break}while(!0);Zi(s)}function Jv(s,a,c,h,g,y,T,M,z,Y,oe,me,X,ne){if(s.timeoutHandle=-1,me=a.subtreeFlags,me&8192||(me&16785408)===16785408){me={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:rs},Vv(a,y,me);var Oe=(y&62914560)===y?wc-Je():(y&4194048)===y?Kv-Je():0;if(Oe=gS(me,Oe),Oe!==null){xs=y,s.cancelPendingCommit=Oe(a1.bind(null,s,a,y,c,h,g,T,M,z,oe,me,null,X,ne)),Zs(s,y,T,!Y);return}}a1(s,a,y,c,h,g,T,M,z)}function Mx(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var h=0;h<c.length;h++){var g=c[h],y=g.getSnapshot;g=g.value;try{if(!si(y(),g))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Zs(s,a,c,h){a&=~Qh,a&=~Da,s.suspendedLanes|=a,s.pingedLanes&=~a,h&&(s.warmLanes|=a),h=s.expirationTimes;for(var g=a;0<g;){var y=31-qt(g),T=1<<y;h[y]=-1,g&=~T}c!==0&&Ul(s,c,a)}function Nc(){return(bt&6)===0?(Fo(0),!1):!0}function sf(){if(tt!==null){if(St===0)var s=tt.return;else s=tt,us=Ea=null,bh(s),gr=null,So=0,s=tt;for(;s!==null;)Rv(s.alternate,s),s=s.return;tt=null}}function wr(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,Qx(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),xs=0,sf(),Nt=s,tt=c=ls(s.current,null),ot=a,St=0,li=null,$s=!1,kr=fn(s,a),Jh=!1,Tr=ci=Qh=Da=Gs=Ht=0,Kn=Uo=null,Xh=!1,(a&8)!==0&&(a|=a&32);var h=s.entangledLanes;if(h!==0)for(s=s.entanglements,h&=a;0<h;){var g=31-qt(h),y=1<<g;a|=s[g],h&=~y}return Cs=a,Yl(),c}function Qv(s,a){We=null,q.H=_o,a===pr||a===sc?(a=m0(),St=3):a===oh?(a=m0(),St=4):St=a===Lh?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,li=a,tt===null&&(Ht=1,yc(s,yi(a,s.current)))}function Xv(){var s=ri.current;return s===null?!0:(ot&4194048)===ot?Si===null:(ot&62914560)===ot||(ot&536870912)!==0?s===Si:!1}function e1(){var s=q.H;return q.H=_o,s===null?_o:s}function t1(){var s=q.A;return q.A=_x,s}function _c(){Ht=4,$s||(ot&4194048)!==ot&&ri.current!==null||(kr=!0),(Gs&134217727)===0&&(Da&134217727)===0||Nt===null||Zs(Nt,ot,ci,!1)}function af(s,a,c){var h=bt;bt|=2;var g=e1(),y=t1();(Nt!==s||ot!==a)&&(Rc=null,wr(s,a)),a=!1;var T=Ht;e:do try{if(St!==0&&tt!==null){var M=tt,z=li;switch(St){case 8:sf(),T=6;break e;case 3:case 2:case 9:case 6:ri.current===null&&(a=!0);var Y=St;if(St=0,li=null,jr(s,M,z,Y),c&&kr){T=0;break e}break;default:Y=St,St=0,li=null,jr(s,M,z,Y)}}Ox(),T=Ht;break}catch(oe){Qv(s,oe)}while(!0);return a&&s.shellSuspendCounter++,us=Ea=null,bt=h,q.H=g,q.A=y,tt===null&&(Nt=null,ot=0,Yl()),T}function Ox(){for(;tt!==null;)n1(tt)}function Dx(s,a){var c=bt;bt|=2;var h=e1(),g=t1();Nt!==s||ot!==a?(Rc=null,jc=Je()+500,wr(s,a)):kr=fn(s,a);e:do try{if(St!==0&&tt!==null){a=tt;var y=li;t:switch(St){case 1:St=0,li=null,jr(s,a,y,1);break;case 2:case 9:if(h0(y)){St=0,li=null,i1(a);break}a=function(){St!==2&&St!==9||Nt!==s||(St=7),Zi(s)},y.then(a,a);break e;case 3:St=7;break e;case 4:St=5;break e;case 7:h0(y)?(St=0,li=null,i1(a)):(St=0,li=null,jr(s,a,y,7));break;case 5:var T=null;switch(tt.tag){case 26:T=tt.memoizedState;case 5:case 27:var M=tt;if(T?q1(T):M.stateNode.complete){St=0,li=null;var z=M.sibling;if(z!==null)tt=z;else{var Y=M.return;Y!==null?(tt=Y,Ac(Y)):tt=null}break t}}St=0,li=null,jr(s,a,y,5);break;case 6:St=0,li=null,jr(s,a,y,6);break;case 8:sf(),Ht=6;break e;default:throw Error(i(462))}}Lx();break}catch(oe){Qv(s,oe)}while(!0);return us=Ea=null,q.H=h,q.A=g,bt=c,tt!==null?0:(Nt=null,ot=0,Yl(),Ht)}function Lx(){for(;tt!==null&&!Me();)n1(tt)}function n1(s){var a=wv(s.alternate,s,Cs);s.memoizedProps=s.pendingProps,a===null?Ac(s):tt=a}function i1(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Cv(c,a,a.pendingProps,a.type,void 0,ot);break;case 11:a=Cv(c,a,a.pendingProps,a.type.render,a.ref,ot);break;case 5:bh(a);default:Rv(c,a),a=tt=t0(a,Cs),a=wv(c,a,Cs)}s.memoizedProps=s.pendingProps,a===null?Ac(s):tt=a}function jr(s,a,c,h){us=Ea=null,bh(a),gr=null,So=0;var g=a.return;try{if(kx(s,g,a,c,ot)){Ht=1,yc(s,yi(c,s.current)),tt=null;return}}catch(y){if(g!==null)throw tt=g,y;Ht=1,yc(s,yi(c,s.current)),tt=null;return}a.flags&32768?(dt||h===1?s=!0:kr||(ot&536870912)!==0?s=!1:($s=s=!0,(h===2||h===9||h===3||h===6)&&(h=ri.current,h!==null&&h.tag===13&&(h.flags|=16384))),s1(a,s)):Ac(a)}function Ac(s){var a=s;do{if((a.flags&32768)!==0){s1(a,$s);return}s=a.return;var c=wx(a.alternate,a,Cs);if(c!==null){tt=c;return}if(a=a.sibling,a!==null){tt=a;return}tt=a=s}while(a!==null);Ht===0&&(Ht=5)}function s1(s,a){do{var c=jx(s.alternate,s);if(c!==null){c.flags&=32767,tt=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){tt=s;return}tt=s=c}while(s!==null);Ht=6,tt=null}function a1(s,a,c,h,g,y,T,M,z){s.cancelPendingCommit=null;do Mc();while(pn!==0);if((bt&6)!==0)throw Error(i(327));if(a!==null){if(a===s.current)throw Error(i(177));if(y=a.lanes|a.childLanes,y|=Gd,Sd(s,c,y,T,M,z),s===Nt&&(tt=Nt=null,ot=0),Er=a,Ws=s,xs=c,ef=y,tf=g,Wv=h,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,Bx(ft,function(){return u1(),null})):(s.callbackNode=null,s.callbackPriority=0),h=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||h){h=q.T,q.T=null,g=ee.p,ee.p=2,T=bt,bt|=4;try{Rx(s,a,c)}finally{bt=T,ee.p=g,q.T=h}}pn=1,r1(),o1(),l1()}}function r1(){if(pn===1){pn=0;var s=Ws,a=Er,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=q.T,q.T=null;var h=ee.p;ee.p=2;var g=bt;bt|=4;try{Fv(a,s);var y=vf,T=Gg(s.containerInfo),M=y.focusedElem,z=y.selectionRange;if(T!==M&&M&&M.ownerDocument&&$g(M.ownerDocument.documentElement,M)){if(z!==null&&zd(M)){var Y=z.start,oe=z.end;if(oe===void 0&&(oe=Y),"selectionStart"in M)M.selectionStart=Y,M.selectionEnd=Math.min(oe,M.value.length);else{var me=M.ownerDocument||document,X=me&&me.defaultView||window;if(X.getSelection){var ne=X.getSelection(),Oe=M.textContent.length,ze=Math.min(z.start,Oe),jt=z.end===void 0?ze:Math.min(z.end,Oe);!ne.extend&&ze>jt&&(T=jt,jt=ze,ze=T);var $=Hg(M,ze),H=Hg(M,jt);if($&&H&&(ne.rangeCount!==1||ne.anchorNode!==$.node||ne.anchorOffset!==$.offset||ne.focusNode!==H.node||ne.focusOffset!==H.offset)){var W=me.createRange();W.setStart($.node,$.offset),ne.removeAllRanges(),ze>jt?(ne.addRange(W),ne.extend(H.node,H.offset)):(W.setEnd(H.node,H.offset),ne.addRange(W))}}}}for(me=[],ne=M;ne=ne.parentNode;)ne.nodeType===1&&me.push({element:ne,left:ne.scrollLeft,top:ne.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<me.length;M++){var de=me[M];de.element.scrollLeft=de.left,de.element.scrollTop=de.top}}Hc=!!gf,vf=gf=null}finally{bt=g,ee.p=h,q.T=c}}s.current=a,pn=2}}function o1(){if(pn===2){pn=0;var s=Ws,a=Er,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=q.T,q.T=null;var h=ee.p;ee.p=2;var g=bt;bt|=4;try{Lv(s,a.alternate,a)}finally{bt=g,ee.p=h,q.T=c}}pn=3}}function l1(){if(pn===4||pn===3){pn=0,Be();var s=Ws,a=Er,c=xs,h=Wv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?pn=5:(pn=0,Er=Ws=null,c1(s,s.pendingLanes));var g=s.pendingLanes;if(g===0&&(Ks=null),yt(c),a=a.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(fi,a,void 0,(a.current.flags&128)===128)}catch{}if(h!==null){a=q.T,g=ee.p,ee.p=2,q.T=null;try{for(var y=s.onRecoverableError,T=0;T<h.length;T++){var M=h[T];y(M.value,{componentStack:M.stack})}}finally{q.T=a,ee.p=g}}(xs&3)!==0&&Mc(),Zi(s),g=s.pendingLanes,(c&261930)!==0&&(g&42)!==0?s===nf?Bo++:(Bo=0,nf=s):Bo=0,Fo(0)}}function c1(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Co(a)))}function Mc(){return r1(),o1(),l1(),u1()}function u1(){if(pn!==5)return!1;var s=Ws,a=ef;ef=0;var c=yt(xs),h=q.T,g=ee.p;try{ee.p=32>c?32:c,q.T=null,c=tf,tf=null;var y=Ws,T=xs;if(pn=0,Er=Ws=null,xs=0,(bt&6)!==0)throw Error(i(331));var M=bt;if(bt|=4,$v(y.current),qv(y,y.current,T,c),bt=M,Fo(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(fi,y)}catch{}return!0}finally{ee.p=g,q.T=h,c1(s,a)}}function d1(s,a,c){a=yi(c,a),a=Dh(s.stateNode,a,2),s=zs(s,a,2),s!==null&&(va(s,2),Zi(s))}function kt(s,a,c){if(s.tag===3)d1(s,s,c);else for(;a!==null;){if(a.tag===3){d1(a,s,c);break}else if(a.tag===1){var h=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ks===null||!Ks.has(h))){s=yi(c,s),c=hv(2),h=zs(a,c,2),h!==null&&(fv(c,h,a,s),va(h,2),Zi(h));break}}a=a.return}}function rf(s,a,c){var h=s.pingCache;if(h===null){h=s.pingCache=new Ax;var g=new Set;h.set(a,g)}else g=h.get(a),g===void 0&&(g=new Set,h.set(a,g));g.has(c)||(Jh=!0,g.add(c),s=Px.bind(null,s,a,c),a.then(s,s))}function Px(s,a,c){var h=s.pingCache;h!==null&&h.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Nt===s&&(ot&c)===c&&(Ht===4||Ht===3&&(ot&62914560)===ot&&300>Je()-wc?(bt&2)===0&&wr(s,0):Qh|=c,Tr===ot&&(Tr=0)),Zi(s)}function h1(s,a){a===0&&(a=Il()),s=Sa(s,a),s!==null&&(va(s,a),Zi(s))}function Ix(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),h1(s,c)}function Ux(s,a){var c=0;switch(s.tag){case 31:case 13:var h=s.stateNode,g=s.memoizedState;g!==null&&(c=g.retryLane);break;case 19:h=s.stateNode;break;case 22:h=s.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(a),h1(s,c)}function Bx(s,a){return Ae(s,a)}var Oc=null,Rr=null,of=!1,Dc=!1,lf=!1,Ys=0;function Zi(s){s!==Rr&&s.next===null&&(Rr===null?Oc=Rr=s:Rr=Rr.next=s),Dc=!0,of||(of=!0,zx())}function Fo(s,a){if(!lf&&Dc){lf=!0;do for(var c=!1,h=Oc;h!==null;){if(s!==0){var g=h.pendingLanes;if(g===0)var y=0;else{var T=h.suspendedLanes,M=h.pingedLanes;y=(1<<31-qt(42|s)+1)-1,y&=g&~(T&~M),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,g1(h,y))}else y=ot,y=rt(h,h===Nt?y:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(y&3)===0||fn(h,y)||(c=!0,g1(h,y));h=h.next}while(c);lf=!1}}function Fx(){f1()}function f1(){Dc=of=!1;var s=0;Ys!==0&&Jx()&&(s=Ys);for(var a=Je(),c=null,h=Oc;h!==null;){var g=h.next,y=m1(h,a);y===0?(h.next=null,c===null?Oc=g:c.next=g,g===null&&(Rr=c)):(c=h,(s!==0||(y&3)!==0)&&(Dc=!0)),h=g}pn!==0&&pn!==5||Fo(s),Ys!==0&&(Ys=0)}function m1(s,a){for(var c=s.suspendedLanes,h=s.pingedLanes,g=s.expirationTimes,y=s.pendingLanes&-62914561;0<y;){var T=31-qt(y),M=1<<T,z=g[T];z===-1?((M&c)===0||(M&h)!==0)&&(g[T]=qn(M,a)):z<=a&&(s.expiredLanes|=M),y&=~M}if(a=Nt,c=ot,c=rt(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h=s.callbackNode,c===0||s===a&&(St===2||St===9)||s.cancelPendingCommit!==null)return h!==null&&h!==null&&He(h),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||fn(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(h!==null&&He(h),yt(c)){case 2:case 8:c=Ke;break;case 32:c=ft;break;case 268435456:c=dn;break;default:c=ft}return h=p1.bind(null,s),c=Ae(c,h),s.callbackPriority=a,s.callbackNode=c,a}return h!==null&&h!==null&&He(h),s.callbackPriority=2,s.callbackNode=null,2}function p1(s,a){if(pn!==0&&pn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Mc()&&s.callbackNode!==c)return null;var h=ot;return h=rt(s,s===Nt?h:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h===0?null:(Yv(s,h,a),m1(s,Je()),s.callbackNode!=null&&s.callbackNode===c?p1.bind(null,s):null)}function g1(s,a){if(Mc())return null;Yv(s,a,!0)}function zx(){Xx(function(){(bt&6)!==0?Ae(Ne,Fx):f1()})}function cf(){if(Ys===0){var s=fr;s===0&&(s=Bt,Bt<<=1,(Bt&261888)===0&&(Bt=256)),Ys=s}return Ys}function v1(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:ql(""+s)}function y1(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function qx(s,a,c,h,g){if(a==="submit"&&c&&c.stateNode===g){var y=v1((g[sn]||null).action),T=h.submitter;T&&(a=(a=T[sn]||null)?v1(a.formAction):T.getAttribute("formAction"),a!==null&&(y=a,T=null));var M=new Gl("action","action",null,h,g);s.push({event:M,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Ys!==0){var z=T?y1(g,T):new FormData(g);Rh(c,{pending:!0,data:z,method:g.method,action:y},null,z)}}else typeof y=="function"&&(M.preventDefault(),z=T?y1(g,T):new FormData(g),Rh(c,{pending:!0,data:z,method:g.method,action:y},y,z))},currentTarget:g}]})}}for(var uf=0;uf<$d.length;uf++){var df=$d[uf],Vx=df.toLowerCase(),Hx=df[0].toUpperCase()+df.slice(1);Ai(Vx,"on"+Hx)}Ai(Zg,"onAnimationEnd"),Ai(Yg,"onAnimationIteration"),Ai(Jg,"onAnimationStart"),Ai("dblclick","onDoubleClick"),Ai("focusin","onFocus"),Ai("focusout","onBlur"),Ai(rx,"onTransitionRun"),Ai(ox,"onTransitionStart"),Ai(lx,"onTransitionCancel"),Ai(Qg,"onTransitionEnd"),Xa("onMouseEnter",["mouseout","mouseover"]),Xa("onMouseLeave",["mouseout","mouseover"]),Xa("onPointerEnter",["pointerout","pointerover"]),Xa("onPointerLeave",["pointerout","pointerover"]),ya("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ya("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ya("onBeforeInput",["compositionend","keypress","textInput","paste"]),ya("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ya("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ya("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$x=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(zo));function b1(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var h=s[c],g=h.event;h=h.listeners;e:{var y=void 0;if(a)for(var T=h.length-1;0<=T;T--){var M=h[T],z=M.instance,Y=M.currentTarget;if(M=M.listener,z!==y&&g.isPropagationStopped())break e;y=M,g.currentTarget=Y;try{y(g)}catch(oe){Zl(oe)}g.currentTarget=null,y=z}else for(T=0;T<h.length;T++){if(M=h[T],z=M.instance,Y=M.currentTarget,M=M.listener,z!==y&&g.isPropagationStopped())break e;y=M,g.currentTarget=Y;try{y(g)}catch(oe){Zl(oe)}g.currentTarget=null,y=z}}}}function nt(s,a){var c=a[Zt];c===void 0&&(c=a[Zt]=new Set);var h=s+"__bubble";c.has(h)||(C1(a,s,2,!1),c.add(h))}function hf(s,a,c){var h=0;a&&(h|=4),C1(c,s,h,a)}var Lc="_reactListening"+Math.random().toString(36).slice(2);function ff(s){if(!s[Lc]){s[Lc]=!0,fg.forEach(function(c){c!=="selectionchange"&&($x.has(c)||hf(c,!1,s),hf(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Lc]||(a[Lc]=!0,hf("selectionchange",!1,a))}}function C1(s,a,c,h){switch(Z1(a)){case 2:var g=bS;break;case 8:g=CS;break;default:g=Rf}c=g.bind(null,a,c,s),g=void 0,!Md||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(g=!0),h?g!==void 0?s.addEventListener(a,c,{capture:!0,passive:g}):s.addEventListener(a,c,!0):g!==void 0?s.addEventListener(a,c,{passive:g}):s.addEventListener(a,c,!1)}function mf(s,a,c,h,g){var y=h;if((a&1)===0&&(a&2)===0&&h!==null)e:for(;;){if(h===null)return;var T=h.tag;if(T===3||T===4){var M=h.stateNode.containerInfo;if(M===g)break;if(T===4)for(T=h.return;T!==null;){var z=T.tag;if((z===3||z===4)&&T.stateNode.containerInfo===g)return;T=T.return}for(;M!==null;){if(T=Ya(M),T===null)return;if(z=T.tag,z===5||z===6||z===26||z===27){h=y=T;continue e}M=M.parentNode}}h=h.return}Eg(function(){var Y=y,oe=_d(c),me=[];e:{var X=Xg.get(s);if(X!==void 0){var ne=Gl,Oe=s;switch(s){case"keypress":if(Hl(c)===0)break e;case"keydown":case"keyup":ne=U4;break;case"focusin":Oe="focus",ne=Pd;break;case"focusout":Oe="blur",ne=Pd;break;case"beforeblur":case"afterblur":ne=Pd;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=Rg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=w4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=z4;break;case Zg:case Yg:case Jg:ne=N4;break;case Qg:ne=V4;break;case"scroll":case"scrollend":ne=T4;break;case"wheel":ne=$4;break;case"copy":case"cut":case"paste":ne=A4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=_g;break;case"toggle":case"beforetoggle":ne=K4}var ze=(a&4)!==0,jt=!ze&&(s==="scroll"||s==="scrollend"),$=ze?X!==null?X+"Capture":null:X;ze=[];for(var H=Y,W;H!==null;){var de=H;if(W=de.stateNode,de=de.tag,de!==5&&de!==26&&de!==27||W===null||$===null||(de=lo(H,$),de!=null&&ze.push(qo(H,de,W))),jt)break;H=H.return}0<ze.length&&(X=new ne(X,Oe,null,c,oe),me.push({event:X,listeners:ze}))}}if((a&7)===0){e:{if(X=s==="mouseover"||s==="pointerover",ne=s==="mouseout"||s==="pointerout",X&&c!==Nd&&(Oe=c.relatedTarget||c.fromElement)&&(Ya(Oe)||Oe[Tn]))break e;if((ne||X)&&(X=oe.window===oe?oe:(X=oe.ownerDocument)?X.defaultView||X.parentWindow:window,ne?(Oe=c.relatedTarget||c.toElement,ne=Y,Oe=Oe?Ya(Oe):null,Oe!==null&&(jt=l(Oe),ze=Oe.tag,Oe!==jt||ze!==5&&ze!==27&&ze!==6)&&(Oe=null)):(ne=null,Oe=Y),ne!==Oe)){if(ze=Rg,de="onMouseLeave",$="onMouseEnter",H="mouse",(s==="pointerout"||s==="pointerover")&&(ze=_g,de="onPointerLeave",$="onPointerEnter",H="pointer"),jt=ne==null?X:oo(ne),W=Oe==null?X:oo(Oe),X=new ze(de,H+"leave",ne,c,oe),X.target=jt,X.relatedTarget=W,de=null,Ya(oe)===Y&&(ze=new ze($,H+"enter",Oe,c,oe),ze.target=W,ze.relatedTarget=jt,de=ze),jt=de,ne&&Oe)t:{for(ze=Gx,$=ne,H=Oe,W=0,de=$;de;de=ze(de))W++;de=0;for(var Ie=H;Ie;Ie=ze(Ie))de++;for(;0<W-de;)$=ze($),W--;for(;0<de-W;)H=ze(H),de--;for(;W--;){if($===H||H!==null&&$===H.alternate){ze=$;break t}$=ze($),H=ze(H)}ze=null}else ze=null;ne!==null&&x1(me,X,ne,ze,!1),Oe!==null&&jt!==null&&x1(me,jt,Oe,ze,!0)}}e:{if(X=Y?oo(Y):window,ne=X.nodeName&&X.nodeName.toLowerCase(),ne==="select"||ne==="input"&&X.type==="file")var gt=Ug;else if(Pg(X))if(Bg)gt=ix;else{gt=tx;var De=ex}else ne=X.nodeName,!ne||ne.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?Y&&Rd(Y.elementType)&&(gt=Ug):gt=nx;if(gt&&(gt=gt(s,Y))){Ig(me,gt,c,oe);break e}De&&De(s,X,Y),s==="focusout"&&Y&&X.type==="number"&&Y.memoizedProps.value!=null&&jd(X,"number",X.value)}switch(De=Y?oo(Y):window,s){case"focusin":(Pg(De)||De.contentEditable==="true")&&(ar=De,qd=Y,vo=null);break;case"focusout":vo=qd=ar=null;break;case"mousedown":Vd=!0;break;case"contextmenu":case"mouseup":case"dragend":Vd=!1,Kg(me,c,oe);break;case"selectionchange":if(ax)break;case"keydown":case"keyup":Kg(me,c,oe)}var Qe;if(Ud)e:{switch(s){case"compositionstart":var lt="onCompositionStart";break e;case"compositionend":lt="onCompositionEnd";break e;case"compositionupdate":lt="onCompositionUpdate";break e}lt=void 0}else sr?Dg(s,c)&&(lt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(lt="onCompositionStart");lt&&(Ag&&c.locale!=="ko"&&(sr||lt!=="onCompositionStart"?lt==="onCompositionEnd"&&sr&&(Qe=wg()):(Ds=oe,Od="value"in Ds?Ds.value:Ds.textContent,sr=!0)),De=Pc(Y,lt),0<De.length&&(lt=new Ng(lt,s,null,c,oe),me.push({event:lt,listeners:De}),Qe?lt.data=Qe:(Qe=Lg(c),Qe!==null&&(lt.data=Qe)))),(Qe=Z4?Y4(s,c):J4(s,c))&&(lt=Pc(Y,"onBeforeInput"),0<lt.length&&(De=new Ng("onBeforeInput","beforeinput",null,c,oe),me.push({event:De,listeners:lt}),De.data=Qe)),qx(me,s,Y,c,oe)}b1(me,a)})}function qo(s,a,c){return{instance:s,listener:a,currentTarget:c}}function Pc(s,a){for(var c=a+"Capture",h=[];s!==null;){var g=s,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=lo(s,c),g!=null&&h.unshift(qo(s,g,y)),g=lo(s,a),g!=null&&h.push(qo(s,g,y))),s.tag===3)return h;s=s.return}return[]}function Gx(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function x1(s,a,c,h,g){for(var y=a._reactName,T=[];c!==null&&c!==h;){var M=c,z=M.alternate,Y=M.stateNode;if(M=M.tag,z!==null&&z===h)break;M!==5&&M!==26&&M!==27||Y===null||(z=Y,g?(Y=lo(c,y),Y!=null&&T.unshift(qo(c,Y,z))):g||(Y=lo(c,y),Y!=null&&T.push(qo(c,Y,z)))),c=c.return}T.length!==0&&s.push({event:a,listeners:T})}var Kx=/\r\n?/g,Wx=/\u0000|\uFFFD/g;function S1(s){return(typeof s=="string"?s:""+s).replace(Kx,`
`).replace(Wx,"")}function k1(s,a){return a=S1(a),S1(s)===a}function wt(s,a,c,h,g,y){switch(c){case"children":typeof h=="string"?a==="body"||a==="textarea"&&h===""||tr(s,h):(typeof h=="number"||typeof h=="bigint")&&a!=="body"&&tr(s,""+h);break;case"className":Fl(s,"class",h);break;case"tabIndex":Fl(s,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Fl(s,c,h);break;case"style":kg(s,h,y);break;case"data":if(a!=="object"){Fl(s,"data",h);break}case"src":case"href":if(h===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(c);break}h=ql(""+h),s.setAttribute(c,h);break;case"action":case"formAction":if(typeof h=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(a!=="input"&&wt(s,a,"name",g.name,g,null),wt(s,a,"formEncType",g.formEncType,g,null),wt(s,a,"formMethod",g.formMethod,g,null),wt(s,a,"formTarget",g.formTarget,g,null)):(wt(s,a,"encType",g.encType,g,null),wt(s,a,"method",g.method,g,null),wt(s,a,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(c);break}h=ql(""+h),s.setAttribute(c,h);break;case"onClick":h!=null&&(s.onclick=rs);break;case"onScroll":h!=null&&nt("scroll",s);break;case"onScrollEnd":h!=null&&nt("scrollend",s);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"multiple":s.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":s.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){s.removeAttribute("xlink:href");break}c=ql(""+h),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(c,""+h):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":h===!0?s.setAttribute(c,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(c,h):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?s.setAttribute(c,h):s.removeAttribute(c);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?s.removeAttribute(c):s.setAttribute(c,h);break;case"popover":nt("beforetoggle",s),nt("toggle",s),Bl(s,"popover",h);break;case"xlinkActuate":as(s,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":as(s,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":as(s,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":as(s,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":as(s,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":as(s,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":as(s,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":as(s,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":as(s,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Bl(s,"is",h);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=S4.get(c)||c,Bl(s,c,h))}}function pf(s,a,c,h,g,y){switch(c){case"style":kg(s,h,y);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"children":typeof h=="string"?tr(s,h):(typeof h=="number"||typeof h=="bigint")&&tr(s,""+h);break;case"onScroll":h!=null&&nt("scroll",s);break;case"onScrollEnd":h!=null&&nt("scrollend",s);break;case"onClick":h!=null&&(s.onclick=rs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!mg.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),a=c.slice(2,g?c.length-7:void 0),y=s[sn]||null,y=y!=null?y[c]:null,typeof y=="function"&&s.removeEventListener(a,y,g),typeof h=="function")){typeof y!="function"&&y!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,h,g);break e}c in s?s[c]=h:h===!0?s.setAttribute(c,""):Bl(s,c,h)}}}function Rn(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":nt("error",s),nt("load",s);var h=!1,g=!1,y;for(y in c)if(c.hasOwnProperty(y)){var T=c[y];if(T!=null)switch(y){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:wt(s,a,y,T,c,null)}}g&&wt(s,a,"srcSet",c.srcSet,c,null),h&&wt(s,a,"src",c.src,c,null);return;case"input":nt("invalid",s);var M=y=T=g=null,z=null,Y=null;for(h in c)if(c.hasOwnProperty(h)){var oe=c[h];if(oe!=null)switch(h){case"name":g=oe;break;case"type":T=oe;break;case"checked":z=oe;break;case"defaultChecked":Y=oe;break;case"value":y=oe;break;case"defaultValue":M=oe;break;case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(i(137,a));break;default:wt(s,a,h,oe,c,null)}}bg(s,y,M,z,Y,T,g,!1);return;case"select":nt("invalid",s),h=T=y=null;for(g in c)if(c.hasOwnProperty(g)&&(M=c[g],M!=null))switch(g){case"value":y=M;break;case"defaultValue":T=M;break;case"multiple":h=M;default:wt(s,a,g,M,c,null)}a=y,c=T,s.multiple=!!h,a!=null?er(s,!!h,a,!1):c!=null&&er(s,!!h,c,!0);return;case"textarea":nt("invalid",s),y=g=h=null;for(T in c)if(c.hasOwnProperty(T)&&(M=c[T],M!=null))switch(T){case"value":h=M;break;case"defaultValue":g=M;break;case"children":y=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(i(91));break;default:wt(s,a,T,M,c,null)}xg(s,h,g,y);return;case"option":for(z in c)if(c.hasOwnProperty(z)&&(h=c[z],h!=null))switch(z){case"selected":s.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:wt(s,a,z,h,c,null)}return;case"dialog":nt("beforetoggle",s),nt("toggle",s),nt("cancel",s),nt("close",s);break;case"iframe":case"object":nt("load",s);break;case"video":case"audio":for(h=0;h<zo.length;h++)nt(zo[h],s);break;case"image":nt("error",s),nt("load",s);break;case"details":nt("toggle",s);break;case"embed":case"source":case"link":nt("error",s),nt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Y in c)if(c.hasOwnProperty(Y)&&(h=c[Y],h!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:wt(s,a,Y,h,c,null)}return;default:if(Rd(a)){for(oe in c)c.hasOwnProperty(oe)&&(h=c[oe],h!==void 0&&pf(s,a,oe,h,c,void 0));return}}for(M in c)c.hasOwnProperty(M)&&(h=c[M],h!=null&&wt(s,a,M,h,c,null))}function Zx(s,a,c,h){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,T=null,M=null,z=null,Y=null,oe=null;for(ne in c){var me=c[ne];if(c.hasOwnProperty(ne)&&me!=null)switch(ne){case"checked":break;case"value":break;case"defaultValue":z=me;default:h.hasOwnProperty(ne)||wt(s,a,ne,null,h,me)}}for(var X in h){var ne=h[X];if(me=c[X],h.hasOwnProperty(X)&&(ne!=null||me!=null))switch(X){case"type":y=ne;break;case"name":g=ne;break;case"checked":Y=ne;break;case"defaultChecked":oe=ne;break;case"value":T=ne;break;case"defaultValue":M=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(i(137,a));break;default:ne!==me&&wt(s,a,X,ne,h,me)}}wd(s,T,M,z,Y,oe,y,g);return;case"select":ne=T=M=X=null;for(y in c)if(z=c[y],c.hasOwnProperty(y)&&z!=null)switch(y){case"value":break;case"multiple":ne=z;default:h.hasOwnProperty(y)||wt(s,a,y,null,h,z)}for(g in h)if(y=h[g],z=c[g],h.hasOwnProperty(g)&&(y!=null||z!=null))switch(g){case"value":X=y;break;case"defaultValue":M=y;break;case"multiple":T=y;default:y!==z&&wt(s,a,g,y,h,z)}a=M,c=T,h=ne,X!=null?er(s,!!c,X,!1):!!h!=!!c&&(a!=null?er(s,!!c,a,!0):er(s,!!c,c?[]:"",!1));return;case"textarea":ne=X=null;for(M in c)if(g=c[M],c.hasOwnProperty(M)&&g!=null&&!h.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:wt(s,a,M,null,h,g)}for(T in h)if(g=h[T],y=c[T],h.hasOwnProperty(T)&&(g!=null||y!=null))switch(T){case"value":X=g;break;case"defaultValue":ne=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==y&&wt(s,a,T,g,h,y)}Cg(s,X,ne);return;case"option":for(var Oe in c)if(X=c[Oe],c.hasOwnProperty(Oe)&&X!=null&&!h.hasOwnProperty(Oe))switch(Oe){case"selected":s.selected=!1;break;default:wt(s,a,Oe,null,h,X)}for(z in h)if(X=h[z],ne=c[z],h.hasOwnProperty(z)&&X!==ne&&(X!=null||ne!=null))switch(z){case"selected":s.selected=X&&typeof X!="function"&&typeof X!="symbol";break;default:wt(s,a,z,X,h,ne)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ze in c)X=c[ze],c.hasOwnProperty(ze)&&X!=null&&!h.hasOwnProperty(ze)&&wt(s,a,ze,null,h,X);for(Y in h)if(X=h[Y],ne=c[Y],h.hasOwnProperty(Y)&&X!==ne&&(X!=null||ne!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(137,a));break;default:wt(s,a,Y,X,h,ne)}return;default:if(Rd(a)){for(var jt in c)X=c[jt],c.hasOwnProperty(jt)&&X!==void 0&&!h.hasOwnProperty(jt)&&pf(s,a,jt,void 0,h,X);for(oe in h)X=h[oe],ne=c[oe],!h.hasOwnProperty(oe)||X===ne||X===void 0&&ne===void 0||pf(s,a,oe,X,h,ne);return}}for(var $ in c)X=c[$],c.hasOwnProperty($)&&X!=null&&!h.hasOwnProperty($)&&wt(s,a,$,null,h,X);for(me in h)X=h[me],ne=c[me],!h.hasOwnProperty(me)||X===ne||X==null&&ne==null||wt(s,a,me,X,h,ne)}function T1(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Yx(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),h=0;h<c.length;h++){var g=c[h],y=g.transferSize,T=g.initiatorType,M=g.duration;if(y&&M&&T1(T)){for(T=0,M=g.responseEnd,h+=1;h<c.length;h++){var z=c[h],Y=z.startTime;if(Y>M)break;var oe=z.transferSize,me=z.initiatorType;oe&&T1(me)&&(z=z.responseEnd,T+=oe*(z<M?1:(M-Y)/(z-Y)))}if(--h,a+=8*(y+T)/(g.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var gf=null,vf=null;function Ic(s){return s.nodeType===9?s:s.ownerDocument}function E1(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function w1(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function yf(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var bf=null;function Jx(){var s=window.event;return s&&s.type==="popstate"?s===bf?!1:(bf=s,!0):(bf=null,!1)}var j1=typeof setTimeout=="function"?setTimeout:void 0,Qx=typeof clearTimeout=="function"?clearTimeout:void 0,R1=typeof Promise=="function"?Promise:void 0,Xx=typeof queueMicrotask=="function"?queueMicrotask:typeof R1<"u"?function(s){return R1.resolve(null).then(s).catch(eS)}:j1;function eS(s){setTimeout(function(){throw s})}function Js(s){return s==="head"}function N1(s,a){var c=a,h=0;do{var g=c.nextSibling;if(s.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"||c==="/&"){if(h===0){s.removeChild(g),Mr(a);return}h--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")h++;else if(c==="html")Vo(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,Vo(c);for(var y=c.firstChild;y;){var T=y.nextSibling,M=y.nodeName;y[ro]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&y.rel.toLowerCase()==="stylesheet"||c.removeChild(y),y=T}}else c==="body"&&Vo(s.ownerDocument.body);c=g}while(c);Mr(a)}function _1(s,a){var c=s;s=0;do{var h=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),h&&h.nodeType===8)if(c=h.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=h}while(c)}function Cf(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Cf(c),Td(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function tS(s,a,c,h){for(;s.nodeType===1;){var g=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!h&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(h){if(!s[ro])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(y=s.getAttribute("rel"),y==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(y!==g.rel||s.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||s.getAttribute("title")!==(g.title==null?null:g.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(y=s.getAttribute("src"),(y!==(g.src==null?null:g.src)||s.getAttribute("type")!==(g.type==null?null:g.type)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&s.getAttribute("name")===y)return s}else return s;if(s=ki(s.nextSibling),s===null)break}return null}function nS(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=ki(s.nextSibling),s===null))return null;return s}function A1(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=ki(s.nextSibling),s===null))return null;return s}function xf(s){return s.data==="$?"||s.data==="$~"}function Sf(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function iS(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var h=function(){a(),c.removeEventListener("DOMContentLoaded",h)};c.addEventListener("DOMContentLoaded",h),s._reactRetry=h}}function ki(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var kf=null;function M1(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return ki(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function O1(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function D1(s,a,c){switch(a=Ic(c),s){case"html":if(s=a.documentElement,!s)throw Error(i(452));return s;case"head":if(s=a.head,!s)throw Error(i(453));return s;case"body":if(s=a.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function Vo(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Td(s)}var Ti=new Map,L1=new Set;function Uc(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Ss=ee.d;ee.d={f:sS,r:aS,D:rS,C:oS,L:lS,m:cS,X:dS,S:uS,M:hS};function sS(){var s=Ss.f(),a=Nc();return s||a}function aS(s){var a=Ja(s);a!==null&&a.tag===5&&a.type==="form"?Q0(a):Ss.r(s)}var Nr=typeof document>"u"?null:document;function P1(s,a,c){var h=Nr;if(h&&typeof a=="string"&&a){var g=gi(a);g='link[rel="'+s+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),L1.has(g)||(L1.add(g),s={rel:s,crossOrigin:c,href:a},h.querySelector(g)===null&&(a=h.createElement("link"),Rn(a,"link",s),bn(a),h.head.appendChild(a)))}}function rS(s){Ss.D(s),P1("dns-prefetch",s,null)}function oS(s,a){Ss.C(s,a),P1("preconnect",s,a)}function lS(s,a,c){Ss.L(s,a,c);var h=Nr;if(h&&s&&a){var g='link[rel="preload"][as="'+gi(a)+'"]';a==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+gi(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+gi(c.imageSizes)+'"]')):g+='[href="'+gi(s)+'"]';var y=g;switch(a){case"style":y=_r(s);break;case"script":y=Ar(s)}Ti.has(y)||(s=v({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Ti.set(y,s),h.querySelector(g)!==null||a==="style"&&h.querySelector(Ho(y))||a==="script"&&h.querySelector($o(y))||(a=h.createElement("link"),Rn(a,"link",s),bn(a),h.head.appendChild(a)))}}function cS(s,a){Ss.m(s,a);var c=Nr;if(c&&s){var h=a&&typeof a.as=="string"?a.as:"script",g='link[rel="modulepreload"][as="'+gi(h)+'"][href="'+gi(s)+'"]',y=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=Ar(s)}if(!Ti.has(y)&&(s=v({rel:"modulepreload",href:s},a),Ti.set(y,s),c.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector($o(y)))return}h=c.createElement("link"),Rn(h,"link",s),bn(h),c.head.appendChild(h)}}}function uS(s,a,c){Ss.S(s,a,c);var h=Nr;if(h&&s){var g=Qa(h).hoistableStyles,y=_r(s);a=a||"default";var T=g.get(y);if(!T){var M={loading:0,preload:null};if(T=h.querySelector(Ho(y)))M.loading=5;else{s=v({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Ti.get(y))&&Tf(s,c);var z=T=h.createElement("link");bn(z),Rn(z,"link",s),z._p=new Promise(function(Y,oe){z.onload=Y,z.onerror=oe}),z.addEventListener("load",function(){M.loading|=1}),z.addEventListener("error",function(){M.loading|=2}),M.loading|=4,Bc(T,a,h)}T={type:"stylesheet",instance:T,count:1,state:M},g.set(y,T)}}}function dS(s,a){Ss.X(s,a);var c=Nr;if(c&&s){var h=Qa(c).hoistableScripts,g=Ar(s),y=h.get(g);y||(y=c.querySelector($o(g)),y||(s=v({src:s,async:!0},a),(a=Ti.get(g))&&Ef(s,a),y=c.createElement("script"),bn(y),Rn(y,"link",s),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function hS(s,a){Ss.M(s,a);var c=Nr;if(c&&s){var h=Qa(c).hoistableScripts,g=Ar(s),y=h.get(g);y||(y=c.querySelector($o(g)),y||(s=v({src:s,async:!0,type:"module"},a),(a=Ti.get(g))&&Ef(s,a),y=c.createElement("script"),bn(y),Rn(y,"link",s),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function I1(s,a,c,h){var g=(g=ce.current)?Uc(g):null;if(!g)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=_r(c.href),c=Qa(g).hoistableStyles,h=c.get(a),h||(h={type:"style",instance:null,count:0,state:null},c.set(a,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=_r(c.href);var y=Qa(g).hoistableStyles,T=y.get(s);if(T||(g=g.ownerDocument||g,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(s,T),(y=g.querySelector(Ho(s)))&&!y._p&&(T.instance=y,T.state.loading=5),Ti.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ti.set(s,c),y||fS(g,s,c,T.state))),a&&h===null)throw Error(i(528,""));return T}if(a&&h!==null)throw Error(i(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Ar(c),c=Qa(g).hoistableScripts,h=c.get(a),h||(h={type:"script",instance:null,count:0,state:null},c.set(a,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function _r(s){return'href="'+gi(s)+'"'}function Ho(s){return'link[rel="stylesheet"]['+s+"]"}function U1(s){return v({},s,{"data-precedence":s.precedence,precedence:null})}function fS(s,a,c,h){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?h.loading=1:(a=s.createElement("link"),h.preload=a,a.addEventListener("load",function(){return h.loading|=1}),a.addEventListener("error",function(){return h.loading|=2}),Rn(a,"link",c),bn(a),s.head.appendChild(a))}function Ar(s){return'[src="'+gi(s)+'"]'}function $o(s){return"script[async]"+s}function B1(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var h=s.querySelector('style[data-href~="'+gi(c.href)+'"]');if(h)return a.instance=h,bn(h),h;var g=v({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return h=(s.ownerDocument||s).createElement("style"),bn(h),Rn(h,"style",g),Bc(h,c.precedence,s),a.instance=h;case"stylesheet":g=_r(c.href);var y=s.querySelector(Ho(g));if(y)return a.state.loading|=4,a.instance=y,bn(y),y;h=U1(c),(g=Ti.get(g))&&Tf(h,g),y=(s.ownerDocument||s).createElement("link"),bn(y);var T=y;return T._p=new Promise(function(M,z){T.onload=M,T.onerror=z}),Rn(y,"link",h),a.state.loading|=4,Bc(y,c.precedence,s),a.instance=y;case"script":return y=Ar(c.src),(g=s.querySelector($o(y)))?(a.instance=g,bn(g),g):(h=c,(g=Ti.get(y))&&(h=v({},c),Ef(h,g)),s=s.ownerDocument||s,g=s.createElement("script"),bn(g),Rn(g,"link",h),s.head.appendChild(g),a.instance=g);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(h=a.instance,a.state.loading|=4,Bc(h,c.precedence,s));return a.instance}function Bc(s,a,c){for(var h=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,y=g,T=0;T<h.length;T++){var M=h[T];if(M.dataset.precedence===a)y=M;else if(y!==g)break}y?y.parentNode.insertBefore(s,y.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function Tf(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function Ef(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Fc=null;function F1(s,a,c){if(Fc===null){var h=new Map,g=Fc=new Map;g.set(c,h)}else g=Fc,h=g.get(c),h||(h=new Map,g.set(c,h));if(h.has(s))return h;for(h.set(s,null),c=c.getElementsByTagName(s),g=0;g<c.length;g++){var y=c[g];if(!(y[ro]||y[Ft]||s==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var T=y.getAttribute(a)||"";T=s+T;var M=h.get(T);M?M.push(y):h.set(T,[y])}}return h}function z1(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function mS(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return s=a.disabled,typeof a.precedence=="string"&&s==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function q1(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function pS(s,a,c,h){if(c.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var g=_r(h.href),y=a.querySelector(Ho(g));if(y){a=y._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=zc.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=y,bn(y);return}y=a.ownerDocument||a,h=U1(h),(g=Ti.get(g))&&Tf(h,g),y=y.createElement("link"),bn(y);var T=y;T._p=new Promise(function(M,z){T.onload=M,T.onerror=z}),Rn(y,"link",h),c.instance=y}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=zc.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var wf=0;function gS(s,a){return s.stylesheets&&s.count===0&&Vc(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var h=setTimeout(function(){if(s.stylesheets&&Vc(s,s.stylesheets),s.unsuspend){var y=s.unsuspend;s.unsuspend=null,y()}},6e4+a);0<s.imgBytes&&wf===0&&(wf=62500*Yx());var g=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Vc(s,s.stylesheets),s.unsuspend)){var y=s.unsuspend;s.unsuspend=null,y()}},(s.imgBytes>wf?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(h),clearTimeout(g)}}:null}function zc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Vc(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var qc=null;function Vc(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,qc=new Map,a.forEach(vS,s),qc=null,zc.call(s))}function vS(s,a){if(!(a.state.loading&4)){var c=qc.get(s);if(c)var h=c.get(null);else{c=new Map,qc.set(s,c);for(var g=s.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var T=g[y];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(c.set(T.dataset.precedence,T),h=T)}h&&c.set(null,h)}g=a.instance,T=g.getAttribute("data-precedence"),y=c.get(T)||h,y===h&&c.set(null,g),c.set(T,g),this.count++,h=zc.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),y?y.parentNode.insertBefore(g,y.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(g,s.firstChild)),a.state.loading|=4}}var Go={$$typeof:A,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function yS(s,a,c,h,g,y,T,M,z){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ao(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ao(0),this.hiddenUpdates=ao(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function V1(s,a,c,h,g,y,T,M,z,Y,oe,me){return s=new yS(s,a,c,T,z,Y,oe,me,M),a=1,y===!0&&(a|=24),y=ai(3,null,null,a),s.current=y,y.stateNode=s,a=sh(),a.refCount++,s.pooledCache=a,a.refCount++,y.memoizedState={element:h,isDehydrated:c,cache:a},lh(y),s}function H1(s){return s?(s=lr,s):lr}function $1(s,a,c,h,g,y){g=H1(g),h.context===null?h.context=g:h.pendingContext=g,h=Fs(a),h.payload={element:c},y=y===void 0?null:y,y!==null&&(h.callback=y),c=zs(s,h,a),c!==null&&(Wn(c,s,a),To(c,s,a))}function G1(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function jf(s,a){G1(s,a),(s=s.alternate)&&G1(s,a)}function K1(s){if(s.tag===13||s.tag===31){var a=Sa(s,67108864);a!==null&&Wn(a,s,67108864),jf(s,67108864)}}function W1(s){if(s.tag===13||s.tag===31){var a=ui();a=Le(a);var c=Sa(s,a);c!==null&&Wn(c,s,a),jf(s,a)}}var Hc=!0;function bS(s,a,c,h){var g=q.T;q.T=null;var y=ee.p;try{ee.p=2,Rf(s,a,c,h)}finally{ee.p=y,q.T=g}}function CS(s,a,c,h){var g=q.T;q.T=null;var y=ee.p;try{ee.p=8,Rf(s,a,c,h)}finally{ee.p=y,q.T=g}}function Rf(s,a,c,h){if(Hc){var g=Nf(h);if(g===null)mf(s,a,h,$c,c),Y1(s,h);else if(SS(g,s,a,c,h))h.stopPropagation();else if(Y1(s,h),a&4&&-1<xS.indexOf(s)){for(;g!==null;){var y=Ja(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var T=Fe(y.pendingLanes);if(T!==0){var M=y;for(M.pendingLanes|=2,M.entangledLanes|=2;T;){var z=1<<31-qt(T);M.entanglements[1]|=z,T&=~z}Zi(y),(bt&6)===0&&(jc=Je()+500,Fo(0))}}break;case 31:case 13:M=Sa(y,2),M!==null&&Wn(M,y,2),Nc(),jf(y,2)}if(y=Nf(h),y===null&&mf(s,a,h,$c,c),y===g)break;g=y}g!==null&&h.stopPropagation()}else mf(s,a,h,null,c)}}function Nf(s){return s=_d(s),_f(s)}var $c=null;function _f(s){if($c=null,s=Ya(s),s!==null){var a=l(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=u(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return $c=s,null}function Z1(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(xe()){case Ne:return 2;case Ke:return 8;case ft:case zt:return 32;case dn:return 268435456;default:return 32}default:return 32}}var Af=!1,Qs=null,Xs=null,ea=null,Ko=new Map,Wo=new Map,ta=[],xS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Y1(s,a){switch(s){case"focusin":case"focusout":Qs=null;break;case"dragenter":case"dragleave":Xs=null;break;case"mouseover":case"mouseout":ea=null;break;case"pointerover":case"pointerout":Ko.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wo.delete(a.pointerId)}}function Zo(s,a,c,h,g,y){return s===null||s.nativeEvent!==y?(s={blockedOn:a,domEventName:c,eventSystemFlags:h,nativeEvent:y,targetContainers:[g]},a!==null&&(a=Ja(a),a!==null&&K1(a)),s):(s.eventSystemFlags|=h,a=s.targetContainers,g!==null&&a.indexOf(g)===-1&&a.push(g),s)}function SS(s,a,c,h,g){switch(a){case"focusin":return Qs=Zo(Qs,s,a,c,h,g),!0;case"dragenter":return Xs=Zo(Xs,s,a,c,h,g),!0;case"mouseover":return ea=Zo(ea,s,a,c,h,g),!0;case"pointerover":var y=g.pointerId;return Ko.set(y,Zo(Ko.get(y)||null,s,a,c,h,g)),!0;case"gotpointercapture":return y=g.pointerId,Wo.set(y,Zo(Wo.get(y)||null,s,a,c,h,g)),!0}return!1}function J1(s){var a=Ya(s.target);if(a!==null){var c=l(a);if(c!==null){if(a=c.tag,a===13){if(a=u(c),a!==null){s.blockedOn=a,mi(s.priority,function(){W1(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,mi(s.priority,function(){W1(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Gc(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=Nf(s.nativeEvent);if(c===null){c=s.nativeEvent;var h=new c.constructor(c.type,c);Nd=h,c.target.dispatchEvent(h),Nd=null}else return a=Ja(c),a!==null&&K1(a),s.blockedOn=c,!1;a.shift()}return!0}function Q1(s,a,c){Gc(s)&&c.delete(a)}function kS(){Af=!1,Qs!==null&&Gc(Qs)&&(Qs=null),Xs!==null&&Gc(Xs)&&(Xs=null),ea!==null&&Gc(ea)&&(ea=null),Ko.forEach(Q1),Wo.forEach(Q1)}function Kc(s,a){s.blockedOn===a&&(s.blockedOn=null,Af||(Af=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,kS)))}var Wc=null;function X1(s){Wc!==s&&(Wc=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Wc===s&&(Wc=null);for(var a=0;a<s.length;a+=3){var c=s[a],h=s[a+1],g=s[a+2];if(typeof h!="function"){if(_f(h||c)===null)continue;break}var y=Ja(c);y!==null&&(s.splice(a,3),a-=3,Rh(y,{pending:!0,data:g,method:c.method,action:h},h,g))}}))}function Mr(s){function a(z){return Kc(z,s)}Qs!==null&&Kc(Qs,s),Xs!==null&&Kc(Xs,s),ea!==null&&Kc(ea,s),Ko.forEach(a),Wo.forEach(a);for(var c=0;c<ta.length;c++){var h=ta[c];h.blockedOn===s&&(h.blockedOn=null)}for(;0<ta.length&&(c=ta[0],c.blockedOn===null);)J1(c),c.blockedOn===null&&ta.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(h=0;h<c.length;h+=3){var g=c[h],y=c[h+1],T=g[sn]||null;if(typeof y=="function")T||X1(c);else if(T){var M=null;if(y&&y.hasAttribute("formAction")){if(g=y,T=y[sn]||null)M=T.formAction;else if(_f(g)!==null)continue}else M=T.action;typeof M=="function"?c[h+1]=M:(c.splice(h,3),h-=3),X1(c)}}}function ey(){function s(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(T){return g=T})},focusReset:"manual",scroll:"manual"})}function a(){g!==null&&(g(),g=null),h||setTimeout(c,20)}function c(){if(!h&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,g=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){h=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),g!==null&&(g(),g=null)}}}function Mf(s){this._internalRoot=s}Zc.prototype.render=Mf.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(i(409));var c=a.current,h=ui();$1(c,h,s,a,null,null)},Zc.prototype.unmount=Mf.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;$1(s.current,2,null,s,null,null),Nc(),a[Tn]=null}};function Zc(s){this._internalRoot=s}Zc.prototype.unstable_scheduleHydration=function(s){if(s){var a=Wt();s={blockedOn:null,target:s,priority:a};for(var c=0;c<ta.length&&a!==0&&a<ta[c].priority;c++);ta.splice(c,0,s),c===0&&J1(s)}};var ty=e.version;if(ty!=="19.2.1")throw Error(i(527,ty,"19.2.1"));ee.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=m(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var TS={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yc.isDisabled&&Yc.supportsFiber)try{fi=Yc.inject(TS),nn=Yc}catch{}}return Jo.createRoot=function(s,a){if(!r(s))throw Error(i(299));var c=!1,h="",g=lv,y=cv,T=uv;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(h=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(y=a.onCaughtError),a.onRecoverableError!==void 0&&(T=a.onRecoverableError)),a=V1(s,1,!1,null,null,c,h,null,g,y,T,ey),s[Tn]=a.current,ff(s),new Mf(a)},Jo.hydrateRoot=function(s,a,c){if(!r(s))throw Error(i(299));var h=!1,g="",y=lv,T=cv,M=uv,z=null;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(T=c.onCaughtError),c.onRecoverableError!==void 0&&(M=c.onRecoverableError),c.formState!==void 0&&(z=c.formState)),a=V1(s,1,!0,a,c??null,h,g,z,y,T,M,ey),a.context=H1(null),c=a.current,h=ui(),h=Le(h),g=Fs(h),g.callback=null,zs(c,g,h),c=h,a.current.lanes=c,va(a,c),Zi(a),s[Tn]=a.current,ff(s),new Zc(a)},Jo.version="19.2.1",Jo}var dy;function OS(){if(dy)return Lf.exports;dy=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Lf.exports=MS(),Lf.exports}var DS=OS();const LS=T2(DS);/**
 * react-router v7.10.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var hy="popstate";function PS(t={}){function e(r,l){let{pathname:u="/",search:d="",hash:f=""}=Ka(r.location.hash.substring(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),xm("",{pathname:u,search:d,hash:f},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(r,l){let u=r.document.querySelector("base"),d="";if(u&&u.getAttribute("href")){let f=r.location.href,m=f.indexOf("#");d=m===-1?f:f.slice(0,m)}return d+"#"+(typeof l=="string"?l:pl(l))}function i(r,l){ni(r.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(l)})`)}return US(e,n,i,t)}function Ut(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function ni(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function IS(){return Math.random().toString(36).substring(2,10)}function fy(t,e){return{usr:t.state,key:t.key,idx:e}}function xm(t,e,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ka(e):e,state:n,key:e&&e.key||i||IS()}}function pl({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ka(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substring(i),t=t.substring(0,i)),t&&(e.pathname=t)}return e}function US(t,e,n,i={}){let{window:r=document.defaultView,v5Compat:l=!1}=i,u=r.history,d="POP",f=null,m=p();m==null&&(m=0,u.replaceState({...u.state,idx:m},""));function p(){return(u.state||{idx:null}).idx}function v(){d="POP";let E=p(),_=E==null?null:E-m;m=E,f&&f({action:d,location:k.location,delta:_})}function C(E,_){d="PUSH";let O=xm(k.location,E,_);n&&n(O,E),m=p()+1;let A=fy(O,m),w=k.createHref(O);try{u.pushState(A,"",w)}catch(j){if(j instanceof DOMException&&j.name==="DataCloneError")throw j;r.location.assign(w)}l&&f&&f({action:d,location:k.location,delta:1})}function x(E,_){d="REPLACE";let O=xm(k.location,E,_);n&&n(O,E),m=p();let A=fy(O,m),w=k.createHref(O);u.replaceState(A,"",w),l&&f&&f({action:d,location:k.location,delta:0})}function S(E){return BS(E)}let k={get action(){return d},get location(){return t(r,u)},listen(E){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(hy,v),f=E,()=>{r.removeEventListener(hy,v),f=null}},createHref(E){return e(r,E)},createURL:S,encodeLocation(E){let _=S(E);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:C,replace:x,go(E){return u.go(E)}};return k}function BS(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Ut(n,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:pl(t);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function w2(t,e,n="/"){return FS(t,e,n,!1)}function FS(t,e,n,i){let r=typeof e=="string"?Ka(e):e,l=_s(r.pathname||"/",n);if(l==null)return null;let u=j2(t);zS(u);let d=null;for(let f=0;d==null&&f<u.length;++f){let m=QS(l);d=YS(u[f],m,i)}return d}function j2(t,e=[],n=[],i="",r=!1){let l=(u,d,f=r,m)=>{let p={relativePath:m===void 0?u.path||"":m,caseSensitive:u.caseSensitive===!0,childrenIndex:d,route:u};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(i)&&f)return;Ut(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length)}let v=Ns([i,p.relativePath]),C=n.concat(p);u.children&&u.children.length>0&&(Ut(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),j2(u.children,e,C,v,f)),!(u.path==null&&!u.index)&&e.push({path:v,score:WS(v,u.index),routesMeta:C})};return t.forEach((u,d)=>{var f;if(u.path===""||!((f=u.path)!=null&&f.includes("?")))l(u,d);else for(let m of R2(u.path))l(u,d,!0,m)}),e}function R2(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),l=n.replace(/\?$/,"");if(i.length===0)return r?[l,""]:[l];let u=R2(i.join("/")),d=[];return d.push(...u.map(f=>f===""?l:[l,f].join("/"))),r&&d.push(...u),d.map(f=>t.startsWith("/")&&f===""?"/":f)}function zS(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:ZS(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var qS=/^:[\w-]+$/,VS=3,HS=2,$S=1,GS=10,KS=-2,my=t=>t==="*";function WS(t,e){let n=t.split("/"),i=n.length;return n.some(my)&&(i+=KS),e&&(i+=HS),n.filter(r=>!my(r)).reduce((r,l)=>r+(qS.test(l)?VS:l===""?$S:GS),i)}function ZS(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function YS(t,e,n=!1){let{routesMeta:i}=t,r={},l="/",u=[];for(let d=0;d<i.length;++d){let f=i[d],m=d===i.length-1,p=l==="/"?e:e.slice(l.length)||"/",v=Du({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},p),C=f.route;if(!v&&m&&n&&!i[i.length-1].route.index&&(v=Du({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},p)),!v)return null;Object.assign(r,v.params),u.push({params:r,pathname:Ns([l,v.pathname]),pathnameBase:ik(Ns([l,v.pathnameBase])),route:C}),v.pathnameBase!=="/"&&(l=Ns([l,v.pathnameBase]))}return u}function Du(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=JS(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let l=r[0],u=l.replace(/(.)\/+$/,"$1"),d=r.slice(1);return{params:i.reduce((m,{paramName:p,isOptional:v},C)=>{if(p==="*"){let S=d[C]||"";u=l.slice(0,l.length-S.length).replace(/(.)\/+$/,"$1")}const x=d[C];return v&&!x?m[p]=void 0:m[p]=(x||"").replace(/%2F/g,"/"),m},{}),pathname:l,pathnameBase:u,pattern:t}}function JS(t,e=!1,n=!0){ni(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,d,f)=>(i.push({paramName:d,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function QS(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ni(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function _s(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}var XS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ek=t=>XS.test(t);function tk(t,e="/"){let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?Ka(t):t,l;if(n)if(ek(n))l=n;else{if(n.includes("//")){let u=n;n=n.replace(/\/\/+/g,"/"),ni(!1,`Pathnames cannot have embedded double slashes - normalizing ${u} -> ${n}`)}n.startsWith("/")?l=py(n.substring(1),"/"):l=py(n,e)}else l=e;return{pathname:l,search:sk(i),hash:ak(r)}}function py(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Bf(t,e,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function nk(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function yp(t){let e=nk(t);return e.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase)}function bp(t,e,n,i=!1){let r;typeof t=="string"?r=Ka(t):(r={...t},Ut(!r.pathname||!r.pathname.includes("?"),Bf("?","pathname","search",r)),Ut(!r.pathname||!r.pathname.includes("#"),Bf("#","pathname","hash",r)),Ut(!r.search||!r.search.includes("#"),Bf("#","search","hash",r)));let l=t===""||r.pathname==="",u=l?"/":r.pathname,d;if(u==null)d=n;else{let v=e.length-1;if(!i&&u.startsWith("..")){let C=u.split("/");for(;C[0]==="..";)C.shift(),v-=1;r.pathname=C.join("/")}d=v>=0?e[v]:"/"}let f=tk(r,d),m=u&&u!=="/"&&u.endsWith("/"),p=(l||u===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(m||p)&&(f.pathname+="/"),f}var Ns=t=>t.join("/").replace(/\/\/+/g,"/"),ik=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),sk=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,ak=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function rk(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function ok(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var N2=["POST","PUT","PATCH","DELETE"];new Set(N2);var lk=["GET",...N2];new Set(lk);var Yr=b.createContext(null);Yr.displayName="DataRouter";var Yu=b.createContext(null);Yu.displayName="DataRouterState";b.createContext(!1);var _2=b.createContext({isTransitioning:!1});_2.displayName="ViewTransition";var ck=b.createContext(new Map);ck.displayName="Fetchers";var uk=b.createContext(null);uk.displayName="Await";var Ni=b.createContext(null);Ni.displayName="Navigation";var El=b.createContext(null);El.displayName="Location";var Vi=b.createContext({outlet:null,matches:[],isDataRoute:!1});Vi.displayName="Route";var Cp=b.createContext(null);Cp.displayName="RouteError";function dk(t,{relative:e}={}){Ut(Jr(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=b.useContext(Ni),{hash:r,pathname:l,search:u}=jl(t,{relative:e}),d=l;return n!=="/"&&(d=l==="/"?n:Ns([n,l])),i.createHref({pathname:d,search:u,hash:r})}function Jr(){return b.useContext(El)!=null}function Fn(){return Ut(Jr(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(El).location}var A2="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function M2(t){b.useContext(Ni).static||b.useLayoutEffect(t)}function yn(){let{isDataRoute:t}=b.useContext(Vi);return t?Tk():hk()}function hk(){Ut(Jr(),"useNavigate() may be used only in the context of a <Router> component.");let t=b.useContext(Yr),{basename:e,navigator:n}=b.useContext(Ni),{matches:i}=b.useContext(Vi),{pathname:r}=Fn(),l=JSON.stringify(yp(i)),u=b.useRef(!1);return M2(()=>{u.current=!0}),b.useCallback((f,m={})=>{if(ni(u.current,A2),!u.current)return;if(typeof f=="number"){n.go(f);return}let p=bp(f,JSON.parse(l),r,m.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Ns([e,p.pathname])),(m.replace?n.replace:n.push)(p,m.state,m)},[e,n,l,r,t])}b.createContext(null);function wl(){let{matches:t}=b.useContext(Vi),e=t[t.length-1];return e?e.params:{}}function jl(t,{relative:e}={}){let{matches:n}=b.useContext(Vi),{pathname:i}=Fn(),r=JSON.stringify(yp(n));return b.useMemo(()=>bp(t,JSON.parse(r),i,e==="path"),[t,r,i,e])}function fk(t,e){return O2(t,e)}function O2(t,e,n,i,r){var O;Ut(Jr(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=b.useContext(Ni),{matches:u}=b.useContext(Vi),d=u[u.length-1],f=d?d.params:{},m=d?d.pathname:"/",p=d?d.pathnameBase:"/",v=d&&d.route;{let A=v&&v.path||"";D2(m,!v||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let C=Fn(),x;if(e){let A=typeof e=="string"?Ka(e):e;Ut(p==="/"||((O=A.pathname)==null?void 0:O.startsWith(p)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${A.pathname}" was given in the \`location\` prop.`),x=A}else x=C;let S=x.pathname||"/",k=S;if(p!=="/"){let A=p.replace(/^\//,"").split("/");k="/"+S.replace(/^\//,"").split("/").slice(A.length).join("/")}let E=w2(t,{pathname:k});ni(v||E!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),ni(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _=yk(E&&E.map(A=>Object.assign({},A,{params:Object.assign({},f,A.params),pathname:Ns([p,l.encodeLocation?l.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?p:Ns([p,l.encodeLocation?l.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),u,n,i,r);return e&&_?b.createElement(El.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},_):_}function mk(){let t=kk(),e=rk(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i},l={padding:"2px 4px",backgroundColor:i},u=null;return console.error("Error handled by React Router default ErrorBoundary:",t),u=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:l},"ErrorBoundary")," or"," ",b.createElement("code",{style:l},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),n?b.createElement("pre",{style:r},n):null,u)}var pk=b.createElement(mk,null),gk=class extends b.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?b.createElement(Vi.Provider,{value:this.props.routeContext},b.createElement(Cp.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function vk({routeContext:t,match:e,children:n}){let i=b.useContext(Yr);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),b.createElement(Vi.Provider,{value:t},n)}function yk(t,e=[],n=null,i=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,u=n==null?void 0:n.errors;if(u!=null){let p=l.findIndex(v=>v.route.id&&(u==null?void 0:u[v.route.id])!==void 0);Ut(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),l=l.slice(0,Math.min(l.length,p+1))}let d=!1,f=-1;if(n)for(let p=0;p<l.length;p++){let v=l[p];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(f=p),v.route.id){let{loaderData:C,errors:x}=n,S=v.route.loader&&!C.hasOwnProperty(v.route.id)&&(!x||x[v.route.id]===void 0);if(v.route.lazy||S){d=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}let m=n&&i?(p,v)=>{var C,x;i(p,{location:n.location,params:((x=(C=n.matches)==null?void 0:C[0])==null?void 0:x.params)??{},unstable_pattern:ok(n.matches),errorInfo:v})}:void 0;return l.reduceRight((p,v,C)=>{let x,S=!1,k=null,E=null;n&&(x=u&&v.route.id?u[v.route.id]:void 0,k=v.route.errorElement||pk,d&&(f<0&&C===0?(D2("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,E=null):f===C&&(S=!0,E=v.route.hydrateFallbackElement||null)));let _=e.concat(l.slice(0,C+1)),O=()=>{let A;return x?A=k:S?A=E:v.route.Component?A=b.createElement(v.route.Component,null):v.route.element?A=v.route.element:A=p,b.createElement(vk,{match:v,routeContext:{outlet:p,matches:_,isDataRoute:n!=null},children:A})};return n&&(v.route.ErrorBoundary||v.route.errorElement||C===0)?b.createElement(gk,{location:n.location,revalidation:n.revalidation,component:k,error:x,children:O(),routeContext:{outlet:null,matches:_,isDataRoute:!0},onError:m}):O()},null)}function xp(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bk(t){let e=b.useContext(Yr);return Ut(e,xp(t)),e}function Ck(t){let e=b.useContext(Yu);return Ut(e,xp(t)),e}function xk(t){let e=b.useContext(Vi);return Ut(e,xp(t)),e}function Sp(t){let e=xk(t),n=e.matches[e.matches.length-1];return Ut(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function Sk(){return Sp("useRouteId")}function kk(){var i;let t=b.useContext(Cp),e=Ck("useRouteError"),n=Sp("useRouteError");return t!==void 0?t:(i=e.errors)==null?void 0:i[n]}function Tk(){let{router:t}=bk("useNavigate"),e=Sp("useNavigate"),n=b.useRef(!1);return M2(()=>{n.current=!0}),b.useCallback(async(r,l={})=>{ni(n.current,A2),n.current&&(typeof r=="number"?await t.navigate(r):await t.navigate(r,{fromRouteId:e,...l}))},[t,e])}var gy={};function D2(t,e,n){!e&&!gy[t]&&(gy[t]=!0,ni(!1,n))}b.memo(Ek);function Ek({routes:t,future:e,state:n,unstable_onError:i}){return O2(t,void 0,n,i,e)}function vy({to:t,replace:e,state:n,relative:i}){Ut(Jr(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=b.useContext(Ni);ni(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=b.useContext(Vi),{pathname:u}=Fn(),d=yn(),f=bp(t,yp(l),u,i==="path"),m=JSON.stringify(f);return b.useEffect(()=>{d(JSON.parse(m),{replace:e,state:n,relative:i})},[d,m,i,e,n]),null}function Qt(t){Ut(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function wk({basename:t="/",children:e=null,location:n,navigationType:i="POP",navigator:r,static:l=!1,unstable_useTransitions:u}){Ut(!Jr(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),f=b.useMemo(()=>({basename:d,navigator:r,static:l,unstable_useTransitions:u,future:{}}),[d,r,l,u]);typeof n=="string"&&(n=Ka(n));let{pathname:m="/",search:p="",hash:v="",state:C=null,key:x="default"}=n,S=b.useMemo(()=>{let k=_s(m,d);return k==null?null:{location:{pathname:k,search:p,hash:v,state:C,key:x},navigationType:i}},[d,m,p,v,C,x,i]);return ni(S!=null,`<Router basename="${d}"> is not able to match the URL "${m}${p}${v}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:b.createElement(Ni.Provider,{value:f},b.createElement(El.Provider,{children:e,value:S}))}function jk({children:t,location:e}){return fk(Sm(t),e)}function Sm(t,e=[]){let n=[];return b.Children.forEach(t,(i,r)=>{if(!b.isValidElement(i))return;let l=[...e,r];if(i.type===b.Fragment){n.push.apply(n,Sm(i.props.children,l));return}Ut(i.type===Qt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ut(!i.props.index||!i.props.children,"An index route cannot have child routes.");let u={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(u.children=Sm(i.props.children,l)),n.push(u)}),n}var au="get",ru="application/x-www-form-urlencoded";function Ju(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function Rk(t){return Ju(t)&&t.tagName.toLowerCase()==="button"}function Nk(t){return Ju(t)&&t.tagName.toLowerCase()==="form"}function _k(t){return Ju(t)&&t.tagName.toLowerCase()==="input"}function Ak(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Mk(t,e){return t.button===0&&(!e||e==="_self")&&!Ak(t)}function km(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let i=t[n];return e.concat(Array.isArray(i)?i.map(r=>[n,r]):[[n,i]])},[]))}function Ok(t,e){let n=km(t);return e&&e.forEach((i,r)=>{n.has(r)||e.getAll(r).forEach(l=>{n.append(r,l)})}),n}var Jc=null;function Dk(){if(Jc===null)try{new FormData(document.createElement("form"),0),Jc=!1}catch{Jc=!0}return Jc}var Lk=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ff(t){return t!=null&&!Lk.has(t)?(ni(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ru}"`),null):t}function Pk(t,e){let n,i,r,l,u;if(Nk(t)){let d=t.getAttribute("action");i=d?_s(d,e):null,n=t.getAttribute("method")||au,r=Ff(t.getAttribute("enctype"))||ru,l=new FormData(t)}else if(Rk(t)||_k(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||d.getAttribute("action");if(i=f?_s(f,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||au,r=Ff(t.getAttribute("formenctype"))||Ff(d.getAttribute("enctype"))||ru,l=new FormData(d,t),!Dk()){let{name:m,type:p,value:v}=t;if(p==="image"){let C=m?`${m}.`:"";l.append(`${C}x`,"0"),l.append(`${C}y`,"0")}else m&&l.append(m,v)}}else{if(Ju(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=au,i=null,r=ru,u=t}return l&&r==="text/plain"&&(u=l,l=void 0),{action:i,method:n.toLowerCase(),encType:r,formData:l,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function kp(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ik(t,e,n){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return i.pathname==="/"?i.pathname=`_root.${n}`:e&&_s(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${n}`,i}async function Uk(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Bk(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function Fk(t,e,n){let i=await Promise.all(t.map(async r=>{let l=e.routes[r.route.id];if(l){let u=await Uk(l,n);return u.links?u.links():[]}return[]}));return Hk(i.flat(1).filter(Bk).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function yy(t,e,n,i,r,l){let u=(f,m)=>n[m]?f.route.id!==n[m].route.id:!0,d=(f,m)=>{var p;return n[m].pathname!==f.pathname||((p=n[m].route.path)==null?void 0:p.endsWith("*"))&&n[m].params["*"]!==f.params["*"]};return l==="assets"?e.filter((f,m)=>u(f,m)||d(f,m)):l==="data"?e.filter((f,m)=>{var v;let p=i.routes[f.route.id];if(!p||!p.hasLoader)return!1;if(u(f,m)||d(f,m))return!0;if(f.route.shouldRevalidate){let C=f.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((v=n[0])==null?void 0:v.params)||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof C=="boolean")return C}return!0}):[]}function zk(t,e,{includeHydrateFallback:n}={}){return qk(t.map(i=>{let r=e.routes[i.route.id];if(!r)return[];let l=[r.module];return r.clientActionModule&&(l=l.concat(r.clientActionModule)),r.clientLoaderModule&&(l=l.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(l=l.concat(r.hydrateFallbackModule)),r.imports&&(l=l.concat(r.imports)),l}).flat(1))}function qk(t){return[...new Set(t)]}function Vk(t){let e={},n=Object.keys(t).sort();for(let i of n)e[i]=t[i];return e}function Hk(t,e){let n=new Set;return new Set(e),t.reduce((i,r)=>{let l=JSON.stringify(Vk(r));return n.has(l)||(n.add(l),i.push({key:l,link:r})),i},[])}function L2(){let t=b.useContext(Yr);return kp(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function $k(){let t=b.useContext(Yu);return kp(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Tp=b.createContext(void 0);Tp.displayName="FrameworkContext";function P2(){let t=b.useContext(Tp);return kp(t,"You must render this element inside a <HydratedRouter> element"),t}function Gk(t,e){let n=b.useContext(Tp),[i,r]=b.useState(!1),[l,u]=b.useState(!1),{onFocus:d,onBlur:f,onMouseEnter:m,onMouseLeave:p,onTouchStart:v}=e,C=b.useRef(null);b.useEffect(()=>{if(t==="render"&&u(!0),t==="viewport"){let k=_=>{_.forEach(O=>{u(O.isIntersecting)})},E=new IntersectionObserver(k,{threshold:.5});return C.current&&E.observe(C.current),()=>{E.disconnect()}}},[t]),b.useEffect(()=>{if(i){let k=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(k)}}},[i]);let x=()=>{r(!0)},S=()=>{r(!1),u(!1)};return n?t!=="intent"?[l,C,{}]:[l,C,{onFocus:Qo(d,x),onBlur:Qo(f,S),onMouseEnter:Qo(m,x),onMouseLeave:Qo(p,S),onTouchStart:Qo(v,x)}]:[!1,C,{}]}function Qo(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function Kk({page:t,...e}){let{router:n}=L2(),i=b.useMemo(()=>w2(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?b.createElement(Zk,{page:t,matches:i,...e}):null}function Wk(t){let{manifest:e,routeModules:n}=P2(),[i,r]=b.useState([]);return b.useEffect(()=>{let l=!1;return Fk(t,e,n).then(u=>{l||r(u)}),()=>{l=!0}},[t,e,n]),i}function Zk({page:t,matches:e,...n}){let i=Fn(),{manifest:r,routeModules:l}=P2(),{basename:u}=L2(),{loaderData:d,matches:f}=$k(),m=b.useMemo(()=>yy(t,e,f,r,i,"data"),[t,e,f,r,i]),p=b.useMemo(()=>yy(t,e,f,r,i,"assets"),[t,e,f,r,i]),v=b.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let S=new Set,k=!1;if(e.forEach(_=>{var A;let O=r.routes[_.route.id];!O||!O.hasLoader||(!m.some(w=>w.route.id===_.route.id)&&_.route.id in d&&((A=l[_.route.id])!=null&&A.shouldRevalidate)||O.hasClientLoader?k=!0:S.add(_.route.id))}),S.size===0)return[];let E=Ik(t,u,"data");return k&&S.size>0&&E.searchParams.set("_routes",e.filter(_=>S.has(_.route.id)).map(_=>_.route.id).join(",")),[E.pathname+E.search]},[u,d,i,r,m,e,t,l]),C=b.useMemo(()=>zk(p,r),[p,r]),x=Wk(p);return b.createElement(b.Fragment,null,v.map(S=>b.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...n})),C.map(S=>b.createElement("link",{key:S,rel:"modulepreload",href:S,...n})),x.map(({key:S,link:k})=>b.createElement("link",{key:S,nonce:n.nonce,...k})))}function Yk(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var I2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{I2&&(window.__reactRouterVersion="7.10.1")}catch{}function Jk({basename:t,children:e,unstable_useTransitions:n,window:i}){let r=b.useRef();r.current==null&&(r.current=PS({window:i,v5Compat:!0}));let l=r.current,[u,d]=b.useState({action:l.action,location:l.location}),f=b.useCallback(m=>{n===!1?d(m):b.startTransition(()=>d(m))},[n]);return b.useLayoutEffect(()=>l.listen(f),[l,f]),b.createElement(wk,{basename:t,children:e,location:u.location,navigationType:u.action,navigator:l,unstable_useTransitions:n===!0})}var U2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,B2=b.forwardRef(function({onClick:e,discover:n="render",prefetch:i="none",relative:r,reloadDocument:l,replace:u,state:d,target:f,to:m,preventScrollReset:p,viewTransition:v,...C},x){let{basename:S,unstable_useTransitions:k}=b.useContext(Ni),E=typeof m=="string"&&U2.test(m),_,O=!1;if(typeof m=="string"&&E&&(_=m,I2))try{let D=new URL(window.location.href),I=m.startsWith("//")?new URL(D.protocol+m):new URL(m),B=_s(I.pathname,S);I.origin===D.origin&&B!=null?m=B+I.search+I.hash:O=!0}catch{ni(!1,`<Link to="${m}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=dk(m,{relative:r}),[w,j,R]=Gk(i,C),N=t3(m,{replace:u,state:d,target:f,preventScrollReset:p,relative:r,viewTransition:v,unstable_useTransitions:k});function L(D){e&&e(D),D.defaultPrevented||N(D)}let F=b.createElement("a",{...C,...R,href:_||A,onClick:O||l?e:L,ref:Yk(x,j),target:f,"data-discover":!E&&n==="render"?"true":void 0});return w&&!E?b.createElement(b.Fragment,null,F,b.createElement(Kk,{page:A})):F});B2.displayName="Link";var Qk=b.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:i="",end:r=!1,style:l,to:u,viewTransition:d,children:f,...m},p){let v=jl(u,{relative:m.relative}),C=Fn(),x=b.useContext(Yu),{navigator:S,basename:k}=b.useContext(Ni),E=x!=null&&o3(v)&&d===!0,_=S.encodeLocation?S.encodeLocation(v).pathname:v.pathname,O=C.pathname,A=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(O=O.toLowerCase(),A=A?A.toLowerCase():null,_=_.toLowerCase()),A&&k&&(A=_s(A,k)||A);const w=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let j=O===_||!r&&O.startsWith(_)&&O.charAt(w)==="/",R=A!=null&&(A===_||!r&&A.startsWith(_)&&A.charAt(_.length)==="/"),N={isActive:j,isPending:R,isTransitioning:E},L=j?e:void 0,F;typeof i=="function"?F=i(N):F=[i,j?"active":null,R?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let D=typeof l=="function"?l(N):l;return b.createElement(B2,{...m,"aria-current":L,className:F,ref:p,style:D,to:u,viewTransition:d},typeof f=="function"?f(N):f)});Qk.displayName="NavLink";var Xk=b.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:i,replace:r,state:l,method:u=au,action:d,onSubmit:f,relative:m,preventScrollReset:p,viewTransition:v,...C},x)=>{let{unstable_useTransitions:S}=b.useContext(Ni),k=a3(),E=r3(d,{relative:m}),_=u.toLowerCase()==="get"?"get":"post",O=typeof d=="string"&&U2.test(d),A=w=>{if(f&&f(w),w.defaultPrevented)return;w.preventDefault();let j=w.nativeEvent.submitter,R=(j==null?void 0:j.getAttribute("formmethod"))||u,N=()=>k(j||w.currentTarget,{fetcherKey:e,method:R,navigate:n,replace:r,state:l,relative:m,preventScrollReset:p,viewTransition:v});S&&n!==!1?b.startTransition(()=>N()):N()};return b.createElement("form",{ref:x,method:_,action:E,onSubmit:i?f:A,...C,"data-discover":!O&&t==="render"?"true":void 0})});Xk.displayName="Form";function e3(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function F2(t){let e=b.useContext(Yr);return Ut(e,e3(t)),e}function t3(t,{target:e,replace:n,state:i,preventScrollReset:r,relative:l,viewTransition:u,unstable_useTransitions:d}={}){let f=yn(),m=Fn(),p=jl(t,{relative:l});return b.useCallback(v=>{if(Mk(v,e)){v.preventDefault();let C=n!==void 0?n:pl(m)===pl(p),x=()=>f(t,{replace:C,state:i,preventScrollReset:r,relative:l,viewTransition:u});d?b.startTransition(()=>x()):x()}},[m,f,p,n,i,e,t,r,l,u,d])}function n3(t){ni(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=b.useRef(km(t)),n=b.useRef(!1),i=Fn(),r=b.useMemo(()=>Ok(i.search,n.current?null:e.current),[i.search]),l=yn(),u=b.useCallback((d,f)=>{const m=km(typeof d=="function"?d(new URLSearchParams(r)):d);n.current=!0,l("?"+m,f)},[l,r]);return[r,u]}var i3=0,s3=()=>`__${String(++i3)}__`;function a3(){let{router:t}=F2("useSubmit"),{basename:e}=b.useContext(Ni),n=Sk(),i=t.fetch,r=t.navigate;return b.useCallback(async(l,u={})=>{let{action:d,method:f,encType:m,formData:p,body:v}=Pk(l,e);if(u.navigate===!1){let C=u.fetcherKey||s3();await i(C,n,u.action||d,{preventScrollReset:u.preventScrollReset,formData:p,body:v,formMethod:u.method||f,formEncType:u.encType||m,flushSync:u.flushSync})}else await r(u.action||d,{preventScrollReset:u.preventScrollReset,formData:p,body:v,formMethod:u.method||f,formEncType:u.encType||m,replace:u.replace,state:u.state,fromRouteId:n,flushSync:u.flushSync,viewTransition:u.viewTransition})},[i,r,e,n])}function r3(t,{relative:e}={}){let{basename:n}=b.useContext(Ni),i=b.useContext(Vi);Ut(i,"useFormAction must be used inside a RouteContext");let[r]=i.matches.slice(-1),l={...jl(t||".",{relative:e})},u=Fn();if(t==null){l.search=u.search;let d=new URLSearchParams(l.search),f=d.getAll("index");if(f.some(p=>p==="")){d.delete("index"),f.filter(v=>v).forEach(v=>d.append("index",v));let p=d.toString();l.search=p?`?${p}`:""}}return(!t||t===".")&&r.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(l.pathname=l.pathname==="/"?n:Ns([n,l.pathname])),pl(l)}function o3(t,{relative:e}={}){let n=b.useContext(_2);Ut(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=F2("useViewTransitionState"),r=jl(t,{relative:e});if(!n.isTransitioning)return!1;let l=_s(n.currentLocation.pathname,i)||n.currentLocation.pathname,u=_s(n.nextLocation.pathname,i)||n.nextLocation.pathname;return Du(r.pathname,u)!=null||Du(r.pathname,l)!=null}var Qu=E2();const l3={gradientStart:"#e8f4f8",gradientEnd:"#f5f9fc",background:"#FAFBFC",surface:"#FFFFFF",surfaceVariant:"#F8FAFC",text:"#1A1A1A",textSecondary:"#4A5568",textTertiary:"#718096",primary:"#3182CE",primaryLight:"#63B3ED",primaryDark:"#2C5282",secondary:"#718096",secondaryLight:"#A0AEC0",secondaryDark:"#4A5568",success:"#38A169",warning:"#D69E2E",error:"#E53E3E",info:"#3182CE",chatBubbleOwn:"#3182CE",chatBubbleOther:"#F7FAFC",chatTextOwn:"#FFFFFF",chatTextOther:"#2D3748",border:"#E2E8F0",borderLight:"#F1F5F9",borderDark:"#CBD5E0",inputBackground:"#FFFFFF",inputBorder:"#E2E8F0",inputText:"#2D3748",inputPlaceholder:"#A0AEC0",buttonPrimary:"#3182CE",buttonSecondary:"#718096",buttonDanger:"#E53E3E",buttonText:"#FFFFFF",headerBackground:"#FFFFFF",headerText:"#2D3748",headerBorder:"#E2E8F0",tabActive:"#3182CE",tabInactive:"#A0AEC0",tabBackground:"#F7FAFC",modalBackground:"#FFFFFF",modalOverlay:"rgba(0, 0, 0, 0.4)",avatarBackground:"#F1F5F9",avatarText:"#4A5568",statusBar:"dark-content"},c3={gradientStart:"#1a2f4f",gradientEnd:"#2d4a68",background:"#0F172A",surface:"#1E293B",surfaceVariant:"#334155",text:"#F8FAFC",textSecondary:"#CBD5E0",textTertiary:"#94A3B8",primary:"#3B82F6",primaryLight:"#60A5FA",primaryDark:"#1D4ED8",secondary:"#64748B",secondaryLight:"#94A3B8",secondaryDark:"#475569",success:"#10B981",warning:"#F59E0B",error:"#EF4444",info:"#3B82F6",chatBubbleOwn:"#3B82F6",chatBubbleOther:"#334155",chatTextOwn:"#FFFFFF",chatTextOther:"#F1F5F9",border:"#334155",borderLight:"#475569",borderDark:"#1E293B",inputBackground:"#1E293B",inputBorder:"#334155",inputText:"#F8FAFC",inputPlaceholder:"#94A3B8",buttonPrimary:"#3B82F6",buttonSecondary:"#64748B",buttonDanger:"#EF4444",buttonText:"#FFFFFF",headerBackground:"#1E293B",headerText:"#F8FAFC",headerBorder:"#334155",tabActive:"#3B82F6",tabInactive:"#94A3B8",tabBackground:"#0F172A",modalBackground:"#1E293B",modalOverlay:"rgba(0, 0, 0, 0.7)",avatarBackground:"#334155",avatarText:"#CBD5E0",statusBar:"light-content"},u3=b.createContext(void 0),d3=({children:t})=>{const[e,n]=b.useState("system"),[i,r]=b.useState("light");b.useEffect(()=>{const m=window.matchMedia("(prefers-color-scheme: dark)"),p=v=>{r(v.matches?"dark":"light")};return p(m),m.addEventListener("change",p),()=>{m.removeEventListener("change",p)}},[]);const l=e==="dark"||e==="system"&&i==="dark",u=l?c3:l3;b.useEffect(()=>{(async()=>{try{const p=localStorage.getItem("theme_mode");p&&["light","dark","system"].includes(p)&&n(p)}catch(p){console.error("Error loading theme mode:",p)}})()},[]);const f={mode:e,isDark:l,setMode:async m=>{try{n(m),localStorage.setItem("theme_mode",m)}catch(p){console.error("Error saving theme mode:",p)}},colors:u};return o.jsx(u3.Provider,{value:f,children:t})};function z2(t,e){return function(){return t.apply(e,arguments)}}const{toString:h3}=Object.prototype,{getPrototypeOf:Ep}=Object,{iterator:Xu,toStringTag:q2}=Symbol,ed=(t=>e=>{const n=h3.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Hi=t=>(t=t.toLowerCase(),e=>ed(e)===t),td=t=>e=>typeof e===t,{isArray:Qr}=Array,Gr=td("undefined");function Rl(t){return t!==null&&!Gr(t)&&t.constructor!==null&&!Gr(t.constructor)&&Jn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const V2=Hi("ArrayBuffer");function f3(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&V2(t.buffer),e}const m3=td("string"),Jn=td("function"),H2=td("number"),Nl=t=>t!==null&&typeof t=="object",p3=t=>t===!0||t===!1,ou=t=>{if(ed(t)!=="object")return!1;const e=Ep(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(q2 in t)&&!(Xu in t)},g3=t=>{if(!Nl(t)||Rl(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},v3=Hi("Date"),y3=Hi("File"),b3=Hi("Blob"),C3=Hi("FileList"),x3=t=>Nl(t)&&Jn(t.pipe),S3=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Jn(t.append)&&((e=ed(t))==="formdata"||e==="object"&&Jn(t.toString)&&t.toString()==="[object FormData]"))},k3=Hi("URLSearchParams"),[T3,E3,w3,j3]=["ReadableStream","Request","Response","Headers"].map(Hi),R3=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _l(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let i,r;if(typeof t!="object"&&(t=[t]),Qr(t))for(i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else{if(Rl(t))return;const l=n?Object.getOwnPropertyNames(t):Object.keys(t),u=l.length;let d;for(i=0;i<u;i++)d=l[i],e.call(null,t[d],d,t)}}function $2(t,e){if(Rl(t))return null;e=e.toLowerCase();const n=Object.keys(t);let i=n.length,r;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const Ua=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,G2=t=>!Gr(t)&&t!==Ua;function Tm(){const{caseless:t,skipUndefined:e}=G2(this)&&this||{},n={},i=(r,l)=>{const u=t&&$2(n,l)||l;ou(n[u])&&ou(r)?n[u]=Tm(n[u],r):ou(r)?n[u]=Tm({},r):Qr(r)?n[u]=r.slice():(!e||!Gr(r))&&(n[u]=r)};for(let r=0,l=arguments.length;r<l;r++)arguments[r]&&_l(arguments[r],i);return n}const N3=(t,e,n,{allOwnKeys:i}={})=>(_l(e,(r,l)=>{n&&Jn(r)?t[l]=z2(r,n):t[l]=r},{allOwnKeys:i}),t),_3=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),A3=(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},M3=(t,e,n,i)=>{let r,l,u;const d={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),l=r.length;l-- >0;)u=r[l],(!i||i(u,t,e))&&!d[u]&&(e[u]=t[u],d[u]=!0);t=n!==!1&&Ep(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},O3=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},D3=t=>{if(!t)return null;if(Qr(t))return t;let e=t.length;if(!H2(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},L3=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Ep(Uint8Array)),P3=(t,e)=>{const i=(t&&t[Xu]).call(t);let r;for(;(r=i.next())&&!r.done;){const l=r.value;e.call(t,l[0],l[1])}},I3=(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},U3=Hi("HTMLFormElement"),B3=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,r){return i.toUpperCase()+r}),by=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),F3=Hi("RegExp"),K2=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};_l(n,(r,l)=>{let u;(u=e(r,l,t))!==!1&&(i[l]=u||r)}),Object.defineProperties(t,i)},z3=t=>{K2(t,(e,n)=>{if(Jn(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];if(Jn(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},q3=(t,e)=>{const n={},i=r=>{r.forEach(l=>{n[l]=!0})};return Qr(t)?i(t):i(String(t).split(e)),n},V3=()=>{},H3=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function $3(t){return!!(t&&Jn(t.append)&&t[q2]==="FormData"&&t[Xu])}const G3=t=>{const e=new Array(10),n=(i,r)=>{if(Nl(i)){if(e.indexOf(i)>=0)return;if(Rl(i))return i;if(!("toJSON"in i)){e[r]=i;const l=Qr(i)?[]:{};return _l(i,(u,d)=>{const f=n(u,r+1);!Gr(f)&&(l[d]=f)}),e[r]=void 0,l}}return i};return n(t,0)},K3=Hi("AsyncFunction"),W3=t=>t&&(Nl(t)||Jn(t))&&Jn(t.then)&&Jn(t.catch),W2=((t,e)=>t?setImmediate:e?((n,i)=>(Ua.addEventListener("message",({source:r,data:l})=>{r===Ua&&l===n&&i.length&&i.shift()()},!1),r=>{i.push(r),Ua.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Jn(Ua.postMessage)),Z3=typeof queueMicrotask<"u"?queueMicrotask.bind(Ua):typeof process<"u"&&process.nextTick||W2,Y3=t=>t!=null&&Jn(t[Xu]),te={isArray:Qr,isArrayBuffer:V2,isBuffer:Rl,isFormData:S3,isArrayBufferView:f3,isString:m3,isNumber:H2,isBoolean:p3,isObject:Nl,isPlainObject:ou,isEmptyObject:g3,isReadableStream:T3,isRequest:E3,isResponse:w3,isHeaders:j3,isUndefined:Gr,isDate:v3,isFile:y3,isBlob:b3,isRegExp:F3,isFunction:Jn,isStream:x3,isURLSearchParams:k3,isTypedArray:L3,isFileList:C3,forEach:_l,merge:Tm,extend:N3,trim:R3,stripBOM:_3,inherits:A3,toFlatObject:M3,kindOf:ed,kindOfTest:Hi,endsWith:O3,toArray:D3,forEachEntry:P3,matchAll:I3,isHTMLForm:U3,hasOwnProperty:by,hasOwnProp:by,reduceDescriptors:K2,freezeMethods:z3,toObjectSet:q3,toCamelCase:B3,noop:V3,toFiniteNumber:H3,findKey:$2,global:Ua,isContextDefined:G2,isSpecCompliantForm:$3,toJSONObject:G3,isAsyncFn:K3,isThenable:W3,setImmediate:W2,asap:Z3,isIterable:Y3};function Ze(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}te.inherits(Ze,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:te.toJSONObject(this.config),code:this.code,status:this.status}}});const Z2=Ze.prototype,Y2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Y2[t]={value:t}});Object.defineProperties(Ze,Y2);Object.defineProperty(Z2,"isAxiosError",{value:!0});Ze.from=(t,e,n,i,r,l)=>{const u=Object.create(Z2);te.toFlatObject(t,u,function(p){return p!==Error.prototype},m=>m!=="isAxiosError");const d=t&&t.message?t.message:"Error",f=e==null&&t?t.code:e;return Ze.call(u,d,f,n,i,r),t&&u.cause==null&&Object.defineProperty(u,"cause",{value:t,configurable:!0}),u.name=t&&t.name||"Error",l&&Object.assign(u,l),u};const J3=null;function Em(t){return te.isPlainObject(t)||te.isArray(t)}function J2(t){return te.endsWith(t,"[]")?t.slice(0,-2):t}function Cy(t,e,n){return t?t.concat(e).map(function(r,l){return r=J2(r),!n&&l?"["+r+"]":r}).join(n?".":""):e}function Q3(t){return te.isArray(t)&&!t.some(Em)}const X3=te.toFlatObject(te,{},null,function(e){return/^is[A-Z]/.test(e)});function nd(t,e,n){if(!te.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=te.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(k,E){return!te.isUndefined(E[k])});const i=n.metaTokens,r=n.visitor||p,l=n.dots,u=n.indexes,f=(n.Blob||typeof Blob<"u"&&Blob)&&te.isSpecCompliantForm(e);if(!te.isFunction(r))throw new TypeError("visitor must be a function");function m(S){if(S===null)return"";if(te.isDate(S))return S.toISOString();if(te.isBoolean(S))return S.toString();if(!f&&te.isBlob(S))throw new Ze("Blob is not supported. Use a Buffer instead.");return te.isArrayBuffer(S)||te.isTypedArray(S)?f&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function p(S,k,E){let _=S;if(S&&!E&&typeof S=="object"){if(te.endsWith(k,"{}"))k=i?k:k.slice(0,-2),S=JSON.stringify(S);else if(te.isArray(S)&&Q3(S)||(te.isFileList(S)||te.endsWith(k,"[]"))&&(_=te.toArray(S)))return k=J2(k),_.forEach(function(A,w){!(te.isUndefined(A)||A===null)&&e.append(u===!0?Cy([k],w,l):u===null?k:k+"[]",m(A))}),!1}return Em(S)?!0:(e.append(Cy(E,k,l),m(S)),!1)}const v=[],C=Object.assign(X3,{defaultVisitor:p,convertValue:m,isVisitable:Em});function x(S,k){if(!te.isUndefined(S)){if(v.indexOf(S)!==-1)throw Error("Circular reference detected in "+k.join("."));v.push(S),te.forEach(S,function(_,O){(!(te.isUndefined(_)||_===null)&&r.call(e,_,te.isString(O)?O.trim():O,k,C))===!0&&x(_,k?k.concat(O):[O])}),v.pop()}}if(!te.isObject(t))throw new TypeError("data must be an object");return x(t),e}function xy(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function wp(t,e){this._pairs=[],t&&nd(t,this,e)}const Q2=wp.prototype;Q2.append=function(e,n){this._pairs.push([e,n])};Q2.toString=function(e){const n=e?function(i){return e.call(this,i,xy)}:xy;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function eT(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function X2(t,e,n){if(!e)return t;const i=n&&n.encode||eT;te.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let l;if(r?l=r(e,n):l=te.isURLSearchParams(e)?e.toString():new wp(e,n).toString(i),l){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+l}return t}let Sy=class{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){te.forEach(this.handlers,function(i){i!==null&&e(i)})}};const eC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},tT=typeof URLSearchParams<"u"?URLSearchParams:wp,nT=typeof FormData<"u"?FormData:null,iT=typeof Blob<"u"?Blob:null,sT={isBrowser:!0,classes:{URLSearchParams:tT,FormData:nT,Blob:iT},protocols:["http","https","file","blob","url","data"]},jp=typeof window<"u"&&typeof document<"u",wm=typeof navigator=="object"&&navigator||void 0,aT=jp&&(!wm||["ReactNative","NativeScript","NS"].indexOf(wm.product)<0),rT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",oT=jp&&window.location.href||"http://localhost",lT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jp,hasStandardBrowserEnv:aT,hasStandardBrowserWebWorkerEnv:rT,navigator:wm,origin:oT},Symbol.toStringTag,{value:"Module"})),On={...lT,...sT};function cT(t,e){return nd(t,new On.classes.URLSearchParams,{visitor:function(n,i,r,l){return On.isNode&&te.isBuffer(n)?(this.append(i,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...e})}function uT(t){return te.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function dT(t){const e={},n=Object.keys(t);let i;const r=n.length;let l;for(i=0;i<r;i++)l=n[i],e[l]=t[l];return e}function tC(t){function e(n,i,r,l){let u=n[l++];if(u==="__proto__")return!0;const d=Number.isFinite(+u),f=l>=n.length;return u=!u&&te.isArray(r)?r.length:u,f?(te.hasOwnProp(r,u)?r[u]=[r[u],i]:r[u]=i,!d):((!r[u]||!te.isObject(r[u]))&&(r[u]=[]),e(n,i,r[u],l)&&te.isArray(r[u])&&(r[u]=dT(r[u])),!d)}if(te.isFormData(t)&&te.isFunction(t.entries)){const n={};return te.forEachEntry(t,(i,r)=>{e(uT(i),r,n,0)}),n}return null}function hT(t,e,n){if(te.isString(t))try{return(e||JSON.parse)(t),te.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(n||JSON.stringify)(t)}const Al={transitional:eC,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",r=i.indexOf("application/json")>-1,l=te.isObject(e);if(l&&te.isHTMLForm(e)&&(e=new FormData(e)),te.isFormData(e))return r?JSON.stringify(tC(e)):e;if(te.isArrayBuffer(e)||te.isBuffer(e)||te.isStream(e)||te.isFile(e)||te.isBlob(e)||te.isReadableStream(e))return e;if(te.isArrayBufferView(e))return e.buffer;if(te.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(i.indexOf("application/x-www-form-urlencoded")>-1)return cT(e,this.formSerializer).toString();if((d=te.isFileList(e))||i.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return nd(d?{"files[]":e}:e,f&&new f,this.formSerializer)}}return l||r?(n.setContentType("application/json",!1),hT(e)):e}],transformResponse:[function(e){const n=this.transitional||Al.transitional,i=n&&n.forcedJSONParsing,r=this.responseType==="json";if(te.isResponse(e)||te.isReadableStream(e))return e;if(e&&te.isString(e)&&(i&&!this.responseType||r)){const u=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(d){if(u)throw d.name==="SyntaxError"?Ze.from(d,Ze.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:On.classes.FormData,Blob:On.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};te.forEach(["delete","get","head","post","put","patch"],t=>{Al.headers[t]={}});const fT=te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),mT=t=>{const e={};let n,i,r;return t&&t.split(`
`).forEach(function(u){r=u.indexOf(":"),n=u.substring(0,r).trim().toLowerCase(),i=u.substring(r+1).trim(),!(!n||e[n]&&fT[n])&&(n==="set-cookie"?e[n]?e[n].push(i):e[n]=[i]:e[n]=e[n]?e[n]+", "+i:i)}),e},ky=Symbol("internals");function Xo(t){return t&&String(t).trim().toLowerCase()}function lu(t){return t===!1||t==null?t:te.isArray(t)?t.map(lu):String(t)}function pT(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)e[i[1]]=i[2];return e}const gT=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function zf(t,e,n,i,r){if(te.isFunction(i))return i.call(this,e,n);if(r&&(e=n),!!te.isString(e)){if(te.isString(i))return e.indexOf(i)!==-1;if(te.isRegExp(i))return i.test(e)}}function vT(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,i)=>n.toUpperCase()+i)}function yT(t,e){const n=te.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+n,{value:function(r,l,u){return this[i].call(this,e,r,l,u)},configurable:!0})})}let Qn=class{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function l(d,f,m){const p=Xo(f);if(!p)throw new Error("header name must be a non-empty string");const v=te.findKey(r,p);(!v||r[v]===void 0||m===!0||m===void 0&&r[v]!==!1)&&(r[v||f]=lu(d))}const u=(d,f)=>te.forEach(d,(m,p)=>l(m,p,f));if(te.isPlainObject(e)||e instanceof this.constructor)u(e,n);else if(te.isString(e)&&(e=e.trim())&&!gT(e))u(mT(e),n);else if(te.isObject(e)&&te.isIterable(e)){let d={},f,m;for(const p of e){if(!te.isArray(p))throw TypeError("Object iterator must return a key-value pair");d[m=p[0]]=(f=d[m])?te.isArray(f)?[...f,p[1]]:[f,p[1]]:p[1]}u(d,n)}else e!=null&&l(n,e,i);return this}get(e,n){if(e=Xo(e),e){const i=te.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return pT(r);if(te.isFunction(n))return n.call(this,r,i);if(te.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Xo(e),e){const i=te.findKey(this,e);return!!(i&&this[i]!==void 0&&(!n||zf(this,this[i],i,n)))}return!1}delete(e,n){const i=this;let r=!1;function l(u){if(u=Xo(u),u){const d=te.findKey(i,u);d&&(!n||zf(i,i[d],d,n))&&(delete i[d],r=!0)}}return te.isArray(e)?e.forEach(l):l(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const l=n[i];(!e||zf(this,this[l],l,e,!0))&&(delete this[l],r=!0)}return r}normalize(e){const n=this,i={};return te.forEach(this,(r,l)=>{const u=te.findKey(i,l);if(u){n[u]=lu(r),delete n[l];return}const d=e?vT(l):String(l).trim();d!==l&&delete n[l],n[d]=lu(r),i[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return te.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&te.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const i=new this(e);return n.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[ky]=this[ky]={accessors:{}}).accessors,r=this.prototype;function l(u){const d=Xo(u);i[d]||(yT(r,u),i[d]=!0)}return te.isArray(e)?e.forEach(l):l(e),this}};Qn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);te.reduceDescriptors(Qn.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}});te.freezeMethods(Qn);function qf(t,e){const n=this||Al,i=e||n,r=Qn.from(i.headers);let l=i.data;return te.forEach(t,function(d){l=d.call(n,l,r.normalize(),e?e.status:void 0)}),r.normalize(),l}function nC(t){return!!(t&&t.__CANCEL__)}function Xr(t,e,n){Ze.call(this,t??"canceled",Ze.ERR_CANCELED,e,n),this.name="CanceledError"}te.inherits(Xr,Ze,{__CANCEL__:!0});function iC(t,e,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(new Ze("Request failed with status code "+n.status,[Ze.ERR_BAD_REQUEST,Ze.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function bT(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function CT(t,e){t=t||10;const n=new Array(t),i=new Array(t);let r=0,l=0,u;return e=e!==void 0?e:1e3,function(f){const m=Date.now(),p=i[l];u||(u=m),n[r]=f,i[r]=m;let v=l,C=0;for(;v!==r;)C+=n[v++],v=v%t;if(r=(r+1)%t,r===l&&(l=(l+1)%t),m-u<e)return;const x=p&&m-p;return x?Math.round(C*1e3/x):void 0}}function xT(t,e){let n=0,i=1e3/e,r,l;const u=(m,p=Date.now())=>{n=p,r=null,l&&(clearTimeout(l),l=null),t(...m)};return[(...m)=>{const p=Date.now(),v=p-n;v>=i?u(m,p):(r=m,l||(l=setTimeout(()=>{l=null,u(r)},i-v)))},()=>r&&u(r)]}const Lu=(t,e,n=3)=>{let i=0;const r=CT(50,250);return xT(l=>{const u=l.loaded,d=l.lengthComputable?l.total:void 0,f=u-i,m=r(f),p=u<=d;i=u;const v={loaded:u,total:d,progress:d?u/d:void 0,bytes:f,rate:m||void 0,estimated:m&&d&&p?(d-u)/m:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};t(v)},n)},Ty=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},Ey=t=>(...e)=>te.asap(()=>t(...e)),ST=On.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,On.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(On.origin),On.navigator&&/(msie|trident)/i.test(On.navigator.userAgent)):()=>!0,kT=On.hasStandardBrowserEnv?{write(t,e,n,i,r,l,u){if(typeof document>"u")return;const d=[`${t}=${encodeURIComponent(e)}`];te.isNumber(n)&&d.push(`expires=${new Date(n).toUTCString()}`),te.isString(i)&&d.push(`path=${i}`),te.isString(r)&&d.push(`domain=${r}`),l===!0&&d.push("secure"),te.isString(u)&&d.push(`SameSite=${u}`),document.cookie=d.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function TT(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function ET(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function sC(t,e,n){let i=!TT(e);return t&&(i||n==!1)?ET(t,e):e}const wy=t=>t instanceof Qn?{...t}:t;function qa(t,e){e=e||{};const n={};function i(m,p,v,C){return te.isPlainObject(m)&&te.isPlainObject(p)?te.merge.call({caseless:C},m,p):te.isPlainObject(p)?te.merge({},p):te.isArray(p)?p.slice():p}function r(m,p,v,C){if(te.isUndefined(p)){if(!te.isUndefined(m))return i(void 0,m,v,C)}else return i(m,p,v,C)}function l(m,p){if(!te.isUndefined(p))return i(void 0,p)}function u(m,p){if(te.isUndefined(p)){if(!te.isUndefined(m))return i(void 0,m)}else return i(void 0,p)}function d(m,p,v){if(v in e)return i(m,p);if(v in t)return i(void 0,m)}const f={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:d,headers:(m,p,v)=>r(wy(m),wy(p),v,!0)};return te.forEach(Object.keys({...t,...e}),function(p){const v=f[p]||r,C=v(t[p],e[p],p);te.isUndefined(C)&&v!==d||(n[p]=C)}),n}const aC=t=>{const e=qa({},t);let{data:n,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:l,headers:u,auth:d}=e;if(e.headers=u=Qn.from(u),e.url=X2(sC(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),d&&u.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),te.isFormData(n)){if(On.hasStandardBrowserEnv||On.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if(te.isFunction(n.getHeaders)){const f=n.getHeaders(),m=["content-type","content-length"];Object.entries(f).forEach(([p,v])=>{m.includes(p.toLowerCase())&&u.set(p,v)})}}if(On.hasStandardBrowserEnv&&(i&&te.isFunction(i)&&(i=i(e)),i||i!==!1&&ST(e.url))){const f=r&&l&&kT.read(l);f&&u.set(r,f)}return e},wT=typeof XMLHttpRequest<"u",jT=wT&&function(t){return new Promise(function(n,i){const r=aC(t);let l=r.data;const u=Qn.from(r.headers).normalize();let{responseType:d,onUploadProgress:f,onDownloadProgress:m}=r,p,v,C,x,S;function k(){x&&x(),S&&S(),r.cancelToken&&r.cancelToken.unsubscribe(p),r.signal&&r.signal.removeEventListener("abort",p)}let E=new XMLHttpRequest;E.open(r.method.toUpperCase(),r.url,!0),E.timeout=r.timeout;function _(){if(!E)return;const A=Qn.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders()),j={data:!d||d==="text"||d==="json"?E.responseText:E.response,status:E.status,statusText:E.statusText,headers:A,config:t,request:E};iC(function(N){n(N),k()},function(N){i(N),k()},j),E=null}"onloadend"in E?E.onloadend=_:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(_)},E.onabort=function(){E&&(i(new Ze("Request aborted",Ze.ECONNABORTED,t,E)),E=null)},E.onerror=function(w){const j=w&&w.message?w.message:"Network Error",R=new Ze(j,Ze.ERR_NETWORK,t,E);R.event=w||null,i(R),E=null},E.ontimeout=function(){let w=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const j=r.transitional||eC;r.timeoutErrorMessage&&(w=r.timeoutErrorMessage),i(new Ze(w,j.clarifyTimeoutError?Ze.ETIMEDOUT:Ze.ECONNABORTED,t,E)),E=null},l===void 0&&u.setContentType(null),"setRequestHeader"in E&&te.forEach(u.toJSON(),function(w,j){E.setRequestHeader(j,w)}),te.isUndefined(r.withCredentials)||(E.withCredentials=!!r.withCredentials),d&&d!=="json"&&(E.responseType=r.responseType),m&&([C,S]=Lu(m,!0),E.addEventListener("progress",C)),f&&E.upload&&([v,x]=Lu(f),E.upload.addEventListener("progress",v),E.upload.addEventListener("loadend",x)),(r.cancelToken||r.signal)&&(p=A=>{E&&(i(!A||A.type?new Xr(null,t,E):A),E.abort(),E=null)},r.cancelToken&&r.cancelToken.subscribe(p),r.signal&&(r.signal.aborted?p():r.signal.addEventListener("abort",p)));const O=bT(r.url);if(O&&On.protocols.indexOf(O)===-1){i(new Ze("Unsupported protocol "+O+":",Ze.ERR_BAD_REQUEST,t));return}E.send(l||null)})},RT=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i=new AbortController,r;const l=function(m){if(!r){r=!0,d();const p=m instanceof Error?m:this.reason;i.abort(p instanceof Ze?p:new Xr(p instanceof Error?p.message:p))}};let u=e&&setTimeout(()=>{u=null,l(new Ze(`timeout ${e} of ms exceeded`,Ze.ETIMEDOUT))},e);const d=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(m=>{m.unsubscribe?m.unsubscribe(l):m.removeEventListener("abort",l)}),t=null)};t.forEach(m=>m.addEventListener("abort",l));const{signal:f}=i;return f.unsubscribe=()=>te.asap(d),f}},NT=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let i=0,r;for(;i<n;)r=i+e,yield t.slice(i,r),i=r},_T=async function*(t,e){for await(const n of AT(t))yield*NT(n,e)},AT=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:i}=await e.read();if(n)break;yield i}}finally{await e.cancel()}},jy=(t,e,n,i)=>{const r=_T(t,e);let l=0,u,d=f=>{u||(u=!0,i&&i(f))};return new ReadableStream({async pull(f){try{const{done:m,value:p}=await r.next();if(m){d(),f.close();return}let v=p.byteLength;if(n){let C=l+=v;n(C)}f.enqueue(new Uint8Array(p))}catch(m){throw d(m),m}},cancel(f){return d(f),r.return()}},{highWaterMark:2})},Ry=64*1024,{isFunction:Qc}=te,MT=(({Request:t,Response:e})=>({Request:t,Response:e}))(te.global),{ReadableStream:Ny,TextEncoder:_y}=te.global,Ay=(t,...e)=>{try{return!!t(...e)}catch{return!1}},OT=t=>{t=te.merge.call({skipUndefined:!0},MT,t);const{fetch:e,Request:n,Response:i}=t,r=e?Qc(e):typeof fetch=="function",l=Qc(n),u=Qc(i);if(!r)return!1;const d=r&&Qc(Ny),f=r&&(typeof _y=="function"?(S=>k=>S.encode(k))(new _y):async S=>new Uint8Array(await new n(S).arrayBuffer())),m=l&&d&&Ay(()=>{let S=!1;const k=new n(On.origin,{body:new Ny,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!k}),p=u&&d&&Ay(()=>te.isReadableStream(new i("").body)),v={stream:p&&(S=>S.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(S=>{!v[S]&&(v[S]=(k,E)=>{let _=k&&k[S];if(_)return _.call(k);throw new Ze(`Response type '${S}' is not supported`,Ze.ERR_NOT_SUPPORT,E)})});const C=async S=>{if(S==null)return 0;if(te.isBlob(S))return S.size;if(te.isSpecCompliantForm(S))return(await new n(On.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(te.isArrayBufferView(S)||te.isArrayBuffer(S))return S.byteLength;if(te.isURLSearchParams(S)&&(S=S+""),te.isString(S))return(await f(S)).byteLength},x=async(S,k)=>{const E=te.toFiniteNumber(S.getContentLength());return E??C(k)};return async S=>{let{url:k,method:E,data:_,signal:O,cancelToken:A,timeout:w,onDownloadProgress:j,onUploadProgress:R,responseType:N,headers:L,withCredentials:F="same-origin",fetchOptions:D}=aC(S),I=e||fetch;N=N?(N+"").toLowerCase():"text";let B=RT([O,A&&A.toAbortSignal()],w),G=null;const Z=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let ue;try{if(R&&m&&E!=="get"&&E!=="head"&&(ue=await x(L,_))!==0){let P=new n(k,{method:"POST",body:_,duplex:"half"}),K;if(te.isFormData(_)&&(K=P.headers.get("content-type"))&&L.setContentType(K),P.body){const[ae,le]=Ty(ue,Lu(Ey(R)));_=jy(P.body,Ry,ae,le)}}te.isString(F)||(F=F?"include":"omit");const q=l&&"credentials"in n.prototype,ee={...D,signal:B,method:E.toUpperCase(),headers:L.normalize().toJSON(),body:_,duplex:"half",credentials:q?F:void 0};G=l&&new n(k,ee);let re=await(l?I(G,D):I(k,ee));const he=p&&(N==="stream"||N==="response");if(p&&(j||he&&Z)){const P={};["status","statusText","headers"].forEach(Te=>{P[Te]=re[Te]});const K=te.toFiniteNumber(re.headers.get("content-length")),[ae,le]=j&&Ty(K,Lu(Ey(j),!0))||[];re=new i(jy(re.body,Ry,ae,()=>{le&&le(),Z&&Z()}),P)}N=N||"text";let Se=await v[te.findKey(v,N)||"text"](re,S);return!he&&Z&&Z(),await new Promise((P,K)=>{iC(P,K,{data:Se,headers:Qn.from(re.headers),status:re.status,statusText:re.statusText,config:S,request:G})})}catch(q){throw Z&&Z(),q&&q.name==="TypeError"&&/Load failed|fetch/i.test(q.message)?Object.assign(new Ze("Network Error",Ze.ERR_NETWORK,S,G),{cause:q.cause||q}):Ze.from(q,q&&q.code,S,G)}}},DT=new Map,rC=t=>{let e=t&&t.env||{};const{fetch:n,Request:i,Response:r}=e,l=[i,r,n];let u=l.length,d=u,f,m,p=DT;for(;d--;)f=l[d],m=p.get(f),m===void 0&&p.set(f,m=d?new Map:OT(e)),p=m;return m};rC();const Rp={http:J3,xhr:jT,fetch:{get:rC}};te.forEach(Rp,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const My=t=>`- ${t}`,LT=t=>te.isFunction(t)||t===null||t===!1;function PT(t,e){t=te.isArray(t)?t:[t];const{length:n}=t;let i,r;const l={};for(let u=0;u<n;u++){i=t[u];let d;if(r=i,!LT(i)&&(r=Rp[(d=String(i)).toLowerCase()],r===void 0))throw new Ze(`Unknown adapter '${d}'`);if(r&&(te.isFunction(r)||(r=r.get(e))))break;l[d||"#"+u]=r}if(!r){const u=Object.entries(l).map(([f,m])=>`adapter ${f} `+(m===!1?"is not supported by the environment":"is not available in the build"));let d=n?u.length>1?`since :
`+u.map(My).join(`
`):" "+My(u[0]):"as no adapter specified";throw new Ze("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return r}const oC={getAdapter:PT,adapters:Rp};function Vf(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Xr(null,t)}function Oy(t){return Vf(t),t.headers=Qn.from(t.headers),t.data=qf.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),oC.getAdapter(t.adapter||Al.adapter,t)(t).then(function(i){return Vf(t),i.data=qf.call(t,t.transformResponse,i),i.headers=Qn.from(i.headers),i},function(i){return nC(i)||(Vf(t),i&&i.response&&(i.response.data=qf.call(t,t.transformResponse,i.response),i.response.headers=Qn.from(i.response.headers))),Promise.reject(i)})}const lC="1.13.2",id={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{id[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});const Dy={};id.transitional=function(e,n,i){function r(l,u){return"[Axios v"+lC+"] Transitional option '"+l+"'"+u+(i?". "+i:"")}return(l,u,d)=>{if(e===!1)throw new Ze(r(u," has been removed"+(n?" in "+n:"")),Ze.ERR_DEPRECATED);return n&&!Dy[u]&&(Dy[u]=!0,console.warn(r(u," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(l,u,d):!0}};id.spelling=function(e){return(n,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function IT(t,e,n){if(typeof t!="object")throw new Ze("options must be an object",Ze.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const l=i[r],u=e[l];if(u){const d=t[l],f=d===void 0||u(d,l,t);if(f!==!0)throw new Ze("option "+l+" must be "+f,Ze.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ze("Unknown option "+l,Ze.ERR_BAD_OPTION)}}const cu={assertOptions:IT,validators:id},Yi=cu.validators;let Fa=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Sy,response:new Sy}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const l=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?l&&!String(i.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+l):i.stack=l}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=qa(this.defaults,n);const{transitional:i,paramsSerializer:r,headers:l}=n;i!==void 0&&cu.assertOptions(i,{silentJSONParsing:Yi.transitional(Yi.boolean),forcedJSONParsing:Yi.transitional(Yi.boolean),clarifyTimeoutError:Yi.transitional(Yi.boolean)},!1),r!=null&&(te.isFunction(r)?n.paramsSerializer={serialize:r}:cu.assertOptions(r,{encode:Yi.function,serialize:Yi.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),cu.assertOptions(n,{baseUrl:Yi.spelling("baseURL"),withXsrfToken:Yi.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=l&&te.merge(l.common,l[n.method]);l&&te.forEach(["delete","get","head","post","put","patch","common"],S=>{delete l[S]}),n.headers=Qn.concat(u,l);const d=[];let f=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(n)===!1||(f=f&&k.synchronous,d.unshift(k.fulfilled,k.rejected))});const m=[];this.interceptors.response.forEach(function(k){m.push(k.fulfilled,k.rejected)});let p,v=0,C;if(!f){const S=[Oy.bind(this),void 0];for(S.unshift(...d),S.push(...m),C=S.length,p=Promise.resolve(n);v<C;)p=p.then(S[v++],S[v++]);return p}C=d.length;let x=n;for(;v<C;){const S=d[v++],k=d[v++];try{x=S(x)}catch(E){k.call(this,E);break}}try{p=Oy.call(this,x)}catch(S){return Promise.reject(S)}for(v=0,C=m.length;v<C;)p=p.then(m[v++],m[v++]);return p}getUri(e){e=qa(this.defaults,e);const n=sC(e.baseURL,e.url,e.allowAbsoluteUrls);return X2(n,e.params,e.paramsSerializer)}};te.forEach(["delete","get","head","options"],function(e){Fa.prototype[e]=function(n,i){return this.request(qa(i||{},{method:e,url:n,data:(i||{}).data}))}});te.forEach(["post","put","patch"],function(e){function n(i){return function(l,u,d){return this.request(qa(d||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:l,data:u}))}}Fa.prototype[e]=n(),Fa.prototype[e+"Form"]=n(!0)});let UT=class cC{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const i=this;this.promise.then(r=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](r);i._listeners=null}),this.promise.then=r=>{let l;const u=new Promise(d=>{i.subscribe(d),l=d}).then(r);return u.cancel=function(){i.unsubscribe(l)},u},e(function(l,u,d){i.reason||(i.reason=new Xr(l,u,d),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new cC(function(r){e=r}),cancel:e}}};function BT(t){return function(n){return t.apply(null,n)}}function FT(t){return te.isObject(t)&&t.isAxiosError===!0}const jm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(jm).forEach(([t,e])=>{jm[e]=t});function uC(t){const e=new Fa(t),n=z2(Fa.prototype.request,e);return te.extend(n,Fa.prototype,e,{allOwnKeys:!0}),te.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return uC(qa(t,r))},n}const en=uC(Al);en.Axios=Fa;en.CanceledError=Xr;en.CancelToken=UT;en.isCancel=nC;en.VERSION=lC;en.toFormData=nd;en.AxiosError=Ze;en.Cancel=en.CanceledError;en.all=function(e){return Promise.all(e)};en.spread=BT;en.isAxiosError=FT;en.mergeConfig=qa;en.AxiosHeaders=Qn;en.formToJSON=t=>tC(te.isHTMLForm(t)?new FormData(t):t);en.getAdapter=oC.getAdapter;en.HttpStatusCode=jm;en.default=en;const{Axios:KA,AxiosError:WA,CanceledError:ZA,isCancel:YA,CancelToken:JA,VERSION:QA,all:XA,Cancel:eM,isAxiosError:tM,spread:nM,toFormData:iM,AxiosHeaders:sM,HttpStatusCode:aM,formToJSON:rM,getAdapter:oM,mergeConfig:lM}=en,zT="https://backend36.dev",qT=zT,VT={getItem:t=>{try{return Promise.resolve(localStorage.getItem(t))}catch(e){return console.error("Error getting item from storage:",e),Promise.resolve(null)}},setItem:(t,e)=>{try{return localStorage.setItem(t,e),Promise.resolve()}catch(n){return console.error("Error setting item in storage:",n),Promise.resolve()}},removeItem:t=>{try{return localStorage.removeItem(t),Promise.resolve()}catch(e){return console.error("Error removing item from storage:",e),Promise.resolve()}}},Pe=en.create({baseURL:qT,withCredentials:!0});Pe.interceptors.request.use(t=>{var e,n;try{const i=localStorage.getItem("auth_token");i&&(t.headers||(t.headers={}),t.headers.Authorization=`Bearer ${i}`)}catch(i){console.error(" Error reading auth_token from localStorage:",i)}return console.log(" API Request:",{method:(e=t.method)==null?void 0:e.toUpperCase(),url:t.url,baseURL:t.baseURL,hasAuthHeader:!!((n=t.headers)!=null&&n.Authorization)}),t},t=>(console.error(" Request Error:",t),Promise.reject(t)));Pe.interceptors.response.use(t=>(console.log(" API Response:",{status:t.status,url:t.config.url}),t),t=>{var e,n;return console.error(" Response Error:",{status:(e=t.response)==null?void 0:e.status,url:(n=t.config)==null?void 0:n.url}),Promise.reject(t)});const Pu=t=>{t?Pe.defaults.headers.common.Authorization=`Bearer ${t}`:delete Pe.defaults.headers.common.Authorization},Np=async()=>(await Pe.get("/conversations")).data,HT=async(t,e)=>{const n={};return e!=null&&e.limit&&(n.limit=e.limit),e!=null&&e.skip&&(n.skip=e.skip),(await Pe.get(`/conversations/${t}/messages`,{params:n})).data},$T=async(t,e)=>(await Pe.post(`/conversations/${t}/messages`,{text:e})).data,dC=async(t,e)=>(await Pe.post(`/conversations/${t}/messages`,e)).data,GT=async(t,e)=>{const n=Array.from(new Set(t.filter(Boolean)));return(await Pe.post("/conversations",{members:n,isGroup:!0,title:e||`Group (${n.length})`})).data},hC=async t=>(await Pe.post("/auth/logout",{token:t})).data,KT=async()=>{try{return await VT.getItem("user_id")}catch(t){return console.error("Error getting user ID:",t),null}},fC=async(t,e=1,n=20)=>(await Pe.get("/users/search",{params:{q:t,page:e,limit:n}})).data,WT=async t=>(await Pe.post("/conversations",{members:[t]})).data,ZT=async(t,e)=>(await Pe.post(`/conversations/${t}/members`,{userIds:e})).data,YT=async(t,e)=>(await Pe.delete(`/conversations/${t}/members/${e}`)).data,JT=async t=>(await Pe.post(`/conversations/${t}/leave`)).data,QT=async(t,e)=>(await Pe.post(`/conversations/${t}/admins/${e}`)).data,XT=async(t,e)=>(await Pe.delete(`/conversations/${t}/admins/${e}`)).data,eE=async(t,e)=>(await Pe.patch(`/conversations/${t}`,e)).data,Rm=async t=>(await Pe.get(`/conversations/${t}/opponent`)).data,tE=async(t,e)=>(await Pe.patch(`/conversations/messages/${t}`,{text:e})).data,nE=async t=>(await Pe.delete(`/conversations/messages/${t}`)).data,iE=async(t,e)=>(await Pe.post(`/conversations/messages/${t}/reactions`,{emoji:e})).data,Ly=async(t,e)=>(await Pe.delete(`/conversations/messages/${t}/reactions/${encodeURIComponent(e)}`)).data,sE=async t=>(await Pe.post(`/conversations/messages/${t}/pin`)).data,aE=async t=>(await Pe.delete(`/conversations/messages/${t}/pin`)).data,rE=async t=>(await Pe.post(`/conversations/messages/${t}/star`)).data,oE=async t=>(await Pe.patch(`/conversations/messages/${t}/revoke`,{})).data,lE=async(t,e)=>(await Pe.post(`/conversations/${t}/read`,{messageId:e})).data,cE=async t=>(await Pe.post("/conversations/join/invite",{inviteCode:t})).data,uE=async t=>(await Pe.get(`/users/${t}`)).data,dE=async(t,e=10)=>{const n={limit:e};return t&&(n.cursor=t),(await Pe.get("/social/posts/feed",{params:n})).data},hE=async()=>(await Pe.get("/social/stories")).data.items,fE=async t=>(await Pe.post("/social/posts",t)).data,mE=async t=>(await Pe.post("/social/stories",t)).data,pE=async t=>{try{return(await(await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&media=music&limit=20`)).json()).results||[]}catch(e){return console.error("Failed to search music:",e),[]}},mC=async t=>{var n,i;const e=new FormData;e.append("file",t);try{const r=await Pe.post("/uploads/s3/public",e,{headers:{},timeout:6e4});return{url:r.data.url,type:r.data.mime.startsWith("image/")?"image":"video"}}catch(r){console.error("Upload error:",r);const l=((i=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:i.error)||(r==null?void 0:r.message)||"Li khng xc nh";throw new Error(`Li khi upload ${t.name}: ${l}`)}},gE=async t=>(await Pe.post(`/social/stories/${t}/view`)).data,vE=async t=>(await Pe.delete(`/social/stories/${t}`)).data,yE=async(t,e)=>(await Pe.post(`/social/stories/${t}/reactions`,{type:e})).data,bE=async t=>(await Pe.delete(`/social/stories/${t}/reactions`)).data,CE=async(t,e)=>(await Pe.post(`/social/stories/${t}/replies`,{content:e})).data,xE=async(t,e,n)=>{try{await Pe.post("/analytics/track",{eventType:t,metadata:e,sessionId:n})}catch(i){console.error("[Analytics] Failed to track event:",i)}},SE=async(t,e,n=20)=>{const i={limit:n};return e&&(i.cursor=e),(await Pe.get(`/social/posts/${t}/comments`,{params:i})).data},kE=async(t,e)=>(await Pe.post(`/social/posts/${t}/comments`,e)).data,TE=async(t=6)=>(await Pe.get("/social/friends/suggestions",{params:{limit:t}})).data,EE=async t=>(await Pe.post("/social/friends/requests",{targetUserId:t})).data,wE=async(t,e=20)=>{const n={limit:e};return(await Pe.get("/social/notifications",{params:n})).data},jE=async t=>(await Pe.post("/social/notifications/read",{ids:t})).data,RE=async t=>(await Pe.get(`/social/posts/${t}/liked`)).data,NE=async(t,e)=>(await Pe.post(`/social/posts/${t}/reactions`,{type:e})).data,_E=async t=>(await Pe.delete(`/social/posts/${t}/reactions`)).data,AE=async t=>{await Pe.post(`/social/posts/${t}/save`)},ME=async(t,e)=>(await Pe.post(`/social/posts/${t}/report`,e)).data,Py=async(t,e,n)=>{var r;const i=await Pe.post("/calls/initiate",{conversationId:t,type:e,targetUserId:n});return console.log("[API] initiateCall response:",i.data),console.log("[API] Call ID from response:",(r=i.data.call)==null?void 0:r.id),i.data},Hf=async t=>(await Pe.post(`/calls/${t}/livekit-token`)).data,pC=async t=>{var e,n;console.log("[API] getCall - Requesting callId:",t),console.log("[API] getCall - Full URL:",`/calls/${t}`);try{const i=await Pe.get(`/calls/${t}`);return console.log("[API] getCall - Success:",i.data),i.data}catch(i){throw console.error("[API] getCall - Error:",i),console.error("[API] getCall - Error response:",(e=i.response)==null?void 0:e.data),console.error("[API] getCall - Error status:",(n=i.response)==null?void 0:n.status),i}},OE=async t=>(await Pe.post(`/calls/${t}/end`)).data,gC=async t=>(await Pe.post(`/calls/${t}/accept`)).data,vC=async t=>(await Pe.post(`/calls/${t}/reject`)).data,ts=Object.create(null);ts.open="0";ts.close="1";ts.ping="2";ts.pong="3";ts.message="4";ts.upgrade="5";ts.noop="6";const uu=Object.create(null);Object.keys(ts).forEach(t=>{uu[ts[t]]=t});const Nm={type:"error",data:"parser error"},yC=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",bC=typeof ArrayBuffer=="function",CC=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,_p=({type:t,data:e},n,i)=>yC&&e instanceof Blob?n?i(e):Iy(e,i):bC&&(e instanceof ArrayBuffer||CC(e))?n?i(e):Iy(new Blob([e]),i):i(ts[t]+(e||"")),Iy=(t,e)=>{const n=new FileReader;return n.onload=function(){const i=n.result.split(",")[1];e("b"+(i||""))},n.readAsDataURL(t)};function Uy(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let $f;function DE(t,e){if(yC&&t.data instanceof Blob)return t.data.arrayBuffer().then(Uy).then(e);if(bC&&(t.data instanceof ArrayBuffer||CC(t.data)))return e(Uy(t.data));_p(t,!1,n=>{$f||($f=new TextEncoder),e($f.encode(n))})}const By="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ll=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<By.length;t++)ll[By.charCodeAt(t)]=t;const LE=t=>{let e=t.length*.75,n=t.length,i,r=0,l,u,d,f;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const m=new ArrayBuffer(e),p=new Uint8Array(m);for(i=0;i<n;i+=4)l=ll[t.charCodeAt(i)],u=ll[t.charCodeAt(i+1)],d=ll[t.charCodeAt(i+2)],f=ll[t.charCodeAt(i+3)],p[r++]=l<<2|u>>4,p[r++]=(u&15)<<4|d>>2,p[r++]=(d&3)<<6|f&63;return m},PE=typeof ArrayBuffer=="function",Ap=(t,e)=>{if(typeof t!="string")return{type:"message",data:xC(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:IE(t.substring(1),e)}:uu[n]?t.length>1?{type:uu[n],data:t.substring(1)}:{type:uu[n]}:Nm},IE=(t,e)=>{if(PE){const n=LE(t);return xC(n,e)}else return{base64:!0,data:t}},xC=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},SC="",UE=(t,e)=>{const n=t.length,i=new Array(n);let r=0;t.forEach((l,u)=>{_p(l,!1,d=>{i[u]=d,++r===n&&e(i.join(SC))})})},BE=(t,e)=>{const n=t.split(SC),i=[];for(let r=0;r<n.length;r++){const l=Ap(n[r],e);if(i.push(l),l.type==="error")break}return i};function FE(){return new TransformStream({transform(t,e){DE(t,n=>{const i=n.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const l=new DataView(r.buffer);l.setUint8(0,126),l.setUint16(1,i)}else{r=new Uint8Array(9);const l=new DataView(r.buffer);l.setUint8(0,127),l.setBigUint64(1,BigInt(i))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(n)})}})}let Gf;function Xc(t){return t.reduce((e,n)=>e+n.length,0)}function eu(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let i=0;for(let r=0;r<e;r++)n[r]=t[0][i++],i===t[0].length&&(t.shift(),i=0);return t.length&&i<t[0].length&&(t[0]=t[0].slice(i)),n}function zE(t,e){Gf||(Gf=new TextDecoder);const n=[];let i=0,r=-1,l=!1;return new TransformStream({transform(u,d){for(n.push(u);;){if(i===0){if(Xc(n)<1)break;const f=eu(n,1);l=(f[0]&128)===128,r=f[0]&127,r<126?i=3:r===126?i=1:i=2}else if(i===1){if(Xc(n)<2)break;const f=eu(n,2);r=new DataView(f.buffer,f.byteOffset,f.length).getUint16(0),i=3}else if(i===2){if(Xc(n)<8)break;const f=eu(n,8),m=new DataView(f.buffer,f.byteOffset,f.length),p=m.getUint32(0);if(p>Math.pow(2,21)-1){d.enqueue(Nm);break}r=p*Math.pow(2,32)+m.getUint32(4),i=3}else{if(Xc(n)<r)break;const f=eu(n,r);d.enqueue(Ap(l?f:Gf.decode(f),e)),i=0}if(r===0||r>t){d.enqueue(Nm);break}}}})}const kC=4;function un(t){if(t)return qE(t)}function qE(t){for(var e in un.prototype)t[e]=un.prototype[e];return t}un.prototype.on=un.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};un.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};un.prototype.off=un.prototype.removeListener=un.prototype.removeAllListeners=un.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var i,r=0;r<n.length;r++)if(i=n[r],i===e||i.fn===e){n.splice(r,1);break}return n.length===0&&delete this._callbacks["$"+t],this};un.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(n){n=n.slice(0);for(var i=0,r=n.length;i<r;++i)n[i].apply(this,e)}return this};un.prototype.emitReserved=un.prototype.emit;un.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};un.prototype.hasListeners=function(t){return!!this.listeners(t).length};const sd=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0),ji=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),VE="arraybuffer";function TC(t,...e){return e.reduce((n,i)=>(t.hasOwnProperty(i)&&(n[i]=t[i]),n),{})}const HE=ji.setTimeout,$E=ji.clearTimeout;function ad(t,e){e.useNativeTimers?(t.setTimeoutFn=HE.bind(ji),t.clearTimeoutFn=$E.bind(ji)):(t.setTimeoutFn=ji.setTimeout.bind(ji),t.clearTimeoutFn=ji.clearTimeout.bind(ji))}const GE=1.33;function KE(t){return typeof t=="string"?WE(t):Math.ceil((t.byteLength||t.size)*GE)}function WE(t){let e=0,n=0;for(let i=0,r=t.length;i<r;i++)e=t.charCodeAt(i),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(i++,n+=4);return n}function EC(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function ZE(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function YE(t){let e={},n=t.split("&");for(let i=0,r=n.length;i<r;i++){let l=n[i].split("=");e[decodeURIComponent(l[0])]=decodeURIComponent(l[1])}return e}class JE extends Error{constructor(e,n,i){super(e),this.description=n,this.context=i,this.type="TransportError"}}class Mp extends un{constructor(e){super(),this.writable=!1,ad(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,i){return super.emitReserved("error",new JE(e,n,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Ap(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=ZE(e);return n.length?"?"+n:""}}class QE extends Mp{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||n()})),this.writable||(i++,this.once("drain",function(){--i||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};BE(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,UE(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=EC()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let wC=!1;try{wC=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const XE=wC;function ew(){}class tw extends QE{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,n){const i=this.request({method:"POST",data:e});i.on("success",n),i.on("error",(r,l)=>{this.onError("xhr post error",r,l)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,i)=>{this.onError("xhr poll error",n,i)}),this.pollXhr=e}}let Ur=class du extends un{constructor(e,n,i){super(),this.createRequest=e,ad(this,i),this._opts=i,this._method=i.method||"GET",this._uri=n,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const n=TC(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(n);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var r;i.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=du.requestsCount++,du.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=ew,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete du.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Ur.requestsCount=0;Ur.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Fy);else if(typeof addEventListener=="function"){const t="onpagehide"in ji?"pagehide":"unload";addEventListener(t,Fy,!1)}}function Fy(){for(let t in Ur.requests)Ur.requests.hasOwnProperty(t)&&Ur.requests[t].abort()}const nw=(function(){const t=jC({xdomain:!1});return t&&t.responseType!==null})();class iw extends tw{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=nw&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Ur(jC,this.uri(),e)}}function jC(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||XE))return new XMLHttpRequest}catch{}if(!e)try{return new ji[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const RC=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class sw extends Mp{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,i=RC?{}:TC(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,i)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const i=e[n],r=n===e.length-1;_p(i,this.supportsBinary,l=>{try{this.doWrite(i,l)}catch{}r&&sd(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=EC()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const Kf=ji.WebSocket||ji.MozWebSocket;class aw extends sw{createSocket(e,n,i){return RC?new Kf(e,n,i):n?new Kf(e,n):new Kf(e)}doWrite(e,n){this.ws.send(n)}}class rw extends Mp{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=zE(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(n).getReader(),r=FE();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const l=()=>{i.read().then(({done:d,value:f})=>{d||(this.onPacket(f),l())}).catch(d=>{})};l();const u={type:"open"};this.query.sid&&(u.data=`{"sid":"${this.query.sid}"}`),this._writer.write(u).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const i=e[n],r=n===e.length-1;this._writer.write(i).then(()=>{r&&sd(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const ow={websocket:aw,webtransport:rw,polling:iw},lw=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,cw=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function _m(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),i=t.indexOf("]");n!=-1&&i!=-1&&(t=t.substring(0,n)+t.substring(n,i).replace(/:/g,";")+t.substring(i,t.length));let r=lw.exec(t||""),l={},u=14;for(;u--;)l[cw[u]]=r[u]||"";return n!=-1&&i!=-1&&(l.source=e,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=uw(l,l.path),l.queryKey=dw(l,l.query),l}function uw(t,e){const n=/\/{2,9}/g,i=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function dw(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,r,l){r&&(n[r]=l)}),n}const Am=typeof addEventListener=="function"&&typeof removeEventListener=="function",hu=[];Am&&addEventListener("offline",()=>{hu.forEach(t=>t())},!1);class ca extends un{constructor(e,n){if(super(),this.binaryType=VE,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const i=_m(e);n.hostname=i.host,n.secure=i.protocol==="https"||i.protocol==="wss",n.port=i.port,i.query&&(n.query=i.query)}else n.host&&(n.hostname=_m(n.host).host);ad(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(i=>{const r=i.prototype.name;this.transports.push(r),this._transportsByName[r]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=YE(this.opts.query)),Am&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},hu.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=kC,n.transport=e,this.id&&(n.sid=this.id);const i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&ca.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",ca.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){const r=this.writeBuffer[i].data;if(r&&(n+=KE(r)),i>0&&n>this._maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,sd(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,i){return this._sendPacket("message",e,n,i),this}send(e,n,i){return this._sendPacket("message",e,n,i),this}_sendPacket(e,n,i,r){if(typeof n=="function"&&(r=n,n=void 0),typeof i=="function"&&(r=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const l={type:e,data:n,options:i};this.emitReserved("packetCreate",l),this.writeBuffer.push(l),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(ca.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Am&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=hu.indexOf(this._offlineEventListener);i!==-1&&hu.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}ca.protocol=kC;class hw extends ca{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),i=!1;ca.priorWebsocketSuccess=!1;const r=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",v=>{if(!i)if(v.type==="pong"&&v.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;ca.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const C=new Error("probe error");C.transport=n.name,this.emitReserved("upgradeError",C)}}))};function l(){i||(i=!0,p(),n.close(),n=null)}const u=v=>{const C=new Error("probe error: "+v);C.transport=n.name,l(),this.emitReserved("upgradeError",C)};function d(){u("transport closed")}function f(){u("socket closed")}function m(v){n&&v.name!==n.name&&l()}const p=()=>{n.removeListener("open",r),n.removeListener("error",u),n.removeListener("close",d),this.off("close",f),this.off("upgrading",m)};n.once("open",r),n.once("error",u),n.once("close",d),this.once("close",f),this.once("upgrading",m),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&n.push(e[i]);return n}}let fw=class extends hw{constructor(e,n={}){const i=typeof e=="object"?e:n;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(r=>ow[r]).filter(r=>!!r)),super(e,i)}};function mw(t,e="",n){let i=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),i=_m(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const l=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+l+":"+i.port+e,i.href=i.protocol+"://"+l+(n&&n.port===i.port?"":":"+i.port),i}const pw=typeof ArrayBuffer=="function",gw=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,NC=Object.prototype.toString,vw=typeof Blob=="function"||typeof Blob<"u"&&NC.call(Blob)==="[object BlobConstructor]",yw=typeof File=="function"||typeof File<"u"&&NC.call(File)==="[object FileConstructor]";function Op(t){return pw&&(t instanceof ArrayBuffer||gw(t))||vw&&t instanceof Blob||yw&&t instanceof File}function fu(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,i=t.length;n<i;n++)if(fu(t[n]))return!0;return!1}if(Op(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return fu(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&fu(t[n]))return!0;return!1}function bw(t){const e=[],n=t.data,i=t;return i.data=Mm(n,e),i.attachments=e.length,{packet:i,buffers:e}}function Mm(t,e){if(!t)return t;if(Op(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let i=0;i<t.length;i++)n[i]=Mm(t[i],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=Mm(t[i],e));return n}return t}function Cw(t,e){return t.data=Om(t.data,e),delete t.attachments,t}function Om(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Om(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Om(t[n],e));return t}const xw=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Sw=5;var ht;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(ht||(ht={}));class kw{constructor(e){this.replacer=e}encode(e){return(e.type===ht.EVENT||e.type===ht.ACK)&&fu(e)?this.encodeAsBinary({type:e.type===ht.EVENT?ht.BINARY_EVENT:ht.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===ht.BINARY_EVENT||e.type===ht.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=bw(e),i=this.encodeAsString(n.packet),r=n.buffers;return r.unshift(i),r}}function zy(t){return Object.prototype.toString.call(t)==="[object Object]"}class Dp extends un{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const i=n.type===ht.BINARY_EVENT;i||n.type===ht.BINARY_ACK?(n.type=i?ht.EVENT:ht.ACK,this.reconstructor=new Tw(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Op(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const i={type:Number(e.charAt(0))};if(ht[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===ht.BINARY_EVENT||i.type===ht.BINARY_ACK){const l=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const u=e.substring(l,n);if(u!=Number(u)||e.charAt(n)!=="-")throw new Error("Illegal attachments");i.attachments=Number(u)}if(e.charAt(n+1)==="/"){const l=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););i.nsp=e.substring(l,n)}else i.nsp="/";const r=e.charAt(n+1);if(r!==""&&Number(r)==r){const l=n+1;for(;++n;){const u=e.charAt(n);if(u==null||Number(u)!=u){--n;break}if(n===e.length)break}i.id=Number(e.substring(l,n+1))}if(e.charAt(++n)){const l=this.tryParse(e.substr(n));if(Dp.isPayloadValid(i.type,l))i.data=l;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case ht.CONNECT:return zy(n);case ht.DISCONNECT:return n===void 0;case ht.CONNECT_ERROR:return typeof n=="string"||zy(n);case ht.EVENT:case ht.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&xw.indexOf(n[0])===-1);case ht.ACK:case ht.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Tw{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Cw(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ew=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Dp,Encoder:kw,get PacketType(){return ht},protocol:Sw},Symbol.toStringTag,{value:"Module"}));function Pi(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const ww=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class _C extends un{constructor(e,n,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Pi(e,"open",this.onopen.bind(this)),Pi(e,"packet",this.onpacket.bind(this)),Pi(e,"error",this.onerror.bind(this)),Pi(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var i,r,l;if(ww.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const u={type:ht.EVENT,data:n};if(u.options={},u.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const p=this.ids++,v=n.pop();this._registerAckCallback(p,v),u.id=p}const d=(r=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||r===void 0?void 0:r.writable,f=this.connected&&!(!((l=this.io.engine)===null||l===void 0)&&l._hasPingExpired());return this.flags.volatile&&!d||(f?(this.notifyOutgoingListeners(u),this.packet(u)):this.sendBuffer.push(u)),this.flags={},this}_registerAckCallback(e,n){var i;const r=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(r===void 0){this.acks[e]=n;return}const l=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let d=0;d<this.sendBuffer.length;d++)this.sendBuffer[d].id===e&&this.sendBuffer.splice(d,1);n.call(this,new Error("operation has timed out"))},r),u=(...d)=>{this.io.clearTimeoutFn(l),n.apply(this,d)};u.withError=!0,this.acks[e]=u}emitWithAck(e,...n){return new Promise((i,r)=>{const l=(u,d)=>u?r(u):i(d);l.withError=!0,n.push(l),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...l)=>i!==this._queue[0]?void 0:(r!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(r)):(this._queue.shift(),n&&n(null,...l)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ht.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ht.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ht.EVENT:case ht.BINARY_EVENT:this.onevent(e);break;case ht.ACK:case ht.BINARY_ACK:this.onack(e);break;case ht.DISCONNECT:this.ondisconnect();break;case ht.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const i of n)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let i=!1;return function(...r){i||(i=!0,n.packet({type:ht.ACK,id:e,data:r}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ht.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let i=0;i<n.length;i++)if(e===n[i])return n.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let i=0;i<n.length;i++)if(e===n[i])return n.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const i of n)i.apply(this,e.data)}}}function eo(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}eo.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-n:t+n}return Math.min(t,this.max)|0};eo.prototype.reset=function(){this.attempts=0};eo.prototype.setMin=function(t){this.ms=t};eo.prototype.setMax=function(t){this.max=t};eo.prototype.setJitter=function(t){this.jitter=t};class Dm extends un{constructor(e,n){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,ad(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((i=n.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new eo({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const r=n.parser||Ew;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new fw(this.uri,this.opts);const n=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const r=Pi(n,"open",function(){i.onopen(),e&&e()}),l=d=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",d),e?e(d):this.maybeReconnectOnOpen()},u=Pi(n,"error",l);if(this._timeout!==!1){const d=this._timeout,f=this.setTimeoutFn(()=>{r(),l(new Error("timeout")),n.close()},d);this.opts.autoUnref&&f.unref(),this.subs.push(()=>{this.clearTimeoutFn(f)})}return this.subs.push(r),this.subs.push(u),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Pi(e,"ping",this.onping.bind(this)),Pi(e,"data",this.ondata.bind(this)),Pi(e,"error",this.onerror.bind(this)),Pi(e,"close",this.onclose.bind(this)),Pi(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){sd(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new _C(this,e,n),this.nsps[e]=i),i}_destroy(e){const n=Object.keys(this.nsps);for(const i of n)if(this.nsps[i].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let i=0;i<n.length;i++)this.engine.write(n[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},n);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const el={};function mu(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=mw(t,e.path||"/socket.io"),i=n.source,r=n.id,l=n.path,u=el[r]&&l in el[r].nsps,d=e.forceNew||e["force new connection"]||e.multiplex===!1||u;let f;return d?f=new Dm(i,e):(el[r]||(el[r]=new Dm(i,e)),f=el[r]),n.query&&!e.query&&(e.query=n.queryKey),f.socket(n.path,e)}Object.assign(mu,{Manager:Dm,Socket:_C,io:mu,connect:mu});const qy="https://backend36.dev";let ct=null,pu=!1,tu=null;const AC=t=>ct!=null&&ct.connected?(console.log(" Socket already connected, returning existing socket"),ct):pu&&tu?(console.log(" Socket connection already in progress, waiting..."),tu):(ct&&(console.log(" Clearing existing socket before creating new one"),ct.disconnect(),ct=null),pu=!0,tu=new Promise(async e=>{console.log(" Creating new socket connection to:",qy),ct=mu(qy,{transports:["polling"],upgrade:!1,reconnection:!0,reconnectionAttempts:15,reconnectionDelay:1e3,reconnectionDelayMax:15e3,timeout:3e4,withCredentials:!0,auth:{token:t},path:"/socket.io",forceNew:!1,rememberUpgrade:!1,autoConnect:!0});try{window.__socket=ct}catch(r){console.warn("[Socket] Unable to set window.__socket reference:",r)}jw(t);const i=()=>{ct&&ct.connected?(console.log(" Socket fully connected, resolving..."),pu=!1,e(ct)):setTimeout(i,100)};i()}),tu),jw=t=>{ct&&(ct.on("connect",()=>{if(console.log(" WebSocket connected successfully"),console.log(" Socket ID:",ct==null?void 0:ct.id),t)try{const e=JSON.parse(atob(t.split(".")[1])),n=Math.floor(Date.now()/1e3),i=e.exp;if(console.log(" JWT Token expires at:",new Date(i*1e3)),i<n){console.error(" JWT Token expired!"),ct==null||ct.disconnect();return}}catch(e){console.error(" JWT Token invalid:",e)}ct==null||ct.emit("test-connection",{platform:"electron",timestamp:Date.now()})}),ct.on("disconnect",e=>{if(console.log(" WebSocket disconnected, reason:",e),e==="io client disconnect"){console.log(" Client initiated disconnect - not auto-reconnecting");return}console.log(" Auto-reconnecting for server disconnect..."),setTimeout(()=>{ct&&!ct.connected&&ct.connect()},2e3)}),ct.on("connect_error",e=>{console.log(" WebSocket connection error:",e.message)}),ct.on("reconnect",e=>{console.log(" Socket reconnected after",e,"attempts")}),ct.on("reconnect_attempt",e=>{console.log(" Socket reconnection attempt:",e)}),ct.on("reconnect_error",e=>{console.log(" Socket reconnection error:",e)}),ct.on("reconnect_failed",()=>{console.log(" Socket reconnection failed")}))},hi=()=>ct,Lm=()=>{ct&&(ct.disconnect(),ct=null),pu=!1},_i=()=>{const t=yn(),e=Fn();return{push:n=>{t(n)},replace:n=>{t(n,{replace:!0})},back:()=>{t(-1)},forward:()=>{t(1)},refresh:()=>{window.location.reload()},pathname:e.pathname,query:Object.fromEntries(new URLSearchParams(e.search))}},MC=()=>Fn().pathname,OC=()=>{const[t,e]=n3(),n=new URLSearchParams(t);return[n,i=>{if(typeof i=="function"){const r=i(n);e(r)}else if(i instanceof URLSearchParams)e(i);else{const r=new URLSearchParams;Object.entries(i).forEach(([l,u])=>{r.set(l,u)}),e(r)}}]};function DC(t,e){return function(){return t.apply(e,arguments)}}const{toString:Rw}=Object.prototype,{getPrototypeOf:Lp}=Object,{iterator:rd,toStringTag:LC}=Symbol,od=(t=>e=>{const n=Rw.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),$i=t=>(t=t.toLowerCase(),e=>od(e)===t),ld=t=>e=>typeof e===t,{isArray:to}=Array,gl=ld("undefined");function Ml(t){return t!==null&&!gl(t)&&t.constructor!==null&&!gl(t.constructor)&&Xn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const PC=$i("ArrayBuffer");function Nw(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&PC(t.buffer),e}const _w=ld("string"),Xn=ld("function"),IC=ld("number"),Ol=t=>t!==null&&typeof t=="object",Aw=t=>t===!0||t===!1,gu=t=>{if(od(t)!=="object")return!1;const e=Lp(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(LC in t)&&!(rd in t)},Mw=t=>{if(!Ol(t)||Ml(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},Ow=$i("Date"),Dw=$i("File"),Lw=$i("Blob"),Pw=$i("FileList"),Iw=t=>Ol(t)&&Xn(t.pipe),Uw=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Xn(t.append)&&((e=od(t))==="formdata"||e==="object"&&Xn(t.toString)&&t.toString()==="[object FormData]"))},Bw=$i("URLSearchParams"),[Fw,zw,qw,Vw]=["ReadableStream","Request","Response","Headers"].map($i),Hw=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Dl(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let i,r;if(typeof t!="object"&&(t=[t]),to(t))for(i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else{if(Ml(t))return;const l=n?Object.getOwnPropertyNames(t):Object.keys(t),u=l.length;let d;for(i=0;i<u;i++)d=l[i],e.call(null,t[d],d,t)}}function UC(t,e){if(Ml(t))return null;e=e.toLowerCase();const n=Object.keys(t);let i=n.length,r;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const Ba=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,BC=t=>!gl(t)&&t!==Ba;function Pm(){const{caseless:t}=BC(this)&&this||{},e={},n=(i,r)=>{const l=t&&UC(e,r)||r;gu(e[l])&&gu(i)?e[l]=Pm(e[l],i):gu(i)?e[l]=Pm({},i):to(i)?e[l]=i.slice():e[l]=i};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&Dl(arguments[i],n);return e}const $w=(t,e,n,{allOwnKeys:i}={})=>(Dl(e,(r,l)=>{n&&Xn(r)?t[l]=DC(r,n):t[l]=r},{allOwnKeys:i}),t),Gw=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Kw=(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},Ww=(t,e,n,i)=>{let r,l,u;const d={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),l=r.length;l-- >0;)u=r[l],(!i||i(u,t,e))&&!d[u]&&(e[u]=t[u],d[u]=!0);t=n!==!1&&Lp(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},Zw=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},Yw=t=>{if(!t)return null;if(to(t))return t;let e=t.length;if(!IC(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},Jw=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Lp(Uint8Array)),Qw=(t,e)=>{const i=(t&&t[rd]).call(t);let r;for(;(r=i.next())&&!r.done;){const l=r.value;e.call(t,l[0],l[1])}},Xw=(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},e7=$i("HTMLFormElement"),t7=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,r){return i.toUpperCase()+r}),Vy=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),n7=$i("RegExp"),FC=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};Dl(n,(r,l)=>{let u;(u=e(r,l,t))!==!1&&(i[l]=u||r)}),Object.defineProperties(t,i)},i7=t=>{FC(t,(e,n)=>{if(Xn(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];if(Xn(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},s7=(t,e)=>{const n={},i=r=>{r.forEach(l=>{n[l]=!0})};return to(t)?i(t):i(String(t).split(e)),n},a7=()=>{},r7=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function o7(t){return!!(t&&Xn(t.append)&&t[LC]==="FormData"&&t[rd])}const l7=t=>{const e=new Array(10),n=(i,r)=>{if(Ol(i)){if(e.indexOf(i)>=0)return;if(Ml(i))return i;if(!("toJSON"in i)){e[r]=i;const l=to(i)?[]:{};return Dl(i,(u,d)=>{const f=n(u,r+1);!gl(f)&&(l[d]=f)}),e[r]=void 0,l}}return i};return n(t,0)},c7=$i("AsyncFunction"),u7=t=>t&&(Ol(t)||Xn(t))&&Xn(t.then)&&Xn(t.catch),zC=((t,e)=>t?setImmediate:e?((n,i)=>(Ba.addEventListener("message",({source:r,data:l})=>{r===Ba&&l===n&&i.length&&i.shift()()},!1),r=>{i.push(r),Ba.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Xn(Ba.postMessage)),d7=typeof queueMicrotask<"u"?queueMicrotask.bind(Ba):typeof process<"u"&&process.nextTick||zC,h7=t=>t!=null&&Xn(t[rd]),ie={isArray:to,isArrayBuffer:PC,isBuffer:Ml,isFormData:Uw,isArrayBufferView:Nw,isString:_w,isNumber:IC,isBoolean:Aw,isObject:Ol,isPlainObject:gu,isEmptyObject:Mw,isReadableStream:Fw,isRequest:zw,isResponse:qw,isHeaders:Vw,isUndefined:gl,isDate:Ow,isFile:Dw,isBlob:Lw,isRegExp:n7,isFunction:Xn,isStream:Iw,isURLSearchParams:Bw,isTypedArray:Jw,isFileList:Pw,forEach:Dl,merge:Pm,extend:$w,trim:Hw,stripBOM:Gw,inherits:Kw,toFlatObject:Ww,kindOf:od,kindOfTest:$i,endsWith:Zw,toArray:Yw,forEachEntry:Qw,matchAll:Xw,isHTMLForm:e7,hasOwnProperty:Vy,hasOwnProp:Vy,reduceDescriptors:FC,freezeMethods:i7,toObjectSet:s7,toCamelCase:t7,noop:a7,toFiniteNumber:r7,findKey:UC,global:Ba,isContextDefined:BC,isSpecCompliantForm:o7,toJSONObject:l7,isAsyncFn:c7,isThenable:u7,setImmediate:zC,asap:d7,isIterable:h7};function Ye(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}ie.inherits(Ye,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ie.toJSONObject(this.config),code:this.code,status:this.status}}});const qC=Ye.prototype,VC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{VC[t]={value:t}});Object.defineProperties(Ye,VC);Object.defineProperty(qC,"isAxiosError",{value:!0});Ye.from=(t,e,n,i,r,l)=>{const u=Object.create(qC);return ie.toFlatObject(t,u,function(f){return f!==Error.prototype},d=>d!=="isAxiosError"),Ye.call(u,t.message,e,n,i,r),u.cause=t,u.name=t.name,l&&Object.assign(u,l),u};const f7=null;function Im(t){return ie.isPlainObject(t)||ie.isArray(t)}function HC(t){return ie.endsWith(t,"[]")?t.slice(0,-2):t}function Hy(t,e,n){return t?t.concat(e).map(function(r,l){return r=HC(r),!n&&l?"["+r+"]":r}).join(n?".":""):e}function m7(t){return ie.isArray(t)&&!t.some(Im)}const p7=ie.toFlatObject(ie,{},null,function(e){return/^is[A-Z]/.test(e)});function cd(t,e,n){if(!ie.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=ie.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(k,E){return!ie.isUndefined(E[k])});const i=n.metaTokens,r=n.visitor||p,l=n.dots,u=n.indexes,f=(n.Blob||typeof Blob<"u"&&Blob)&&ie.isSpecCompliantForm(e);if(!ie.isFunction(r))throw new TypeError("visitor must be a function");function m(S){if(S===null)return"";if(ie.isDate(S))return S.toISOString();if(ie.isBoolean(S))return S.toString();if(!f&&ie.isBlob(S))throw new Ye("Blob is not supported. Use a Buffer instead.");return ie.isArrayBuffer(S)||ie.isTypedArray(S)?f&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function p(S,k,E){let _=S;if(S&&!E&&typeof S=="object"){if(ie.endsWith(k,"{}"))k=i?k:k.slice(0,-2),S=JSON.stringify(S);else if(ie.isArray(S)&&m7(S)||(ie.isFileList(S)||ie.endsWith(k,"[]"))&&(_=ie.toArray(S)))return k=HC(k),_.forEach(function(A,w){!(ie.isUndefined(A)||A===null)&&e.append(u===!0?Hy([k],w,l):u===null?k:k+"[]",m(A))}),!1}return Im(S)?!0:(e.append(Hy(E,k,l),m(S)),!1)}const v=[],C=Object.assign(p7,{defaultVisitor:p,convertValue:m,isVisitable:Im});function x(S,k){if(!ie.isUndefined(S)){if(v.indexOf(S)!==-1)throw Error("Circular reference detected in "+k.join("."));v.push(S),ie.forEach(S,function(_,O){(!(ie.isUndefined(_)||_===null)&&r.call(e,_,ie.isString(O)?O.trim():O,k,C))===!0&&x(_,k?k.concat(O):[O])}),v.pop()}}if(!ie.isObject(t))throw new TypeError("data must be an object");return x(t),e}function $y(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function Pp(t,e){this._pairs=[],t&&cd(t,this,e)}const $C=Pp.prototype;$C.append=function(e,n){this._pairs.push([e,n])};$C.toString=function(e){const n=e?function(i){return e.call(this,i,$y)}:$y;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function g7(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function GC(t,e,n){if(!e)return t;const i=n&&n.encode||g7;ie.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let l;if(r?l=r(e,n):l=ie.isURLSearchParams(e)?e.toString():new Pp(e,n).toString(i),l){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+l}return t}class Gy{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ie.forEach(this.handlers,function(i){i!==null&&e(i)})}}const KC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},v7=typeof URLSearchParams<"u"?URLSearchParams:Pp,y7=typeof FormData<"u"?FormData:null,b7=typeof Blob<"u"?Blob:null,C7={isBrowser:!0,classes:{URLSearchParams:v7,FormData:y7,Blob:b7},protocols:["http","https","file","blob","url","data"]},Ip=typeof window<"u"&&typeof document<"u",Um=typeof navigator=="object"&&navigator||void 0,x7=Ip&&(!Um||["ReactNative","NativeScript","NS"].indexOf(Um.product)<0),S7=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",k7=Ip&&window.location.href||"http://localhost",T7=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ip,hasStandardBrowserEnv:x7,hasStandardBrowserWebWorkerEnv:S7,navigator:Um,origin:k7},Symbol.toStringTag,{value:"Module"})),Dn={...T7,...C7};function E7(t,e){return cd(t,new Dn.classes.URLSearchParams,{visitor:function(n,i,r,l){return Dn.isNode&&ie.isBuffer(n)?(this.append(i,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...e})}function w7(t){return ie.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function j7(t){const e={},n=Object.keys(t);let i;const r=n.length;let l;for(i=0;i<r;i++)l=n[i],e[l]=t[l];return e}function WC(t){function e(n,i,r,l){let u=n[l++];if(u==="__proto__")return!0;const d=Number.isFinite(+u),f=l>=n.length;return u=!u&&ie.isArray(r)?r.length:u,f?(ie.hasOwnProp(r,u)?r[u]=[r[u],i]:r[u]=i,!d):((!r[u]||!ie.isObject(r[u]))&&(r[u]=[]),e(n,i,r[u],l)&&ie.isArray(r[u])&&(r[u]=j7(r[u])),!d)}if(ie.isFormData(t)&&ie.isFunction(t.entries)){const n={};return ie.forEachEntry(t,(i,r)=>{e(w7(i),r,n,0)}),n}return null}function R7(t,e,n){if(ie.isString(t))try{return(e||JSON.parse)(t),ie.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(n||JSON.stringify)(t)}const Ll={transitional:KC,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",r=i.indexOf("application/json")>-1,l=ie.isObject(e);if(l&&ie.isHTMLForm(e)&&(e=new FormData(e)),ie.isFormData(e))return r?JSON.stringify(WC(e)):e;if(ie.isArrayBuffer(e)||ie.isBuffer(e)||ie.isStream(e)||ie.isFile(e)||ie.isBlob(e)||ie.isReadableStream(e))return e;if(ie.isArrayBufferView(e))return e.buffer;if(ie.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(i.indexOf("application/x-www-form-urlencoded")>-1)return E7(e,this.formSerializer).toString();if((d=ie.isFileList(e))||i.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return cd(d?{"files[]":e}:e,f&&new f,this.formSerializer)}}return l||r?(n.setContentType("application/json",!1),R7(e)):e}],transformResponse:[function(e){const n=this.transitional||Ll.transitional,i=n&&n.forcedJSONParsing,r=this.responseType==="json";if(ie.isResponse(e)||ie.isReadableStream(e))return e;if(e&&ie.isString(e)&&(i&&!this.responseType||r)){const u=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(d){if(u)throw d.name==="SyntaxError"?Ye.from(d,Ye.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Dn.classes.FormData,Blob:Dn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ie.forEach(["delete","get","head","post","put","patch"],t=>{Ll.headers[t]={}});const N7=ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_7=t=>{const e={};let n,i,r;return t&&t.split(`
`).forEach(function(u){r=u.indexOf(":"),n=u.substring(0,r).trim().toLowerCase(),i=u.substring(r+1).trim(),!(!n||e[n]&&N7[n])&&(n==="set-cookie"?e[n]?e[n].push(i):e[n]=[i]:e[n]=e[n]?e[n]+", "+i:i)}),e},Ky=Symbol("internals");function tl(t){return t&&String(t).trim().toLowerCase()}function vu(t){return t===!1||t==null?t:ie.isArray(t)?t.map(vu):String(t)}function A7(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)e[i[1]]=i[2];return e}const M7=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Wf(t,e,n,i,r){if(ie.isFunction(i))return i.call(this,e,n);if(r&&(e=n),!!ie.isString(e)){if(ie.isString(i))return e.indexOf(i)!==-1;if(ie.isRegExp(i))return i.test(e)}}function O7(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,i)=>n.toUpperCase()+i)}function D7(t,e){const n=ie.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+n,{value:function(r,l,u){return this[i].call(this,e,r,l,u)},configurable:!0})})}let ei=class{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function l(d,f,m){const p=tl(f);if(!p)throw new Error("header name must be a non-empty string");const v=ie.findKey(r,p);(!v||r[v]===void 0||m===!0||m===void 0&&r[v]!==!1)&&(r[v||f]=vu(d))}const u=(d,f)=>ie.forEach(d,(m,p)=>l(m,p,f));if(ie.isPlainObject(e)||e instanceof this.constructor)u(e,n);else if(ie.isString(e)&&(e=e.trim())&&!M7(e))u(_7(e),n);else if(ie.isObject(e)&&ie.isIterable(e)){let d={},f,m;for(const p of e){if(!ie.isArray(p))throw TypeError("Object iterator must return a key-value pair");d[m=p[0]]=(f=d[m])?ie.isArray(f)?[...f,p[1]]:[f,p[1]]:p[1]}u(d,n)}else e!=null&&l(n,e,i);return this}get(e,n){if(e=tl(e),e){const i=ie.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return A7(r);if(ie.isFunction(n))return n.call(this,r,i);if(ie.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=tl(e),e){const i=ie.findKey(this,e);return!!(i&&this[i]!==void 0&&(!n||Wf(this,this[i],i,n)))}return!1}delete(e,n){const i=this;let r=!1;function l(u){if(u=tl(u),u){const d=ie.findKey(i,u);d&&(!n||Wf(i,i[d],d,n))&&(delete i[d],r=!0)}}return ie.isArray(e)?e.forEach(l):l(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const l=n[i];(!e||Wf(this,this[l],l,e,!0))&&(delete this[l],r=!0)}return r}normalize(e){const n=this,i={};return ie.forEach(this,(r,l)=>{const u=ie.findKey(i,l);if(u){n[u]=vu(r),delete n[l];return}const d=e?O7(l):String(l).trim();d!==l&&delete n[l],n[d]=vu(r),i[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return ie.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&ie.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const i=new this(e);return n.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[Ky]=this[Ky]={accessors:{}}).accessors,r=this.prototype;function l(u){const d=tl(u);i[d]||(D7(r,u),i[d]=!0)}return ie.isArray(e)?e.forEach(l):l(e),this}};ei.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ie.reduceDescriptors(ei.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}});ie.freezeMethods(ei);function Zf(t,e){const n=this||Ll,i=e||n,r=ei.from(i.headers);let l=i.data;return ie.forEach(t,function(d){l=d.call(n,l,r.normalize(),e?e.status:void 0)}),r.normalize(),l}function ZC(t){return!!(t&&t.__CANCEL__)}function no(t,e,n){Ye.call(this,t??"canceled",Ye.ERR_CANCELED,e,n),this.name="CanceledError"}ie.inherits(no,Ye,{__CANCEL__:!0});function YC(t,e,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(new Ye("Request failed with status code "+n.status,[Ye.ERR_BAD_REQUEST,Ye.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function L7(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function P7(t,e){t=t||10;const n=new Array(t),i=new Array(t);let r=0,l=0,u;return e=e!==void 0?e:1e3,function(f){const m=Date.now(),p=i[l];u||(u=m),n[r]=f,i[r]=m;let v=l,C=0;for(;v!==r;)C+=n[v++],v=v%t;if(r=(r+1)%t,r===l&&(l=(l+1)%t),m-u<e)return;const x=p&&m-p;return x?Math.round(C*1e3/x):void 0}}function I7(t,e){let n=0,i=1e3/e,r,l;const u=(m,p=Date.now())=>{n=p,r=null,l&&(clearTimeout(l),l=null),t(...m)};return[(...m)=>{const p=Date.now(),v=p-n;v>=i?u(m,p):(r=m,l||(l=setTimeout(()=>{l=null,u(r)},i-v)))},()=>r&&u(r)]}const Iu=(t,e,n=3)=>{let i=0;const r=P7(50,250);return I7(l=>{const u=l.loaded,d=l.lengthComputable?l.total:void 0,f=u-i,m=r(f),p=u<=d;i=u;const v={loaded:u,total:d,progress:d?u/d:void 0,bytes:f,rate:m||void 0,estimated:m&&d&&p?(d-u)/m:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};t(v)},n)},Wy=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},Zy=t=>(...e)=>ie.asap(()=>t(...e)),U7=Dn.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,Dn.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(Dn.origin),Dn.navigator&&/(msie|trident)/i.test(Dn.navigator.userAgent)):()=>!0,B7=Dn.hasStandardBrowserEnv?{write(t,e,n,i,r,l){const u=[t+"="+encodeURIComponent(e)];ie.isNumber(n)&&u.push("expires="+new Date(n).toGMTString()),ie.isString(i)&&u.push("path="+i),ie.isString(r)&&u.push("domain="+r),l===!0&&u.push("secure"),document.cookie=u.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function F7(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function z7(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function JC(t,e,n){let i=!F7(e);return t&&(i||n==!1)?z7(t,e):e}const Yy=t=>t instanceof ei?{...t}:t;function Va(t,e){e=e||{};const n={};function i(m,p,v,C){return ie.isPlainObject(m)&&ie.isPlainObject(p)?ie.merge.call({caseless:C},m,p):ie.isPlainObject(p)?ie.merge({},p):ie.isArray(p)?p.slice():p}function r(m,p,v,C){if(ie.isUndefined(p)){if(!ie.isUndefined(m))return i(void 0,m,v,C)}else return i(m,p,v,C)}function l(m,p){if(!ie.isUndefined(p))return i(void 0,p)}function u(m,p){if(ie.isUndefined(p)){if(!ie.isUndefined(m))return i(void 0,m)}else return i(void 0,p)}function d(m,p,v){if(v in e)return i(m,p);if(v in t)return i(void 0,m)}const f={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:d,headers:(m,p,v)=>r(Yy(m),Yy(p),v,!0)};return ie.forEach(Object.keys({...t,...e}),function(p){const v=f[p]||r,C=v(t[p],e[p],p);ie.isUndefined(C)&&v!==d||(n[p]=C)}),n}const QC=t=>{const e=Va({},t);let{data:n,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:l,headers:u,auth:d}=e;e.headers=u=ei.from(u),e.url=GC(JC(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),d&&u.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):"")));let f;if(ie.isFormData(n)){if(Dn.hasStandardBrowserEnv||Dn.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((f=u.getContentType())!==!1){const[m,...p]=f?f.split(";").map(v=>v.trim()).filter(Boolean):[];u.setContentType([m||"multipart/form-data",...p].join("; "))}}if(Dn.hasStandardBrowserEnv&&(i&&ie.isFunction(i)&&(i=i(e)),i||i!==!1&&U7(e.url))){const m=r&&l&&B7.read(l);m&&u.set(r,m)}return e},q7=typeof XMLHttpRequest<"u",V7=q7&&function(t){return new Promise(function(n,i){const r=QC(t);let l=r.data;const u=ei.from(r.headers).normalize();let{responseType:d,onUploadProgress:f,onDownloadProgress:m}=r,p,v,C,x,S;function k(){x&&x(),S&&S(),r.cancelToken&&r.cancelToken.unsubscribe(p),r.signal&&r.signal.removeEventListener("abort",p)}let E=new XMLHttpRequest;E.open(r.method.toUpperCase(),r.url,!0),E.timeout=r.timeout;function _(){if(!E)return;const A=ei.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders()),j={data:!d||d==="text"||d==="json"?E.responseText:E.response,status:E.status,statusText:E.statusText,headers:A,config:t,request:E};YC(function(N){n(N),k()},function(N){i(N),k()},j),E=null}"onloadend"in E?E.onloadend=_:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(_)},E.onabort=function(){E&&(i(new Ye("Request aborted",Ye.ECONNABORTED,t,E)),E=null)},E.onerror=function(){i(new Ye("Network Error",Ye.ERR_NETWORK,t,E)),E=null},E.ontimeout=function(){let w=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const j=r.transitional||KC;r.timeoutErrorMessage&&(w=r.timeoutErrorMessage),i(new Ye(w,j.clarifyTimeoutError?Ye.ETIMEDOUT:Ye.ECONNABORTED,t,E)),E=null},l===void 0&&u.setContentType(null),"setRequestHeader"in E&&ie.forEach(u.toJSON(),function(w,j){E.setRequestHeader(j,w)}),ie.isUndefined(r.withCredentials)||(E.withCredentials=!!r.withCredentials),d&&d!=="json"&&(E.responseType=r.responseType),m&&([C,S]=Iu(m,!0),E.addEventListener("progress",C)),f&&E.upload&&([v,x]=Iu(f),E.upload.addEventListener("progress",v),E.upload.addEventListener("loadend",x)),(r.cancelToken||r.signal)&&(p=A=>{E&&(i(!A||A.type?new no(null,t,E):A),E.abort(),E=null)},r.cancelToken&&r.cancelToken.subscribe(p),r.signal&&(r.signal.aborted?p():r.signal.addEventListener("abort",p)));const O=L7(r.url);if(O&&Dn.protocols.indexOf(O)===-1){i(new Ye("Unsupported protocol "+O+":",Ye.ERR_BAD_REQUEST,t));return}E.send(l||null)})},H7=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i=new AbortController,r;const l=function(m){if(!r){r=!0,d();const p=m instanceof Error?m:this.reason;i.abort(p instanceof Ye?p:new no(p instanceof Error?p.message:p))}};let u=e&&setTimeout(()=>{u=null,l(new Ye(`timeout ${e} of ms exceeded`,Ye.ETIMEDOUT))},e);const d=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(m=>{m.unsubscribe?m.unsubscribe(l):m.removeEventListener("abort",l)}),t=null)};t.forEach(m=>m.addEventListener("abort",l));const{signal:f}=i;return f.unsubscribe=()=>ie.asap(d),f}},$7=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let i=0,r;for(;i<n;)r=i+e,yield t.slice(i,r),i=r},G7=async function*(t,e){for await(const n of K7(t))yield*$7(n,e)},K7=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:i}=await e.read();if(n)break;yield i}}finally{await e.cancel()}},Jy=(t,e,n,i)=>{const r=G7(t,e);let l=0,u,d=f=>{u||(u=!0,i&&i(f))};return new ReadableStream({async pull(f){try{const{done:m,value:p}=await r.next();if(m){d(),f.close();return}let v=p.byteLength;if(n){let C=l+=v;n(C)}f.enqueue(new Uint8Array(p))}catch(m){throw d(m),m}},cancel(f){return d(f),r.return()}},{highWaterMark:2})},ud=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",XC=ud&&typeof ReadableStream=="function",W7=ud&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),e9=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Z7=XC&&e9(()=>{let t=!1;const e=new Request(Dn.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Qy=64*1024,Bm=XC&&e9(()=>ie.isReadableStream(new Response("").body)),Uu={stream:Bm&&(t=>t.body)};ud&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Uu[e]&&(Uu[e]=ie.isFunction(t[e])?n=>n[e]():(n,i)=>{throw new Ye(`Response type '${e}' is not supported`,Ye.ERR_NOT_SUPPORT,i)})})})(new Response);const Y7=async t=>{if(t==null)return 0;if(ie.isBlob(t))return t.size;if(ie.isSpecCompliantForm(t))return(await new Request(Dn.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(ie.isArrayBufferView(t)||ie.isArrayBuffer(t))return t.byteLength;if(ie.isURLSearchParams(t)&&(t=t+""),ie.isString(t))return(await W7(t)).byteLength},J7=async(t,e)=>{const n=ie.toFiniteNumber(t.getContentLength());return n??Y7(e)},Q7=ud&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:l,timeout:u,onDownloadProgress:d,onUploadProgress:f,responseType:m,headers:p,withCredentials:v="same-origin",fetchOptions:C}=QC(t);m=m?(m+"").toLowerCase():"text";let x=H7([r,l&&l.toAbortSignal()],u),S;const k=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let E;try{if(f&&Z7&&n!=="get"&&n!=="head"&&(E=await J7(p,i))!==0){let j=new Request(e,{method:"POST",body:i,duplex:"half"}),R;if(ie.isFormData(i)&&(R=j.headers.get("content-type"))&&p.setContentType(R),j.body){const[N,L]=Wy(E,Iu(Zy(f)));i=Jy(j.body,Qy,N,L)}}ie.isString(v)||(v=v?"include":"omit");const _="credentials"in Request.prototype;S=new Request(e,{...C,signal:x,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:_?v:void 0});let O=await fetch(S,C);const A=Bm&&(m==="stream"||m==="response");if(Bm&&(d||A&&k)){const j={};["status","statusText","headers"].forEach(F=>{j[F]=O[F]});const R=ie.toFiniteNumber(O.headers.get("content-length")),[N,L]=d&&Wy(R,Iu(Zy(d),!0))||[];O=new Response(Jy(O.body,Qy,N,()=>{L&&L(),k&&k()}),j)}m=m||"text";let w=await Uu[ie.findKey(Uu,m)||"text"](O,t);return!A&&k&&k(),await new Promise((j,R)=>{YC(j,R,{data:w,headers:ei.from(O.headers),status:O.status,statusText:O.statusText,config:t,request:S})})}catch(_){throw k&&k(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new Ye("Network Error",Ye.ERR_NETWORK,t,S),{cause:_.cause||_}):Ye.from(_,_&&_.code,t,S)}}),Fm={http:f7,xhr:V7,fetch:Q7};ie.forEach(Fm,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Xy=t=>`- ${t}`,X7=t=>ie.isFunction(t)||t===null||t===!1,t9={getAdapter:t=>{t=ie.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let l=0;l<e;l++){n=t[l];let u;if(i=n,!X7(n)&&(i=Fm[(u=String(n)).toLowerCase()],i===void 0))throw new Ye(`Unknown adapter '${u}'`);if(i)break;r[u||"#"+l]=i}if(!i){const l=Object.entries(r).map(([d,f])=>`adapter ${d} `+(f===!1?"is not supported by the environment":"is not available in the build"));let u=e?l.length>1?`since :
`+l.map(Xy).join(`
`):" "+Xy(l[0]):"as no adapter specified";throw new Ye("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return i},adapters:Fm};function Yf(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new no(null,t)}function eb(t){return Yf(t),t.headers=ei.from(t.headers),t.data=Zf.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),t9.getAdapter(t.adapter||Ll.adapter)(t).then(function(i){return Yf(t),i.data=Zf.call(t,t.transformResponse,i),i.headers=ei.from(i.headers),i},function(i){return ZC(i)||(Yf(t),i&&i.response&&(i.response.data=Zf.call(t,t.transformResponse,i.response),i.response.headers=ei.from(i.response.headers))),Promise.reject(i)})}const n9="1.11.0",dd={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{dd[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});const tb={};dd.transitional=function(e,n,i){function r(l,u){return"[Axios v"+n9+"] Transitional option '"+l+"'"+u+(i?". "+i:"")}return(l,u,d)=>{if(e===!1)throw new Ye(r(u," has been removed"+(n?" in "+n:"")),Ye.ERR_DEPRECATED);return n&&!tb[u]&&(tb[u]=!0,console.warn(r(u," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(l,u,d):!0}};dd.spelling=function(e){return(n,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function e8(t,e,n){if(typeof t!="object")throw new Ye("options must be an object",Ye.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const l=i[r],u=e[l];if(u){const d=t[l],f=d===void 0||u(d,l,t);if(f!==!0)throw new Ye("option "+l+" must be "+f,Ye.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ye("Unknown option "+l,Ye.ERR_BAD_OPTION)}}const yu={assertOptions:e8,validators:dd},Ji=yu.validators;let za=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Gy,response:new Gy}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const l=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?l&&!String(i.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+l):i.stack=l}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Va(this.defaults,n);const{transitional:i,paramsSerializer:r,headers:l}=n;i!==void 0&&yu.assertOptions(i,{silentJSONParsing:Ji.transitional(Ji.boolean),forcedJSONParsing:Ji.transitional(Ji.boolean),clarifyTimeoutError:Ji.transitional(Ji.boolean)},!1),r!=null&&(ie.isFunction(r)?n.paramsSerializer={serialize:r}:yu.assertOptions(r,{encode:Ji.function,serialize:Ji.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),yu.assertOptions(n,{baseUrl:Ji.spelling("baseURL"),withXsrfToken:Ji.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=l&&ie.merge(l.common,l[n.method]);l&&ie.forEach(["delete","get","head","post","put","patch","common"],S=>{delete l[S]}),n.headers=ei.concat(u,l);const d=[];let f=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(n)===!1||(f=f&&k.synchronous,d.unshift(k.fulfilled,k.rejected))});const m=[];this.interceptors.response.forEach(function(k){m.push(k.fulfilled,k.rejected)});let p,v=0,C;if(!f){const S=[eb.bind(this),void 0];for(S.unshift(...d),S.push(...m),C=S.length,p=Promise.resolve(n);v<C;)p=p.then(S[v++],S[v++]);return p}C=d.length;let x=n;for(v=0;v<C;){const S=d[v++],k=d[v++];try{x=S(x)}catch(E){k.call(this,E);break}}try{p=eb.call(this,x)}catch(S){return Promise.reject(S)}for(v=0,C=m.length;v<C;)p=p.then(m[v++],m[v++]);return p}getUri(e){e=Va(this.defaults,e);const n=JC(e.baseURL,e.url,e.allowAbsoluteUrls);return GC(n,e.params,e.paramsSerializer)}};ie.forEach(["delete","get","head","options"],function(e){za.prototype[e]=function(n,i){return this.request(Va(i||{},{method:e,url:n,data:(i||{}).data}))}});ie.forEach(["post","put","patch"],function(e){function n(i){return function(l,u,d){return this.request(Va(d||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:l,data:u}))}}za.prototype[e]=n(),za.prototype[e+"Form"]=n(!0)});let t8=class i9{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const i=this;this.promise.then(r=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](r);i._listeners=null}),this.promise.then=r=>{let l;const u=new Promise(d=>{i.subscribe(d),l=d}).then(r);return u.cancel=function(){i.unsubscribe(l)},u},e(function(l,u,d){i.reason||(i.reason=new no(l,u,d),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new i9(function(r){e=r}),cancel:e}}};function n8(t){return function(n){return t.apply(null,n)}}function i8(t){return ie.isObject(t)&&t.isAxiosError===!0}const zm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zm).forEach(([t,e])=>{zm[e]=t});function s9(t){const e=new za(t),n=DC(za.prototype.request,e);return ie.extend(n,za.prototype,e,{allOwnKeys:!0}),ie.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return s9(Va(t,r))},n}const tn=s9(Ll);tn.Axios=za;tn.CanceledError=no;tn.CancelToken=t8;tn.isCancel=ZC;tn.VERSION=n9;tn.toFormData=cd;tn.AxiosError=Ye;tn.Cancel=tn.CanceledError;tn.all=function(e){return Promise.all(e)};tn.spread=n8;tn.isAxiosError=i8;tn.mergeConfig=Va;tn.AxiosHeaders=ei;tn.formToJSON=t=>WC(ie.isHTMLForm(t)?new FormData(t):t);tn.getAdapter=t9.getAdapter;tn.HttpStatusCode=zm;tn.default=tn;const{Axios:hM,AxiosError:fM,CanceledError:mM,isCancel:pM,CancelToken:gM,VERSION:vM,all:yM,Cancel:bM,isAxiosError:CM,spread:xM,toFormData:SM,AxiosHeaders:kM,HttpStatusCode:TM,formToJSON:EM,getAdapter:wM,mergeConfig:jM}=tn,nb="https://backend36.dev",io=typeof window<"u";var b2;const s8=io&&((b2=window==null?void 0:window.location)==null?void 0:b2.hostname)&&/^(localhost|127\.|192\.168\.|10\.|172\.(1[6-9]|2\d|3[0-1]))$/.test(window.location.hostname);var C2;const a8=io&&((C2=window==null?void 0:window.location)==null?void 0:C2.hostname)&&/^(192\.168\.|10\.|172\.(1[6-9]|2\d|3[0-1]))$/.test(window.location.hostname);var x2;const a9=io&&((x2=window==null?void 0:window.location)==null?void 0:x2.hostname)&&window.location.hostname.includes("ngrok");var S2;const r9=io&&((S2=window==null?void 0:window.location)==null?void 0:S2.hostname)&&!window.location.hostname.includes("localhost")&&!window.location.hostname.match(/^(192\.168\.|10\.|172\.(1[6-9]|2\d|3[0-1]))/)&&!a9&&!window.location.hostname.includes("ngrok"),o9=io&&r9?"/api":nb;var k2;io&&((k2=window==null?void 0:window.location)!=null&&k2.hostname)&&(console.log(" Web environment detected"),console.log(" window.location.hostname:",window.location.hostname),console.log(" isLocalhost:",s8),console.log(" isLAN:",a8),console.log(" isNgrok:",a9),console.log(" isProduction:",r9),console.log(" API_URL:",o9));const qe=tn.create({baseURL:o9,withCredentials:!0});if(typeof window<"u"){const t=window.localStorage.getItem("auth_token");t&&(qe.defaults.headers.common.Authorization=`Bearer ${t}`)}qe.interceptors.request.use(t=>{var n;if(typeof window<"u"){const i=window.localStorage.getItem("auth_token");i&&!t.headers.Authorization&&(t.headers.Authorization=`Bearer ${i}`)}const e=typeof t.headers.Authorization=="string"?t.headers.Authorization.substring(0,30)+"...":t.headers.Authorization?String(t.headers.Authorization):"none";return console.log(" API Request:",{method:(n=t.method)==null?void 0:n.toUpperCase(),url:t.url,baseURL:t.baseURL,hasAuth:!!t.headers.Authorization,authHeader:e}),t},t=>(console.error(" Request Error:",t),Promise.reject(t)));qe.interceptors.response.use(t=>(console.log(" API Response:",{status:t.status,statusText:t.statusText,data:t.data}),t),t=>{var e,n,i,r,l,u,d;return console.error(" Response Error:",{status:(e=t.response)==null?void 0:e.status,statusText:(n=t.response)==null?void 0:n.statusText,data:(i=t.response)==null?void 0:i.data,config:{method:(l=(r=t.config)==null?void 0:r.method)==null?void 0:l.toUpperCase(),url:(u=t.config)==null?void 0:u.url,data:(d=t.config)==null?void 0:d.data}}),Promise.reject(t)});const r8=t=>{t?qe.defaults.headers.common.Authorization=`Bearer ${t}`:delete qe.defaults.headers.common.Authorization},l9=async(t,e)=>(await qe.post("/auth/login",{email:t,password:e})).data,ib=async t=>{const e=new FormData;e.append("file",t);const n=await qe.post("/uploads/s3/public",e,{});return{url:n.data.url,type:n.data.mime.startsWith("image/")?"image":"video"}},o8=async(t,e,n)=>(await qe.post("/auth/register",{email:t,password:e,name:n})).data,l8=async(t,e)=>(await qe.post("/auth/verify-otp",{email:t,otp:e})).data,c8=async t=>(await qe.post("/auth/resend-otp",{email:t})).data,u8=async t=>(await qe.post("/auth/send-verification-otp",{email:t})).data,d8=async t=>(await qe.patch("/users/profile",t)).data,Pl=async()=>{try{return typeof window>"u"?null:window.localStorage.getItem("user_id")}catch(t){return console.error("Error getting user ID from localStorage:",t),null}},qm=async()=>(await qe.get("/social/friends")).data,h8=async t=>(await qe.post(`/users/${t}/block`)).data,f8=async t=>(await qe.delete(`/users/${t}/block`)).data,m8=async t=>(await qe.get(`/users/${t}/block-status`)).data,p8=async t=>(await qe.delete(`/social/friends/${t}`)).data,sb=async(t,e="authored")=>{var n;try{return(await qe.get(`/social/users/${t}/photos`,{params:{type:e}})).data}catch(i){if(((n=i==null?void 0:i.response)==null?void 0:n.status)===404)return{items:[]};throw i}},nu=async t=>(await qe.patch("/users/me/profile",t)).data,c9=async(t,e,n=20)=>{const i={limit:n};return e&&(i.cursor=e),(await qe.get(`/social/users/${t}/posts`,{params:i})).data},g8=async(t,e)=>(await qe.post("/auth/change-password",{currentPassword:t,newPassword:e})).data,u9=async t=>(await qe.post("/users/by-ids",{userIds:t})).data,v8=async(t,e=1,n=20)=>{console.log(" searchUsers called with:",{query:t,page:e,limit:n}),console.log(" API base URL:",qe.defaults.baseURL),console.log(" Auth header:",qe.defaults.headers.common.Authorization);const i=await qe.get("/users/search",{params:{q:t,page:e,limit:n}});return console.log(" searchUsers response:",i.data),i.data},y8=async(t,e)=>(await qe.post(`/social/posts/${t}/comments`,e)).data,b8=async(t,e)=>{const n={};return e&&(n.cursor=e),(await qe.get(`/social/posts/${t}/comments`,{params:n})).data},C8=async(t,e)=>{const n={};return e&&(n.cursor=e),(await qe.get(`/social/hashtags/${encodeURIComponent(t)}/posts`,{params:n})).data},x8=async t=>(await qe.get(`/social/posts/${t}`)).data,S8=async(t,e)=>(await qe.post(`/social/posts/${t}/share`,e)).data,k8=async t=>(await qe.post(`/social/posts/${t}/save`,{})).data,d9=async t=>(await qe.delete(`/social/posts/${t}/save`)).data,T8=async t=>{const e={};return t&&(e.cursor=t),(await qe.get("/social/posts/saved",{params:e})).data},h9=async(t,e)=>(await qe.post(`/social/posts/${t}/report`,e)).data,E8=async(t=6)=>(await qe.get("/social/friends/suggestions",{params:{limit:t}})).data,f9=async t=>(await qe.post("/social/friends/requests",{targetUserId:t})).data,m9=async(t,e)=>(await qe.post(`/social/friends/${t}/respond`,{action:e})).data,w8=async()=>(await qe.get("/social/friends/requests/pending")).data,j8=async(t,e=20)=>{const n={limit:e};return(await qe.get("/social/notifications",{params:n})).data},R8=async t=>(await qe.post("/social/notifications/read",{ids:t})).data,so=async t=>(await qe.get(`/users/${t}`)).data,N8=async t=>{const e=typeof t=="string"?{q:t}:{q:t.q,type:t.type};return(await qe.get("/social/search",{params:e})).data},Up=async(t,e)=>(await qe.post(`/social/posts/${t}/reactions`,{type:e})).data,Bp=async t=>(await qe.delete(`/social/posts/${t}/reactions`)).data,Vm=async(t,e=10)=>{const n={limit:e};return t&&(n.cursor=t),(await qe.get("/reels",{params:n})).data},_8=async(t,e,n=20)=>{const i={limit:n};return e&&(i.cursor=e),(await qe.get(`/reels/users/${t}`,{params:i})).data},ab=async(t,e="LIKE")=>(await qe.post(`/reels/${t}/like`,{type:e})).data,rb=async t=>(await qe.delete(`/reels/${t}/like`)).data,A8=async t=>(await qe.get(`/reels/${t}/liked`)).data,M8=async()=>(await qe.post("/reels/sync")).data;function ob(){console.log(" LoginScreen component rendering...");const t=_i(),[e,n]=b.useState(""),[i,r]=b.useState(""),[l,u]=b.useState(!1);b.useEffect(()=>{localStorage.getItem("auth_token")&&(console.log(" Already logged in, redirecting to home..."),t.push("/conversations"))},[t]),console.log(" LoginScreen render complete");const d=async()=>{var f,m,p,v,C;if(!e||!i){alert("Thiu thng tin: Nhp email v mt khu");return}try{u(!0);const x=await l9(e,i);console.log(" Login response:",x);const S=x.accessToken,k=x.user.id||x.user._id||x.user.userId;if(!k){console.error(" No userId found in login response!"),alert("Li: Khng tm thy user ID trong phn hi ng nhp");return}localStorage.setItem("auth_token",S),localStorage.setItem("user_id",k),localStorage.setItem("user_data",JSON.stringify(x.user)),r8(S),window.dispatchEvent(new Event("auth:login")),console.log(" Login successful, navigating to Conversations..."),t.push("/conversations")}catch(x){if(console.error(" Login error:",x),((f=x==null?void 0:x.response)==null?void 0:f.status)===403){if(confirm("Email cha c xc thc. Vui lng kim tra email v xc thc ti khon trc khi ng nhp. Bn c mun gi li m OTP khng?"))try{u(!0),await u8(e),alert(`M OTP xc thc  c gi n ${e}. Vui lng kim tra email v th ng nhp li.`),r("")}catch(k){console.error(" Send verification OTP error:",k),alert(((p=(m=k==null?void 0:k.response)==null?void 0:m.data)==null?void 0:p.message)||"Khng th gi li OTP. Vui lng th li sau.")}finally{u(!1)}}else alert("ng nhp tht bi: "+(((C=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:C.message)||x.message))}finally{u(!1)}};return o.jsxs("div",{className:"auth-container",children:[o.jsxs("div",{className:"auth-brand-area",children:[o.jsx("div",{className:"auth-gradient-bg"}),o.jsx("div",{className:"auth-shape auth-shape-1"}),o.jsx("div",{className:"auth-shape auth-shape-2"}),o.jsx("div",{className:"auth-shape auth-shape-3"}),o.jsxs("div",{className:"auth-brand-content",children:[o.jsxs("div",{className:"auth-logo-large",children:[o.jsx("div",{className:"auth-logo-icon",children:"D"}),o.jsx("div",{className:"auth-logo-text",children:"ZoLa"})]}),o.jsx("p",{className:"auth-brand-tagline",children:"Kt ni vi bn b v th gii xung quanh bn"}),o.jsxs("div",{className:"auth-brand-features",children:[o.jsxs("div",{className:"auth-feature",children:[o.jsx("svg",{className:"auth-feature-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"})}),o.jsx("span",{children:"Nhn tin thi gian thc"})]}),o.jsxs("div",{className:"auth-feature",children:[o.jsx("svg",{className:"auth-feature-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),o.jsx("span",{children:"Gi video & chia s mn hnh"})]}),o.jsxs("div",{className:"auth-feature",children:[o.jsx("svg",{className:"auth-feature-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),o.jsx("span",{children:"Chia s khonh khc vi bn b"})]})]})]})]}),o.jsxs("div",{className:"auth-form-area",children:[o.jsx("div",{className:"auth-glow-effect"}),o.jsxs("div",{className:"auth-form-container",children:[o.jsxs("div",{className:"auth-form-header",children:[o.jsx("h1",{className:"auth-form-title",children:"Cho mng tr li"}),o.jsx("p",{className:"auth-form-subtitle",children:"Nhp thng tin ca bn  tip tc"})]}),o.jsxs("div",{className:"auth-form",children:[o.jsxs("div",{className:"auth-input-group",children:[o.jsx("label",{className:"auth-label",children:"Email"}),o.jsx("input",{type:"email",placeholder:"you@example.com",className:"auth-input",value:e,onChange:f=>n(f.target.value),onKeyPress:f=>f.key==="Enter"&&d(),autoComplete:"email"})]}),o.jsxs("div",{className:"auth-input-group",children:[o.jsx("label",{className:"auth-label",children:"Mt khu"}),o.jsx("input",{type:"password",placeholder:"",className:"auth-input",value:i,onChange:f=>r(f.target.value),onKeyPress:f=>f.key==="Enter"&&d(),autoComplete:"current-password"})]}),o.jsx("button",{className:"auth-button-primary",onClick:d,disabled:l,children:l?o.jsxs("span",{className:"auth-button-loading",children:[o.jsxs("svg",{className:"auth-spinner",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ang ng nhp..."]}):"ng nhp"})]}),o.jsxs("div",{className:"auth-form-footer",children:[o.jsx("span",{className:"auth-footer-text",children:"Cha c ti khon?"}),o.jsx("button",{className:"auth-link",onClick:()=>t.push("/register"),children:"To ti khon"})]}),o.jsx("div",{className:"auth-decorative-line"})]})]})]})}function O8(){const t=_i(),[e,n]=b.useState(""),[i,r]=b.useState(""),[l,u]=b.useState(""),[d,f]=b.useState(""),[m,p]=b.useState(!1),[v,C]=b.useState({}),x=()=>{const k={};return!e||!i||!l?(k.general="Vui lng in y  thng tin",C(k),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?i.length<6?(k.password="Mt khu phi c t nht 6 k t",C(k),!1):i!==l?(k.confirmPassword="Mt khu xc nhn khng khp",C(k),!1):(C({}),!0):(k.email="Email khng hp l. Vui lng nhp email ng nh dng",C(k),!1)},S=async()=>{var k,E,_,O,A,w,j;if(x())try{p(!0),C({}),console.log(" Attempting to register user");const R=await o8(e,i,d||void 0);console.log(" Register response:",R);const N=R==null?void 0:R.otp;console.log(" OTP info from register response:",N);const L=new URLSearchParams({email:e,password:i,...d&&{name:d}});t.push(`/otp-verification?${L.toString()}`),(N==null?void 0:N.emailSent)===!0?alert(`ng k thnh cng!
M OTP  c gi n ${e}. Vui lng nhp m xc thc.`):N!=null&&N.otpCreated&&N.emailSent===!1?alert(`ng k thnh cng!
`+(N.message||"OTP  c to nhng khng th gi email. Bn c th th gi li OTP  mn hnh tip theo.")):((N==null?void 0:N.otpCreated)===!1||!N)&&alert(`ng k thnh cng!
Khng th gi OTP t ng. Vui lng s dng nt "Gi li OTP"  mn hnh tip theo.`)}catch(R){console.error(" Registration error:",R),console.error(" Error response:",R==null?void 0:R.response),console.error(" Error response data:",(k=R==null?void 0:R.response)==null?void 0:k.data),console.error(" Error response status:",(E=R==null?void 0:R.response)==null?void 0:E.status);let N="C li xy ra, vui lng th li";if(((_=R==null?void 0:R.response)==null?void 0:_.status)===400){const L=(O=R==null?void 0:R.response)==null?void 0:O.data;L!=null&&L.message?N=L.message:L!=null&&L.errors?N=`Li validation: ${Array.isArray(L.errors)?L.errors.join(", "):JSON.stringify(L.errors)}`:N="D liu khng hp l. Vui lng kim tra li thng tin."}else((A=R==null?void 0:R.response)==null?void 0:A.status)===409?N="Email  c s dng. Vui lng chn email khc.":(j=(w=R==null?void 0:R.response)==null?void 0:w.data)!=null&&j.message?N=R.response.data.message:R!=null&&R.message&&(N=R.message);C({general:N})}finally{p(!1)}};return o.jsxs("div",{className:"auth-container",children:[o.jsxs("div",{className:"auth-brand-area",children:[o.jsx("div",{className:"auth-gradient-bg"}),o.jsx("div",{className:"auth-shape auth-shape-1"}),o.jsx("div",{className:"auth-shape auth-shape-2"}),o.jsx("div",{className:"auth-shape auth-shape-3"}),o.jsxs("div",{className:"auth-brand-content",children:[o.jsxs("div",{className:"auth-logo-large",children:[o.jsx("div",{className:"auth-logo-icon",children:"D"}),o.jsx("div",{className:"auth-logo-text",children:"Zola"})]}),o.jsx("p",{className:"auth-brand-tagline",children:"Tham gia cng ng v bt u kt ni ngay hm nay"}),o.jsxs("div",{className:"auth-brand-features",children:[o.jsxs("div",{className:"auth-feature",children:[o.jsx("svg",{className:"auth-feature-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),o.jsx("span",{children:"Xy dng mng li ca bn"})]}),o.jsxs("div",{className:"auth-feature",children:[o.jsx("svg",{className:"auth-feature-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),o.jsx("span",{children:"Gi lin lc ngay lp tc"})]}),o.jsxs("div",{className:"auth-feature",children:[o.jsx("svg",{className:"auth-feature-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"})}),o.jsx("span",{children:"T do th hin bn thn"})]})]})]})]}),o.jsxs("div",{className:"auth-form-area",children:[o.jsx("div",{className:"auth-glow-effect"}),o.jsxs("div",{className:"auth-form-container",children:[o.jsxs("div",{className:"auth-form-header",children:[o.jsx("h1",{className:"auth-form-title",children:"To ti khon"}),o.jsx("p",{className:"auth-form-subtitle",children:"Bt u vi ti khon min ph ca bn"})]}),o.jsxs("div",{className:"auth-form",children:[o.jsxs("div",{className:"auth-input-group",children:[o.jsx("label",{className:"auth-label",children:"H v tn"}),o.jsx("input",{type:"text",placeholder:"Nguyn Vn A",className:"auth-input",value:d,onChange:k=>f(k.target.value),autoComplete:"name"})]}),o.jsxs("div",{className:"auth-input-group",children:[o.jsx("label",{className:"auth-label",children:"Email"}),o.jsx("input",{type:"email",placeholder:"you@example.com",className:`auth-input ${v.email?"auth-input-error":""}`,value:e,onChange:k=>{n(k.target.value),v.email&&C({...v,email:""})},autoComplete:"email"}),v.email&&o.jsx("span",{className:"auth-error-text",children:v.email})]}),o.jsxs("div",{className:"auth-input-group",children:[o.jsx("label",{className:"auth-label",children:"Mt khu"}),o.jsx("input",{type:"password",placeholder:"",className:`auth-input ${v.password?"auth-input-error":""}`,value:i,onChange:k=>{r(k.target.value),v.password&&C({...v,password:""})},onKeyPress:k=>k.key==="Enter"&&S(),autoComplete:"new-password"}),v.password&&o.jsx("span",{className:"auth-error-text",children:v.password})]}),o.jsxs("div",{className:"auth-input-group",children:[o.jsx("label",{className:"auth-label",children:"Xc nhn mt khu"}),o.jsx("input",{type:"password",placeholder:"",className:`auth-input ${v.confirmPassword?"auth-input-error":""}`,value:l,onChange:k=>{u(k.target.value),v.confirmPassword&&C({...v,confirmPassword:""})},onKeyPress:k=>k.key==="Enter"&&S(),autoComplete:"new-password"}),v.confirmPassword&&o.jsx("span",{className:"auth-error-text",children:v.confirmPassword})]}),v.general&&o.jsx("div",{className:"auth-error-message",children:v.general}),o.jsx("button",{className:"auth-button-primary",onClick:S,disabled:m,children:m?o.jsxs("span",{className:"auth-button-loading",children:[o.jsxs("svg",{className:"auth-spinner",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ang to ti khon..."]}):"To ti khon"}),o.jsxs("p",{className:"auth-terms",children:["Bng cch ng k, bn ng  vi"," ",o.jsx("a",{href:"#",className:"auth-terms-link",children:"iu khon"})," v"," ",o.jsx("a",{href:"#",className:"auth-terms-link",children:"Chnh sch bo mt"})]})]}),o.jsxs("div",{className:"auth-form-footer",children:[o.jsx("span",{className:"auth-footer-text",children:" c ti khon?"}),o.jsx("button",{className:"auth-link",onClick:()=>t.push("/login"),children:"ng nhp"})]}),o.jsx("div",{className:"auth-decorative-line"})]})]})]})}function D8(){const t=OC(),e=_i(),[n,i]=b.useState(""),[r,l]=b.useState(!1),[u,d]=b.useState(!1),[f,m]=b.useState(300),[p,v]=b.useState(!1),[C,x]=b.useState(""),S=b.useRef(null),k=t.get("email")||"",E=t.get("password")||"";t.get("name"),b.useEffect(()=>{if(f>0){const j=setTimeout(()=>m(f-1),1e3);return()=>clearTimeout(j)}else v(!0)},[f]),b.useEffect(()=>{n.length===6&&!r&&O()},[n]),b.useEffect(()=>{const j=setTimeout(()=>{var R;(R=S.current)==null||R.focus()},500);return()=>clearTimeout(j)},[]);const _=j=>{const R=Math.floor(j/60),N=j%60;return`${R}:${N.toString().padStart(2,"0")}`},O=async()=>{var j,R;if(n.length!==6){x("Vui lng nhp y  6 ch s");return}try{l(!0),x(""),console.log(" Verifying OTP");const N=await l8(k,n);console.log(" OTP verification response:",N),console.log(" Auto logging in after email verification");const L=await l9(k,E);console.log(" Auto login response:",L),typeof window<"u"&&(localStorage.setItem("auth_token",L.accessToken),localStorage.setItem("user_id",L.user.id),localStorage.setItem("user_data",JSON.stringify(L.user))),e.push("/feed")}catch(N){console.error(" OTP verification error:",N);const L=((R=(j=N==null?void 0:N.response)==null?void 0:j.data)==null?void 0:R.message)||N.message||"M OTP khng ng hoc  ht hn";x(L),i("")}finally{l(!1)}},A=async()=>{var j,R;try{d(!0),x("");const N=await c8(k);console.log(" Resend OTP response:",N),m(300),v(!1),i(""),N&&N.emailSent===!1?alert(N.message||"OTP mi  c to nhng khng th gi email. Vui lng th li sau."):alert(` gi li m OTP
M OTP mi  c gi n ${k}`),setTimeout(()=>{var L;(L=S.current)==null||L.focus()},500)}catch(N){console.error(" Resend OTP error:",N);const L=((R=(j=N==null?void 0:N.response)==null?void 0:j.data)==null?void 0:R.message)||N.message||"Khng th gi li m OTP. Vui lng th li sau.";x(L)}finally{d(!1)}},w=()=>{e.push("/register")};return k?o.jsx("div",{className:"auth-container",children:o.jsxs("div",{className:"auth-form-area",children:[o.jsx("div",{className:"auth-glow-effect"}),o.jsxs("div",{className:"auth-form-container",children:[o.jsxs("div",{className:"auth-form-header",children:[o.jsx("h1",{className:"auth-form-title",children:"Xc thc OTP"}),o.jsx("p",{className:"auth-form-subtitle",children:"Nhp m 6 ch s  c gi n:"}),o.jsx("p",{style:{color:"#0866FF",fontWeight:600,marginTop:8},children:k})]}),o.jsxs("div",{className:"auth-form",children:[o.jsxs("div",{className:"auth-input-group",children:[o.jsx("label",{className:"auth-label",children:"M OTP"}),o.jsx("input",{ref:S,type:"text",placeholder:"000000",className:`auth-input ${C?"auth-input-error":""}`,style:{textAlign:"center",fontSize:24,fontWeight:700,letterSpacing:8,fontFamily:"monospace"},value:n,onChange:j=>{const R=j.target.value.replace(/\D/g,"").slice(0,6);i(R),C&&x("")},maxLength:6,autoComplete:"one-time-code"}),C&&o.jsx("span",{className:"auth-error-text",children:C})]}),o.jsx("div",{style:{textAlign:"center",marginBottom:20},children:p?o.jsx("button",{className:"auth-link",onClick:A,disabled:u,style:{background:"none",border:"none",padding:0},children:u?"ang gi...":"Gi li m OTP"}):o.jsxs("p",{style:{color:"#f02849",fontSize:14,fontWeight:600},children:["Gi li sau: ",_(f)]})}),o.jsx("button",{className:"auth-button-primary",onClick:O,disabled:r||n.length!==6,children:r?o.jsxs("span",{className:"auth-button-loading",children:[o.jsxs("svg",{className:"auth-spinner",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ang xc thc..."]}):"Xc thc"}),o.jsx("div",{className:"auth-form-footer",style:{marginTop:20},children:o.jsx("button",{className:"auth-link",onClick:w,style:{background:"none",border:"none",padding:0},children:" Quay li ng k"})})]})]})]})}):o.jsx("div",{className:"auth-container",children:o.jsx("div",{className:"auth-form-area",children:o.jsxs("div",{className:"auth-form-container",children:[o.jsx("div",{className:"auth-error-message",children:"Email khng hp l. Vui lng ng k li."}),o.jsx("button",{className:"auth-button-primary",onClick:w,children:"Quay li ng k"})]})})})}const L8=()=>{const[t,e]=b.useState([]),[n,i]=b.useState(null),[r,l]=b.useState(!0),[u,d]=b.useState(!1),[f,m]=b.useState(null),p=b.useCallback(async(w=!1)=>{if(!u&&!(!r&&!w)){d(!0),m(null);try{const j=await dE(w?void 0:n||void 0);l(j.hasNext),i(j.nextCursor),e(R=>w?j.items:[...R,...j.items])}catch(j){console.error("Failed to load feed",j),m((j==null?void 0:j.message)||"Failed to load feed")}finally{d(!1)}}},[n,r,u]);b.useEffect(()=>{p(!0)},[]),b.useEffect(()=>{const w=window.__socket;if(!w)return;const j=N=>{e(L=>L.some(F=>F._id===N._id)?L:[N,...L])},R=N=>{e(L=>L.map(F=>F._id===N.postId?{...F,likeCount:N.total??F.likeCount,reactionCounts:N.reactionCounts??F.reactionCounts}:F)),N.userId&&window.__currentUserId&&N.userId===window.__currentUserId&&x(L=>({...L,[N.postId]:N.reaction??null}))};return w.on("social:post:new",j),w.on("social:post:reaction",R),()=>{w.off("social:post:new",j),w.off("social:post:reaction",R)}},[]);const v=b.useCallback(async(w,j=[],R="PUBLIC")=>{const N=await fE({content:w,media:j,visibility:R});e(L=>[N,...L])},[]),[C,x]=b.useState({}),S=b.useCallback(async w=>{try{const{liked:j,type:R}=await RE(w);return x(N=>({...N,[w]:j?R||"LIKE":null})),j}catch(j){return console.error("Failed to check liked status",j),!1}},[]);b.useEffect(()=>{t.forEach(w=>{C[w._id]===void 0&&S(w._id)})},[t,S]);const k=b.useCallback((w,j,R)=>{e(N=>N.map(L=>{if(L._id!==w)return L;const F={...L.reactionCounts||{}};R&&(F[R]=Math.max(0,(F[R]||0)-1)),j&&(F[j]=(F[j]||0)+1);const D=Object.values(F).reduce((I,B)=>I+(B||0),0);return{...L,reactionCounts:F,likeCount:D}}))},[]),E=b.useCallback(async(w,j)=>{const R=C[w]||null;x(N=>({...N,[w]:j})),k(w,j,R);try{await NE(w,j)}catch(N){console.error("Failed to react",N),x(L=>({...L,[w]:R})),k(w,R,j)}},[C,k]),_=b.useCallback(async w=>{const j=C[w]||null;if(j){x(R=>({...R,[w]:null})),k(w,null,j);try{await _E(w)}catch(R){console.error("Failed to remove reaction",R),x(N=>({...N,[w]:j})),k(w,j,null)}}},[C,k]),O=b.useCallback(async w=>{await AE(w)},[]),A=b.useCallback(async(w,j)=>{await ME(w,j)},[]);return{items:t,hasNext:r,isLoading:u,error:f,loadMore:p,createPost:v,reactionMap:C,selectReaction:E,clearReaction:_,savePost:O,reportPost:A}},P8=()=>{const[t,e]=b.useState([]),[n,i]=b.useState(!1),[r,l]=b.useState(null),u=b.useCallback(async()=>{i(!0),l(null);try{const p=await hE();e(p)}catch(p){console.error("Failed to load stories",p),l((p==null?void 0:p.message)||"Khng th ti stories")}finally{i(!1)}},[]);b.useEffect(()=>{u()},[u]),b.useEffect(()=>{const p=window.__socket;if(!p)return;const v=S=>{e(k=>{const E=[...k],_=E.findIndex(O=>O.author._id===S.author._id);if(_>=0){const O=E[_],A=[S.story,...O.stories.filter(w=>w._id!==S.story._id)];return E[_]={...O,stories:A},E}return[{author:S.author,stories:[S.story]},...k]})},C=S=>{e(k=>k.map(E=>E.author._id===S.authorId?{...E,stories:E.stories.filter(_=>_._id!==S.storyId)}:E).filter(E=>E.stories.length>0))},x=S=>{e(k=>k.map(E=>({...E,stories:E.stories.map(_=>_._id===S.storyId?{..._,viewCount:S.viewCount}:_)})))};return p.on("social:story:new",v),p.on("social:story:deleted",C),p.on("social:story:viewed",x),()=>{p.off("social:story:new",v),p.off("social:story:deleted",C),p.off("social:story:viewed",x)}},[]);const d=b.useCallback(async p=>{await mE(p),await u()},[u]),f=b.useCallback(async p=>{e(v=>v.map(C=>({...C,stories:C.stories.map(x=>x._id===p?{...x,hasSeen:!0,viewCount:x.viewCount+(x.hasSeen?0:1)}:x)})));try{await gE(p)}catch(v){console.error("Failed to mark story viewed",v)}},[]),m=b.useCallback(async p=>{await vE(p),e(v=>v.map(C=>({...C,stories:C.stories.filter(x=>x._id!==p)})).filter(C=>C.stories.length>0))},[]);return{stories:t,isLoading:n,error:r,reloadStories:u,createStory:d,markStorySeen:f,deleteStory:m}},I8=(t=6)=>{const[e,n]=b.useState([]),[i,r]=b.useState(!1),l=b.useCallback(async()=>{r(!0);try{const u=await TE(t);n(u.suggestions||[])}catch(u){console.error("Failed to load friend suggestions",u)}finally{r(!1)}},[t]);return b.useEffect(()=>{l()},[l]),b.useEffect(()=>{const u=window.__socket;if(!u)return;const d=()=>l();return u.on("social:suggestions:refresh",d),()=>{u.off("social:suggestions:refresh",d)}},[l]),{items:e,isLoading:i,reload:l}},U8=t=>{const[e,n]=b.useState([]),[i,r]=b.useState(null),[l,u]=b.useState(!0),[d,f]=b.useState(!1),m=b.useCallback(async(v=!1)=>{if(!d&&!(!l&&!v)){f(!0);try{const C=await SE(t,v?void 0:i||void 0);u(C.hasNext),r(C.nextCursor),n(x=>v?C.items:[...x,...C.items])}finally{f(!1)}}},[i,l,d,t]),p=b.useCallback(async v=>{const C=await kE(t,{content:v});n(x=>[C,...x])},[t]);return{items:e,hasNext:l,isLoading:d,loadMore:m,createComment:p}},B8=()=>{const t="__analytics_session_id";let e=sessionStorage.getItem(t);return e||(e=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem(t,e)),e},F8=()=>{const t=b.useRef(B8()),e=b.useCallback((n,i)=>{xE(n,i,t.current)},[]);return b.useEffect(()=>{},[]),{trackEvent:e}},z8=({children:t,leftSidebar:e,rightSidebar:n,header:i,hideSidebars:r=!1})=>{const u=Fn().pathname.startsWith("/profile"),d=r||u;return o.jsxs("div",{className:"feed-root",children:[i,o.jsx("div",{className:"feed-main-layout",children:o.jsxs("div",{className:`feed-inner ${d?"feed-inner--full-width":""}`,children:[!d&&e&&o.jsx("aside",{className:"feed-sidebar feed-sidebar--left",children:e}),o.jsx("main",{className:`feed-center ${d?"feed-center--full-width":""}`,children:t}),!d&&n&&o.jsx("aside",{className:"feed-right feed-right--sidebar",children:n})]})})]})},q8=({currentUser:t,activeRoute:e="/"})=>{var i,r;const n=yn();return o.jsxs(o.Fragment,{children:[t&&o.jsxs("div",{className:"feed-nav-item feed-nav-item--user",onClick:()=>n(`/profile/${t._id}`),children:[o.jsx("div",{className:"feed-nav-avatar",children:t.avatar?o.jsx("img",{src:t.avatar,alt:t.name}):o.jsx("div",{className:"feed-nav-avatar-initials",children:((r=(i=t.name)==null?void 0:i.charAt(0))==null?void 0:r.toUpperCase())||"U"})}),o.jsx("span",{className:"feed-nav-user-name",children:t.name})]}),o.jsx("div",{className:"feed-nav-section-title",children:"Menu"}),o.jsxs("div",{className:`feed-nav-item ${e==="/"||e==="/feed"?"feed-nav-item--active":""}`,onClick:()=>n("/feed"),children:[o.jsx("div",{className:"feed-nav-icon",children:""}),o.jsx("span",{children:"Bng tin"})]}),o.jsxs("div",{className:`feed-nav-item ${e==="/conversations"?"feed-nav-item--active":""}`,onClick:()=>n("/conversations"),children:[o.jsx("div",{className:"feed-nav-icon",children:""}),o.jsx("span",{children:"Tin nhn"})]}),o.jsxs("div",{className:`feed-nav-item ${e==="/friends"?"feed-nav-item--active":""}`,onClick:()=>n("/friends"),children:[o.jsx("div",{className:"feed-nav-icon",children:""}),o.jsx("span",{children:"Bn b"})]}),o.jsxs("div",{className:`feed-nav-item ${e==="/search"?"feed-nav-item--active":""}`,onClick:()=>n("/search"),children:[o.jsx("div",{className:"feed-nav-icon",children:""}),o.jsx("span",{children:"Tm kim"})]}),o.jsxs("div",{className:`feed-nav-item ${e==="/saved"?"feed-nav-item--active":""}`,onClick:()=>n("/saved"),children:[o.jsx("div",{className:"feed-nav-icon",children:""}),o.jsx("span",{children:"Bi vit  lu"})]})]})},V8=({friendSuggestions:t=[],isLoading:e=!1,sentRequests:n={},onSendRequest:i})=>o.jsxs("div",{className:"feed-card",children:[o.jsx("div",{className:"feed-right-card-title",children:"Gi  bn b"}),e&&o.jsx("div",{style:{opacity:.7},children:"ang ti..."}),!e&&t.length===0&&o.jsx("p",{className:"feed-right-text",children:"Khng c gi  no lc ny."}),o.jsx("div",{className:"suggestion-list",children:t.map(r=>{var l,u;return o.jsxs("div",{className:"suggestion-item",children:[o.jsx("div",{className:"suggestion-avatar",children:r.user.avatar?o.jsx("img",{src:r.user.avatar,alt:r.user.name}):o.jsx("div",{className:"suggestion-avatar-initials",children:((u=(l=r.user.name)==null?void 0:l.charAt(0))==null?void 0:u.toUpperCase())||"U"})}),o.jsxs("div",{className:"suggestion-info",children:[o.jsx("div",{className:"suggestion-name",children:r.user.name}),o.jsxs("div",{className:"suggestion-mutual",children:[r.mutualCount," bn chung"]}),r.mutualFriends.length>0&&o.jsxs("div",{className:"suggestion-mutual-list",children:[r.mutualFriends.map(d=>d.name).slice(0,2).join(", "),r.mutualCount>2?"...":""]})]}),i&&o.jsx("button",{className:"suggestion-btn",onClick:()=>i(r.user._id),disabled:n[r.user._id],children:n[r.user._id]?" gi":"Kt bn"})]},r.user._id)})})]}),H8=()=>{const[t,e]=b.useState(!1),[n,i]=b.useState([]),[r,l]=b.useState(0),[u,d]=b.useState(!1),f=b.useRef(null);b.useEffect(()=>{m();const x=setInterval(m,3e4);return()=>clearInterval(x)},[]),b.useEffect(()=>{const x=S=>{f.current&&!f.current.contains(S.target)&&e(!1)};return t&&document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[t]);const m=async()=>{try{d(!0);const x=await wE(void 0,20);i(x.items||[]);const S=(x.items||[]).filter(k=>!k.isRead).length;l(S)}catch(x){console.error("Failed to load notifications:",x)}finally{d(!1)}},p=async x=>{try{await jE(x),i(S=>S.map(k=>x.includes(k._id)?{...k,isRead:!0}:k)),l(S=>Math.max(0,S-x.length))}catch(S){console.error("Failed to mark read:",S)}},v=x=>{var k;const S=((k=x.actor)==null?void 0:k.name)||"Ai ";switch(x.type){case"POST_LIKED":return`${S}  thch bi vit ca bn`;case"POST_COMMENTED":return`${S}  bnh lun bi vit ca bn`;case"FRIEND_REQUEST":return`${S}  gi li mi kt bn`;case"FRIEND_ACCEPTED":return`${S}  chp nhn li mi kt bn`;default:return x.message||"Thng bo mi"}},C=x=>{const S=new Date(x),E=new Date().getTime()-S.getTime(),_=Math.floor(E/6e4),O=Math.floor(E/36e5),A=Math.floor(E/864e5);return _<1?"Va xong":_<60?`${_} pht trc`:O<24?`${O} gi trc`:A<7?`${A} ngy trc`:S.toLocaleDateString("vi-VN")};return o.jsxs("div",{className:"notifications-wrapper",ref:f,children:[o.jsxs("button",{className:"feed-icon-button notifications-button",onClick:()=>e(!t),title:"Thng bo",children:["",r>0&&o.jsx("span",{className:"notifications-badge",children:r})]}),t&&o.jsxs("div",{className:"notifications-dropdown",children:[o.jsxs("div",{className:"notifications-header",children:[o.jsx("h3",{children:"Thng bo"}),r>0&&o.jsx("button",{className:"notifications-mark-all-read",onClick:()=>{const x=n.filter(S=>!S.isRead).map(S=>S._id);x.length>0&&p(x)},children:"nh du tt c  c"})]}),o.jsxs("div",{className:"notifications-list",children:[u&&o.jsx("div",{style:{padding:20,textAlign:"center"},children:"ang ti..."}),!u&&n.length===0&&o.jsx("div",{style:{padding:20,textAlign:"center",opacity:.7},children:"Khng c thng bo no."}),n.map(x=>{var S,k,E,_;return o.jsxs("div",{className:`notification-item ${x.isRead?"":"notification-item--unread"}`,onClick:()=>{x.isRead||p([x._id])},children:[o.jsx("div",{className:"notification-avatar",children:(S=x.actor)!=null&&S.avatar?o.jsx("img",{src:x.actor.avatar,alt:x.actor.name}):o.jsx("div",{className:"notification-avatar-initials",children:((_=(E=(k=x.actor)==null?void 0:k.name)==null?void 0:E.charAt(0))==null?void 0:_.toUpperCase())||"U"})}),o.jsxs("div",{className:"notification-content",children:[o.jsx("div",{className:"notification-text",children:v(x)}),o.jsx("div",{className:"notification-time",children:C(x.createdAt)})]}),!x.isRead&&o.jsx("div",{className:"notification-dot"})]},x._id)})]})]})]})},$8=({currentUser:t})=>{var f,m;const e=yn(),n=Fn(),[i,r]=b.useState(""),l=async()=>{try{const p=localStorage.getItem("auth_token");p&&await hC(p)}catch(p){console.error("Logout error:",p)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),localStorage.removeItem("user_data"),Pu(),Lm(),window.location.href="/login"}},u=p=>{p.preventDefault(),i.trim()&&e(`/search?q=${encodeURIComponent(i.trim())}`)},d=p=>n.pathname===p;return o.jsxs("header",{className:"fb-navbar",children:[o.jsxs("div",{className:"fb-navbar-left",children:[o.jsx("div",{className:"fb-logo",onClick:()=>e("/feed"),role:"button",tabIndex:0,children:o.jsx("span",{className:"fb-logo-text",children:"D"})}),o.jsxs("form",{onSubmit:u,className:"fb-search-wrapper",children:[o.jsx("svg",{className:"fb-search-icon",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:o.jsx("path",{d:"M10.743 10.743a6 6 0 1 1-1.06-1.06l4.158 4.157a.75.75 0 1 1-1.06 1.061l-4.158-4.158zM11.5 6a5.5 5.5 0 1 0-11 0 5.5 5.5 0 0 0 11 0z"})}),o.jsx("input",{type:"text",className:"fb-search-input",placeholder:"Search Facebook",value:i,onChange:p=>r(p.target.value)})]})]}),o.jsxs("div",{className:"fb-navbar-center",children:[o.jsx("button",{className:`fb-nav-tab ${d("/feed")||d("/")?"fb-nav-tab--active":""}`,onClick:()=>e("/feed"),title:"Home",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M25.825 12.29C25.824 12.289 25.823 12.288 25.821 12.286L15.027 2.937C14.752 2.675 14.392 2.527 13.989 2.521 13.608 2.527 13.248 2.675 13.001 2.912L2.175 12.29C1.756 12.658 1.629 13.245 1.868 13.759 2.079 14.215 2.567 14.479 3.069 14.479L5 14.479 5 23.729C5 24.695 5.784 25.479 6.75 25.479L11 25.479C11.552 25.479 12 25.031 12 24.479L12 18.309C12 18.126 12.148 17.979 12.33 17.979L15.67 17.979C15.852 17.979 16 18.126 16 18.309L16 24.479C16 25.031 16.448 25.479 17 25.479L21.25 25.479C22.217 25.479 23 24.695 23 23.729L23 14.479 24.931 14.479C25.433 14.479 25.921 14.215 26.132 13.759 26.371 13.245 26.244 12.658 25.825 12.29"})})}),o.jsx("button",{className:`fb-nav-tab ${d("/reels")||d("/video")?"fb-nav-tab--active":""}`,onClick:()=>e("/reels"),title:"Video","aria-label":"Video",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M8.75 25.25C8.336 25.25 8 24.914 8 24.5 8 24.086 8.336 23.75 8.75 23.75L19.25 23.75C19.664 23.75 20 24.086 20 24.5 20 24.914 19.664 25.25 19.25 25.25L8.75 25.25ZM17.163 12.846 12.055 15.923C11.591 16.202 11 15.869 11 15.327L11 9.172C11 8.631 11.591 8.297 12.055 8.576L17.163 11.654C17.612 11.924 17.612 12.575 17.163 12.846ZM21.75 20.25C22.992 20.25 24 19.242 24 18L24 6.5C24 5.258 22.992 4.25 21.75 4.25L6.25 4.25C5.008 4.25 4 5.258 4 6.5L4 18C4 19.242 5.008 20.25 6.25 20.25L21.75 20.25ZM21.75 21.75 6.25 21.75C4.179 21.75 2.5 20.071 2.5 18L2.5 6.5C2.5 4.429 4.179 2.75 6.25 2.75L21.75 2.75C23.821 2.75 25.5 4.429 25.5 6.5L25.5 18C25.5 20.071 23.821 21.75 21.75 21.75Z"})})}),o.jsx("button",{className:`fb-nav-tab ${d("/saved")?"fb-nav-tab--active":""}`,onClick:()=>e("/saved"),title:"Marketplace",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M17.5 23.979 21.25 23.979C21.386 23.979 21.5 23.864 21.5 23.729L21.5 13.979C21.5 13.427 21.949 13.979 22.5 13.979L24.33 13.979 14.017 4.046 3.672 13.979 5.5 13.979C6.052 13.979 5.5 13.427 5.5 13.979L5.5 23.729C5.5 23.864 5.615 23.979 5.75 23.979L9.5 23.979 9.5 17.729C9.5 16.66 10.364 15.979 11.5 15.979L15.5 15.979C16.636 15.979 17.5 16.66 17.5 17.729L17.5 23.979ZM21.25 25.479 17 25.479C16.448 25.479 16 25.031 16 24.479L16 18.329C16 18.135 15.844 17.979 15.65 17.979L11.35 17.979C11.156 17.979 11 18.135 11 18.329L11 24.479C11 25.031 10.552 25.479 10 25.479L5.75 25.479C4.784 25.479 4 24.695 4 23.729L4 15.479 2.5 15.479C1.817 15.479 1.265 14.782 1.408 14.113 1.464 13.853 1.596 13.611 1.792 13.417L13.768 1.92C14.001 1.69 14.322 1.562 14.655 1.562 14.988 1.562 15.309 1.69 15.541 1.92L27.518 13.417C27.714 13.611 27.846 13.853 27.902 14.113 28.045 14.782 27.493 15.479 26.81 15.479L25.5 15.479 25.5 23.729C25.5 24.695 24.716 25.479 23.75 25.479L21.25 25.479Z"})})}),o.jsx("button",{className:`fb-nav-tab ${d("/friends")?"fb-nav-tab--active":""}`,onClick:()=>e("/friends"),title:"Groups",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M25.5 14C25.5 7.649 20.351 2.5 14 2.5 7.649 2.5 2.5 7.649 2.5 14 2.5 20.351 7.649 25.5 14 25.5 20.351 25.5 25.5 20.351 25.5 14ZM27 14C27 21.18 21.18 27 14 27 6.82 27 1 21.18 1 14 1 6.82 6.82 1 14 1 21.18 1 27 6.82 27 14ZM7.479 14 7.631 14C7.933 14 8.102 14.338 7.934 14.591 7.334 15.491 6.983 16.568 6.983 17.724L6.983 18.221C6.983 18.342 6.99 18.461 7.004 18.578 7.03 18.802 6.862 19 6.637 19L6.123 19C5.228 19 4.5 18.25 4.5 17.327 4.5 15.492 5.727 14 7.479 14ZM20.521 14C22.274 14 23.5 15.491 23.5 17.327 23.5 18.25 22.772 19 21.878 19L21.364 19C21.139 19 20.971 18.802 20.997 18.578 21.011 18.461 21.017 18.342 21.017 18.221L21.017 17.724C21.017 16.568 20.667 15.491 20.067 14.591 19.899 14.338 20.068 14 20.369 14L20.521 14ZM8.25 13C7.147 13 6.25 11.991 6.25 10.75 6.25 9.384 7.035 8.5 8.25 8.5 9.465 8.5 10.25 9.384 10.25 10.75 10.25 11.991 9.353 13 8.25 13ZM19.75 13C18.647 13 17.75 11.991 17.75 10.75 17.75 9.384 18.535 8.5 19.75 8.5 20.965 8.5 21.75 9.384 21.75 10.75 21.75 11.991 20.853 13 19.75 13ZM15.172 13.5C17.558 13.5 19.5 15.395 19.5 17.724L19.5 18.221C19.5 19.202 18.683 20 17.677 20L10.323 20C9.317 20 8.5 19.202 8.5 18.221L8.5 17.724C8.5 15.395 10.442 13.5 12.828 13.5L15.172 13.5ZM16.75 9.75C16.75 11.483 15.517 12.5 14 12.5 12.484 12.5 11.25 11.483 11.25 9.75 11.25 8.017 12.484 7 14 7 15.517 7 16.75 8.017 16.75 9.75Z"})})}),o.jsx("button",{className:`fb-nav-tab ${d("/settings")?"fb-nav-tab--active":""}`,onClick:()=>e("/settings"),title:"Gaming",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M23.5 9.5H10.25a.75.75 0 00-.75.75v7c0 .414.336.75.75.75H17v5.5H4.5v-19h19v5zm0 14v-1.25a.75.75 0 00-.75-.75H18a.75.75 0 00-.75.75V24a1 1 0 001 1h4.5a1 1 0 001-1zM3.5 23.25v-19c0-1.079.914-2 2-2h17c1.079 0 2 .914 2 2v19c0 1.079-.914 2-2 2h-17c-1.079 0-2-.914-2-2z"})})})]}),o.jsxs("div",{className:"fb-navbar-right",children:[o.jsx("button",{className:"fb-icon-button",title:"Menu",onClick:()=>e("/settings"),children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M2.5 6.5a1 1 0 000 2h15a1 1 0 000-2h-15zm0 5a1 1 0 000 2h15a1 1 0 000-2h-15z"})})}),o.jsx("button",{className:"fb-icon-button",title:"Messenger",onClick:()=>e("/conversations"),children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M10 0C4.477 0 0 4.145 0 9.25c0 2.9 1.434 5.483 3.675 7.184v3.316a.75.75 0 001.193.593l3.427-2.569a11.08 11.08 0 001.705.13c5.523 0 10-4.145 10-9.25S15.523 0 10 0zm1.061 12.44l-2.56-2.73-5.003 2.73 5.503-5.842 2.622 2.73 4.94-2.73-5.502 5.841z"})})}),o.jsx("div",{className:"fb-notifications-wrapper",children:o.jsx(H8,{})}),o.jsx("div",{className:"fb-profile-menu",children:o.jsx("button",{className:"fb-profile-button",onClick:()=>e("/profile"),title:(t==null?void 0:t.name)||"Profile",children:t!=null&&t.avatar?o.jsx("img",{src:t.avatar,alt:t.name,className:"fb-profile-avatar"}):o.jsx("div",{className:"fb-profile-avatar fb-profile-avatar-initials",children:((m=(f=t==null?void 0:t.name)==null?void 0:f.charAt(0))==null?void 0:m.toUpperCase())||"U"})})}),o.jsx("button",{className:"fb-icon-button",title:"Logout",onClick:l,children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M3 3a1 1 0 011-1h6a1 1 0 110 2H5v12h5a1 1 0 110 2H4a1 1 0 01-1-1V3zm11.293 3.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L15.586 11H9a1 1 0 110-2h6.586l-1.293-1.293a1 1 0 010-1.414z"})})})]})]})},G8=({isOpen:t,onClose:e,onSubmit:n,currentUser:i})=>{var A,w;const[r,l]=b.useState(""),[u,d]=b.useState([]),[f,m]=b.useState([]),[p,v]=b.useState(!1),[C,x]=b.useState("PUBLIC"),S=b.useRef(null),k=b.useRef(null);b.useEffect(()=>{t&&k.current&&k.current.focus()},[t]),b.useEffect(()=>{t||(l(""),d([]),f.forEach(j=>URL.revokeObjectURL(j)),m([]),S.current&&(S.current.value=""))},[t]);const E=j=>{const R=Array.from(j.target.files||[]);if(R.length===0)return;const N=[];for(const D of R){if(D.size>20*1024*1024){alert(`File ${D.name} qu ln (ti a 20MB)`);continue}if(!D.type.startsWith("image/")&&!D.type.startsWith("video/")){alert(`File ${D.name} khng phi nh hoc video`);continue}N.push(D)}if(N.length===0)return;const L=N.slice(0,4);d(L);const F=L.map(D=>URL.createObjectURL(D));m(F)},_=j=>{const R=u.filter((L,F)=>F!==j),N=f.filter((L,F)=>F!==j);d(R),m(N),URL.revokeObjectURL(f[j])},O=async()=>{if(!(!r.trim()&&u.length===0)){v(!0);try{const j=[];for(const R of u)try{const N=await mC(R);j.push(N)}catch(N){console.error("Failed to upload media:",N);const L=(N==null?void 0:N.message)||`Li khi upload ${R.name}`;throw alert(L),N}await n(r,j,C),e()}catch(j){console.error("Failed to create post:",j),alert("Li khi ng bi")}finally{v(!1)}}};return t?o.jsx("div",{className:"create-post-modal-overlay",onClick:e,children:o.jsxs("div",{className:"create-post-modal",onClick:j=>j.stopPropagation(),children:[o.jsxs("div",{className:"create-post-modal-header",children:[o.jsx("h2",{children:"To bi vit"}),o.jsx("button",{className:"create-post-modal-close",onClick:e,children:""})]}),o.jsxs("div",{className:"create-post-modal-body",children:[o.jsx("div",{className:"create-post-modal-user",children:i?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"create-post-modal-avatar",children:i.avatar?o.jsx("img",{src:i.avatar,alt:i.name}):o.jsx("div",{className:"create-post-modal-avatar-initials",children:((w=(A=i.name)==null?void 0:A.charAt(0))==null?void 0:w.toUpperCase())||"U"})}),o.jsxs("div",{className:"create-post-modal-user-info",children:[o.jsx("div",{className:"create-post-modal-user-name",children:i.name}),o.jsxs("button",{className:"create-post-modal-privacy",onClick:()=>x(C==="PUBLIC"?"FRIENDS":"PUBLIC"),children:[C==="PUBLIC"?o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""})," Cng khai"]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""})," Bn b"]}),o.jsx("span",{children:""})]})]})]}):o.jsx("div",{children:"Loading..."})}),o.jsx("textarea",{ref:k,className:"create-post-modal-textarea",value:r,onChange:j=>l(j.target.value),placeholder:`${(i==null?void 0:i.name)||"Bn"} i, bn ang ngh g th?`,rows:4}),f.length>0&&o.jsx("div",{className:"create-post-modal-media-preview",children:f.map((j,R)=>o.jsxs("div",{className:"create-post-modal-media-item",children:[o.jsx("img",{src:j,alt:`Preview ${R+1}`}),o.jsx("button",{className:"create-post-modal-media-remove",onClick:()=>_(R),type:"button",children:""})]},R))}),o.jsxs("div",{className:"create-post-modal-actions",children:[o.jsx("div",{className:"create-post-modal-actions-label",children:"Thm vo bi vit ca bn"}),o.jsxs("div",{className:"create-post-modal-actions-buttons",children:[o.jsxs("button",{className:"create-post-modal-action-btn",onClick:()=>{var j;return(j=S.current)==null?void 0:j.click()},type:"button",title:"nh/Video",children:[o.jsx("span",{className:"create-post-modal-action-icon",children:""}),o.jsx("span",{children:"nh/Video"})]}),o.jsxs("button",{className:"create-post-modal-action-btn",type:"button",title:"Gn th bn b",disabled:!0,children:[o.jsx("span",{className:"create-post-modal-action-icon",children:""}),o.jsx("span",{children:"Gn th bn b"})]}),o.jsxs("button",{className:"create-post-modal-action-btn",type:"button",title:"Cm xc",disabled:!0,children:[o.jsx("span",{className:"create-post-modal-action-icon",children:""}),o.jsx("span",{children:"Cm xc"})]}),o.jsxs("button",{className:"create-post-modal-action-btn",type:"button",title:"V tr",disabled:!0,children:[o.jsx("span",{className:"create-post-modal-action-icon",children:""}),o.jsx("span",{children:"V tr"})]}),o.jsxs("button",{className:"create-post-modal-action-btn",type:"button",title:"GIF",disabled:!0,children:[o.jsx("span",{className:"create-post-modal-action-icon",children:"GIF"}),o.jsx("span",{children:"GIF"})]})]})]}),o.jsx("input",{ref:S,type:"file",accept:"image/*,video/*",multiple:!0,onChange:E,style:{display:"none"}})]}),o.jsx("div",{className:"create-post-modal-footer",children:o.jsx("button",{className:"create-post-modal-submit",onClick:O,disabled:p||!r.trim()&&u.length===0,children:p?"ang ng...":"ng"})})]})}):null},K8=({isOpen:t,onClose:e,onSubmit:n,currentUser:i})=>{var Be,Je;const[r,l]=b.useState(""),[u,d]=b.useState([]),[f,m]=b.useState("FRIENDS"),[p,v]=b.useState(null),[C,x]=b.useState(!1),[S,k]=b.useState(""),[E,_]=b.useState(""),[O,A]=b.useState(""),[w,j]=b.useState(""),[R,N]=b.useState([]),[L,F]=b.useState(!1),[D,I]=b.useState(!1),[B,G]=b.useState(null),[Z,ue]=b.useState(!1),[q,ee]=b.useState(0),[re,he]=b.useState(30),[Se,P]=b.useState(!1),[K,ae]=b.useState(0),le=b.useRef(null),[Te,ce]=b.useState(!1),[_e,V]=b.useState(!1),[ve,be]=b.useState(null);b.useEffect(()=>{t||(l(""),d([]),m("FRIENDS"),v(null),x(!1),k(""),_(""),A(""),j(""),N([]),I(!1),G(null),ue(!1),ee(0),he(30),P(!1),ae(0),le.current&&(le.current.pause(),le.current.src=""),be(null),ce(!1),V(!1))},[t]);const Ue=b.useCallback(async xe=>{if(!xe.trim()){N([]);return}F(!0);try{const Ne=await pE(xe);N(Ne)}catch{be("Tm kim nhc tht bi")}finally{F(!1)}},[]),et=xe=>{xe.previewUrl?(G(xe),ue(!0),ee(0),he(30),ae(0)):(v({title:xe.trackName,artist:xe.artistName,url:void 0,thumbnail:xe.artworkUrl100||xe.artworkUrl60,durationMs:xe.trackTimeMillis,source:"itunes",startTime:0,endTime:30}),x(!1),I(!1),j(""),N([]),be(null))},At=()=>{B&&(v({title:B.trackName,artist:B.artistName,url:B.previewUrl,thumbnail:B.artworkUrl100||B.artworkUrl60,durationMs:B.trackTimeMillis,source:"itunes",startTime:q,endTime:re}),ue(!1),x(!1),I(!1),j(""),N([]),G(null),P(!1),ae(0),le.current&&(le.current.pause(),le.current.src=""),be(null))},mt=()=>{ue(!1),G(null),P(!1),ae(0),ee(0),he(30),le.current&&(le.current.pause(),le.current.src="")};b.useEffect(()=>{const xe=le.current;if(!xe||!(B!=null&&B.previewUrl))return;xe.src=B.previewUrl,xe.currentTime=q;const Ne=()=>{const Ke=xe.currentTime;ae(Ke),Ke>=re&&(xe.pause(),P(!1),xe.currentTime=q)};return xe.addEventListener("timeupdate",Ne),xe.addEventListener("ended",()=>{P(!1),xe.currentTime=q}),()=>{xe.removeEventListener("timeupdate",Ne)}},[B,q,re]);const Dt=()=>{const xe=le.current;xe&&(Se?(xe.pause(),P(!1)):(xe.currentTime=q,xe.play().then(()=>P(!0)).catch(()=>P(!1))))},Q=xe=>{const Ne=le.current;if(!Ne||!(B!=null&&B.previewUrl))return;const Ke=xe.currentTarget.getBoundingClientRect(),zt=(xe.clientX-Ke.left)/Ke.width,dn=30,hn=Math.max(0,Math.min(dn,zt*dn));hn<q?(ee(Math.max(0,hn-15)),he(Math.max(30,hn+15))):hn>re?(he(Math.min(dn,hn+15)),ee(Math.max(0,hn-15))):(Ne.currentTime=hn,ae(hn))},Ee=(xe,Ne)=>{var Os;const Ke=le.current;if(!Ke||!(B!=null&&B.previewUrl))return;const ft=30,zt=(Os=Ne.currentTarget.closest(".story-music-segment-timeline"))==null?void 0:Os.getBoundingClientRect();if(!zt)return;const dn=fi=>{const nn=fi.clientX-zt.left,qt=Math.max(0,Math.min(1,nn/zt.width))*ft;if(xe==="start"){const Ve=Math.max(0,Math.min(qt,re-5));ee(Ve),Ke.currentTime<Ve&&(Ke.currentTime=Ve)}else{const Ve=Math.max(q+5,Math.min(ft,qt));he(Ve),Ke.currentTime>Ve&&(Ke.currentTime=Ve)}},hn=()=>{document.removeEventListener("mousemove",dn),document.removeEventListener("mouseup",hn)};document.addEventListener("mousemove",dn),document.addEventListener("mouseup",hn)};if(!t)return null;const se=async xe=>{if(!(!xe||xe.length===0)){ce(!0),be(null);try{const Ne=[];for(const Ke of Array.from(xe)){if(!Ke.type.startsWith("image/")&&!Ke.type.startsWith("video/")){be("Ch h tr nh hoc video.");continue}const ft=await mC(Ke);Ne.push({url:ft.url,type:ft.type==="video"?"video":"image"})}d(Ke=>[...Ke,...Ne])}catch(Ne){be((Ne==null?void 0:Ne.message)||"Upload tht bi")}finally{ce(!1)}}},fe=()=>{if(!S.trim()||!E.trim()){be("Vui lng nhp tn bi ht v ngh s.");return}v({title:S.trim(),artist:E.trim(),url:O.trim()||void 0,source:"custom"}),x(!1),be(null)},Ae=()=>{v(null),k(""),_(""),A("")},He=async()=>{if(u.length===0){be("Vui lng thm t nht mt nh hoc video.");return}V(!0),be(null);try{await n({media:u,caption:r.trim()||void 0,visibility:f,music:p||void 0}),l(""),d([]),m("FRIENDS"),v(null),k(""),_(""),A(""),e()}catch(xe){be((xe==null?void 0:xe.message)||"ng tin tht bi")}finally{V(!1)}},Me=xe=>{d(Ne=>Ne.filter((Ke,ft)=>ft!==xe))};return o.jsx("div",{className:"modal-backdrop",children:o.jsxs("div",{className:"modal-card",children:[o.jsxs("header",{className:"modal-header",children:[o.jsx("h3",{children:"To tin"}),o.jsx("button",{className:"modal-close",onClick:e,children:""})]}),o.jsxs("div",{className:"modal-body",children:[o.jsxs("div",{className:"modal-user-row",children:[o.jsx("div",{className:"feed-avatar-circle",children:i!=null&&i.avatar?o.jsx("img",{src:i.avatar,alt:i.name}):o.jsx("div",{className:"feed-avatar-initials",children:((Je=(Be=i==null?void 0:i.name)==null?void 0:Be.charAt(0))==null?void 0:Je.toUpperCase())||"U"})}),o.jsxs("div",{children:[o.jsx("div",{className:"modal-user-name",children:(i==null?void 0:i.name)||"Bn"}),o.jsxs("select",{className:"modal-select",value:f,onChange:xe=>m(xe.target.value),children:[o.jsx("option",{value:"FRIENDS",children:"Bn b"}),o.jsx("option",{value:"PUBLIC",children:"Cng khai"})]})]})]}),o.jsx("textarea",{className:"modal-textarea",placeholder:"Chia s cm ngh...",value:r,onChange:xe=>l(xe.target.value)}),o.jsxs("div",{className:"story-media-preview",children:[u.map((xe,Ne)=>o.jsxs("div",{className:"story-media-item",children:[o.jsx("button",{className:"story-media-remove",onClick:()=>Me(Ne),children:""}),xe.type==="video"?o.jsx("video",{src:xe.url,controls:!0}):o.jsx("img",{src:xe.url,alt:`story-${Ne}`})]},Ne)),o.jsxs("label",{className:"story-media-upload",children:[o.jsx("span",{children:Te?"ang upload...":"Thm nh/video"}),o.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:xe=>se(xe.target.files),disabled:Te})]})]}),o.jsxs("div",{className:"story-music-section",children:[p?o.jsxs("div",{className:"story-music-display",children:[o.jsxs("div",{className:"story-music-info",children:[o.jsx("span",{className:"story-music-icon",children:""}),o.jsxs("div",{children:[o.jsx("div",{className:"story-music-title",children:p.title}),o.jsx("div",{className:"story-music-artist",children:p.artist})]})]}),o.jsx("button",{className:"story-music-remove",onClick:Ae,children:""})]}):o.jsxs("button",{className:"story-music-add-btn",onClick:()=>x(!C),children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Thm nhc"})]}),C&&!p&&o.jsxs("div",{className:"story-music-input",children:[o.jsxs("div",{className:"story-music-tabs",children:[o.jsx("button",{className:`story-music-tab ${D?"":"active"}`,onClick:()=>I(!1),children:"Nhp th cng"}),o.jsx("button",{className:`story-music-tab ${D?"active":""}`,onClick:()=>I(!0),children:"Tm kim nhc"})]}),D?o.jsxs("div",{className:"story-music-search",children:[o.jsxs("div",{className:"story-music-search-box",children:[o.jsx("input",{type:"text",placeholder:"Tm kim bi ht, ngh s...",value:w,onChange:xe=>{j(xe.target.value);const Ne=xe.target.value.trim();Ne.length>2?Ue(Ne):N([])},className:"story-music-field"}),L&&o.jsx("span",{className:"story-music-search-loading",children:""})]}),R.length>0&&o.jsx("div",{className:"story-music-results",children:R.map(xe=>o.jsxs("div",{className:"story-music-result-item",onClick:()=>et(xe),children:[xe.artworkUrl60&&o.jsx("img",{src:xe.artworkUrl60,alt:xe.trackName,className:"story-music-result-thumb"}),o.jsxs("div",{className:"story-music-result-info",children:[o.jsx("div",{className:"story-music-result-title",children:xe.trackName}),o.jsx("div",{className:"story-music-result-artist",children:xe.artistName})]}),xe.previewUrl&&o.jsx("span",{className:"story-music-result-preview",children:""})]},xe.trackId))}),w.length>2&&R.length===0&&!L&&o.jsx("div",{className:"story-music-no-results",children:"Khng tm thy kt qu"})]}):o.jsxs(o.Fragment,{children:[o.jsx("input",{type:"text",placeholder:"Tn bi ht",value:S,onChange:xe=>k(xe.target.value),className:"story-music-field"}),o.jsx("input",{type:"text",placeholder:"Ngh s",value:E,onChange:xe=>_(xe.target.value),className:"story-music-field"}),o.jsx("input",{type:"text",placeholder:"URL nhc (ty chn)",value:O,onChange:xe=>A(xe.target.value),className:"story-music-field"})]}),o.jsxs("div",{className:"story-music-actions",children:[o.jsx("button",{className:"story-music-cancel-btn",onClick:()=>{x(!1),k(""),_(""),A(""),j(""),N([]),I(!1)},children:"Hy"}),!D&&o.jsx("button",{className:"story-music-confirm-btn",onClick:fe,children:"Thm"})]})]})]}),ve&&o.jsx("div",{className:"modal-error",children:ve})]}),Z&&B&&o.jsx("div",{className:"story-music-segment-overlay",children:o.jsxs("div",{className:"story-music-segment-modal",children:[o.jsxs("div",{className:"story-music-segment-header",children:[o.jsxs("div",{className:"story-music-segment-track-info",children:[B.artworkUrl60&&o.jsx("img",{src:B.artworkUrl60,alt:B.trackName,className:"story-music-segment-thumb"}),o.jsxs("div",{children:[o.jsx("div",{className:"story-music-segment-track-title",children:B.trackName}),o.jsx("div",{className:"story-music-segment-track-artist",children:B.artistName})]})]}),o.jsx("button",{className:"story-music-segment-close",onClick:mt,children:""})]}),o.jsxs("div",{className:"story-music-segment-content",children:[o.jsxs("div",{className:"story-music-segment-timeline",onClick:Q,children:[o.jsx("div",{className:"story-music-segment-waveform",children:Array.from({length:60}).map((xe,Ne)=>{const Ke=Ne/60*30,ft=Ke>=q&&Ke<=re,zt=Ke<=K,dn=Math.random()*40+20;return o.jsx("div",{className:`story-music-segment-wave-bar ${ft?"active":""} ${zt&&ft?"played":""}`,style:{height:`${dn}%`}},Ne)})}),o.jsxs("div",{className:"story-music-segment-range",style:{left:`${q/30*100}%`,width:`${(re-q)/30*100}%`},children:[o.jsx("div",{className:"story-music-segment-handle start",onMouseDown:xe=>Ee("start",xe)}),o.jsx("div",{className:"story-music-segment-handle end",onMouseDown:xe=>Ee("end",xe)})]}),o.jsx("div",{className:"story-music-segment-playhead",style:{left:`${K/30*100}%`}})]}),o.jsxs("div",{className:"story-music-segment-time-info",children:[o.jsxs("span",{children:[Math.floor(q),"s - ",Math.floor(re),"s"]}),o.jsxs("span",{className:"story-music-segment-duration",children:["(",Math.floor(re-q),"s)"]})]}),o.jsxs("div",{className:"story-music-segment-controls",children:[o.jsx("button",{className:"story-music-segment-control-btn",onClick:Dt,children:Se?"":""}),o.jsx("button",{className:"story-music-segment-control-btn",onClick:()=>{le.current&&(le.current.currentTime=q,ae(q))},children:""}),o.jsx("button",{className:"story-music-segment-control-btn confirm",onClick:At,children:""})]})]}),o.jsx("audio",{ref:le,preload:"metadata"})]})}),o.jsxs("footer",{className:"modal-footer",children:[o.jsx("button",{className:"modal-secondary-btn",onClick:e,disabled:_e,children:"Hy"}),o.jsx("button",{className:"modal-primary-btn",onClick:He,disabled:_e,children:_e?"ang ng...":"ng tin"})]})]})})},Jf=["Spam hoc qung co","Ni dung phn cm","Tin gi/misleading","Quy ri hoc th ch","Vi phm bn quyn","Khc"],W8=({isOpen:t,post:e,onClose:n,onSubmit:i,isSubmitting:r})=>{var C;const[l,u]=b.useState(Jf[0]),[d,f]=b.useState(""),[m,p]=b.useState(null);if(b.useEffect(()=>{t||(u(Jf[0]),f(""),p(null))},[t]),!t||!e)return null;const v=async x=>{if(x.preventDefault(),!l||l.trim().length<3){p("Vui lng chn l do");return}try{await i({reason:l,details:d.trim()?d.trim():void 0})}catch(S){p((S==null?void 0:S.message)||"Khng th gi bo co lc ny")}};return o.jsx("div",{className:"report-modal-overlay",children:o.jsxs("div",{className:"report-modal-card",children:[o.jsxs("div",{className:"report-modal-header",children:[o.jsxs("div",{children:[o.jsx("h3",{children:"Bo co bi vit"}),o.jsxs("p",{children:["Bi vit ca ",((C=e.author)==null?void 0:C.name)||"ngi dng"]})]}),o.jsx("button",{className:"report-modal-close",onClick:n,children:""})]}),o.jsxs("form",{onSubmit:v,children:[o.jsxs("div",{className:"report-modal-section",children:[o.jsx("label",{className:"report-modal-label",children:"L do"}),o.jsx("div",{className:"report-modal-reasons",children:Jf.map(x=>o.jsxs("label",{className:"report-reason-option",children:[o.jsx("input",{type:"radio",name:"report-reason",value:x,checked:l===x,onChange:()=>u(x),disabled:r}),o.jsx("span",{children:x})]},x))})]}),o.jsxs("div",{className:"report-modal-section",children:[o.jsxs("label",{className:"report-modal-label",children:["M t thm ",o.jsx("span",{style:{opacity:.6},children:"(tu chn)"})]}),o.jsx("textarea",{className:"report-modal-textarea",placeholder:"Nhp m t chi tit nu cn...",value:d,onChange:x=>f(x.target.value),disabled:r,rows:4})]}),m&&o.jsx("div",{className:"report-modal-error",children:m}),o.jsxs("div",{className:"report-modal-actions",children:[o.jsx("button",{type:"button",className:"report-modal-secondary",onClick:n,disabled:r,children:"Hu"}),o.jsx("button",{type:"submit",className:"report-modal-primary",disabled:r,children:r?"ang gi...":"Gi bo co"})]})]})]})})},Z8=({currentUser:t,groups:e,loading:n,onCreateStory:i,onSelectStory:r})=>{var l,u;return o.jsxs("section",{className:"stories-bar",children:[o.jsxs("div",{className:"story-card story-card--add",onClick:i,children:[o.jsxs("div",{className:"story-card-avatar story-card-avatar--mine",children:[t!=null&&t.avatar?o.jsx("img",{src:t.avatar,alt:t.name}):o.jsx("div",{className:"story-card-initials",children:((u=(l=t==null?void 0:t.name)==null?void 0:l.charAt(0))==null?void 0:u.toUpperCase())||"U"}),o.jsx("div",{className:"story-card-add-icon",children:""})]}),o.jsx("div",{className:"story-card-name",children:"To tin"})]}),o.jsx("div",{className:"stories-scroll",children:n&&e.length===0?o.jsx("div",{className:"story-card story-card--loading",children:"ang ti..."}):e.map((d,f)=>{var C,x,S;const m=d.stories.some(k=>!k.hasSeen),p=d.stories[0];if(!p)return null;const v=d.author.avatar||((C=p.media[0])==null?void 0:C.url);return o.jsxs("div",{className:`story-card ${m?"story-card--unseen":"story-card--seen"}`,onClick:()=>r(f,0),children:[o.jsxs("div",{className:"story-card-avatar",children:[v?o.jsx("img",{src:v,alt:d.author.name||"Story"}):o.jsx("div",{className:"story-card-initials",children:((S=(x=d.author.name)==null?void 0:x.charAt(0))==null?void 0:S.toUpperCase())||"U"}),m&&o.jsx("span",{className:"story-card-ring"})]}),o.jsx("div",{className:"story-card-name",children:d.author.name||d.author.username||"Ngi dng"})]},d.author._id)})})]})},Qf=[{type:"LIKE",emoji:"",label:"Thch"},{type:"LOVE",emoji:"",label:"Yu thch"},{type:"HAHA",emoji:"",label:"Haha"},{type:"WOW",emoji:"",label:"Wow"},{type:"SAD",emoji:"",label:"Bun"},{type:"ANGRY",emoji:"",label:"Phn n"}],Y8=({groups:t,state:e,onClose:n,onNext:i,onPrev:r,onStorySeen:l,onDeleteStory:u,currentUserId:d})=>{var P,K,ae,le,Te,ce,_e;const[f,m]=b.useState(""),[p,v]=b.useState(null),[C,x]=b.useState({}),[S,k]=b.useState(!1),[E,_]=b.useState(!1),[O,A]=b.useState(!1),w=b.useRef(null),j=b.useRef(null);b.useEffect(()=>{m("")},[e==null?void 0:e.storyIndex,e==null?void 0:e.groupIndex]);const R=t&&e?t[e.groupIndex]:null,N=(P=R==null?void 0:R.stories)==null?void 0:P[e==null?void 0:e.storyIndex];if(b.useEffect(()=>{N&&(v(N.userReaction||null),x(N.reactionCounts||{}))},[N==null?void 0:N._id]),b.useEffect(()=>{N&&!N.hasSeen&&l(N._id)},[N==null?void 0:N._id,N==null?void 0:N.hasSeen,l]),b.useEffect(()=>{var be,Ue,et;const V=j.current;if(!V)return;const ve=(be=N==null?void 0:N.music)==null?void 0:be.url;if(ve){V.src=ve,V.volume=E?0:.7;const At=((Ue=N.music)==null?void 0:Ue.startTime)||0,mt=((et=N.music)==null?void 0:et.endTime)||30;V.currentTime=At,V.play().then(()=>{A(!0)}).catch(Q=>{console.log("Autoplay blocked:",Q),A(!1)});const Dt=()=>{V.currentTime>=mt&&(V.currentTime=At)};return V.addEventListener("timeupdate",Dt),()=>{V.removeEventListener("timeupdate",Dt),V.pause(),V.src=""}}else V.pause(),V.src="",A(!1)},[e==null?void 0:e.storyIndex,e==null?void 0:e.groupIndex,(K=N==null?void 0:N.music)==null?void 0:K.url,E]),!e)return null;const L=(ae=N==null?void 0:N.media)==null?void 0:ae[0],F=L==null?void 0:L.url,D=(L==null?void 0:L.type)==="video",I=((le=R==null?void 0:R.author)==null?void 0:le.name)||((Te=R==null?void 0:R.author)==null?void 0:Te.username)||"Loading User...",B=(ce=R==null?void 0:R.author)==null?void 0:ce.avatar,G=N==null?void 0:N.music,Z=N==null?void 0:N.caption,ue=e.storyIndex>0||e.groupIndex>0,q=R?e.storyIndex<R.stories.length-1||e.groupIndex<t.length-1:!1,ee=d&&(R==null?void 0:R.author._id)===d,re=async V=>{if(N)try{if(p===V){const ve=await bE(N._id);v(null),x(ve.reactionCounts)}else{const ve=await yE(N._id,V);v(ve.reaction),x(ve.reactionCounts)}k(!1)}catch(ve){console.error("Failed to react to story:",ve)}},he=async V=>{if(V.preventDefault(),!(!f.trim()||!N))try{await CE(N._id,f.trim()),m("")}catch(ve){console.error("Failed to reply to story:",ve)}},Se=Object.values(C).reduce((V,ve)=>V+ve,0);return Qu.createPortal(o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% {
            transform: scale(1);
            opacity: 1;
          }
          50% {
            transform: scale(1.2);
            opacity: 0.8;
          }
        }
      `}),o.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",zIndex:99999,backgroundColor:"#000000",display:"flex",flexDirection:"row",overflow:"hidden",fontFamily:"system-ui, -apple-system, sans-serif"},children:[o.jsxs("div",{style:{width:"360px",flexShrink:0,backgroundColor:"#242526",borderRight:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",flexDirection:"column",zIndex:50,position:"relative"},children:[o.jsxs("div",{style:{height:"64px",display:"flex",alignItems:"center",padding:"0 16px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[o.jsx("button",{onClick:n,style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"#3A3B3C",color:"white",display:"flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",marginRight:"16px",fontSize:"20px"},"aria-label":"Close",children:""}),o.jsx("span",{style:{color:"white",fontWeight:"bold",fontSize:"20px"},children:"Stories"})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"8px"},children:[o.jsx("h3",{style:{color:"white",fontWeight:"600",padding:"8px",margin:"8px 0"},children:"All Stories"}),t==null?void 0:t.map((V,ve)=>{var Ue,et;const be=V.stories.some(At=>!At.hasSeen);return o.jsxs("div",{style:{padding:"12px",borderRadius:"8px",display:"flex",alignItems:"center",gap:"12px",cursor:"pointer",backgroundColor:ve===(e==null?void 0:e.groupIndex)?"#3A3B3C":"transparent",transition:"background-color 0.2s",marginBottom:"4px"},children:[V.author.avatar?o.jsx("img",{src:V.author.avatar,alt:V.author.name,style:{width:"48px",height:"48px",borderRadius:"50%",objectFit:"cover",border:`2px solid ${be?"#0084FF":"#555"}`,flexShrink:0}}):o.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",border:`2px solid ${be?"#0084FF":"#555"}`,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"18px",flexShrink:0},children:((et=(Ue=V.author.name)==null?void 0:Ue.charAt(0))==null?void 0:et.toUpperCase())||"U"}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontWeight:be?"600":"400",fontSize:"14px",color:be?"white":"#B0B3B8",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:V.author.name||V.author.username||"User"}),o.jsxs("div",{style:{fontSize:"12px",color:"#B0B3B8"},children:[V.stories.length," story"]})]})]},V.author._id)})]})]}),o.jsxs("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#000000",zIndex:40},children:[o.jsx("button",{onClick:n,style:{position:"absolute",top:"24px",right:"24px",zIndex:100,width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"24px",border:"none",cursor:"pointer",transition:"background-color 0.2s"},"aria-label":"Close",children:""}),N?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{position:"relative",width:"100%",maxWidth:"450px",aspectRatio:"9/16",backgroundColor:"#18191A",borderRadius:"12px",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)"},children:[F&&(D?o.jsx("video",{src:F,autoPlay:!0,loop:!0,muted:E,playsInline:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",backgroundColor:"#000"}}):o.jsx("img",{src:F,alt:"Story",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",backgroundColor:"#000"}})),o.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,padding:"16px",background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.4) 50%, transparent 100%)",zIndex:20,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[o.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",border:"2px solid rgba(255, 255, 255, 0.2)",overflow:"hidden",flexShrink:0},children:B?o.jsx("img",{src:B,alt:I,style:{width:"100%",height:"100%",objectFit:"cover"}}):o.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"14px"},children:I.charAt(0).toUpperCase()})}),o.jsxs("div",{children:[o.jsx("div",{style:{color:"white",fontWeight:"600",fontSize:"14px",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:I}),o.jsx("div",{style:{color:"#E4E6EB",fontSize:"12px",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:new Date(N.createdAt).toLocaleString("vi-VN",{hour:"2-digit",minute:"2-digit"})})]})]}),o.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[D&&o.jsx("button",{onClick:()=>_(!E),style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",fontSize:"14px"},title:E?"Unmute":"Mute",children:E?"":""}),ee&&o.jsx("button",{onClick:()=>u==null?void 0:u(N._id),style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",fontSize:"14px"},title:"Delete",children:""})]})]}),G&&o.jsxs("div",{style:{position:"absolute",top:"80px",left:"16px",zIndex:20,display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",borderRadius:"20px",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[o.jsx("span",{style:{fontSize:"12px",animation:O?"pulse 1.5s ease-in-out infinite":"none"},children:""}),o.jsx("span",{style:{color:"white",fontSize:"12px",fontWeight:"500",maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:G.title}),G.url&&o.jsx("button",{onClick:()=>{j.current&&(O?(j.current.pause(),A(!1)):j.current.play().then(()=>A(!0)).catch(V=>console.log("Play failed:",V)))},style:{width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.2)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:"white",transition:"background-color 0.2s"},children:O?"":""}),o.jsx("button",{onClick:()=>_(!E),style:{width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.2)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:"white",transition:"background-color 0.2s"},children:E?"":""})]}),Z&&o.jsx("div",{style:{position:"absolute",top:"112px",left:"16px",right:"16px",zIndex:20},children:o.jsx("div",{style:{padding:"8px 16px",borderRadius:"8px",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:o.jsx("p",{style:{color:"white",fontSize:"14px",margin:0},children:Z})})}),o.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"16px",paddingBottom:"24px",background:"linear-gradient(0deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.5) 50%, transparent 100%)",zIndex:20},children:[Se>0&&o.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",padding:"0 8px"},children:Qf.map(V=>{const ve=C[V.type]||0;return ve===0?null:o.jsxs("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx("span",{children:V.emoji}),o.jsx("span",{children:ve})]},V.type)})}),o.jsxs("form",{onSubmit:he,style:{display:"flex",gap:"12px",alignItems:"center"},children:[o.jsx("input",{type:"text",placeholder:"Tr li...",value:f,onChange:V=>m(V.target.value),style:{flex:1,height:"40px",backgroundColor:"transparent",border:"1px solid rgba(255, 255, 255, 0.5)",borderRadius:"20px",padding:"0 16px",color:"white",fontSize:"14px",outline:"none"}}),o.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},onMouseEnter:()=>{w.current&&clearTimeout(w.current),k(!0)},onMouseLeave:()=>{w.current=setTimeout(()=>{k(!1)},300)},children:[o.jsx("button",{type:"button",onClick:()=>{re(p||"LIKE")},style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",transition:"transform 0.2s"},children:p&&((_e=Qf.find(V=>V.type===p))==null?void 0:_e.emoji)||""}),S&&o.jsx("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:"8px",display:"flex",gap:"4px",padding:"8px",borderRadius:"24px",backgroundColor:"rgba(0, 0, 0, 0.9)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.5)"},children:Qf.map(V=>o.jsx("button",{type:"button",onClick:()=>re(V.type),style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",transition:"transform 0.2s"},title:V.label,children:V.emoji},V.type))})]}),o.jsx("button",{type:"submit",disabled:!f.trim(),style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:f.trim()?"#0084FF":"rgba(255, 255, 255, 0.1)",border:"none",cursor:f.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",transition:"background-color 0.2s"},children:""})]})]}),o.jsx("audio",{ref:j,onEnded:()=>A(!1),onError:()=>A(!1),style:{display:"none"}})]}),ue&&o.jsx("button",{onClick:r,style:{position:"absolute",left:"40px",width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"32px",transition:"background-color 0.2s",zIndex:50},"aria-label":"Previous",children:""}),q&&o.jsx("button",{onClick:i,style:{position:"absolute",right:"40px",width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"32px",transition:"background-color 0.2s",zIndex:50},"aria-label":"Next",children:""})]}):o.jsxs("div",{style:{color:"white",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"48px",marginBottom:"24px"},children:""}),o.jsx("p",{style:{fontSize:"20px",marginBottom:"16px"},children:"Loading Story..."}),o.jsx("button",{onClick:n,style:{marginTop:"24px",padding:"12px 24px",backgroundColor:"#0084FF",color:"white",borderRadius:"24px",border:"none",cursor:"pointer",fontSize:"16px"},children:"Close Viewer"})]})]})]})]}),document.body)},J8=({size:t=20,color:e,className:n=""})=>o.jsx("svg",{width:t,height:t,viewBox:"0 0 61 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:n,style:{display:"inline-block",verticalAlign:"middle",color:e||"currentColor"},children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M60.0003 30C60.0003 13.4315 46.5689 0 30.0003 0C13.4318 0 0.00030899 13.4315 0.00030899 30C0.00030899 46.5685 13.4318 60 30.0003 60C35.9253 60 41.455 58.2799 46.1097 55.312L55.6783 58.661C58.4678 59.6373 61.1369 56.9305 60.1215 54.155L56.4606 44.1484C58.7197 39.9314 60.0003 35.112 60.0003 30ZM30.0003 5C43.8074 5 55.0003 16.1929 55.0003 30C55.0003 34.6245 53.747 38.9486 51.5631 42.6596C51.1839 43.304 51.113 44.0843 51.3699 44.7865L54.336 52.8938L46.5842 50.1807C45.8245 49.9148 44.9833 50.0309 44.3241 50.4926C40.2682 53.3334 35.3326 55 30.0003 55C16.1932 55 5.00031 43.8071 5.00031 30C5.00031 16.1929 16.1932 5 30.0003 5Z",fill:"currentColor"})}),Q8="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M18%208.5C19.3807%208.5%2020.5%207.38071%2020.5%206C20.5%204.61929%2019.3807%203.5%2018%203.5C16.6193%203.5%2015.5%204.61929%2015.5%206C15.5%207.38071%2016.6193%208.5%2018%208.5Z'%20stroke='currentColor'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M6%2014.5C7.38071%2014.5%208.5%2013.3807%208.5%2012C8.5%2010.6193%207.38071%209.5%206%209.5C4.61929%209.5%203.5%2010.6193%203.5%2012C3.5%2013.3807%204.61929%2014.5%206%2014.5Z'%20stroke='currentColor'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M18%2020.5C19.3807%2020.5%2020.5%2019.3807%2020.5%2018C20.5%2016.6193%2019.3807%2015.5%2018%2015.5C16.6193%2015.5%2015.5%2016.6193%2015.5%2018C15.5%2019.3807%2016.6193%2020.5%2018%2020.5Z'%20stroke='currentColor'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M8.25%2011.25L15.75%207.25'%20stroke='currentColor'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M8.25%2012.75L15.75%2016.75'%20stroke='currentColor'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",X8=({size:t=20,color:e,className:n=""})=>e&&e!=="currentColor"?o.jsxs("svg",{width:t,height:t,viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:n,style:{display:"inline-block",verticalAlign:"middle",color:e},children:[o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.5 27.6963C27.2533 27.6963 23 31.9496 23 37.1963V67.1963C23 72.443 27.2533 76.6963 32.5 76.6963H62.5C67.7467 76.6963 72 72.443 72 67.1963V52.1963C72 50.8156 73.1193 49.6963 74.5 49.6963C75.8807 49.6963 77 50.8156 77 52.1963V67.1963C77 75.2044 70.5081 81.6963 62.5 81.6963H32.5C24.4919 81.6963 18 75.2044 18 67.1963V37.1963C18 29.1882 24.4919 22.6963 32.5 22.6963H49.5C50.8807 22.6963 52 23.8156 52 25.1963C52 26.577 50.8807 27.6963 49.5 27.6963H32.5Z",fill:"currentColor"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M34.1263 56.0649C34.1317 55.409 34.3947 54.7816 34.8585 54.3178L67.7015 21.4748C69.0683 20.108 71.2844 20.108 72.6512 21.4748L79.7223 28.5459C81.0891 29.9127 81.0891 32.1288 79.7223 33.4956L46.8793 66.3386C46.4155 66.8024 45.788 67.0653 45.1322 67.0708L36.5762 67.1415C35.906 67.147 35.2617 66.8832 34.7878 66.4093C34.3138 65.9354 34.0501 65.2911 34.0556 64.6209L34.1263 56.0649ZM39.1177 57.1296L39.0764 62.1206L44.0674 62.0794L75.1261 31.0208L70.1763 26.071L39.1177 57.1296Z",fill:"currentColor"})]}):o.jsx("img",{src:Q8,alt:"Share",width:t,height:t,className:n,style:{display:"inline-block",verticalAlign:"middle"}}),Fp=({size:t=24,className:e=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M59.9999 0C26.8499 0 0 26.85 0 59.9999C0 93.1498 26.8499 120 59.9999 120C93.1498 120 120 93.1498 120 59.9999C120 26.85 93.1498 0 59.9999 0Z",fill:"url(#like_gradient)"}),o.jsx("path",{d:"M90.2999 55.05C94.3499 57.9 93.5999 63.9 89.2499 66.15C91.4999 69.8999 88.6499 74.8499 84.7499 75.8999C85.3499 76.9499 85.6499 77.8499 85.4999 78.8999C84.8999 83.2499 80.0999 83.9999 76.4999 83.9999H56.8499C49.05 83.9999 45.15 79.6499 45.15 76.0499V57.6C45.15 47.85 56.0999 39.6 56.0999 32.7L55.1999 24.3C55.1999 23.85 55.1999 22.5 55.6499 22.2C56.2499 21.6 58.0499 20.55 60.5999 20.55C62.2499 20.55 63.4499 20.8501 64.7999 21.6001C69.2999 23.85 69.8999 29.4 69.8999 33.9C69.8999 36 67.1999 42.45 66.8999 44.7C70.3499 43.5 78.4499 42.15 84.7499 43.05C92.0999 44.1 94.1999 49.05 90.2999 55.05ZM28.65 48H34.95C36.15 48 37.35 48.45 38.25 49.35C39.15 50.25 39.6 51.45 39.6 52.65V82.7999C39.6 83.9999 39.15 85.1999 38.25 86.0999C37.35 86.9999 36.15 87.4499 34.95 87.4499H28.65C27.45 87.4499 26.25 86.9999 25.35 86.0999C24.45 85.1999 24 83.9999 24 82.7999V52.65C24 51.45 24.45 50.25 25.35 49.35C26.25 48.45 27.45 48 28.65 48Z",fill:"white"}),o.jsx("defs",{children:o.jsxs("radialGradient",{id:"like_gradient",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(41.8938 37.318) rotate(77.6772) scale(84.6968 84.6968)",children:[o.jsx("stop",{stopColor:"#18AFFF"}),o.jsx("stop",{offset:"1",stopColor:"#0062DF"})]})})]}),p9=({size:t=24,className:e=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M59.9999 0C26.8499 0 0 26.85 0 59.9999C0 93.1498 26.8499 120 59.9999 120C93.1498 120 120 93.1498 120 59.9999C120 26.85 93.1498 0 59.9999 0Z",fill:"url(#love_gradient)"}),o.jsx("path",{d:"M78.6009 30C62.1009 30 60.0009 43.65 60.0009 43.65C60.0009 43.65 57.9009 30 41.401 30C25.501 30 20.851 46.65 22.801 55.6499C27.901 79.1999 59.8509 95.6999 59.8509 95.6999C59.8509 95.6999 91.8009 79.1999 96.9009 55.6499C99.0009 46.65 94.3508 30 78.6009 30Z",fill:"white"}),o.jsx("defs",{children:o.jsxs("radialGradient",{id:"love_gradient",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(16.2437 63.5304 -63.5294 16.2438 53.436 53.3625)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#FF8297"}),o.jsx("stop",{offset:"0.1592",stopColor:"#FD7A90"}),o.jsx("stop",{offset:"0.4121",stopColor:"#F8637B"}),o.jsx("stop",{offset:"0.7251",stopColor:"#EF3D5B"}),o.jsx("stop",{offset:"1",stopColor:"#E61739"})]})})]}),g9=({size:t=24,className:e=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M119.999 59.9999C119.999 93.1657 93.2656 120 60.2242 120C27.1827 120 0.449219 93.1657 0.449219 59.9999C0.449219 26.8341 27.1827 0 60.2242 0C93.1154 0 119.999 26.8341 119.999 59.9999Z",fill:"url(#haha_gradient1)"}),o.jsx("path",{d:"M119.55 59.9999C119.55 93.1657 92.8164 120 59.775 120C26.7335 120 0 93.1657 0 59.9999C0 26.8341 26.7335 0 59.775 0C92.6662 0 119.55 26.8341 119.55 59.9999Z",fill:"url(#haha_gradient2)"}),o.jsx("path",{d:"M95.9649 71.1555C96.4155 68.5927 95.3641 66.0299 92.9611 65.1254C87.5544 62.8641 76.5906 59.9998 59.6194 59.9998C42.7983 59.9998 31.8345 62.8641 26.2775 65.1254C23.8745 66.0299 22.8232 68.5927 23.2738 71.1555C26.2775 86.5324 35.8896 105.226 59.6194 105.226C83.3491 105.075 92.9611 86.3816 95.9649 71.1555Z",fill:"url(#haha_mouth)"}),o.jsx("path",{d:"M83.8003 95.7286C79.2947 91.5075 71.7852 88.1909 59.7702 88.1909C47.6049 88.1909 40.0955 91.5075 35.5898 95.7286C41.297 101.306 49.1068 105.075 59.62 105.075C70.2833 105.075 78.0931 101.306 83.8003 95.7286Z",fill:"url(#haha_tongue)"}),o.jsx("path",{d:"M28.6853 50.3518C26.7328 50.3518 25.2309 48.8442 24.9306 46.8844C24.1796 38.7437 30.1872 31.5076 38.4475 30.7538C46.5577 30 53.7667 36.0302 54.5177 44.3216C54.6679 46.4322 53.166 48.2412 51.2135 48.392C49.1109 48.5427 47.3086 47.0352 47.1584 45.0754C46.858 41.005 43.2535 37.99 39.1985 38.2915C35.1434 38.593 32.1396 42.2111 32.44 46.2814C32.5902 48.392 31.0883 50.201 29.1358 50.3518C28.8354 50.3518 28.6853 50.3518 28.6853 50.3518Z",fill:"url(#haha_eye_left)"}),o.jsx("path",{d:"M90.7126 50.3519C90.5624 50.3519 90.5624 50.3519 90.4122 50.3519C88.3096 50.2011 86.8078 48.3921 87.1082 46.2815C87.4085 42.2112 84.4048 38.5931 80.3497 38.2916C76.2946 37.9901 72.6901 40.8544 72.3897 45.0755C72.2395 47.186 70.4372 48.6936 68.3346 48.3921C66.2319 48.2413 64.7301 46.4323 65.0305 44.3217C65.7814 36.0303 72.9905 30.1509 81.1006 30.7539C89.2108 31.5077 95.2183 38.7438 94.6176 46.8845C94.167 48.8443 92.5149 50.3519 90.7126 50.3519Z",fill:"url(#haha_eye_right)"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"haha_gradient1",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(-0.141675 81.2323 -83.6337 -0.146963 59.229 49.6661)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#FFED85"}),o.jsx("stop",{offset:"0.1898",stopColor:"#FFE180"}),o.jsx("stop",{offset:"0.5295",stopColor:"#FFC273"}),o.jsx("stop",{offset:"0.9773",stopColor:"#FF915E"}),o.jsx("stop",{offset:"1",stopColor:"#FF8E5D"})]}),o.jsxs("radialGradient",{id:"haha_gradient2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(32.3913 29.692) scale(99.6575 100.032)",children:[o.jsx("stop",{stopColor:"#FFEA84",stopOpacity:"0"}),o.jsx("stop",{offset:"1",stopColor:"#F08423",stopOpacity:"0.34"})]}),o.jsxs("linearGradient",{id:"haha_mouth",x1:"59.6193",y1:"61.8679",x2:"59.6193",y2:"114.428",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("linearGradient",{id:"haha_tongue",x1:"59.6951",y1:"86.3056",x2:"59.6951",y2:"104.754",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#FC607C"}),o.jsx("stop",{offset:"1",stopColor:"#D91F3A"})]}),o.jsxs("radialGradient",{id:"haha_eye_left",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(39.6977 40.4935) scale(12.5283 12.5754)",children:[o.jsx("stop",{stopColor:"#2C445F"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("radialGradient",{id:"haha_eye_right",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(79.6228 40.4933) scale(12.5424 12.5896)",children:[o.jsx("stop",{stopColor:"#2C445F"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]})]})]}),v9=({size:t=24,className:e=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 26.85 120 59.9999Z",fill:"url(#wow_gradient1)"}),o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 26.85 120 59.9999Z",fill:"url(#wow_gradient2)"}),o.jsx("path",{d:"M42.4481 81.1498C41.2481 94.9497 47.8481 104.4 59.9981 104.4C72.1481 104.4 78.7481 94.9497 77.5481 81.1498C76.3481 67.3498 69.2981 59.5498 59.9981 59.5498C50.8481 59.6998 43.6481 67.4998 42.4481 81.1498Z",fill:"url(#wow_mouth)"}),o.jsx("path",{d:"M92.8482 24.1498C89.8482 20.2498 85.0482 18.8998 78.5982 22.1998C77.2482 22.9498 75.5982 22.3498 74.8482 20.9998C74.0982 19.6498 74.6982 17.9998 76.0482 17.2498C85.0482 12.7498 92.6981 14.9998 97.1981 20.8498C98.0981 22.0498 97.9481 23.8498 96.7481 24.7498C95.5481 25.4998 93.7482 25.3498 92.8482 24.1498Z",fill:"#E27421"}),o.jsx("path",{d:"M27.2977 24.1498C30.2977 20.2498 35.0977 18.8998 41.5477 22.1998C42.8977 22.9498 44.5477 22.3498 45.2977 20.9998C46.0477 19.6498 45.4477 17.9998 44.0977 17.2498C35.0978 12.7498 27.4477 14.9998 22.9477 20.8498C22.0477 22.0498 22.1977 23.8498 23.3977 24.7498C24.5977 25.4998 26.3977 25.3498 27.2977 24.1498Z",fill:"#E27421"}),o.jsx("path",{d:"M72.5996 42.8994C72.5996 36.7494 77.2496 31.6494 82.7996 31.6494C88.4996 31.6494 92.9995 36.5994 92.9995 42.8994C92.9995 49.0494 88.3496 54.1494 82.7996 54.1494C77.2496 54.1494 72.5996 49.0494 72.5996 42.8994Z",fill:"url(#wow_eye_right)"}),o.jsx("path",{d:"M77.0996 38.5495C77.0996 36.5995 78.2995 34.9495 79.6495 34.9495C80.9995 34.9495 82.1995 36.5995 82.1995 38.5495C82.1995 40.4995 80.9995 42.1495 79.6495 42.1495C78.2995 42.1495 77.0996 40.4995 77.0996 38.5495Z",fill:"#4E506A"}),o.jsx("path",{d:"M47.5504 42.8994C47.5504 36.7494 42.9004 31.6494 37.3504 31.6494C31.6505 31.6494 27.1504 36.5994 27.1504 42.8994C27.1504 49.0494 31.8005 54.1494 37.3504 54.1494C42.9004 54.1494 47.5504 49.0494 47.5504 42.8994Z",fill:"url(#wow_eye_left)"}),o.jsx("path",{d:"M35.5512 38.5495C35.5512 36.5995 34.3512 34.9495 33.0012 34.9495C31.6512 34.9495 30.4512 36.5995 30.4512 38.5495C30.4512 40.4995 31.6512 42.1495 33.0012 42.1495C34.3512 42.1495 35.5512 40.4995 35.5512 38.5495Z",fill:"#4E506A"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"wow_gradient1",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(59.1578 49.6699) rotate(90.1003) scale(81.1448 83.858)",children:[o.jsx("stop",{stopColor:"#FFED85"}),o.jsx("stop",{offset:"0.1898",stopColor:"#FFE180"}),o.jsx("stop",{offset:"0.5295",stopColor:"#FFC273"}),o.jsx("stop",{offset:"0.9773",stopColor:"#FF915E"}),o.jsx("stop",{offset:"1",stopColor:"#FF8E5D"})]}),o.jsxs("radialGradient",{id:"wow_gradient2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(32.7622 29.73) scale(99.9228 99.9228)",children:[o.jsx("stop",{stopColor:"#FFEA84",stopOpacity:"0"}),o.jsx("stop",{offset:"1",stopColor:"#F08423",stopOpacity:"0.34"})]}),o.jsxs("linearGradient",{id:"wow_mouth",x1:"59.9981",y1:"59.6782",x2:"59.9981",y2:"104.401",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("radialGradient",{id:"wow_eye_right",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(82.9203 42.8993) scale(10.7262 10.7262)",children:[o.jsx("stop",{stopColor:"#2C445F"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("radialGradient",{id:"wow_eye_left",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(37.193 42.8993) rotate(180) scale(10.7262 10.7262)",children:[o.jsx("stop",{stopColor:"#2C445F"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]})]})]}),y9=({size:t=24,className:e=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 27 120 59.9999Z",fill:"url(#sad_gradient1)"}),o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 27 120 59.9999Z",fill:"url(#sad_gradient2)"}),o.jsx("path",{d:"M43.1992 93.5998C43.1992 94.4998 43.7992 95.0998 44.6992 95.0998C46.9492 95.0998 49.9492 91.0498 59.8492 91.0498C69.7491 91.0498 72.8992 95.0998 74.9992 95.0998C76.0492 95.0998 76.4992 94.4998 76.4992 93.5998C76.4992 91.0498 71.2492 82.0498 59.6992 82.0498C48.5992 82.0498 43.1992 90.8998 43.1992 93.5998Z",fill:"url(#sad_mouth)"}),o.jsx("path",{d:"M10.6491 110.25C5.54913 105.15 5.09917 96.8998 9.74916 91.1998L19.4991 79.4998C19.9491 78.8998 20.9991 78.8998 21.4491 79.4998L31.1991 91.1998C35.8491 96.7498 35.549 105 30.299 110.25C25.0491 115.8 16.1991 115.8 10.6491 110.25Z",fill:"url(#sad_tear1)"}),o.jsx("path",{d:"M20.5492 112.5C17.2492 112.5 14.2492 111.3 11.8492 108.9C7.3492 104.4 7.0492 97.3501 11.0992 92.4001L20.5492 81.1501L29.9992 92.4001C34.0492 97.3501 33.7492 104.4 29.2492 108.9C26.9992 111.3 23.8491 112.5 20.5492 112.5Z",fill:"url(#sad_tear2)"}),o.jsx("path",{d:"M76.498 67.1997C76.498 60.8997 80.698 55.9497 85.798 55.9497C90.8979 55.9497 95.098 61.0497 95.098 67.1997C95.098 69.7497 94.348 72.1497 93.148 74.0997C92.848 74.5497 92.548 74.8497 92.098 75.1497C91.648 75.4497 91.198 75.5997 90.748 75.7497C87.598 76.4997 84.148 76.4997 80.998 75.7497C80.548 75.5997 79.948 75.4497 79.648 75.1497C79.198 74.8497 78.898 74.5497 78.598 74.0997C77.098 71.9997 76.498 69.5997 76.498 67.1997Z",fill:"url(#sad_eye_right)"}),o.jsx("path",{d:"M84.4507 60.1497C85.5007 61.3497 85.5007 63.7497 84.6007 65.5497C83.7007 67.3497 82.0507 67.6497 81.0007 66.4497C79.9507 65.2497 79.9507 62.8497 80.8507 61.0497C81.7507 59.2497 83.4007 58.9497 84.4507 60.1497Z",fill:"#4E506A"}),o.jsx("path",{d:"M43.6488 67.1997C43.6488 60.8997 39.4488 55.9497 34.3488 55.9497C29.2488 55.9497 25.0488 61.0497 25.0488 67.1997C25.0488 69.7497 25.7989 72.1497 26.9989 74.0997C27.2989 74.5497 27.5988 74.8497 28.0488 75.1497C28.4988 75.4497 28.9489 75.5997 29.3989 75.7497C32.5488 76.4997 35.9988 76.4997 39.1488 75.7497C39.5988 75.5997 40.1989 75.4497 40.4989 75.1497C40.9489 74.8497 41.2488 74.5497 41.5488 74.0997C42.8988 71.9997 43.6488 69.5997 43.6488 67.1997Z",fill:"url(#sad_eye_left)"}),o.jsx("path",{d:"M30.0007 60.1497C28.9507 61.3497 28.9507 63.7497 29.8507 65.5497C30.7507 67.3497 32.4007 67.6497 33.4507 66.4497C34.5007 65.2497 34.5007 62.8497 33.6007 61.0497C32.7007 59.2497 31.0507 58.9497 30.0007 60.1497Z",fill:"#4E506A"}),o.jsx("path",{d:"M82.0486 40.0502C90.4485 41.8502 95.2486 45.9002 100.649 51.3002C102.449 53.1002 100.049 56.5502 97.7985 54.4502C94.1985 51.1502 89.3986 47.5502 81.1486 45.9002C76.9486 45.0002 78.5986 39.3002 82.0486 40.0502Z",fill:"url(#sad_brow_right)"}),o.jsx("path",{d:"M37.9494 40.0502C29.5494 41.8502 24.7494 45.9002 19.3494 51.3002C17.5494 53.1002 19.9494 56.5502 22.1994 54.4502C25.7994 51.1502 30.5994 47.5502 38.8494 45.9002C43.0494 45.0002 41.3994 39.3002 37.9494 40.0502Z",fill:"url(#sad_brow_left)"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"sad_gradient1",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(60.0584 27.0733) rotate(90.1003) scale(92.9773 133.486)",children:[o.jsx("stop",{stopColor:"#FFED85"}),o.jsx("stop",{offset:"0.1898",stopColor:"#FFE180"}),o.jsx("stop",{offset:"0.5295",stopColor:"#FFC273"}),o.jsx("stop",{offset:"0.9773",stopColor:"#FF915E"}),o.jsx("stop",{offset:"1",stopColor:"#FF8E5D"})]}),o.jsxs("radialGradient",{id:"sad_gradient2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(32.7396 29.7385) scale(99.9021 99.9021)",children:[o.jsx("stop",{stopColor:"#FFEA84",stopOpacity:"0"}),o.jsx("stop",{offset:"1",stopColor:"#F08423",stopOpacity:"0.34"})]}),o.jsxs("linearGradient",{id:"sad_mouth",x1:"59.9734",y1:"82.0513",x2:"59.8311",y2:"95.2637",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("linearGradient",{id:"sad_tear1",x1:"20.5002",y1:"114.363",x2:"20.5002",y2:"79.0402",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#20BBF2"}),o.jsx("stop",{offset:"1",stopColor:"#007EDB"})]}),o.jsxs("radialGradient",{id:"sad_tear2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(19.7889 105.519) scale(23.1402 23.1402)",children:[o.jsx("stop",{offset:"0.0961217",stopColor:"#2FD7FC"}),o.jsx("stop",{offset:"1",stopColor:"#007EDB"})]}),o.jsxs("radialGradient",{id:"sad_eye_right",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(85.6435 68.3406) rotate(90) scale(11.4648 12.2507)",children:[o.jsx("stop",{stopColor:"#3B426A"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("radialGradient",{id:"sad_eye_left",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(34.391 68.3406) rotate(90) scale(11.4648 12.2507)",children:[o.jsx("stop",{stopColor:"#3B426A"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("linearGradient",{id:"sad_brow_right",x1:"89.9657",y1:"37.0589",x2:"89.9657",y2:"54.0427",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#E78E0D"}),o.jsx("stop",{offset:"1",stopColor:"#CB6000"})]}),o.jsxs("linearGradient",{id:"sad_brow_left",x1:"30.0321",y1:"37.0589",x2:"30.0321",y2:"54.0427",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#E78E0D"}),o.jsx("stop",{offset:"1",stopColor:"#CB6000"})]})]})]}),b9=({size:t=24,className:e=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 26.85 120 59.9999Z",fill:"url(#angry_gradient)"}),o.jsx("path",{d:"M44.0996 92.2494C44.0996 95.5494 51.1496 94.9494 59.9996 94.9494C68.6996 94.9494 75.8996 95.3994 75.8996 92.2494C75.8996 88.3494 68.8496 85.6494 59.9996 85.6494C51.1496 85.7994 44.0996 88.3494 44.0996 92.2494Z",fill:"url(#angry_mouth)"}),o.jsx("path",{d:"M25.3516 68.2497C25.3516 61.4997 30.0016 55.9497 35.8515 55.9497C41.7015 55.9497 46.3515 61.4997 46.3515 68.2497C46.3515 71.0997 45.6015 73.6497 44.1015 75.7497C43.5015 76.6497 42.4516 77.3997 41.2516 77.6997C39.9016 77.9997 37.9516 78.2997 35.7016 78.2997C33.4516 78.2997 31.5016 77.9997 30.1516 77.6997C28.9516 77.3997 28.0516 76.7997 27.3016 75.7497C26.1016 73.4997 25.3516 70.9497 25.3516 68.2497Z",fill:"url(#angry_eye_left)"}),o.jsx("path",{d:"M73.502 68.2497C73.502 61.4997 78.1519 55.9497 84.0019 55.9497C89.8519 55.9497 94.5019 61.4997 94.5019 68.2497C94.5019 71.0997 93.6019 73.6497 92.2519 75.7497C91.6519 76.6497 90.6019 77.3997 89.4019 77.6997C87.6019 78.1497 85.8019 78.2997 83.8519 78.2997C81.6019 78.2997 79.652 77.9997 78.302 77.6997C77.102 77.3997 76.2019 76.7997 75.4519 75.7497C74.2519 73.4997 73.502 70.9497 73.502 68.2497Z",fill:"url(#angry_eye_right)"}),o.jsx("path",{d:"M37.2012 64.4997C37.2012 64.6497 37.2012 64.7997 37.2012 65.0997C37.2012 66.5997 35.8512 67.7997 34.2012 67.7997C32.5512 67.7997 31.2012 66.5997 31.2012 65.0997C31.2012 64.4997 31.3512 63.8997 31.8012 63.4497C33.6012 63.7497 35.4012 64.0497 37.2012 64.4997Z",fill:"#4F4F67"}),o.jsx("path",{d:"M81.6016 67.7997C79.9516 67.7997 78.7516 66.5997 78.6016 65.2497C80.5516 64.9497 82.5016 64.6497 84.3016 64.1997C84.4516 64.4997 84.4516 64.7997 84.4516 65.0997C84.6016 66.4497 83.2516 67.7997 81.6016 67.7997Z",fill:"#4F4F67"}),o.jsx("path",{d:"M49.5022 56.8504C52.8021 57.1504 52.2021 63.0004 49.3521 63.0004C37.3521 61.6504 25.9522 58.2004 21.3022 55.9504C19.8022 55.2004 19.3522 54.1504 19.6522 52.9504C19.9522 51.6004 21.3022 50.7004 22.0522 51.0004C33.7522 54.1504 37.9522 55.6504 49.5022 56.8504Z",fill:"url(#angry_brow_left)"}),o.jsx("path",{d:"M70.353 56.8504C67.053 57.1504 67.6531 63.0004 70.5031 63.0004C82.5031 61.6504 93.9031 58.2004 98.553 55.9504C100.053 55.2004 100.503 54.1504 100.203 52.9504C99.903 51.6004 98.553 50.7004 97.803 51.0004C86.2531 54.1504 82.053 55.6504 70.353 56.8504Z",fill:"url(#angry_brow_right)"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"angry_gradient",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(42.0603 40.1242) rotate(76.293) scale(78.6551 78.6551)",children:[o.jsx("stop",{stopColor:"#FFB06C"}),o.jsx("stop",{offset:"1",stopColor:"#FD4545"})]}),o.jsxs("linearGradient",{id:"angry_mouth",x1:"59.9996",y1:"87.027",x2:"59.9996",y2:"95.0839",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("radialGradient",{id:"angry_eye_left",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(35.8889 67.1247) scale(10.8563 10.8563)",children:[o.jsx("stop",{stopColor:"#2C445F"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("radialGradient",{id:"angry_eye_right",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(84.1094 67.1248) scale(10.864 10.864)",children:[o.jsx("stop",{stopColor:"#2C445F"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("linearGradient",{id:"angry_brow_left",x1:"35.6533",y1:"64.4563",x2:"35.6533",y2:"46.9588",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#9A2F00"}),o.jsx("stop",{offset:"1",stopColor:"#D44800"})]}),o.jsxs("linearGradient",{id:"angry_brow_right",x1:"84.2019",y1:"64.4563",x2:"84.2019",y2:"46.9588",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#9A2F00"}),o.jsx("stop",{offset:"1",stopColor:"#D44800"})]})]})]}),e6=({size:t=24,className:e=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M120.001 59.9999C120.001 92.9998 93.0019 120 60.0026 120C27.0033 120 0.00390625 92.9998 0.00390625 59.9999C0.00390625 27 27.0033 0 60.0026 0C93.0019 0 120.001 27 120.001 59.9999Z",fill:"url(#care_gradient1)"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M120.001 59.9999C120.001 92.9998 93.0019 120 60.0026 120C27.0033 120 0.00390625 92.9998 0.00390625 59.9999C0.00390625 27 27.0033 0 60.0026 0C93.0019 0 120.001 27 120.001 59.9999Z",fill:"url(#care_gradient2)"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M72.7502 44.25C72.0002 42 48.0007 42 47.2507 44.25C46.5008 46.5 51.7507 49.5 60.0005 49.5C68.2503 49.5 73.5002 46.5 72.7502 44.25Z",fill:"url(#care_mouth)"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M72.7509 63.7502C57.0012 59.2502 51.7513 69.7502 51.7513 69.7502C51.7513 69.7502 53.2513 57.7502 37.5016 52.5002C22.502 48.0002 13.5022 62.2502 12.7522 70.5002C11.2522 89.2501 27.7518 110.25 33.7517 117.75C34.5017 120 36.7516 120 39.0016 120C48.0014 117.75 73.5008 109.5 83.2506 93.0001C87.0006 84.7501 87.7505 68.2502 72.7509 63.7502Z",fill:"url(#care_heart1)"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M72.7509 63.7502C57.0012 59.2502 51.7513 69.7502 51.7513 69.7502C51.7513 69.7502 53.2513 57.7502 37.5016 52.5002C22.502 48.0002 13.5022 62.2502 12.7522 70.5002C11.2522 89.2501 27.7518 110.25 33.7517 117.75C34.5017 120 36.7516 120 39.0016 120C48.0014 117.75 73.5008 109.5 83.2506 93.0001C87.0006 84.7501 87.7505 68.2502 72.7509 63.7502Z",fill:"url(#care_heart2)"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M36.0014 73.4998C36.0014 73.4998 36.0014 73.4998 36.0014 72.7498C36.7513 71.9998 38.2513 71.2498 39.0013 70.4998C42.0012 68.2498 40.5013 64.4998 36.7513 65.2498C36.0014 65.2498 27.0016 68.2498 21.0017 65.9998C15.0018 63.7498 14.2518 61.4998 9.75193 57.7498C7.05199 55.0498 2.5521 53.0998 0.152151 55.7998C-0.447836 64.1998 0.752101 72.1498 3.30205 79.6498C4.80201 82.0498 6.602 84.2998 9.00195 86.2498C30.0015 102.75 48.7511 93.7497 49.5011 81.7498C50.2511 72.7498 39.0013 73.4998 36.0014 73.4998Z",fill:"url(#care_hand_left)"}),o.jsx("path",{d:"M120.003 59.9998C118.353 56.2499 110.103 52.9499 107.253 58.6498C101.253 69.8998 99.0033 81.1498 84.7536 82.6498C80.2537 83.3998 74.2538 81.8998 69.7539 81.1498C66.004 80.3998 65.254 84.8998 68.254 87.1498C69.7539 87.8998 70.5039 88.6498 72.0039 89.3998V90.1498C68.254 90.1498 57.7542 91.6498 60.0042 100.65C62.5541 111.15 85.0536 114.75 102.303 102.6C113.253 91.6498 120.003 76.6498 120.003 59.9998Z",fill:"url(#care_hand_right)"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M75.4473 31.0508C75.4473 36.3008 78.4472 37.8007 82.9471 38.5507C87.447 39.3007 91.1969 37.0508 91.1969 31.0508C91.1969 26.5508 88.947 20.5508 82.9471 20.5508C77.6972 20.5508 75.4473 26.5508 75.4473 31.0508Z",fill:"url(#care_eye_right)"}),o.jsx("path",{d:"M81.0003 29.8506C82.5743 29.8506 83.8502 28.5746 83.8502 27.0006C83.8502 25.4266 82.5743 24.1506 81.0003 24.1506C79.4263 24.1506 78.1504 25.4266 78.1504 27.0006C78.1504 28.5746 79.4263 29.8506 81.0003 29.8506Z",fill:"#4E506A"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.0993 31.0508C44.0993 36.3008 41.0993 37.8007 36.5994 38.5507C32.0995 39.3007 28.3496 37.0508 28.3496 31.0508C28.3496 26.5508 30.5996 20.5508 36.5994 20.5508C41.8493 20.5508 44.0993 26.5508 44.0993 31.0508Z",fill:"url(#care_eye_left)"}),o.jsx("path",{d:"M33.0003 29.8506C34.5743 29.8506 35.8502 28.5746 35.8502 27.0006C35.8502 25.4266 34.5743 24.1506 33.0003 24.1506C31.4263 24.1506 30.1504 25.4266 30.1504 27.0006C30.1504 28.5746 31.4263 29.8506 33.0003 29.8506Z",fill:"#4E506A"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M76.8027 9.44983C73.2028 10.0498 73.0528 14.8498 75.9027 14.8498C83.4026 14.8498 89.8524 17.5498 93.0024 19.9498C95.5523 21.5998 96.7523 18.2998 95.5523 16.6498C91.6524 11.8498 83.1026 8.39983 76.8027 9.44983Z",fill:"url(#care_brow_right)"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M42.7546 9.44983C46.3545 10.0498 46.5045 14.8498 43.6546 14.8498C36.1548 14.8498 29.7049 17.5498 26.5549 19.9498C24.005 21.5998 22.8051 18.2998 24.005 16.6498C28.0549 11.8498 36.4548 8.39983 42.7546 9.44983Z",fill:"url(#care_brow_left)"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"care_gradient1",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(47.6957 31.1383) scale(89.5206 89.5224)",children:[o.jsx("stop",{stopColor:"#FFED85"}),o.jsx("stop",{offset:"0.1898",stopColor:"#FFE180"}),o.jsx("stop",{offset:"0.5295",stopColor:"#FFC273"}),o.jsx("stop",{offset:"0.9773",stopColor:"#FF915E"}),o.jsx("stop",{offset:"1",stopColor:"#FF8E5D"})]}),o.jsxs("radialGradient",{id:"care_gradient2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(47.9312 35.3752) scale(55.7262 55.7273)",children:[o.jsx("stop",{stopColor:"#FFEA84",stopOpacity:"0"}),o.jsx("stop",{offset:"1",stopColor:"#F08423",stopOpacity:"0.34"})]}),o.jsxs("linearGradient",{id:"care_mouth",x1:"60.0005",y1:"49.5486",x2:"60.0005",y2:"42.6111",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("linearGradient",{id:"care_heart1",x1:"50.5869",y1:"73.1189",x2:"35.3569",y2:"122.185",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#F34462"}),o.jsx("stop",{offset:"1",stopColor:"#CC0820"})]}),o.jsxs("radialGradient",{id:"care_heart2",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(18.5091 6.88096 -6.88083 18.5094 66.4004 82.0926)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#FF7091",stopOpacity:"0.7"}),o.jsx("stop",{offset:"1",stopColor:"#FE6D8E",stopOpacity:"0"})]}),o.jsxs("radialGradient",{id:"care_hand_left",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(-1.19242 56.0298) scale(53.2287 53.2298)",children:[o.jsx("stop",{stopColor:"#FF9F64"}),o.jsx("stop",{offset:"1",stopColor:"#FFE682"})]}),o.jsxs("radialGradient",{id:"care_hand_right",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(115.486 62.4255) scale(68.4645 68.4659)",children:[o.jsx("stop",{stopColor:"#FF9F64"}),o.jsx("stop",{offset:"1",stopColor:"#FFE682"})]}),o.jsxs("radialGradient",{id:"care_eye_right",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(83.06 32.3302) rotate(-90) scale(13.9473 13.9478)",children:[o.jsx("stop",{stopColor:"#3B426A"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("radialGradient",{id:"care_eye_left",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(36.5441 32.3302) rotate(-90) scale(13.9473 13.9478)",children:[o.jsx("stop",{stopColor:"#3B426A"}),o.jsx("stop",{offset:"0.9792",stopColor:"#191A33"})]}),o.jsxs("radialGradient",{id:"care_brow_right",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(0.511506 -3.39725 15.959 2.40291 84.3526 12.247)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#E38200"}),o.jsx("stop",{offset:"1",stopColor:"#D16C00"})]}),o.jsxs("radialGradient",{id:"care_brow_left",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(-0.511506 -3.39725 -15.959 2.40291 35.2625 12.2473)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#E38200"}),o.jsx("stop",{offset:"1",stopColor:"#D16C00"})]})]})]}),t6={LIKE:Fp,LOVE:p9,HAHA:g9,WOW:v9,SAD:y9,ANGRY:b9,CARE:e6},lb=({type:t,size:e=24,className:n=""})=>{const i=t6[t];return i?o.jsx(i,{size:e,className:n}):null},Xf=[{type:"LIKE",emoji:"",label:"Thch",Icon:Fp},{type:"LOVE",emoji:"",label:"Yu thch",Icon:p9},{type:"HAHA",emoji:"",label:"Haha",Icon:g9},{type:"WOW",emoji:"",label:"Wow",Icon:v9},{type:"SAD",emoji:"",label:"Bun",Icon:y9},{type:"ANGRY",emoji:"",label:"Phn n",Icon:b9}],n6=({post:t,reaction:e=null,onSelectReaction:n,onClearReaction:i,onSavePost:r,onUnsavePost:l,onReportPost:u,isSaved:d=!1})=>{var le,Te;const f=yn(),[m,p]=b.useState(!1),{items:v,loadMore:C,createComment:x,isLoading:S,hasNext:k}=U8(t._id),[E,_]=b.useState(""),[O,A]=b.useState(!1),w=b.useRef(null),[j,R]=b.useState(!1),N=b.useRef(null),L=b.useRef(null),F=t.author||{name:`User ${t.authorId}`,_id:t.authorId},D=typeof n=="function",I=e,B=async()=>{const ce=E.trim();ce&&(await x(ce),_(""))},G=t.savedAt?new Date(t.savedAt).toLocaleString("vi-VN",{hour:"2-digit",minute:"2-digit",day:"numeric",month:"numeric",year:"numeric"}):null;b.useEffect(()=>{if(!O)return;const ce=_e=>{w.current&&!w.current.contains(_e.target)&&A(!1)};return document.addEventListener("mousedown",ce),()=>document.removeEventListener("mousedown",ce)},[O]);const Z=async()=>{r&&(await r(t._id),A(!1))},ue=async()=>{l&&(await l(t._id),A(!1))},q=()=>{u&&(u(t),A(!1))};b.useEffect(()=>{if(!j)return;const ce=_e=>{N.current&&!N.current.contains(_e.target)&&R(!1)};return document.addEventListener("mousedown",ce),()=>document.removeEventListener("mousedown",ce)},[j]);const ee=()=>{D&&(L.current&&clearTimeout(L.current),R(!0))},re=()=>{L.current&&clearTimeout(L.current),L.current=setTimeout(()=>R(!1),150)},he=()=>{D&&(I?i==null||i(t._id):n==null||n(t._id,"LIKE"))},Se=ce=>{n==null||n(t._id,ce),R(!1)},P=t.reactionCounts||{},K=t.likeCount||Object.values(P).reduce((ce,_e)=>ce+(_e||0),0),ae=Xf.filter(ce=>(P[ce.type]||0)>0).slice(0,3);return o.jsxs("article",{className:"feed-card",style:{marginTop:8},children:[o.jsxs("div",{className:"feed-post-header",children:[o.jsxs("div",{className:"feed-post-author",children:[o.jsx("div",{className:"feed-post-avatar",onClick:()=>f(`/profile/${F._id}`),style:{cursor:"pointer"},children:F.avatar?o.jsx("img",{src:F.avatar,alt:F.name}):o.jsx("div",{className:"feed-post-avatar-initials",children:((Te=(le=F.name)==null?void 0:le.charAt(0))==null?void 0:Te.toUpperCase())||"U"})}),o.jsxs("div",{children:[o.jsx("span",{className:"feed-post-author-name",onClick:()=>f(`/profile/${F._id}`),style:{cursor:"pointer"},children:F.name}),o.jsxs("div",{className:"feed-post-meta-wrapper",children:[o.jsx("span",{className:"feed-post-meta",children:new Date(t.createdAt).toLocaleString("vi-VN",{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),G&&o.jsxs("span",{className:"feed-post-meta feed-post-meta--saved",children:[" lu lc ",G]})]})]})]}),o.jsxs("div",{className:"feed-post-menu",ref:w,children:[o.jsx("button",{className:"feed-post-menu-button",onClick:()=>A(ce=>!ce),"aria-label":"Ty chn bi vit",children:""}),O&&o.jsxs("div",{className:"feed-post-menu-dropdown",children:[d?o.jsx("button",{onClick:ue,disabled:!l,children:"B lu bi vit"}):r&&o.jsx("button",{onClick:Z,children:"Lu bi vit"}),u&&o.jsx("button",{className:"danger",onClick:q,children:"Bo co bi vit"})]})]})]}),o.jsx("div",{className:"feed-post-content",children:t.content}),t.media&&t.media.length>0&&o.jsx("div",{className:"feed-post-media",children:t.media.map((ce,_e)=>o.jsx("div",{className:"feed-post-media-item",children:ce.type==="image"?o.jsx("img",{src:ce.url,alt:"",className:"feed-post-image"}):ce.type==="video"?o.jsx("video",{src:ce.url,controls:!0,className:"feed-post-video"}):o.jsx("div",{className:"feed-post-media-placeholder",children:o.jsxs("span",{children:[" ",ce.type]})})},_e))}),o.jsxs("div",{className:"feed-post-social",children:[o.jsxs("div",{className:"feed-post-reaction-summary",children:[ae.map(ce=>o.jsx("span",{className:"feed-post-reaction-icon feed-post-reaction-icon--svg",children:o.jsx(lb,{type:ce.type,size:18})},ce.type)),K>0&&o.jsx("span",{className:"feed-post-reaction-total",children:K})]}),o.jsxs("div",{className:"feed-post-comment-count",children:[t.commentCount||0," bnh lun"]})]}),o.jsxs("div",{className:"feed-post-actions",children:[o.jsxs("div",{className:`feed-post-action-btn ${I?"feed-post-action-btn--liked":""}`,onMouseEnter:ee,onMouseLeave:re,children:[o.jsx("button",{className:"feed-post-reaction-button",onClick:he,disabled:!D,children:(()=>{const ce=I?Xf.find(V=>V.type===I):null,_e=(ce==null?void 0:ce.label)||"Thch";return o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"feed-post-reaction-button-icon",children:I?o.jsx(lb,{type:I,size:20}):o.jsx(Fp,{size:20})}),o.jsx("span",{children:_e})]})})()}),j&&o.jsx("div",{className:"reaction-picker reaction-picker--svg",ref:N,onMouseEnter:ee,onMouseLeave:re,children:Xf.map(ce=>o.jsxs("button",{onClick:()=>Se(ce.type),className:"reaction-picker-btn",children:[o.jsx("span",{className:"reaction-emoji reaction-emoji--svg",children:o.jsx(ce.Icon,{size:40})}),o.jsx("span",{className:"reaction-label",children:ce.label})]},ce.type))})]}),o.jsxs("button",{className:"feed-post-action-btn",onClick:()=>p(ce=>!ce),children:[o.jsx(J8,{size:20,color:"currentColor"}),o.jsx("span",{children:"Bnh lun"})]}),o.jsxs("button",{className:"feed-post-action-btn",disabled:!0,children:[o.jsx(X8,{size:24,color:"white"}),o.jsx("span",{children:"Chia s"})]})]}),m&&o.jsxs("div",{className:"feed-comments",children:[o.jsxs("div",{children:[v.map(ce=>{const _e=ce.author||{name:`User ${ce.authorId}`,_id:ce.authorId};return o.jsxs("div",{className:"feed-comment-item",children:[o.jsxs("div",{className:"feed-comment-author",children:[o.jsx("span",{onClick:()=>f(`/profile/${_e._id}`),style:{cursor:"pointer",fontWeight:600},children:_e.name}),o.jsx("span",{style:{opacity:.6,marginLeft:8},children:new Date(ce.createdAt).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})})]}),o.jsx("div",{className:"feed-comment-content",children:ce.content})]},ce._id)}),k&&o.jsx("button",{className:"feed-post-action-btn",onClick:()=>C(),disabled:S,children:"Xem thm bnh lun"})]}),o.jsx("div",{style:{marginTop:8},children:o.jsx("input",{value:E,onChange:ce=>_(ce.target.value),placeholder:"Vit bnh lun...",className:"feed-comment-input",onKeyDown:ce=>{ce.key==="Enter"&&!ce.shiftKey&&(ce.preventDefault(),B())}})})]})]})},cb=()=>{var mt,Dt;yn();const{items:t,hasNext:e,isLoading:n,createPost:i,loadMore:r,reactionMap:l,selectReaction:u,clearReaction:d,savePost:f,reportPost:m}=L8(),{trackEvent:p}=F8(),{stories:v,isLoading:C,createStory:x,markStorySeen:S,deleteStory:k}=P8(),{items:E,isLoading:_,reload:O}=I8(5),[A,w]=b.useState(""),[j,R]=b.useState(!1),[N,L]=b.useState(!1),[F,D]=b.useState(null),[I,B]=b.useState({}),G=b.useRef(null),[Z,ue]=b.useState(null),[q,ee]=b.useState(!1),[re,he]=b.useState(null);b.useEffect(()=>{(async()=>{try{const Ee=await KT();if(Ee){const se=await uE(Ee),fe={_id:se._id,name:se.name||se.email||"User",avatar:se.avatar};he(fe),window.__currentUserId=fe._id}}catch(Ee){console.error("Failed to load current user:",Ee)}})()},[]),b.useEffect(()=>{const Q=()=>{if(!e||n)return;const Ee=window.innerHeight+window.scrollY,se=document.documentElement.scrollHeight-200;Ee>=se&&r()};return window.addEventListener("scroll",Q),()=>window.removeEventListener("scroll",Q)},[e,n,r]),b.useEffect(()=>{if(!F)return;const Q=v[F.groupIndex];(!Q||!Q.stories[F.storyIndex])&&D(null)},[v,F]);const Se=async(Q,Ee,se)=>{await i(Q,Ee,se)},P=async Q=>{await x(Q),L(!1)},K=(Q,Ee=0)=>{D({groupIndex:Q,storyIndex:Ee})},ae=(Q,Ee)=>{let se=Q.groupIndex,fe=Q.storyIndex;for(;;){const Ae=v[se];if(!Ae)return null;if(fe+=Ee,fe>=0&&fe<Ae.stories.length)return{groupIndex:se,storyIndex:fe};if(se+=Ee,se<0||se>=v.length)return null;const He=v[se];if(!He||He.stories.length===0){fe=Ee>0?-1:(He==null?void 0:He.stories.length)??0;continue}return fe=Ee>0?0:He.stories.length-1,{groupIndex:se,storyIndex:fe}}},le=()=>{D(Q=>Q&&(ae(Q,1)??null))},Te=()=>{D(Q=>Q&&(ae(Q,-1)??null))},ce=async Q=>{await k(Q),D(null)},_e=async Q=>{var Ee,se;try{await EE(Q),B(fe=>({...fe,[Q]:!0})),p("FRIEND_SUGGESTION_CLICK",{targetUserId:Q,action:"send_request"}),O()}catch(fe){alert(((se=(Ee=fe==null?void 0:fe.response)==null?void 0:Ee.data)==null?void 0:se.error)||"Khng th gi li mi")}},V=async Q=>{var Ee,se;try{await f(Q),window.alert(" lu bi vit vo mc Lu tr.")}catch(fe){window.alert(((se=(Ee=fe==null?void 0:fe.response)==null?void 0:Ee.data)==null?void 0:se.error)||"Khng th lu bi vit.")}},ve=async Q=>{var Ee,se;if(Z){ee(!0);try{await m(Z._id,Q),window.alert(" gi bo co. Cm n bn!"),ue(null)}catch(fe){window.alert(((se=(Ee=fe==null?void 0:fe.response)==null?void 0:Ee.data)==null?void 0:se.error)||"Khng th gi bo co.")}finally{ee(!1)}}},be=o.jsx($8,{currentUser:re}),Ue=o.jsx(q8,{currentUser:re,activeRoute:"/feed"}),et=o.jsx(V8,{friendSuggestions:E,isLoading:_,sentRequests:I,onSendRequest:_e}),At=o.jsxs(o.Fragment,{children:[o.jsx(Z8,{currentUser:re,groups:v,loading:C,onCreateStory:()=>L(!0),onSelectStory:K}),o.jsx("section",{className:"feed-card",children:o.jsxs("div",{className:"feed-create-header",children:[re?o.jsx("div",{className:"feed-avatar-circle",children:re.avatar?o.jsx("img",{src:re.avatar,alt:re.name}):o.jsx("div",{className:"feed-avatar-initials",children:((Dt=(mt=re.name)==null?void 0:mt.charAt(0))==null?void 0:Dt.toUpperCase())||"U"})}):o.jsx("div",{className:"feed-avatar-circle",children:"U"}),o.jsx("input",{className:"feed-create-input",value:A,onChange:Q=>w(Q.target.value),onFocus:()=>R(!0),placeholder:re?`Ngh g th, ${re.name}?`:"Ngh g th hm nay?"})]})}),o.jsxs("section",{ref:G,style:{paddingBottom:24,flex:1,minHeight:0},children:[t.map(Q=>o.jsx(n6,{post:Q,reaction:l[Q._id]||null,onSelectReaction:(Ee,se)=>u(Ee,se),onClearReaction:Ee=>d(Ee),onSavePost:V,onReportPost:Ee=>ue(Ee)},Q._id)),n&&o.jsx("div",{style:{padding:16,textAlign:"center"},children:"ang ti..."}),!n&&t.length===0&&o.jsx("div",{style:{padding:16,textAlign:"center",opacity:.7},children:"Cha c bi vit no. Hy l ngi u tin ng nh!"})]})]});return o.jsxs(o.Fragment,{children:[o.jsx(z8,{header:be,leftSidebar:Ue,rightSidebar:et,children:At}),o.jsx(G8,{isOpen:j,onClose:()=>{R(!1),w("")},onSubmit:Se,currentUser:re}),o.jsx(K8,{isOpen:N,onClose:()=>L(!1),onSubmit:P,currentUser:re}),o.jsx(Y8,{groups:v,state:F,onClose:()=>D(null),onNext:le,onPrev:Te,onStorySeen:S,onDeleteStory:ce,currentUserId:re==null?void 0:re._id}),o.jsx(W8,{isOpen:!!Z,post:Z,onClose:()=>ue(null),onSubmit:ve,isSubmitting:q})]})};function i6({header:t,messageArea:e,composer:n,rightPanel:i}){return o.jsxs("div",{className:"chat-container",children:[o.jsxs("div",{className:"chat-main",children:[o.jsx("div",{className:"chat-header",children:t}),o.jsx("div",{className:"chat-content",children:e}),o.jsx("div",{className:"chat-composer",children:n})]}),i?o.jsx("aside",{className:"chat-side-panel",children:i}):null]})}function s6({title:t,subtitle:e,avatar:n,statusDotColor:i,actions:r,onVideoCall:l,onAudioCall:u,onToggleInfo:d,isInfoVisible:f}){return o.jsxs("div",{className:"chat-header-content",children:[o.jsxs("div",{className:"chat-header-left",children:[n?o.jsx("img",{src:n,alt:t,className:"chat-header-avatar"}):o.jsx("div",{className:"chat-header-avatar chat-header-avatar--fallback",children:t.slice(0,1).toUpperCase()}),o.jsxs("div",{className:"chat-header-text",children:[o.jsx("div",{className:"chat-header-title",children:t}),e?o.jsxs("div",{className:"chat-header-subtitle",children:[i?o.jsx("span",{className:"chat-header-status-dot",style:{backgroundColor:i}}):null,e]}):null]})]}),o.jsxs("div",{className:"chat-header-actions",children:[l&&o.jsx("button",{className:"chat-header-action-button",onClick:l,title:"Gi video",type:"button",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("rect",{x:"2",y:"5",width:"14",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),o.jsx("path",{d:"M22 7l-6 5 6 5V7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),u&&o.jsx("button",{className:"chat-header-action-button",onClick:u,title:"Gi thoi",type:"button",children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),d&&o.jsx("button",{className:`chat-header-action-button ${f?"active":""}`,onClick:d,title:"Thng tin",type:"button",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),o.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),o.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),r]})]})}function a6({message:t}){if(!t)return null;const e=typeof t=="string"?t:t.text??"[nh km]";return o.jsxs("div",{className:"chat-reply-preview",children:[o.jsx("div",{className:"chat-reply-indicator"}),o.jsxs("div",{className:"chat-reply-content",children:[o.jsx("div",{className:"chat-reply-label",children:"Tr li"}),o.jsx("div",{className:"chat-reply-text",children:e})]})]})}function r6({reactions:t}){if(!t||t.length===0)return null;const e=t.reduce((n,i)=>(n[i.emoji]=(n[i.emoji]??0)+1,n),{});return o.jsx("div",{className:"chat-reaction-summary",children:Object.entries(e).map(([n,i])=>o.jsxs("span",{className:"chat-reaction-chip",children:[n," ",i]},n))})}const C9=b.forwardRef(({message:t,isOwn:e,onReply:n,onCopy:i,onPinToggle:r,onEdit:l,onDelete:u,onForward:d,onStar:f,onRevoke:m,anchorClassName:p,style:v},C)=>o.jsxs("div",{ref:C,className:["chat-context-menu",p].filter(Boolean).join(" "),style:v,children:[o.jsx("button",{className:"chat-context-menu-item",onClick:x=>{x.stopPropagation(),n(t)},children:" Tr li"}),o.jsx("button",{className:"chat-context-menu-item",onClick:x=>{x.stopPropagation(),navigator.clipboard.writeText(t.text??""),i==null||i(t)},children:" Sao chp"}),o.jsx("button",{className:"chat-context-menu-item",onClick:x=>{x.stopPropagation(),r==null||r(!t.isPinned)},children:t.isPinned?" B ghim":" Ghim tin nhn"}),t.isStarred?o.jsx("button",{className:"chat-context-menu-item",disabled:!0,children:"  nh du"}):o.jsx("button",{className:"chat-context-menu-item",onClick:x=>{x.stopPropagation(),f==null||f()},children:" nh du sao"}),e?o.jsx("button",{className:"chat-context-menu-item",onClick:x=>{x.stopPropagation(),l==null||l()},children:" Chnh sa"}):null,e&&!t.isRevoked?o.jsx("button",{className:"chat-context-menu-item",onClick:x=>{x.stopPropagation(),m==null||m()},children:" Thu hi"}):null,e?o.jsx("button",{className:"chat-context-menu-item chat-context-menu-item--danger",onClick:x=>{x.stopPropagation(),u==null||u()},children:" Xa"}):null,o.jsx("button",{className:"chat-context-menu-item",onClick:x=>{x.stopPropagation(),d==null||d(t)},children:" Chuyn tip"})]}));C9.displayName="MessageContextMenu";const o6=["","","","","","","","","","","",""];function l6({isOpen:t,position:e,onSelect:n,onClose:i,anchorClassName:r}){const l=b.useRef(null);return b.useEffect(()=>{if(!t)return;const u=d=>{const f=d.target;l.current&&!l.current.contains(f)&&i()};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[t,i]),t?Qu.createPortal(o.jsx("div",{ref:l,className:["chat-reaction-picker",r].filter(Boolean).join(" "),style:{position:"fixed",top:`${e.top}px`,...e.right!==void 0?{right:`${e.right}px`}:{left:`${e.left}px`},zIndex:1e5},children:o.jsx("div",{className:"chat-reaction-picker-grid",children:o6.map(u=>o.jsx("button",{className:"chat-reaction-picker-item",onClick:d=>{d.stopPropagation(),n(u),i()},title:u,children:u},u))})}),document.body):null}const c6=t=>t.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);function u6({message:t,isOwn:e,senderName:n,senderAvatar:i,onReply:r,onReact:l,onTogglePin:u,onEdit:d,onDelete:f,onForward:m,onStar:p,onRevoke:v}){var he,Se;const C=n||((he=t.sender)==null?void 0:he.name)||"Ngi dng",x=i||((Se=t.sender)==null?void 0:Se.avatar),[S,k]=b.useState(!1),[E,_]=b.useState(!1),[O,A]=b.useState(null),[w,j]=b.useState(null),R=b.useRef(null),N=b.useRef(null),L=b.useRef(null),F=b.useMemo(()=>["chat-bubble-wrapper",e?"chat-bubble-wrapper--own":"chat-bubble-wrapper--other"].join(" "),[e]),D=b.useMemo(()=>["chat-bubble-row",e?"chat-bubble-row--own":"chat-bubble-row--other"].join(" "),[e]),I=b.useMemo(()=>["chat-bubble-footer",e?"chat-bubble-footer--own":"chat-bubble-footer--other"].join(" "),[e]),B=b.useMemo(()=>["chat-bubble",e?"chat-bubble--own":"chat-bubble--other"].join(" "),[e]),G=(()=>{if(t.replyTo)return typeof t.replyTo=="string"?"[Tr li tin nhn trc]":t.replyTo})();b.useEffect(()=>{if(!S||!N.current)return;const P=()=>{if(N.current){const ae=N.current.getBoundingClientRect();A({top:ae.bottom+6,right:window.innerWidth-ae.right,left:ae.left})}};P(),window.addEventListener("scroll",P,!0),window.addEventListener("resize",P);const K=ae=>{const le=ae.target;R.current&&!R.current.contains(le)&&N.current&&!N.current.contains(le)&&(k(!1),A(null))};return document.addEventListener("mousedown",K),()=>{document.removeEventListener("mousedown",K),window.removeEventListener("scroll",P,!0),window.removeEventListener("resize",P)}},[S]),b.useEffect(()=>{if(!E||!L.current)return;const P=()=>{if(L.current){const K=L.current.getBoundingClientRect();j({top:K.bottom+6,right:window.innerWidth-K.right,left:K.left})}};return P(),window.addEventListener("scroll",P,!0),window.addEventListener("resize",P),()=>{window.removeEventListener("scroll",P,!0),window.removeEventListener("resize",P)}},[E]);const Z=!!t.isRevoked,ue=!!t.deletedAt,q=!!t.text||!!t.imageUrl,ee=Z||ue,re=()=>Z?o.jsx("div",{className:"chat-bubble-removed",children:"Tin nhn  b thu hi"}):ue?o.jsx("div",{className:"chat-bubble-removed",children:"Tin nhn  b xa"}):q?o.jsxs(o.Fragment,{children:[t.text?o.jsx("div",{className:"chat-bubble-text",children:t.text}):null,t.imageUrl?o.jsx("img",{src:t.imageUrl,alt:"attachment",className:"chat-bubble-image"}):null]}):o.jsx("div",{className:"chat-bubble-removed",children:"[Khng c ni dung hin th]"});return o.jsxs("div",{className:F,"data-message-id":t._id,children:[o.jsxs("div",{className:D,children:[!e&&o.jsx("div",{className:"chat-bubble-sender-avatar",children:x?o.jsx("img",{src:x,alt:C,className:"chat-bubble-sender-avatar-img"}):o.jsx("div",{className:"chat-bubble-sender-avatar-initials",children:c6(C)})}),o.jsxs("div",{className:B,children:[!e&&o.jsx("div",{className:"chat-bubble-sender-name",children:C}),t.isPinned?o.jsx("div",{className:"chat-bubble-pinned",children:"  ghim"}):null,t.isStarred?o.jsx("div",{className:"chat-bubble-starred",children:"  nh du"}):null,G?o.jsx(a6,{message:G}):null,o.jsx("div",{className:"chat-bubble-body",children:re()})]}),o.jsxs("div",{className:["chat-bubble-actions",e?"chat-bubble-actions--own":"chat-bubble-actions--other",S||E?"chat-bubble-actions--visible":""].filter(Boolean).join(" "),children:[o.jsx("button",{ref:L,className:"chat-bubble-action",onClick:()=>{if(!ee){if(L.current){const P=L.current.getBoundingClientRect();j({top:P.bottom+6,right:window.innerWidth-P.right,left:P.left})}_(P=>!P)}},title:"Thm cm xc",type:"button",disabled:ee,children:""}),o.jsx("button",{ref:N,className:"chat-bubble-action",onClick:()=>{ee||k(P=>!P)},title:"Ty chn",type:"button",disabled:ee,children:""}),E&&w?o.jsx(l6,{isOpen:E,position:w,onSelect:P=>{l==null||l(t._id,P),_(!1),j(null)},onClose:()=>{_(!1),j(null)},anchorClassName:e?void 0:"chat-reaction-picker--other"}):null,S&&O?Qu.createPortal(o.jsx(C9,{ref:R,message:t,isOwn:e,style:{top:`${O.top}px`,...e?{right:`${O.right}px`}:{left:`${O.left}px`}},onReply:P=>{r==null||r(P),k(!1),A(null)},onCopy:()=>{k(!1),A(null)},onPinToggle:P=>{u==null||u(t._id,P),k(!1),A(null)},onEdit:()=>{d==null||d(t),k(!1),A(null)},onDelete:()=>{f==null||f(t),k(!1),A(null)},onRevoke:()=>{v==null||v(t),k(!1),A(null)},onStar:()=>{p==null||p(t),k(!1),A(null)},onForward:P=>{m==null||m(P),k(!1),A(null)},anchorClassName:e?void 0:"chat-context-menu--other"}),document.body):null]})]}),o.jsxs("div",{className:I,children:[o.jsxs("div",{className:"chat-bubble-meta",children:[o.jsx("span",{className:"chat-bubble-time",children:new Date(t.createdAt).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}),t.isEdited?o.jsx("span",{className:"chat-bubble-edited",children:"( chnh sa)"}):null,t.pending?o.jsx("span",{className:"chat-bubble-pending",children:"ang gi"}):null,t.error?o.jsx("span",{className:"chat-bubble-error",children:t.error}):null,e&&t.readBy&&t.readBy.length>0&&!t.pending&&!t.error?o.jsx("span",{className:"chat-bubble-read",title:` c bi ${t.readBy.length} ngi`,children:""}):e&&!t.pending&&!t.error?o.jsx("span",{className:"chat-bubble-sent",title:" gi",children:""}):null]}),o.jsx(r6,{reactions:t.reactions})]})]})}function d6({messages:t,onSelect:e}){return t.length?o.jsxs("div",{className:"chat-pinned-bar",children:[o.jsx("span",{className:"chat-pinned-label",children:"Tin nhn  ghim"}),o.jsx("div",{className:"chat-pinned-items",children:t.map(n=>o.jsxs("button",{type:"button",className:"chat-pinned-item",onClick:()=>e==null?void 0:e(n._id),children:[o.jsx("span",{className:"chat-pinned-icon",children:""}),o.jsx("span",{className:"chat-pinned-text",children:n.text??"[nh km]"})]},n._id))})]}):null}function h6({messages:t,currentUserId:e,loading:n,hasMore:i,opponentName:r,opponentAvatar:l,onReply:u,onLoadMore:d,onReact:f,onTogglePin:m,onScrollToMessage:p,focusMessageId:v,onFocusHandled:C,onEdit:x,onDelete:S,onForward:k,onStar:E,onRevoke:_}){const O=b.useRef(null),A=b.useRef({});b.useEffect(()=>{const R=O.current;R&&(R.scrollTop=R.scrollHeight)},[t]),b.useEffect(()=>{const R=O.current;if(!R||!d)return;const N=()=>{R.scrollTop<=32&&d()};return R.addEventListener("scroll",N),()=>R.removeEventListener("scroll",N)},[d]);const w=t.filter(R=>R.isPinned),j=R=>{const N=A.current[R];N?(N.scrollIntoView({behavior:"smooth",block:"center"}),N.classList.add("chat-message-row--highlight"),setTimeout(()=>N.classList.remove("chat-message-row--highlight"),1200)):p==null||p(R)};return b.useEffect(()=>{v&&(j(v),C==null||C())},[v,t]),o.jsxs("div",{className:"chat-message-list-wrapper",children:[o.jsx(d6,{messages:w,onSelect:j}),o.jsxs("div",{className:"chat-message-list",ref:O,children:[i?o.jsx("button",{type:"button",className:"chat-load-more",onClick:()=>d==null?void 0:d(),children:"Xem thm tin nhn c"}):null,n?o.jsx("div",{className:"chat-message-placeholder",children:"ang ti tin nhn..."}):null,!n&&t.length===0?o.jsx("div",{className:"chat-message-placeholder",children:"Bt u cuc tr chuyn u tin!"}):null,t.map(R=>{var L,F;const N=R.senderId===e;return o.jsxs("div",{className:`chat-message-row ${N?"mine":""}`,ref:D=>{D&&R._id&&(A.current[R._id]=D)},onMouseEnter:()=>{},children:[o.jsx(u6,{message:R,isOwn:R.senderId===e,senderName:((L=R.sender)==null?void 0:L.name)||(R.senderId!==e?r:void 0),senderAvatar:((F=R.sender)==null?void 0:F.avatar)||(R.senderId!==e?l:void 0),onReply:u,onReact:f,onTogglePin:m,onEdit:x,onDelete:S,onForward:k,onStar:E,onRevoke:_}),o.jsx("div",{className:"chat-message-actions",children:o.jsx("button",{className:"chat-message-action",onClick:()=>u==null?void 0:u(R),title:"Tr li",children:""})})]},R._id||R.localId)})]})]})}function f6({onSend:t,disabled:e,onValueChange:n,replyPreview:i,onCancelReply:r,editingLabel:l,onCancelEdit:u,value:d}){const[f,m]=b.useState(""),p=b.useMemo(()=>d!==void 0?d:f,[d,f]),[v,C]=b.useState(!1),x=b.useCallback(E=>{d!==void 0||m(E),n==null||n(E)},[n,d]),S=b.useCallback(()=>{d!==void 0||m(""),n==null||n("")},[n,d]),k=b.useCallback(async E=>{E.preventDefault();const _=p.trim();if(!(!_&&!i))try{C(!0),await t({text:_}),S()}finally{C(!1)}},[t,p,i,S]);return o.jsxs("form",{className:"chat-composer-form",onSubmit:k,children:[i?o.jsxs("div",{className:"chat-composer-reply-preview",children:[o.jsx("div",{className:"chat-reply-indicator"}),o.jsxs("div",{className:"chat-composer-reply-body",children:[o.jsx("span",{className:"chat-reply-label",children:"Tr li"}),o.jsx("span",{className:"chat-reply-text",children:i})]}),o.jsx("button",{type:"button",className:"chat-reply-cancel",onClick:r,children:""})]}):null,l?o.jsxs("div",{className:"chat-composer-edit-banner",children:[o.jsx("span",{children:l}),o.jsx("button",{type:"button",onClick:u,children:"Hy"})]}):null,o.jsx("input",{className:"chat-composer-input",placeholder:"Nhp tin nhn...",value:p,onChange:E=>x(E.target.value),disabled:e||v}),o.jsx("button",{className:"chat-composer-send",type:"submit",disabled:e||v||!p.trim(),children:"Gi"})]})}function m6({users:t}){if(!t.length)return null;const e=t.length===1?`${t[0].name??"Ai "} ang nhp...`:`${t.length} ngi ang nhp...`;return o.jsx("div",{className:"chat-typing-indicator",children:e})}function p6({message:t,onClose:e,onForwarded:n}){const[i,r]=b.useState([]),[l,u]=b.useState(!0),[d,f]=b.useState(null),[m,p]=b.useState(!1);b.useEffect(()=>{t&&v()},[t]);const v=async()=>{try{u(!0);const x=await Np();r(x)}catch(x){console.error("Failed to load conversations:",x)}finally{u(!1)}},C=async()=>{if(!(!t||!d))try{p(!0),await dC(d,{text:t.text,imageUrl:t.imageUrl,type:t.type}),n==null||n(),e()}catch(x){console.error("Failed to forward message:",x),alert("Khng th chuyn tip tin nhn. Vui lng th li.")}finally{p(!1)}};return t?o.jsx("div",{className:"chat-forward-dialog-overlay",onClick:e,children:o.jsxs("div",{className:"chat-forward-dialog",onClick:x=>x.stopPropagation(),children:[o.jsxs("div",{className:"chat-forward-dialog-header",children:[o.jsx("h3",{children:"Chuyn tip tin nhn"}),o.jsx("button",{className:"chat-forward-dialog-close",onClick:e,children:""})]}),o.jsx("div",{className:"chat-forward-dialog-preview",children:o.jsxs("div",{className:"chat-forward-preview-message",children:[t.text&&o.jsx("div",{className:"chat-forward-preview-text",children:t.text}),t.imageUrl&&o.jsx("img",{src:t.imageUrl,alt:"Preview",className:"chat-forward-preview-image"})]})}),o.jsx("div",{className:"chat-forward-dialog-list",children:l?o.jsx("div",{className:"chat-forward-dialog-loading",children:"ang ti..."}):i.length===0?o.jsx("div",{className:"chat-forward-dialog-empty",children:"Khng c cuc tr chuyn no"}):i.map(x=>o.jsxs("button",{className:`chat-forward-dialog-item ${d===x._id?"chat-forward-dialog-item--selected":""}`,onClick:()=>f(x._id),children:[o.jsx("div",{className:"chat-forward-dialog-item-avatar",children:x.isGroup?"":""}),o.jsx("div",{className:"chat-forward-dialog-item-info",children:o.jsx("div",{className:"chat-forward-dialog-item-name",children:x.isGroup?x.title||`Nhm (${x.members.length})`:x.title||"Ngi dng"})})]},x._id))}),o.jsxs("div",{className:"chat-forward-dialog-actions",children:[o.jsx("button",{className:"chat-forward-dialog-cancel",onClick:e,children:"Hy"}),o.jsx("button",{className:"chat-forward-dialog-forward",onClick:C,disabled:!d||m,children:m?"ang chuyn tip...":"Chuyn tip"})]})]})}):null}function g6({conversationId:t,opponentName:e,opponentAvatar:n,messages:i=[],onClose:r}){const[l,u]=b.useState(!1),[d,f]=b.useState("media"),[m,p]=b.useState(!1),[v,C]=b.useState([]),[x,S]=b.useState(0),k=b.useMemo(()=>e||"on chat",[e]),E=b.useMemo(()=>i.filter(w=>{var L,F,D;const j=!!w.imageUrl,R=w.type==="image",N=(D=(F=(L=w.file)==null?void 0:L.mime)==null?void 0:F.startsWith)==null?void 0:D.call(F,"image/");return j||R||N}),[i]),_=b.useMemo(()=>i.filter(w=>{var L,F;const j=w.type==="file",R=!!w.file,N=w.file&&!((F=(L=w.file.mime)==null?void 0:L.startsWith)!=null&&F.call(L,"image/"));return j||R&&N}),[i]),O=b.useMemo(()=>E.map(w=>{var R,N,L;return w.imageUrl||((L=(N=(R=w.file)==null?void 0:R.mime)==null?void 0:N.startsWith)!=null&&L.call(N,"image/")?w.file.url:void 0)||null}).filter(w=>!!w),[E]),A=w=>{if(!O.length)return;const j=Math.max(0,Math.min(w,O.length-1));C(O),S(j),p(!0)};return o.jsxs("div",{className:"direct-chat-panel",children:[o.jsxs("div",{className:"direct-chat-panel-section",children:[o.jsxs("div",{className:"direct-chat-panel-header",children:[o.jsx("div",{className:"direct-chat-panel-avatar",children:n?o.jsx("img",{src:n,alt:k}):o.jsx("div",{className:"direct-chat-panel-avatar-fallback",children:k.charAt(0).toUpperCase()})}),o.jsxs("div",{className:"direct-chat-panel-header-text",children:[o.jsx("div",{className:"direct-chat-panel-title",children:k}),o.jsx("div",{className:"direct-chat-panel-subtitle",children:"on chat c nhn"})]})]}),o.jsxs("div",{className:"direct-chat-panel-actions",children:[o.jsxs("button",{className:"direct-chat-panel-action-btn",children:[o.jsx("span",{className:"action-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsx("span",{className:"action-label",children:"Trang c nhn"})]}),o.jsxs("button",{className:"direct-chat-panel-action-btn",children:[o.jsx("span",{className:"action-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M13.73 21a2 2 0 01-3.46 0",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsx("span",{className:"action-label",children:"Tt thng bo"})]}),o.jsxs("button",{className:"direct-chat-panel-action-btn",children:[o.jsx("span",{className:"action-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsx("span",{className:"action-label",children:"Tm kim"})]})]}),o.jsx("div",{className:"direct-chat-panel-divider"})]}),o.jsxs("div",{className:"direct-chat-panel-section",children:[o.jsx("div",{className:"direct-chat-panel-section-title",children:"TU CHNH ON CHAT"}),o.jsxs("div",{className:"direct-chat-panel-list",children:[o.jsxs("button",{className:"direct-chat-panel-item",children:[o.jsx("span",{className:"item-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),o.jsx("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsx("span",{children:"i ch "})]}),o.jsxs("button",{className:"direct-chat-panel-item",children:[o.jsx("span",{className:"item-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3H14z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M7 22H4a2 2 0 01-2-2v-7a2 2 0 012-2h3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsx("span",{children:"Thay i biu tng cm xc"})]}),o.jsxs("button",{className:"direct-chat-panel-item",children:[o.jsx("span",{className:"item-icon item-icon-text",children:"Aa"}),o.jsx("span",{children:"Chnh sa bit danh"})]})]})]}),o.jsxs("div",{className:"direct-chat-panel-section",children:[o.jsx("div",{className:"direct-chat-panel-section-title",children:"FILE PHNG TIN & FILE"}),o.jsxs("div",{className:"direct-chat-panel-list",children:[o.jsxs("button",{className:"direct-chat-panel-item",onClick:()=>{f("media"),u(!0)},children:[o.jsx("span",{className:"item-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),o.jsx("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsx("span",{children:"File phng tin"})]}),o.jsxs("button",{className:"direct-chat-panel-item",onClick:()=>{f("files"),u(!0)},children:[o.jsx("span",{className:"item-icon",children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2v11z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),o.jsx("span",{children:"File"})]})]})]}),l&&o.jsx("div",{className:"media-overlay",children:o.jsxs("div",{className:"media-overlay-inner",children:[o.jsxs("div",{className:"media-overlay-header",children:[o.jsx("button",{className:"media-back-btn",onClick:()=>u(!1),children:""}),o.jsxs("div",{className:"media-title-group",children:[o.jsx("div",{className:"media-title",children:"File phng tin & file"}),o.jsx("div",{className:"media-subtitle",children:k})]})]}),o.jsxs("div",{className:"media-tabs",children:[o.jsx("button",{className:`media-tab ${d==="media"?"active":""}`,onClick:()=>f("media"),children:"File phng tin"}),o.jsx("button",{className:`media-tab ${d==="files"?"active":""}`,onClick:()=>f("files"),children:"File"})]}),o.jsx("div",{className:"media-content",children:d==="media"?E.length===0?o.jsx("div",{className:"media-placeholder",children:o.jsx("p",{children:"Cha c file phng tin no trong on chat ny."})}):o.jsx("div",{className:"media-grid",children:E.map((w,j)=>{var L,F,D;const R=w._id||w.localId||`${w.createdAt}-${w.senderId}`,N=w.imageUrl||((D=(F=(L=w.file)==null?void 0:L.mime)==null?void 0:F.startsWith)!=null&&D.call(F,"image/")?w.file.url:void 0);return N?o.jsx("button",{type:"button",className:"media-grid-item",onClick:()=>A(j),children:o.jsx("img",{src:N,alt:""})},R):null})}):_.length===0?o.jsx("div",{className:"media-placeholder",children:o.jsx("p",{children:"Cha c file no trong on chat ny."})}):o.jsx("div",{className:"media-file-list",children:_.map(w=>{const j=w.file;if(!j)return null;const R=w._id||w.localId||`${w.createdAt}-${w.senderId}`;return o.jsxs("a",{href:j.url,target:"_blank",rel:"noreferrer",className:"media-file-item",children:[o.jsx("div",{className:"media-file-icon",children:o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z",stroke:"#0966FF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8",stroke:"#0966FF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsxs("div",{className:"media-file-info",children:[o.jsx("div",{className:"media-file-name",children:j.name||"File nh km"}),o.jsx("div",{className:"media-file-meta",children:new Date(w.createdAt).toLocaleDateString("vi-VN")})]})]},R)})})})]})}),m?Qu.createPortal(o.jsx("div",{className:"image-viewer-backdrop",onClick:()=>p(!1),children:o.jsxs("div",{className:"image-viewer-content",onClick:w=>w.stopPropagation(),children:[v[x]?o.jsx("img",{src:v[x],alt:"attachment-large"}):null,v.length>1?o.jsx("div",{className:"image-viewer-thumbs",children:v.map((w,j)=>o.jsx("button",{type:"button",className:`image-viewer-thumb ${j===x?"active":""}`,onClick:()=>S(j),children:o.jsx("img",{src:w,alt:`thumb-${j}`})},w+j))}):null]})}),document.body):null]})}function v6(t,e,n){if(!t)return()=>{};const i=C=>{var k;let x,S;"conversationId"in C&&"message"in C?(x=C.message,S=C.conversationId):(x=C,S=String(x.conversationId)),S===e?(console.log(" Socket received message for current conversation:",x._id),(k=n.onMessageCreated)==null||k.call(n,x)):console.log(" Socket received message for different conversation:",S,"current:",e)},r=C=>{var k;let x,S;"conversationId"in C&&"message"in C?(x=C.message,S=C.conversationId):(x=C,S=String(x.conversationId)),S===e&&((k=n.onMessageUpdated)==null||k.call(n,x))},l=C=>{var k;const x=C.messageId,S=C.conversationId;(!S||S===e)&&((k=n.onMessageDeleted)==null||k.call(n,x))},u=C=>{var x;C.conversationId===e&&((x=n.onTypingStarted)==null||x.call(n,C.userId))},d=C=>{var x;C.conversationId===e&&((x=n.onTypingStopped)==null||x.call(n,C.userId))},f=C=>{var x;(x=n.onMessagePinned)==null||x.call(n,C)},m=C=>{var x;C!=null&&C.messageId&&((x=n.onMessageReaction)==null||x.call(n,C))},p=C=>{var x;C!=null&&C.messageId&&(C.conversationId&&C.conversationId!==e||(x=n.onMessageRevoked)==null||x.call(n,C))},v=C=>{var x;C!=null&&C.messageId&&(C.conversationId&&C.conversationId!==e||(x=n.onMessageRead)==null||x.call(n,C))};return t.on("message:new",i),t.on("newMessage",i),t.on("chatMessage",i),t.on("message:update",r),t.on("message:edited",r),t.on("message:delete",l),t.on("message:deleted",l),t.on("message:pinned",f),t.on("message:reaction",m),t.on("message:revoked",p),t.on("message:read",v),t.on("typing:start",u),t.on("typing:stop",d),()=>{t.off("message:new",i),t.off("newMessage",i),t.off("chatMessage",i),t.off("message:update",r),t.off("message:edited",r),t.off("message:delete",l),t.off("message:deleted",l),t.off("message:pinned",f),t.off("message:reaction",m),t.off("message:revoked",p),t.off("message:read",v),t.off("typing:start",u),t.off("typing:stop",d)}}const ub=40,La=t=>({...t}),ia=t=>[...t].sort((e,n)=>new Date(e.createdAt).getTime()-new Date(n.createdAt).getTime());function y6(t){const[e,n]=b.useState([]),[i,r]=b.useState(!1),[l,u]=b.useState(!1),[d,f]=b.useState(!1),[m,p]=b.useState(null),[v,C]=b.useState(null),[x,S]=b.useState(0);b.useEffect(()=>{const I=localStorage.getItem("user_id");I&&C(I)},[]),b.useEffect(()=>{S(0),n([])},[t]);const k=b.useCallback(async(I=0)=>{var B;if(!t){n([]),r(!1);return}try{I===0?u(!0):f(!0),p(null);const G=await HT(t,{limit:ub,skip:I});let Z,ue=!1;Array.isArray(G)?(Z=G,ue=Z.length>=ub):(Z=G.messages||[],ue=((B=G.pagination)==null?void 0:B.hasMore)||!1);const q=Z.map(La);n(I===0?ia(q):ee=>ia([...q,...ee])),r(ue),S(I+q.length)}catch(G){console.error(" Failed to load messages:",G),p(G instanceof Error?G.message:"Failed to load messages")}finally{u(!1),f(!1)}},[t]);b.useEffect(()=>{k(0)},[k]);const E=b.useCallback((I,B)=>{n(G=>{const Z=G.map(ue=>ue._id===I?B(ue):ue).filter(ue=>ue!==null);return ia(Z)})},[]);b.useEffect(()=>{if(!t)return;const I=hi();if(!I){console.warn(" Socket not available, cannot join room");return}const B=()=>{console.log(` Joining conversation room: conv:${t}`),I.emit("conversation:join",t)};if(I.connected)B();else{console.log(" Socket not connected yet, waiting for connect...");const Z=()=>{console.log(` Socket connected, joining room: conv:${t}`),B(),I.off("connect",Z)};return I.on("connect",Z),()=>{I.off("connect",Z)}}const G=v6(I,t,{onMessageCreated:Z=>{console.log(" New message received via socket:",Z._id),n(ue=>ue.some(ee=>ee._id===Z._id)?(console.log(" Message already exists, skipping:",Z._id),ue):(console.log(" Adding new message to list"),ia([...ue,La(Z)])))},onMessageUpdated:Z=>{n(ue=>ia(ue.map(q=>q._id===Z._id?La(Z):q)))},onMessageDeleted:Z=>{n(ue=>ue.filter(q=>q._id!==Z))},onMessagePinned:Z=>{console.log(` Socket: Message ${Z.messageId} ${Z.action}ed`),k()},onMessageReaction:Z=>{if(!Z.reaction)return;const ue=Z.reaction;E(Z.messageId,q=>{const ee=q.reactions??[];return Z.action==="remove"?{...q,reactions:ee.filter(he=>!(he.userId===ue.userId&&he.emoji===ue.emoji))}:ee.some(he=>he.userId===ue.userId&&he.emoji===ue.emoji)?q:{...q,reactions:[...ee,{emoji:ue.emoji,userId:ue.userId,createdAt:ue.createdAt??new Date().toISOString()}]}})},onMessageRevoked:Z=>{E(Z.messageId,ue=>({...ue,isRevoked:!0,revokedAt:Z.revokedAt??new Date().toISOString(),revokedBy:Z.revokedBy,text:null,imageUrl:void 0}))},onMessageRead:Z=>{Z.userId&&E(Z.messageId,ue=>{var re;if((re=ue.readBy)==null?void 0:re.some(he=>he.userId===Z.userId))return ue;const ee=[...ue.readBy??[],{userId:Z.userId,readAt:Z.readAt??new Date().toISOString()}];return{...ue,readBy:ee}})}});return()=>{G()}},[t,k]);const _=b.useCallback(async()=>{if(t)try{await lE(t)}catch(I){console.warn(" Failed to mark conversation as read:",I)}},[t]),O=b.useCallback(async I=>{var q;if(!t){console.warn("sendMessage called without conversationId");return}const B=((q=I.text)==null?void 0:q.trim())??"";if(!B&&!I.imageUrl)return;const G=new Date().toISOString(),Z=`local-${Date.now()}`,ue={_id:Z,localId:Z,pending:!0,text:B,imageUrl:I.imageUrl,type:I.imageUrl?"image":"text",conversationId:t,senderId:v??"me",createdAt:G,updatedAt:G};n(ee=>ia([...ee,ue]));try{let ee;if(I.imageUrl){const re={text:I.text,imageUrl:I.imageUrl,replyTo:I.replyTo};ee=await dC(t,re)}else ee=await $T(t,B);n(re=>ia(re.map(he=>he.localId===Z?La(ee):he)))}catch(ee){console.error(" Failed to send message:",ee);const re=ee instanceof Error?ee.message:"Failed to send message";n(he=>he.map(Se=>Se.localId===Z?{...Se,pending:!1,error:re}:Se)),p(re)}},[t,v]),A=b.useCallback(async()=>{!i||d||!t||await k(x)},[i,d,t,x,k]),w=b.useCallback(async(I,B)=>{var ue;const G=e.find(q=>q._id===I);if((ue=G==null?void 0:G.reactions)==null?void 0:ue.some(q=>q.emoji===B&&q.userId===v)){E(I,q=>({...q,reactions:(q.reactions??[]).filter(ee=>!(ee.emoji===B&&ee.userId===v))}));try{await Ly(I,B)}catch(q){console.error(" Failed to remove reaction:",q),k()}return}E(I,q=>({...q,reactions:[...q.reactions??[],{emoji:B,userId:v??"me",createdAt:new Date().toISOString()}]}));try{await iE(I,B)}catch(q){console.error(" Failed to add reaction:",q),await Ly(I,B).catch(()=>{}),k()}},[e,E,v,k]),j=b.useCallback(async(I,B)=>{console.log(` Toggling pin for message ${I}, shouldPin: ${B}`),E(I,G=>({...G,isPinned:B}));try{let G;B?(console.log(` Pinning message ${I}...`),G=await sE(I)):(console.log(` Unpinning message ${I}...`),G=await aE(I)),console.log(" Pin toggle successful, response:",G),E(I,()=>La(G)),await k()}catch(G){console.error(" Failed to toggle pin:",G),E(I,Z=>({...Z,isPinned:!B}))}},[E,k]),R=b.useCallback(async(I,B)=>{E(I,G=>({...G,text:B,isEdited:!0}));try{await tE(I,B)}catch(G){console.error(" Failed to edit message:",G),k()}},[E,k]),N=b.useCallback(async I=>{const B=e;E(I,()=>null);try{await nE(I)}catch(G){console.error(" Failed to delete message:",G),n(B)}},[e,E]),L=b.useCallback(async I=>{E(I,B=>({...B,isRevoked:!0,revokedAt:new Date().toISOString(),revokedBy:v??void 0,text:null,imageUrl:void 0}));try{const B=await oE(I);E(I,()=>La(B))}catch(B){console.error(" Failed to revoke message:",B),k()}},[E,v,k]),F=b.useCallback(async I=>{E(I,B=>({...B,isStarred:!0}));try{const B=await rE(I);E(I,()=>La(B))}catch(B){console.error(" Failed to star message:",B),k()}},[E,k]),D=ia(e);return b.useMemo(()=>({messages:D,loading:l,error:m,currentUserId:v,hasMore:i,sendMessage:O,reload:()=>k(0),loadOlder:A,markConversationAsRead:_,reactToMessage:w,togglePinMessage:j,editMessageContent:R,deleteMessageById:N,revokeMessageById:L,starMessageById:F}),[D,l,m,v,i,O,k,A,_,w,j,R,N,L,F])}function x9(t){const[e,n]=b.useState(null),[i,r]=b.useState(!1),[l,u]=b.useState(null),d=b.useCallback(async()=>{var f,m,p,v,C;if(!t){n(null);return}try{r(!0),u(null);const x=await Rm(t);n({conversationId:t,userId:(f=x.user)==null?void 0:f._id,name:((m=x.user)==null?void 0:m.name)??"Ngi dng",avatar:((p=x.user)==null?void 0:p.avatar)??void 0,status:(v=x.status)!=null&&v.isOnline?"online":"offline",lastSeen:(C=x.status)==null?void 0:C.lastActive})}catch(x){console.error(" Failed to load opponent info:",x),u(x instanceof Error?x.message:"Failed to load opponent info")}finally{r(!1)}},[t]);return b.useEffect(()=>{d()},[d]),{info:e,loading:i,error:l,reload:d}}function b6(t,e){const[n,i]=b.useState([]),r=b.useRef(null);b.useEffect(()=>{if(!t)return;const f=hi();if(!f)return;const m=v=>{v.conversationId===t&&v.userId!==e&&i(C=>C.some(S=>S.userId===v.userId)?C:[...C,{userId:v.userId,name:v.userName}])},p=v=>{v.conversationId===t&&i(C=>C.filter(x=>x.userId!==v.userId))};return f.on("typing:start",m),f.on("typing:stop",p),()=>{f.off("typing:start",m),f.off("typing:stop",p)}},[t,e]);const l=b.useCallback(()=>{if(!t)return;const f=hi();f&&(f.emit("typing:stop",{conversationId:t}),r.current&&(clearTimeout(r.current),r.current=null))},[t]),u=b.useCallback(f=>{if(!t)return;const m=hi();m&&(f.trim().length>0?(m.emit("typing:start",{conversationId:t}),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{l()},3e3)):l())},[t,l]),d=b.useCallback(()=>{l()},[l]);return{typingUsers:n,handleInputChange:u,notifyMessageSent:d}}function Hm(t){var e;if(typeof window<"u"&&((e=window.electronAPI)!=null&&e.showNotification))return window.electronAPI.showNotification({...t,onClick:t.conversationId?{conversationId:t.conversationId}:void 0});if("Notification"in window&&Notification.permission==="granted"){const n=new Notification(t.title||"Tin nhn mi",{body:t.body,icon:t.icon});return t.conversationId&&(n.onclick=()=>{window.focus();const i=new CustomEvent("navigate-to-conversation",{detail:{conversationId:t.conversationId}});window.dispatchEvent(i)}),Promise.resolve(!0)}return Promise.resolve(!1)}async function C6(){if(typeof window>"u")return!1;if(window.electronAPI)return!0;if("Notification"in window){if(Notification.permission==="granted")return!0;if(Notification.permission==="default")return await Notification.requestPermission()==="granted"}return!1}function x6(t){const e=b.useRef(!0),n=b.useRef(!1);b.useEffect(()=>{n.current||(C6(),n.current=!0);const i=()=>{e.current=!0},r=()=>{e.current=!1};return window.addEventListener("focus",i),window.addEventListener("blur",r),()=>{window.removeEventListener("focus",i),window.removeEventListener("blur",r)}},[]),b.useEffect(()=>{const i=hi();if(!i)return;const r=l=>{var v;const{conversationId:u,message:d}=l,f=u===t,m=d.senderId===localStorage.getItem("user_id"),p=!f||!e.current;if(!m&&p){const C=((v=d.sender)==null?void 0:v.name)||"Ai ",x=d.text||(d.imageUrl?" Hnh nh":"Tin nhn");Hm({title:C,body:x.length>100?x.substring(0,100)+"...":x,conversationId:u})}};return i.on("message:new",r),i.on("newMessage",r),i.on("chatMessage",r),()=>{i.off("message:new",r),i.off("newMessage",r),i.off("chatMessage",r)}},[t]),b.useEffect(()=>{const i=hi();if(!i)return;const r=l=>{const u=l.actorName||"Ngi dng";let d="";switch(l.type){case"POST_LIKED":d=`${u}  thch bi vit ca bn`;break;case"POST_COMMENTED":d=`${u}  bnh lun bi vit ca bn`;break;case"FRIEND_REQUEST":d=`${u}  gi li mi kt bn`;break;case"FRIEND_ACCEPTED":d=`${u}  chp nhn li mi kt bn`;break;default:d="Bn c thng bo mi"}Hm({title:"Day2 Social",body:d})};return i.on("social:notification",r),()=>{i.off("social:notification",r)}},[])}function S9({conversationId:t,conversationName:e,isGroup:n,groupAvatar:i,groupMemberCount:r,memberIds:l,onTypingStart:u,onTypingStop:d}){const f=yn(),{messages:m,loading:p,error:v,currentUserId:C,hasMore:x,sendMessage:S,markConversationAsRead:k,loadOlder:E,reactToMessage:_,togglePinMessage:O,editMessageContent:A,deleteMessageById:w,revokeMessageById:j,starMessageById:R}=y6(t),N=!n,{info:L}=x9(N?t:void 0),F=b6(t,C??void 0);x6(t);const[D,I]=b.useState(null),[B,G]=b.useState(null),[Z,ue]=b.useState(""),[q,ee]=b.useState(null),[re,he]=b.useState(null),[Se,P]=b.useState(!1);b.useEffect(()=>{k()},[k]),b.useEffect(()=>{v&&console.error("Chat error:",v)},[v]),b.useEffect(()=>{I(null),ee(null),ue("")},[t]);const K=n?e??"Nhm":(L==null?void 0:L.name)??e??"ang ti...",ae=n?`${r??0} thnh vin`:L?L.status==="online"?"ang hot ng":L.lastSeen?`Hot ng: ${new Date(L.lastSeen).toLocaleString("vi-VN")}`:"Khng hot ng":"ang ti...",le=async V=>{if(q){V.text&&V.text.trim()&&await A(q._id,V.text.trim()),ee(null),ue("");return}await S({...V,replyTo:D==null?void 0:D._id}),I(null),ue(""),F.notifyMessageSent(),d==null||d()},Te=()=>{if(n||!C)return;if(L!=null&&L.userId&&L.userId!==C)return L.userId;const V=l==null?void 0:l.find(be=>be&&be!==C);if(V)return V;const ve=m.find(be=>be.senderId&&be.senderId!==C);if(ve!=null&&ve.senderId)return ve.senderId},ce=async()=>{var ve;if(!C)return;const V=Te();if(!n&&!V){console.warn("[DesktopChat] Cannot determine target user for video call");return}try{console.log("[DesktopChat] Initiating video call...",{isGroup:n,targetUserId:V});const be=await Py(t,"video",V);console.log("[DesktopChat] Call initiated:",be),(ve=be.call)!=null&&ve.id?(console.log("[DesktopChat] Navigating to call screen:",be.call.id),f(`/call/${be.call.id}`,{state:{conversationId:t,initiatorId:C,remoteUserId:V||"",type:"video",callType:be.call.callType||"p2p",livekitRoomName:be.call.livekitRoomName,isInitiator:!0}})):console.error("[DesktopChat] No call ID in response:",be)}catch(be){console.error("[DesktopChat] Error initiating video call:",be)}},_e=async()=>{var ve;if(!C)return;const V=Te();if(!n&&!V){console.warn("[DesktopChat] Cannot determine target user for audio call");return}try{console.log("[DesktopChat] Initiating audio call...",{isGroup:n,targetUserId:V});const be=await Py(t,"audio",V);console.log("[DesktopChat] Call initiated:",be),(ve=be.call)!=null&&ve.id?(console.log("[DesktopChat] Navigating to call screen:",be.call.id),f(`/call/${be.call.id}`,{state:{conversationId:t,initiatorId:C,remoteUserId:V||"",type:"audio",callType:be.call.callType||"p2p",livekitRoomName:be.call.livekitRoomName,isInitiator:!0}})):console.error("[DesktopChat] No call ID in response:",be)}catch(be){console.error("[DesktopChat] Error initiating audio call:",be)}};return o.jsxs(o.Fragment,{children:[o.jsx(i6,{header:o.jsx(s6,{title:K,subtitle:ae,avatar:n?i:L==null?void 0:L.avatar,statusDotColor:!n&&(L==null?void 0:L.status)==="online"?"#10B981":void 0,onVideoCall:ce,onAudioCall:_e,onToggleInfo:()=>P(!Se),isInfoVisible:Se}),messageArea:o.jsxs(o.Fragment,{children:[o.jsx(h6,{messages:m,currentUserId:C,loading:p,hasMore:x,opponentName:L==null?void 0:L.name,opponentAvatar:L==null?void 0:L.avatar,onLoadMore:E,onReply:V=>{ee(null),I(V),ue("")},onReact:(V,ve)=>_(V,ve),onTogglePin:(V,ve)=>O(V,ve),onEdit:V=>{I(null),ee(V),ue(V.text??"")},onDelete:V=>{w(V._id)},onForward:V=>{he(V)},onStar:V=>{V.isStarred||R(V._id)},onRevoke:V=>{j(V._id)},onScrollToMessage:V=>{G(V),E()},focusMessageId:B,onFocusHandled:()=>G(null)}),o.jsx(m6,{users:F.typingUsers})]}),composer:o.jsx(f6,{disabled:p,replyPreview:D==null?void 0:D.text,editingLabel:q?"Chnh sa tin nhn":void 0,value:Z,onValueChange:V=>{ue(V),F.handleInputChange(V),V.trim()?u==null||u():d==null||d()},onCancelReply:()=>I(null),onCancelEdit:()=>{ee(null),ue("")},onSend:le}),rightPanel:!n&&Se?o.jsx(g6,{conversationId:t,opponentName:L==null?void 0:L.name,opponentAvatar:L==null?void 0:L.avatar,messages:m,onClose:()=>P(!1)}):null}),o.jsx(p6,{message:re,onClose:()=>he(null),onForwarded:()=>{he(null)}})]})}function S6({isOpen:t,onClose:e,onCreated:n}){const[i,r]=b.useState(""),[l,u]=b.useState([]),[d,f]=b.useState([]),[m,p]=b.useState(""),[v,C]=b.useState(!1),[x,S]=b.useState(!1),[k,E]=b.useState(null),[_,O]=b.useState(null),A=b.useMemo(()=>localStorage.getItem("user_id")||"",[]);b.useEffect(()=>{if(!t){r(""),u([]),f([]),p(""),E(null),O(null),C(!1),S(!1);return}p("")},[t]),b.useEffect(()=>{d.length<2&&m&&p("")},[d.length,m]),b.useEffect(()=>{let D=!0;if(!t)return;if(i.trim().length<2){u([]),O("Nhp t nht 2 k t  tm kim"),E(null);return}async function I(){C(!0),O(null);try{const G=await fC(i.trim());if(!D)return;const Z=G.users.filter(ue=>ue._id!==A);u(Z),E(Z.length===0?"Khng tm thy ngi dng ph hp":null)}catch(G){if(console.error("Search users error:",G),!D)return;E("Khng th tm kim lc ny, th li sau")}finally{D&&C(!1)}}const B=setTimeout(I,350);return()=>{D=!1,clearTimeout(B)}},[i,t,A]);const w=D=>d.some(I=>I._id===D),j=D=>{f(I=>I.some(B=>B._id===D._id)?I.filter(B=>B._id!==D._id):[...I,D])},R=d.map(D=>D._id),N=async()=>{var D,I;if(d.length===0){E("Hy chn t nht mt ngi dng");return}S(!0),E(null);try{let B;d.length===1?B=await WT(d[0]._id):B=await GT(R,m.trim()||void 0),n==null||n(B),e()}catch(B){console.error("Create conversation error:",B);const G=((I=(D=B==null?void 0:B.response)==null?void 0:D.data)==null?void 0:I.error)||(B==null?void 0:B.message);E(G||"Khng th to cuc tr chuyn, th li sau")}finally{S(!1)}};if(!t)return null;const L=d.length>=1&&!x,F=d.length>=2;return o.jsx("div",{className:"new-conversation-modal-overlay",role:"dialog","aria-modal":"true",children:o.jsxs("div",{className:"new-conversation-modal",children:[o.jsxs("header",{className:"new-conversation-modal__header",children:[o.jsxs("div",{children:[o.jsx("h2",{children:"To cuc tr chuyn"}),o.jsx("p",{children:"Chn mt hoc nhiu ngi  bt u tr chuyn"})]}),o.jsx("button",{className:"modal-close-btn",onClick:e,"aria-label":"ng",children:""})]}),o.jsxs("div",{className:"new-conversation-modal__body",children:[F&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"groupName",children:"Tn nhm"}),o.jsx("input",{id:"groupName",type:"text",value:m,onChange:D=>p(D.target.value),placeholder:"V d: Nhm d n, Team marketing..."}),o.jsx("span",{className:"hint",children:"Nhm s xut hin khi bn chn t 2 ngi tr ln"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"searchUsers",children:"Tm kim ngi dng"}),o.jsx("input",{id:"searchUsers",type:"text",value:i,onChange:D=>r(D.target.value),placeholder:"Nhp tn, email hoc username"})]}),v&&o.jsx("div",{className:"hint",children:"ang tm kim..."}),_&&!v&&o.jsx("div",{className:"hint",children:_}),k&&!v&&o.jsx("div",{className:"error-message",children:k}),o.jsx("div",{className:"search-results",children:l.map(D=>{var I,B;return o.jsxs("button",{type:"button",className:`search-result-item ${w(D._id)?"selected":""}`,onClick:()=>j(D),children:[o.jsx("div",{className:"result-avatar",children:D.avatar?o.jsx("img",{src:D.avatar,alt:D.name}):((B=(I=D.name)==null?void 0:I[0])==null?void 0:B.toUpperCase())||"?"}),o.jsxs("div",{className:"result-info",children:[o.jsx("div",{className:"result-name",children:D.name}),o.jsxs("div",{className:"result-subline",children:[D.email,D.username?`  @${D.username}`:""]})]}),w(D._id)&&o.jsx("span",{className:"result-check",children:""})]},D._id)})}),d.length>0&&o.jsx("div",{className:"selected-users",children:d.map(D=>o.jsxs("span",{className:"selected-chip",onClick:()=>j(D),children:[D.name,o.jsx("span",{className:"chip-remove",children:""})]},D._id))})]}),o.jsxs("footer",{className:"new-conversation-modal__footer",children:[o.jsx("button",{className:"secondary-btn",onClick:e,disabled:x,children:"Hy"}),o.jsx("button",{className:"primary-btn",onClick:N,disabled:!L,children:x?"ang to...":"To"})]})]})})}function k6({isOpen:t,onClose:e,onConfirm:n,conversation:i}){const[r,l]=b.useState(""),[u,d]=b.useState([]),[f,m]=b.useState(new Set),[p,v]=b.useState(!1),[C,x]=b.useState(!1),[S,k]=b.useState(null);b.useEffect(()=>{t||(l(""),d([]),m(new Set),k(null))},[t]),b.useEffect(()=>{let O=!0;if(!t||r.trim().length<2){d([]);return}return(async()=>{v(!0);try{const A=await fC(r.trim());if(!O)return;const w=new Set(i.members.map(R=>String(R))),j=A.users.filter(R=>!w.has(R._id));d(j)}catch(A){console.error("Search users error",A),O&&k("Khng th tm kim ngi dng, th li sau")}finally{O&&v(!1)}})(),()=>{O=!1}},[t,r,i.members]);const E=O=>{m(A=>{const w=new Set(A);return w.has(O)?w.delete(O):w.add(O),w})},_=async()=>{var O,A;if(f.size===0){k("Hy chn t nht mt ngi");return}try{x(!0),await n(Array.from(f)),e()}catch(w){console.error("Add members error",w),k(((A=(O=w==null?void 0:w.response)==null?void 0:O.data)==null?void 0:A.error)||"Khng th thm thnh vin")}finally{x(!1)}};return t?o.jsx("div",{className:"group-modal-overlay",children:o.jsxs("div",{className:"group-modal",children:[o.jsxs("header",{className:"group-modal__header",children:[o.jsx("h2",{children:"Thm thnh vin"}),o.jsx("button",{onClick:e,children:""})]}),o.jsxs("div",{className:"group-modal__body",children:[o.jsx("input",{type:"text",placeholder:"Nhp tn/email  tm kim",value:r,onChange:O=>l(O.target.value)}),p&&o.jsx("div",{className:"hint",children:"ang tm..."}),S&&o.jsx("div",{className:"error-message",children:S}),o.jsxs("div",{className:"group-modal__list",children:[u.map(O=>o.jsxs("button",{type:"button",className:`group-modal__item ${f.has(O._id)?"selected":""}`,onClick:()=>E(O._id),children:[o.jsx("div",{className:"member-avatar",children:O.avatar?o.jsx("img",{src:O.avatar,alt:O.name}):O.name.slice(0,2).toUpperCase()}),o.jsxs("div",{className:"member-meta",children:[o.jsx("div",{children:O.name}),o.jsx("span",{className:"member-email",children:O.email})]}),f.has(O._id)&&o.jsx("span",{children:""})]},O._id)),!p&&u.length===0&&r.length>=2&&o.jsx("div",{className:"hint",children:"Khng tm thy ngi dng no"})]})]}),o.jsxs("footer",{className:"group-modal__footer",children:[o.jsx("button",{className:"secondary-btn",onClick:e,disabled:C,children:"Hy"}),o.jsx("button",{className:"primary-btn",onClick:_,disabled:C,children:C?"ang thm...":"Thm thnh vin"})]})]})}):null}function T6({isOpen:t,onClose:e,onSave:n,initialTitle:i,initialAvatar:r}){const[l,u]=b.useState(i||""),[d,f]=b.useState(r||""),[m,p]=b.useState(null),[v,C]=b.useState(!1);b.useEffect(()=>{t&&(u(i||""),f(r||""),p(null))},[t,i,r]);const x=async()=>{var S,k;if(!l.trim()){p("Tn nhm khng c  trng");return}try{C(!0),await n({title:l.trim(),avatar:d.trim()||void 0}),e()}catch(E){console.error("Update group info error",E),p(((k=(S=E==null?void 0:E.response)==null?void 0:S.data)==null?void 0:k.error)||"Khng th cp nht nhm")}finally{C(!1)}};return t?o.jsx("div",{className:"group-modal-overlay",children:o.jsxs("div",{className:"group-modal",children:[o.jsxs("header",{className:"group-modal__header",children:[o.jsx("h2",{children:"Chnh sa nhm"}),o.jsx("button",{onClick:e,children:""})]}),o.jsxs("div",{className:"group-modal__body",children:[m&&o.jsx("div",{className:"error-message",children:m}),o.jsx("label",{children:"Tn nhm"}),o.jsx("input",{value:l,onChange:S=>u(S.target.value),placeholder:"Nhp tn nhm mi"}),o.jsx("label",{children:"nh nhm (URL)"}),o.jsx("input",{value:d,onChange:S=>f(S.target.value),placeholder:"https://..."}),d&&o.jsx("div",{className:"preview-avatar",children:o.jsx("img",{src:d,alt:"preview"})})]}),o.jsxs("footer",{className:"group-modal__footer",children:[o.jsx("button",{className:"secondary-btn",onClick:e,disabled:v,children:"Hy"}),o.jsx("button",{className:"primary-btn",onClick:x,disabled:v,children:v?"ang lu...":"Lu"})]})]})}):null}function db({isOpen:t,title:e,description:n,confirmLabel:i="Xc nhn",onClose:r,onConfirm:l,variant:u="danger"}){if(!t)return null;const d=async()=>{await l(),r()};return o.jsx("div",{className:"group-modal-overlay",children:o.jsxs("div",{className:"group-modal",children:[o.jsxs("header",{className:"group-modal__header",children:[o.jsx("h2",{children:e}),o.jsx("button",{onClick:r,children:""})]}),o.jsx("div",{className:"group-modal__body",children:o.jsx("p",{children:n})}),o.jsxs("footer",{className:"group-modal__footer",children:[o.jsx("button",{className:"secondary-btn",onClick:r,children:"Hy"}),o.jsx("button",{className:`primary-btn ${u==="danger"?"danger":""}`,onClick:d,children:i})]})]})})}const E6="0.0.0",w6={version:E6},j6=w6.version;function R6(){var Te,ce,_e;console.log(" ConversationsScreen component rendering...");const t=yn(),[e,n]=b.useState([]),[i,r]=b.useState(null),[l,u]=b.useState(!0),[d,f]=b.useState(""),[m,p]=b.useState("all"),[v,C]=b.useState(!1),[x,S]=b.useState(!1),[k,E]=b.useState(!1),[_,O]=b.useState(!1),[A,w]=b.useState(null),[j,R]=b.useState(null),[N,L]=b.useState(!1);b.useEffect(()=>{console.log(" ConversationsScreen useEffect - loading conversations...");const V=localStorage.getItem("auth_token");if(V){const ve=hi();if(!ve||!ve.connected){console.log(" Connecting socket...");const be=AC(V);be instanceof Promise?be.then(Ue=>{Ue&&console.log(" Socket connected successfully")}):be&&console.log(" Socket connected successfully")}else console.log(" Socket already connected")}F()},[]),b.useEffect(()=>{const V=ve=>{const be=ve.detail,Ue=be==null?void 0:be.conversation;if(!(Ue!=null&&Ue._id)){console.warn("[Conversations] Received deep link join event without conversation payload");return}console.log("[Conversations] Deep link joined conversation:",Ue._id),n(et=>{const At=et.findIndex(Dt=>Dt._id===Ue._id);if(At===-1)return[Ue,...et];const mt=[...et];return mt[At]=Ue,mt}),r(Ue)};return window.addEventListener("conversation:joined",V),()=>{window.removeEventListener("conversation:joined",V)}},[]);const F=async()=>{try{u(!0),console.log(" Loading conversations from API...");const V=await Np();console.log(" Conversations loaded:",V.length,"items"),console.log(" Sample conversation:",V[0]?{_id:V[0]._id,isGroup:V[0].isGroup,title:V[0].title,opponent:V[0].opponent,lastMessageSender:V[0].lastMessageSender}:"No conversations"),n(V)}catch(V){console.error(" Error loading conversations:",V)}finally{u(!1),console.log(" Loading complete, loading state:",!1)}},D=()=>{t("/feed")},I=async()=>{try{const V=localStorage.getItem("auth_token");V&&await hC(V),localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),localStorage.removeItem("user_data"),Pu(),Lm(),window.location.href="/login"}catch(V){console.error("Logout error:",V),localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),localStorage.removeItem("user_data"),Pu(),Lm(),window.location.href="/login"}},B=e.filter(V=>m==="groups"?V.isGroup:m==="direct"?!V.isGroup:!0).filter(V=>{var be,Ue;if(!d)return!0;const ve=d.toLowerCase();return((be=V.title)==null?void 0:be.toLowerCase().includes(ve))||((Ue=V.lastMessageSender)==null?void 0:Ue.name.toLowerCase().includes(ve))}),G=V=>{if(!V)return"";const ve=new Date(V),Ue=new Date().getTime()-ve.getTime(),et=Math.floor(Ue/(1e3*60*60*24));return et===0?ve.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):et===1?"Hm qua":et<7?ve.toLocaleDateString("vi-VN",{weekday:"short"}):ve.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit"})},Z=V=>V.split(" ").map(ve=>ve[0]).join("").toUpperCase().slice(0,2),ue=V=>{var Ue,et,At,mt;if(V.isGroup)return"";const ve=((Ue=V.opponent)==null?void 0:Ue.avatar)||((et=V.lastMessageSender)==null?void 0:et.avatar);if(ve)return o.jsx("img",{src:ve,alt:"",className:"conversation-avatar-img"});const be=V.title||((At=V.opponent)==null?void 0:At.name)||((mt=V.lastMessageSender)==null?void 0:mt.name)||"U";return Z(be)},q=V=>{r(V)},ee=()=>{C(!0)},re=V=>{n(ve=>{const be=ve.filter(Ue=>Ue._id!==V._id);return[V,...be]}),r(V)},he=V=>{r(V),n(ve=>{const be=ve.findIndex(et=>et._id===V._id);if(be===-1)return[V,...ve];const Ue=[...ve];return Ue[be]=V,Ue})},Se=async V=>{if(!i)return;const ve=await ZT(i._id,V);he(ve)},P=async V=>{if(!i)return;const ve=await eE(i._id,V);he(ve)},K=async()=>{if(!(!i||!A))try{let V=null;A.type==="remove"?V=await YT(i._id,A.userId):A.type==="makeAdmin"?V=await QT(i._id,A.userId):A.type==="removeAdmin"&&(V=await XT(i._id,A.userId)),V&&he(V)}catch(V){console.error("Member action error:",V)}finally{w(null)}},ae=async()=>{if(i)try{await JT(i._id),r(null),F()}catch(V){console.error("Leave group error:",V)}finally{O(!1)}};(ce=(Te=import.meta)==null?void 0:Te.env)!=null&&ce.VITE_INVITE_BASE_URL,console.log(" ConversationsScreen render - loading:",l,"conversations:",e.length),!l&&e.length===0&&console.log(" No conversations, showing empty state");const le=i?"center-panel center-panel--chat-active":"center-panel";return o.jsxs("div",{className:"desktop-layout",children:[o.jsxs("div",{className:"left-panel",children:[o.jsxs("div",{className:"desktop-header",children:[o.jsxs("h1",{className:"desktop-header-title",children:["Day2",o.jsxs("span",{className:"desktop-header-version",children:["v",j6]})]}),o.jsxs("div",{className:"desktop-header-actions",children:[o.jsx("button",{className:"header-button",title:"Mng x hi Day2",onClick:D,children:""}),o.jsx("button",{className:"header-button",onClick:()=>t("/settings"),children:""}),o.jsx("button",{className:"header-button",onClick:I,children:""})]})]}),o.jsx("div",{className:"search-container",children:o.jsx("input",{type:"text",placeholder:"Tm kim...",className:"search-input",value:d,onChange:V=>f(V.target.value)})}),o.jsx("div",{className:"new-chat-actions single",children:o.jsx("button",{className:"new-chat-button",onClick:ee,children:"+ To cuc tr chuyn"})}),o.jsxs("div",{className:"tabs-container",children:[o.jsx("button",{className:`tab ${m==="all"?"active":""}`,onClick:()=>p("all"),children:"Tt c"}),o.jsx("button",{className:`tab ${m==="direct"?"active":""}`,onClick:()=>p("direct"),children:"Tin nhn"}),o.jsx("button",{className:`tab ${m==="groups"?"active":""}`,onClick:()=>p("groups"),children:"Nhm"})]}),o.jsx("div",{className:"conversations-list",children:l?o.jsx("div",{style:{padding:20,textAlign:"center",color:"#999"},children:"ang ti..."}):B.length===0?o.jsx("div",{style:{padding:20,textAlign:"center",color:"#999"},children:"Khng c cuc tr chuyn"}):B.map(V=>{var ve,be,Ue;return o.jsxs("div",{className:`conversation-item ${(i==null?void 0:i._id)===V._id?"selected":""}`,onClick:()=>q(V),children:[o.jsx("div",{className:"conversation-avatar",children:ue(V)}),o.jsxs("div",{className:"conversation-content",children:[o.jsxs("div",{className:"conversation-header",children:[o.jsx("span",{className:"conversation-name",children:V.isGroup?V.title||`Nhm (${V.members.length})`:V.title||((ve=V.opponent)==null?void 0:ve.name)||((be=V.lastMessageSender)==null?void 0:be.name)||"Ngi dng"}),V.lastMessageAt&&o.jsx("span",{className:"conversation-time",children:G(V.lastMessageAt)})]}),o.jsx("div",{className:"conversation-preview",children:(Ue=V.lastMessageSender)!=null&&Ue.name?`${V.lastMessageSender.name}: `:""})]})]},V._id)})})]}),o.jsx("div",{className:le,children:i?o.jsx(S9,{conversationId:i._id,conversationName:i.isGroup?i.title||`Nhm (${i.members.length})`:i.title||((_e=i.opponent)==null?void 0:_e.name)||"Ngi dng",isGroup:i.isGroup,groupAvatar:i.groupAvatar,groupMemberCount:i.members.length,memberIds:i.members}):o.jsxs("div",{className:"empty-chat-area",children:[o.jsx("div",{className:"empty-chat-title",children:"Chn mt cuc tr chuyn"}),o.jsx("div",{className:"empty-chat-subtitle",children:"Chn mt cuc tr chuyn t danh sch  bt u nhn tin"})]})}),o.jsx(S6,{isOpen:v,onClose:()=>C(!1),onCreated:re}),i&&i.isGroup&&o.jsxs(o.Fragment,{children:[o.jsx(k6,{isOpen:x,onClose:()=>S(!1),onConfirm:Se,conversation:i}),o.jsx(T6,{isOpen:k,onClose:()=>E(!1),onSave:P,initialTitle:i.title,initialAvatar:i.groupAvatar}),o.jsx(db,{isOpen:!!A,onClose:()=>w(null),onConfirm:K,title:(A==null?void 0:A.type)==="remove"?"Xa thnh vin":(A==null?void 0:A.type)==="makeAdmin"?"Chn lm admin":"B quyn admin",description:(A==null?void 0:A.type)==="remove"?"Bn chc chn mun xa thnh vin ny khi nhm?":(A==null?void 0:A.type)==="makeAdmin"?"Trao quyn admin cho thnh vin ny?":"B quyn admin ca thnh vin ny?",confirmLabel:(A==null?void 0:A.type)==="remove"?"Xa khi nhm":(A==null?void 0:A.type)==="makeAdmin"?"Chn lm admin":"B admin",variant:(A==null?void 0:A.type)==="remove"?"danger":"default"}),o.jsx(db,{isOpen:_,onClose:()=>O(!1),onConfirm:ae,title:"Ri nhm",description:"Bn chc chn mun ri khi nhm ny?",confirmLabel:"Ri nhm",variant:"danger"})]})]})}function N6(){const{conversationId:t}=wl();return t?o.jsx(S9,{conversationId:t}):o.jsx("div",{style:{width:"100%",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",backgroundColor:"#0f172a"},children:"Khng tm thy cuc tr chuyn."})}const _6=(t=6)=>{const[e,n]=b.useState([]),[i,r]=b.useState(!1),l=b.useCallback(async()=>{r(!0);try{const u=await E8(t);n(u.suggestions||[])}catch(u){console.error("Failed to load friend suggestions",u)}finally{r(!1)}},[t]);return b.useEffect(()=>{l()},[l]),b.useEffect(()=>{const u=window.__socket;if(!u)return;const d=()=>l();return u.on("social:suggestions:refresh",d),()=>{u.off("social:suggestions:refresh",d)}},[l]),{items:e,isLoading:i,reload:l}},k9=t=>{const[e,n]=b.useState([]),[i,r]=b.useState(null),[l,u]=b.useState(!0),[d,f]=b.useState(!1),m=b.useCallback(async(v=!1)=>{if(!d&&!(!l&&!v)){f(!0);try{const C=await b8(t,v?void 0:i||void 0);u(C.hasNext),r(C.nextCursor),n(x=>v?C.items:[...x,...C.items])}finally{f(!1)}}},[i,l,d,t]),p=b.useCallback(async v=>{const C=await y8(t,{content:v});n(x=>[C,...x])},[t]);return{items:e,hasNext:l,isLoading:d,loadMore:m,createComment:p}},A6=()=>{const[t,e]=b.useState([]),[n,i]=b.useState(null),[r,l]=b.useState(!0),[u,d]=b.useState(!1),[f,m]=b.useState({}),p=b.useCallback(async(k=!1)=>{if(!u&&!(!r&&!k)){d(!0);try{const E=await T8(k?void 0:n||void 0);l(E.hasNext),i(E.nextCursor),e(O=>k?E.items:[...O,...E.items]);const _={};E.items.forEach(O=>{_[O._id]=O.currentUserReaction||null}),m(O=>k?_:{...O,..._})}catch(E){console.error("Failed to load saved posts",E)}finally{d(!1)}}},[n,r,u]);b.useEffect(()=>{p(!0)},[]);const v=b.useCallback((k,E,_)=>{e(O=>O.map(A=>{if(A._id!==k)return A;const w={...A.reactionCounts||{}};_&&(w[_]=Math.max(0,(w[_]||0)-1)),E&&(w[E]=(w[E]||0)+1);const j=Object.values(w).reduce((R,N)=>R+(N||0),0);return{...A,reactionCounts:w,likeCount:j}}))},[]),C=b.useCallback(async(k,E)=>{const _=f[k]||null;m(O=>({...O,[k]:E})),v(k,E,_);try{await Up(k,E)}catch(O){console.error("Failed to react",O),m(A=>({...A,[k]:_})),v(k,_,E)}},[f,v]),x=b.useCallback(async k=>{const E=f[k]||null;if(E){m(_=>({..._,[k]:null})),v(k,null,E);try{await Bp(k)}catch(_){console.error("Failed to remove reaction",_),m(O=>({...O,[k]:E})),v(k,E,null)}}},[f,v]),S=b.useCallback(async k=>{await d9(k),e(E=>E.filter(_=>_._id!==k))},[]);return{items:t,hasNext:r,isLoading:u,loadMore:p,unsave:S,reactionMap:f,selectReaction:C,clearReaction:x}},M6=({size:t=24,className:e,color:n="#0966FF"})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M51.634 25.7258C50.3759 24.7581 48.6241 24.7581 47.366 25.7258L27.366 41.1104C26.5047 41.773 26 42.798 26 43.8846V71.9302C26 73.8632 27.567 75.4302 29.5 75.4302H69.5C71.433 75.4302 73 73.8632 73 71.9302V43.8846C73 42.798 72.4953 41.773 71.634 41.1104L51.634 25.7258ZM44.3175 21.7627C47.3728 19.4124 51.6272 19.4124 54.6825 21.7627L74.6825 37.1473C76.7743 38.7563 78 41.2456 78 43.8846V71.9302C78 76.6246 74.1944 80.4302 69.5 80.4302H29.5C24.8056 80.4302 21 76.6246 21 71.9302V43.8846C21 41.2456 22.2257 38.7563 24.3175 37.1473L44.3175 21.7627Z",fill:n}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38 57.9302C38 54.3403 40.9101 51.4302 44.5 51.4302H53.5C57.0899 51.4302 60 54.3403 60 57.9302V77.9302H55V57.9302C55 57.1017 54.3284 56.4302 53.5 56.4302H44.5C43.6716 56.4302 43 57.1017 43 57.9302V77.9302H38V57.9302Z",fill:n})]}),T9=({size:t=24,className:e,color:n="#0966FF"})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.5 66.6667C19.5 59.3949 25.3949 53.5 32.6667 53.5H45.3333C52.6051 53.5 58.5 59.3949 58.5 66.6667C58.5 70.9929 54.9929 74.5 50.6667 74.5H27.3333C23.0071 74.5 19.5 70.9929 19.5 66.6667ZM32.6667 58.5C28.1563 58.5 24.5 62.1563 24.5 66.6667C24.5 68.2315 25.7685 69.5 27.3333 69.5H50.6667C52.2315 69.5 53.5 68.2315 53.5 66.6667C53.5 62.1563 49.8437 58.5 45.3333 58.5H32.6667Z",fill:n}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M62.5 60C62.5 58.6193 63.6193 57.5 65 57.5H70C75.799 57.5 80.5 62.201 80.5 68C80.5 71.5899 77.5899 74.5 74 74.5H65C63.6193 74.5 62.5 73.3807 62.5 72C62.5 70.6193 63.6193 69.5 65 69.5H74C74.8284 69.5 75.5 68.8284 75.5 68C75.5 64.9624 73.0376 62.5 70 62.5H65C63.6193 62.5 62.5 61.3807 62.5 60Z",fill:n}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M39 29.5C34.8579 29.5 31.5 32.8579 31.5 37C31.5 41.1421 34.8579 44.5 39 44.5C43.1421 44.5 46.5 41.1421 46.5 37C46.5 32.8579 43.1421 29.5 39 29.5ZM26.5 37C26.5 30.0964 32.0964 24.5 39 24.5C45.9036 24.5 51.5 30.0964 51.5 37C51.5 43.9036 45.9036 49.5 39 49.5C32.0964 49.5 26.5 43.9036 26.5 37Z",fill:n}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M64 40.5C62.067 40.5 60.5 42.067 60.5 44C60.5 45.933 62.067 47.5 64 47.5C65.933 47.5 67.5 45.933 67.5 44C67.5 42.067 65.933 40.5 64 40.5ZM55.5 44C55.5 39.3056 59.3056 35.5 64 35.5C68.6944 35.5 72.5 39.3056 72.5 44C72.5 48.6944 68.6944 52.5 64 52.5C59.3056 52.5 55.5 48.6944 55.5 44Z",fill:n})]}),O6=({size:t=24,className:e,color:n="#0966FF"})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.3415 49.5C20.3415 32.9315 33.7729 19.5 50.3415 19.5C66.91 19.5 80.3415 32.9315 80.3415 49.5C80.3415 66.0685 66.91 79.5 50.3415 79.5C44.4165 79.5 38.8868 77.7799 34.2321 74.812L24.6634 78.161C21.874 79.1373 19.2049 76.4305 20.2203 73.655L23.8812 63.6484C21.6221 59.4314 20.3415 54.612 20.3415 49.5ZM50.3415 24.5C36.5344 24.5 25.3415 35.6929 25.3415 49.5C25.3415 54.1245 26.5948 58.4486 28.7787 62.1596C29.1579 62.804 29.2288 63.5843 28.9719 64.2865L26.0058 72.3938L33.7576 69.6807C34.5173 69.4148 35.3585 69.5309 36.0177 69.9926C40.0736 72.8334 45.0092 74.5 50.3415 74.5C64.1486 74.5 75.3415 63.3071 75.3415 49.5C75.3415 35.6929 64.1486 24.5 50.3415 24.5Z",fill:n}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M43.632 42.6762C44.5013 41.8611 45.8252 41.773 46.7949 42.4657L55.5716 48.7347L61.574 42.7323C62.5503 41.7559 64.1333 41.7559 65.1096 42.7323C66.0859 43.7086 66.0859 45.2915 65.1096 46.2678L57.6096 53.7678C56.7454 54.6319 55.3832 54.7447 54.3887 54.0344L45.5565 47.7256L39.0517 53.8239C38.0444 54.7682 36.4623 54.7172 35.518 53.7099C34.5736 52.7026 34.6247 51.1205 35.632 50.1762L43.632 42.6762Z",fill:n})]}),bu=({size:t=24,className:e,color:n="#0966FF"})=>o.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:o.jsx("path",{d:"M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z",fill:n})}),D6=({size:t=24,className:e,color:n="#0966FF"})=>o.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:o.jsx("path",{d:"M21.99 4C21.99 2.9 21.1 2 20 2H4C2.9 2 2 2.9 2 4V16C2 17.1 2.9 18 4 18H18L22 22L21.99 4ZM18 14H6V12H18V14ZM18 11H6V9H18V11ZM18 8H6V6H18V8Z",fill:n})}),L6=({size:t=24,className:e,color:n="currentColor"})=>o.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:o.jsx("path",{d:"M12 22C13.1 22 14 21.1 14 20H10C10 21.1 10.9 22 12 22ZM18 16V11C18 7.93 16.37 5.36 13.5 4.68V4C13.5 3.17 12.83 2.5 12 2.5C11.17 2.5 10.5 3.17 10.5 4V4.68C7.64 5.36 6 7.92 6 11V16L4 18V19H20V18L18 16ZM16 17H8V11C8 8.52 9.51 6.5 12 6.5C14.49 6.5 16 8.52 16 11V17Z",fill:n})}),P6=()=>{const[t,e]=b.useState(!1),[n,i]=b.useState([]),[r,l]=b.useState(0),[u,d]=b.useState(!1),[f,m]=b.useState(new Set),p=b.useRef(null);b.useEffect(()=>{v();const E=setInterval(v,3e4);return()=>clearInterval(E)},[]),b.useEffect(()=>{const E=_=>{p.current&&!p.current.contains(_.target)&&e(!1)};return t&&document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[t]);const v=async()=>{try{d(!0);const E=await j8(void 0,20);i(E.items||[]);const _=(E.items||[]).filter(O=>!O.isRead).length;l(_)}catch(E){console.error("Failed to load notifications:",E)}finally{d(!1)}},C=async E=>{try{await R8(E),i(_=>_.map(O=>E.includes(O._id)?{...O,isRead:!0}:O)),l(_=>Math.max(0,_-E.length))}catch(_){console.error("Failed to mark read:",_)}},x=E=>{var O;const _=((O=E.actor)==null?void 0:O.name)||"Ai ";switch(E.type){case"POST_LIKED":return`${_}  thch bi vit ca bn`;case"POST_COMMENTED":return`${_}  bnh lun bi vit ca bn`;case"FRIEND_REQUEST":return`${_}  gi li mi kt bn`;case"FRIEND_ACCEPTED":return`${_}  chp nhn li mi kt bn`;default:return E.message||"Thng bo mi"}},S=E=>{const _=new Date(E),A=new Date().getTime()-_.getTime(),w=Math.floor(A/6e4),j=Math.floor(A/36e5),R=Math.floor(A/864e5);return w<1?"Va xong":w<60?`${w} pht trc`:j<24?`${j} gi trc`:R<7?`${R} ngy trc`:_.toLocaleDateString("vi-VN")},k=async(E,_)=>{var w,j;if(!E.entityId){console.error("No friendshipId in notification");return}const O=E.entityId,A=`${O}-${_}`;try{m(R=>new Set(R).add(A)),await m9(O,_),i(R=>R.filter(N=>N._id!==E._id)),l(R=>Math.max(0,R-1)),await v()}catch(R){console.error("Failed to respond to friend request:",R),alert(((j=(w=R==null?void 0:R.response)==null?void 0:w.data)==null?void 0:j.error)||(R==null?void 0:R.message)||"Khng th x l yu cu kt bn")}finally{m(R=>{const N=new Set(R);return N.delete(A),N})}};return o.jsxs("div",{className:"notifications-wrapper",ref:p,children:[o.jsxs("button",{className:"feed-icon-button notifications-button",onClick:()=>e(!t),title:"Thng bo",children:[o.jsx(L6,{size:20,color:"currentColor"}),r>0&&o.jsx("span",{className:"notifications-badge",children:r})]}),t&&o.jsxs("div",{className:"notifications-dropdown",children:[o.jsxs("div",{className:"notifications-header",children:[o.jsx("h3",{children:"Thng bo"}),r>0&&o.jsx("button",{className:"notifications-mark-all-read",onClick:()=>{const E=n.filter(_=>!_.isRead).map(_=>_._id);E.length>0&&C(E)},children:"nh du tt c  c"})]}),o.jsxs("div",{className:"notifications-list",children:[u&&o.jsx("div",{style:{padding:20,textAlign:"center"},children:"ang ti..."}),!u&&n.length===0&&o.jsx("div",{style:{padding:20,textAlign:"center",opacity:.7},children:"Khng c thng bo no."}),n.map(E=>{var R,N,L,F;const _=E.type==="FRIEND_REQUEST",O=E.entityId,A=f.has(`${O}-accept`),w=f.has(`${O}-decline`),j=A||w;return o.jsxs("div",{className:`notification-item ${E.isRead?"":"notification-item--unread"}`,onClick:D=>{D.target.closest(".notification-actions")||E.isRead||C([E._id])},children:[o.jsx("div",{className:"notification-avatar",children:(R=E.actor)!=null&&R.avatar?o.jsx("img",{src:E.actor.avatar,alt:E.actor.name}):o.jsx("div",{className:"notification-avatar-initials",children:((F=(L=(N=E.actor)==null?void 0:N.name)==null?void 0:L.charAt(0))==null?void 0:F.toUpperCase())||"U"})}),o.jsxs("div",{className:"notification-content",children:[o.jsx("div",{className:"notification-text",children:x(E)}),o.jsx("div",{className:"notification-time",children:S(E.createdAt)}),_&&O&&o.jsxs("div",{className:"notification-actions",onClick:D=>D.stopPropagation(),children:[o.jsx("button",{className:"notification-action-btn notification-action-accept",onClick:()=>k(E,"accept"),disabled:j,children:A?"ang x l...":"Kt bn"}),o.jsx("button",{className:"notification-action-btn notification-action-decline",onClick:()=>k(E,"decline"),disabled:j,children:w?"ang x l...":"T chi"})]})]}),!E.isRead&&o.jsx("div",{className:"notification-dot"})]},E._id)})]})]})]})},Wa=({currentUser:t,onLogout:e})=>{var m,p;const n=_i(),i=MC(),[r,l]=b.useState(""),u=v=>{n.push(v)},d=v=>{if(v.preventDefault(),r.trim()){const C=encodeURIComponent(r.trim());n.push(`/search?q=${C}`)}},f=v=>i===v||v==="/feed"&&i==="/";return o.jsxs("header",{className:"fb-navbar",children:[o.jsxs("div",{className:"fb-navbar-left",children:[o.jsx("div",{className:"fb-logo",onClick:()=>u("/feed"),role:"button",tabIndex:0,children:o.jsx("span",{className:"fb-logo-text",children:"D"})}),o.jsxs("form",{onSubmit:d,className:"fb-search-wrapper",children:[o.jsx("svg",{className:"fb-search-icon",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:o.jsx("path",{d:"M10.743 10.743a6 6 0 1 1-1.06-1.06l4.158 4.157a.75.75 0 1 1-1.06 1.061l-4.158-4.158zM11.5 6a5.5 5.5 0 1 0-11 0 5.5 5.5 0 0 0 11 0z"})}),o.jsx("input",{type:"text",className:"fb-search-input",placeholder:"Search Facebook",value:r,onChange:v=>l(v.target.value)})]})]}),o.jsxs("div",{className:"fb-navbar-center",children:[o.jsx("button",{className:`fb-nav-tab ${f("/feed")?"fb-nav-tab--active":""}`,onClick:()=>u("/feed"),title:"Home",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M25.825 12.29C25.824 12.289 25.823 12.288 25.821 12.286L15.027 2.937C14.752 2.675 14.392 2.527 13.989 2.521 13.608 2.527 13.248 2.675 13.001 2.912L2.175 12.29C1.756 12.658 1.629 13.245 1.868 13.759 2.079 14.215 2.567 14.479 3.069 14.479L5 14.479 5 23.729C5 24.695 5.784 25.479 6.75 25.479L11 25.479C11.552 25.479 12 25.031 12 24.479L12 18.309C12 18.126 12.148 17.979 12.33 17.979L15.67 17.979C15.852 17.979 16 18.126 16 18.309L16 24.479C16 25.031 16.448 25.479 17 25.479L21.25 25.479C22.217 25.479 23 24.695 23 23.729L23 14.479 24.931 14.479C25.433 14.479 25.921 14.215 26.132 13.759 26.371 13.245 26.244 12.658 25.825 12.29"})})}),o.jsx("button",{className:`fb-nav-tab ${f("/reels")?"fb-nav-tab--active":""}`,onClick:()=>u("/reels"),title:"Video",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M8.75 25.25C8.336 25.25 8 24.914 8 24.5 8 24.086 8.336 23.75 8.75 23.75L19.25 23.75C19.664 23.75 20 24.086 20 24.5 20 24.914 19.664 25.25 19.25 25.25L8.75 25.25ZM17.163 12.846 12.055 15.923C11.591 16.202 11 15.869 11 15.327L11 9.172C11 8.631 11.591 8.297 12.055 8.576L17.163 11.654C17.612 11.924 17.612 12.575 17.163 12.846ZM21.75 20.25C22.992 20.25 24 19.242 24 18L24 6.5C24 5.258 22.992 4.25 21.75 4.25L6.25 4.25C5.008 4.25 4 5.258 4 6.5L4 18C4 19.242 5.008 20.25 6.25 20.25L21.75 20.25ZM21.75 21.75 6.25 21.75C4.179 21.75 2.5 20.071 2.5 18L2.5 6.5C2.5 4.429 4.179 2.75 6.25 2.75L21.75 2.75C23.821 2.75 25.5 4.429 25.5 6.5L25.5 18C25.5 20.071 23.821 21.75 21.75 21.75Z"})})}),o.jsx("button",{className:`fb-nav-tab ${f("/saved")?"fb-nav-tab--active":""}`,onClick:()=>u("/saved"),title:"Saved",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M17.5 23.979 21.25 23.979C21.386 23.979 21.5 23.864 21.5 23.729L21.5 13.979C21.5 13.427 21.949 13.979 22.5 13.979L24.33 13.979 14.017 4.046 3.672 13.979 5.5 13.979C6.052 13.979 5.5 13.427 5.5 13.979L5.5 23.729C5.5 23.864 5.615 23.979 5.75 23.979L9.5 23.979 9.5 17.729C9.5 16.66 10.364 15.979 11.5 15.979L15.5 15.979C16.636 15.979 17.5 16.66 17.5 17.729L17.5 23.979ZM21.25 25.479 17 25.479C16.448 25.479 16 25.031 16 24.479L16 18.329C16 18.135 15.844 17.979 15.65 17.979L11.35 17.979C11.156 17.979 11 18.135 11 18.329L11 24.479C11 25.031 10.552 25.479 10 25.479L5.75 25.479C4.784 25.479 4 24.695 4 23.729L4 15.479 2.5 15.479C1.817 15.479 1.265 14.782 1.408 14.113 1.464 13.853 1.596 13.611 1.792 13.417L13.768 1.92C14.001 1.69 14.322 1.562 14.655 1.562 14.988 1.562 15.309 1.69 15.541 1.92L27.518 13.417C27.714 13.611 27.846 13.853 27.902 14.113 28.045 14.782 27.493 15.479 26.81 15.479L25.5 15.479 25.5 23.729C25.5 24.695 24.716 25.479 23.75 25.479L21.25 25.479Z"})})}),o.jsx("button",{className:`fb-nav-tab ${f("/friends")?"fb-nav-tab--active":""}`,onClick:()=>u("/friends"),title:"Friends",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M25.5 14C25.5 7.649 20.351 2.5 14 2.5 7.649 2.5 2.5 7.649 2.5 14 2.5 20.351 7.649 25.5 14 25.5 20.351 25.5 25.5 20.351 25.5 14ZM27 14C27 21.18 21.18 27 14 27 6.82 27 1 21.18 1 14 1 6.82 6.82 1 14 1 21.18 1 27 6.82 27 14ZM7.479 14 7.631 14C7.933 14 8.102 14.338 7.934 14.591 7.334 15.491 6.983 16.568 6.983 17.724L6.983 18.221C6.983 18.342 6.99 18.461 7.004 18.578 7.03 18.802 6.862 19 6.637 19L6.123 19C5.228 19 4.5 18.25 4.5 17.327 4.5 15.492 5.727 14 7.479 14ZM20.521 14C22.274 14 23.5 15.491 23.5 17.327 23.5 18.25 22.772 19 21.878 19L21.364 19C21.139 19 20.971 18.802 20.997 18.578 21.011 18.461 21.017 18.342 21.017 18.221L21.017 17.724C21.017 15.395 20.667 14.591 20.067 14.591 19.899 14.338 20.068 14 20.369 14L20.521 14ZM8.25 13C7.147 13 6.25 11.991 6.25 10.75 6.25 9.384 7.035 8.5 8.25 8.5 9.465 8.5 10.25 9.384 10.25 10.75 10.25 11.991 9.353 13 8.25 13ZM19.75 13C18.647 13 17.75 11.991 17.75 10.75 17.75 9.384 18.535 8.5 19.75 8.5 20.965 8.5 21.75 9.384 21.75 10.75 21.75 11.991 20.853 13 19.75 13ZM15.172 13.5C17.558 13.5 19.5 15.395 19.5 17.724L19.5 18.221C19.5 19.202 18.683 20 17.677 20L10.323 20C9.317 20 8.5 19.202 8.5 18.221L8.5 17.724C8.5 15.395 10.442 13.5 12.828 13.5L15.172 13.5ZM16.75 9.75C16.75 11.483 15.517 12.5 14 12.5 12.484 12.5 11.25 11.483 11.25 9.75 11.25 8.017 12.484 7 14 7 15.517 7 16.75 8.017 16.75 9.75Z"})})}),o.jsx("button",{className:`fb-nav-tab ${f("/settings")?"fb-nav-tab--active":""}`,onClick:()=>u("/settings"),title:"Settings",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M23.5 9.5H10.25a.75.75 0 00-.75.75v7c0 .414.336.75.75.75H17v5.5H4.5v-19h19v5zm0 14v-1.25a.75.75 0 00-.75-.75H18a.75.75 0 00-.75.75V24a1 1 0 001 1h4.5a1 1 0 001-1zM3.5 23.25v-19c0-1.079.914-2 2-2h17c1.079 0 2 .914 2 2v19c0 1.079-.914 2-2 2h-17c-1.079 0-2-.914-2-2z"})})})]}),o.jsxs("div",{className:"fb-navbar-right",children:[o.jsx("button",{className:"fb-icon-button",title:"Menu",onClick:()=>u("/settings"),children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M2.5 6.5a1 1 0 000 2h15a1 1 0 000-2h-15zm0 5a1 1 0 000 2h15a1 1 0 000-2h-15z"})})}),o.jsx("button",{className:"fb-icon-button",title:"Messenger",onClick:()=>u("/conversations"),children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M10 0C4.477 0 0 4.145 0 9.25c0 2.9 1.434 5.483 3.675 7.184v3.316a.75.75 0 001.193.593l3.427-2.569a11.08 11.08 0 001.705.13c5.523 0 10-4.145 10-9.25S15.523 0 10 0zm1.061 12.44l-2.56-2.73-5.003 2.73 5.503-5.842 2.622 2.73 4.94-2.73-5.502 5.841z"})})}),o.jsx("div",{className:"fb-notifications-wrapper",children:o.jsx(P6,{})}),o.jsx("div",{className:"fb-profile-menu",children:o.jsx("button",{className:"fb-profile-button",onClick:()=>u("/profile"),title:(t==null?void 0:t.name)||"Profile",children:t!=null&&t.avatar?o.jsx("img",{src:t.avatar,alt:t.name,className:"fb-profile-avatar"}):o.jsx("div",{className:"fb-profile-avatar fb-profile-avatar-initials",children:((p=(m=t==null?void 0:t.name)==null?void 0:m.charAt(0))==null?void 0:p.toUpperCase())||"U"})})}),o.jsx("button",{className:"fb-icon-button",title:"Logout",onClick:e,children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M8 2a1 1 0 011 1v3h2V3a3 3 0 00-3-3H5a3 3 0 00-3 3v14a3 3 0 003 3h3a3 3 0 003-3v-3H9v3a1 1 0 01-1 1H5a1 1 0 01-1-1V3a1 1 0 011-1h3zm5.293 5.293L16.586 10l-3.293 2.707 1.414 1.414L20.414 10l-5.707-5.121-1.414 1.414z"})})})]})]})},I6=()=>{const t=_i(),[e,n]=b.useState([]),[i,r]=b.useState([]),[l,u]=b.useState(""),[d,f]=b.useState([]),[m,p]=b.useState(!0),[v,C]=b.useState("friends"),{items:x,isLoading:S,reload:k}=_6(8),[E,_]=b.useState({}),[O,A]=b.useState(null);b.useEffect(()=>{j(),R(),w()},[]);const w=async()=>{try{const D=await Pl();if(D){const I=await so(D);A({_id:I._id,name:I.name||I.email||"User",avatar:I.avatar})}}catch(D){console.error("Failed to load current user:",D)}},j=async()=>{try{const D=await qm();if(D.friendIds&&D.friendIds.length>0){const I=await u9(D.friendIds);n(I.users||[])}else n([])}catch(D){console.error("Failed to load friends:",D)}finally{p(!1)}},R=async()=>{try{const D=await w8();r(D.received||[])}catch(D){console.error("Failed to load pending requests:",D)}},N=async()=>{if(!l.trim()){f([]);return}try{const D=await v8(l,1,20);f(D.users||[]),C("search")}catch(D){console.error("Search failed:",D)}},L=async D=>{var I,B;try{await f9(D),alert(" gi li mi kt bn!"),_(G=>({...G,[D]:!0})),k()}catch(G){alert(((B=(I=G.response)==null?void 0:I.data)==null?void 0:B.error)||"Li khi gi li mi")}},F=async(D,I)=>{try{await m9(D,I),I==="accept"&&j(),R()}catch(B){console.error("Failed to respond:",B)}};return o.jsxs("div",{className:"feed-root",children:[o.jsx(Wa,{}),o.jsx("div",{className:"feed-main-layout",children:o.jsxs("div",{className:"feed-inner",children:[o.jsxs("aside",{className:"feed-sidebar",children:[o.jsx("div",{className:"feed-nav-section-title",children:"Menu"}),o.jsxs("div",{className:"feed-nav-item",onClick:()=>t.push("/feed"),children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx(M6,{size:24,color:"currentColor"})}),o.jsx("span",{children:"Bng tin"})]}),o.jsxs("div",{className:"feed-nav-item",onClick:()=>t.push("/conversations"),children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx(O6,{size:24,color:"currentColor"})}),o.jsx("span",{children:"Tin nhn"})]}),o.jsxs("div",{className:"feed-nav-item feed-nav-item--active",children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx(T9,{size:24,color:"currentColor"})}),o.jsx("span",{children:"Bn b"})]})]}),o.jsxs("main",{className:"feed-main",children:[o.jsx("div",{className:"feed-header",children:o.jsx("h2",{children:"Bn b"})}),o.jsxs("div",{className:"friends-tabs",children:[o.jsxs("button",{className:`friends-tab ${v==="friends"?"active":""}`,onClick:()=>C("friends"),children:["Bn b (",e.length,")"]}),o.jsxs("button",{className:`friends-tab ${v==="requests"?"active":""}`,onClick:()=>C("requests"),children:["Li mi (",i.length,")"]}),o.jsx("button",{className:`friends-tab ${v==="search"?"active":""}`,onClick:()=>C("search"),children:"Tm kim"})]}),v==="search"&&o.jsxs("div",{className:"friends-search",children:[o.jsx("input",{type:"text",value:l,onChange:D=>u(D.target.value),placeholder:"Tm kim ngi dng...",className:"friends-search-input",onKeyDown:D=>{D.key==="Enter"&&N()}}),o.jsx("button",{className:"friends-search-btn",onClick:N,children:"Tm"})]}),o.jsxs("div",{className:"friends-list",children:[m&&o.jsx("div",{style:{padding:20},children:"ang ti..."}),v==="friends"&&o.jsxs(o.Fragment,{children:[e.length===0&&!m&&o.jsx("div",{style:{padding:20,opacity:.7,textAlign:"center"},children:"Bn cha c bn b no."}),e.map(D=>{var I,B;return o.jsxs("div",{className:"friend-item",children:[o.jsx("div",{className:"friend-avatar",children:D.avatar?o.jsx("img",{src:D.avatar,alt:D.name}):o.jsx("div",{className:"friend-avatar-initials",children:((B=(I=D.name)==null?void 0:I.charAt(0))==null?void 0:B.toUpperCase())||"U"})}),o.jsxs("div",{className:"friend-info",children:[o.jsx("div",{className:"friend-name",children:D.name||"Ngi dng"}),o.jsx("div",{className:"friend-email",children:D.email})]}),o.jsx("button",{className:"friend-action-btn",onClick:()=>t.push(`/profile/${D._id}`),children:"Xem trang"})]},D._id)})]}),v==="requests"&&o.jsxs(o.Fragment,{children:[i.length===0&&!m&&o.jsx("div",{style:{padding:20,opacity:.7,textAlign:"center"},children:"Khng c li mi no."}),i.map(D=>{var I,B,G,Z,ue,q;return o.jsxs("div",{className:"friend-item",children:[o.jsx("div",{className:"friend-avatar",children:(I=D.user)!=null&&I.avatar?o.jsx("img",{src:D.user.avatar,alt:D.user.name}):o.jsx("div",{className:"friend-avatar-initials",children:((Z=(G=(B=D.user)==null?void 0:B.name)==null?void 0:G.charAt(0))==null?void 0:Z.toUpperCase())||"U"})}),o.jsxs("div",{className:"friend-info",children:[o.jsx("div",{className:"friend-name",children:((ue=D.user)==null?void 0:ue.name)||"Ngi dng"}),o.jsx("div",{className:"friend-email",children:(q=D.user)==null?void 0:q.email})]}),o.jsxs("div",{className:"friend-actions",children:[o.jsx("button",{className:"friend-action-btn friend-action-btn--accept",onClick:()=>F(D._id,"accept"),children:"Chp nhn"}),o.jsx("button",{className:"friend-action-btn friend-action-btn--decline",onClick:()=>F(D._id,"decline"),children:"T chi"})]})]},D._id)})]}),v==="search"&&o.jsxs(o.Fragment,{children:[d.length===0&&l&&o.jsx("div",{style:{padding:20,opacity:.7,textAlign:"center"},children:"Khng tm thy kt qu."}),d.map(D=>{var I,B;return o.jsxs("div",{className:"friend-item",children:[o.jsx("div",{className:"friend-avatar",children:D.avatar?o.jsx("img",{src:D.avatar,alt:D.name}):o.jsx("div",{className:"friend-avatar-initials",children:((B=(I=D.name)==null?void 0:I.charAt(0))==null?void 0:B.toUpperCase())||"U"})}),o.jsxs("div",{className:"friend-info",children:[o.jsx("div",{className:"friend-name",children:D.name||"Ngi dng"}),o.jsx("div",{className:"friend-email",children:D.email})]}),o.jsx("div",{className:"friend-actions",children:o.jsx("button",{className:"friend-action-btn",disabled:E[D._id],onClick:()=>L(D._id),children:E[D._id]?" gi li mi":"Kt bn"})})]},D._id)})]})]})]}),o.jsx("aside",{className:"feed-right-panel",children:o.jsxs("div",{className:"feed-right-card",children:[o.jsx("h3",{children:"Gi  bn b"}),S&&o.jsx("p",{style:{opacity:.7},children:"ang ti..."}),!S&&x.length===0&&o.jsx("p",{style:{opacity:.7},children:"Khng c gi  no."}),o.jsx("div",{className:"suggestion-list",children:x.map(D=>{var I,B;return o.jsxs("div",{className:"suggestion-item",children:[o.jsx("div",{className:"suggestion-avatar",children:D.user.avatar?o.jsx("img",{src:D.user.avatar,alt:D.user.name}):o.jsx("div",{className:"suggestion-avatar-initials",children:((B=(I=D.user.name)==null?void 0:I.charAt(0))==null?void 0:B.toUpperCase())||"U"})}),o.jsxs("div",{className:"suggestion-info",children:[o.jsx("div",{className:"suggestion-name",children:D.user.name||D.user.email}),o.jsxs("div",{className:"suggestion-mutual",children:[D.mutualCount," bn chung"]}),D.mutualFriends.length>0&&o.jsxs("div",{className:"suggestion-mutual-list",children:[D.mutualFriends.map(G=>G.name).slice(0,2).join(", "),D.mutualCount>2?"...":""]})]}),o.jsx("button",{className:"suggestion-btn",disabled:E[D.user._id],onClick:()=>L(D.user._id),children:E[D.user._id]?" gi":"Kt bn"})]},D.user._id)})})]})})]})})]})},U6=[{id:"all",label:"Tt c",icon:o.jsx(bu,{size:20,color:"currentColor"})},{id:"users",label:"Mi ngi",icon:o.jsx(T9,{size:20,color:"currentColor"})},{id:"posts",label:"Bi vit",icon:o.jsx(D6,{size:20,color:"currentColor"})}],B6=()=>{const t=_i(),n=OC().get("q")||"",[i,r]=b.useState(n),[l,u]=b.useState("all"),[d,f]=b.useState(null),[m,p]=b.useState(!1),[v,C]=b.useState(null),[x,S]=b.useState(null);b.useEffect(()=>{(async()=>{try{const j=await Pl();if(j){const R=await so(j);S({_id:R._id,name:R.name||R.email||"User",avatar:R.avatar})}}catch(j){console.error("Failed to load current user:",j)}})()},[]);const k=b.useCallback(async(w,j)=>{var N,L;const R=w.trim();if(!R){C("Nhp t kha  tm kim."),f(null);return}p(!0),C(null);try{const F=await N8(R),D=[];if(F.users&&F.users.length>0){const G=F.users.map(async ue=>{try{return(await c9(ue._id,void 0,5)).items||[]}catch{return[]}});(await Promise.all(G)).forEach(ue=>D.push(...ue))}const I=new Set(F.posts.map(G=>G._id)),B=D.filter(G=>!I.has(G._id));f({users:F.users,posts:[...F.posts,...B]})}catch(F){console.error("Failed to search",F),C(((L=(N=F==null?void 0:F.response)==null?void 0:N.data)==null?void 0:L.error)||(F==null?void 0:F.message)||"Khng th tm kim lc ny")}finally{p(!1)}},[]);b.useEffect(()=>{n&&k(n,l)},[n]);const E=w=>{w.preventDefault(),i.trim()&&(t.push(`/search?q=${encodeURIComponent(i.trim())}`),k(i,l))},_=w=>{u(w)},O=l==="posts"?[]:(d==null?void 0:d.users)||[],A=l==="users"?[]:(d==null?void 0:d.posts)||[];return o.jsxs("div",{className:"feed-root",children:[o.jsx(Wa,{}),o.jsx("div",{className:"feed-main-layout",children:o.jsxs("div",{className:"feed-inner search-page-inner",children:[o.jsxs("aside",{className:"search-filter-sidebar",children:[o.jsxs("div",{className:"search-filter-header",children:[o.jsx("h2",{children:"Kt qu tm kim"}),i&&o.jsxs("p",{className:"search-filter-query",children:['"',i,'"']})]}),o.jsxs("div",{className:"search-filter-section",children:[o.jsx("h3",{children:"B lc"}),o.jsx("div",{className:"search-filter-list",children:U6.map(w=>o.jsxs("button",{className:`search-filter-item ${l===w.id?"search-filter-item--active":""}`,onClick:()=>_(w.id),children:[o.jsx("span",{className:"search-filter-icon",children:w.icon}),o.jsx("span",{className:"search-filter-label",children:w.label})]},w.id))})]})]}),o.jsxs("main",{className:"search-results-main",children:[o.jsx("div",{className:"search-input-bar",children:o.jsxs("form",{className:"search-form-inline",onSubmit:E,children:[o.jsxs("div",{className:"search-input-wrapper",children:[o.jsx("span",{className:"search-input-icon",children:o.jsx(bu,{size:18,color:"currentColor"})}),o.jsx("input",{className:"search-input-field",placeholder:"Tm kim trn Zola...",value:i,onChange:w=>r(w.target.value)})]}),o.jsx("button",{className:"search-submit-btn",type:"submit",children:"Tm kim"})]})}),v&&o.jsx("div",{className:"search-error-banner",children:v}),m&&o.jsxs("div",{className:"search-loading-state",children:[o.jsx("div",{className:"search-loading-spinner"}),o.jsx("span",{children:"ang tm kim..."})]}),!m&&d&&o.jsxs("div",{className:"search-results-container",children:[O.length>0&&o.jsxs("div",{className:"search-results-section",children:[o.jsx("h3",{className:"search-results-section-title",children:"Mi ngi"}),o.jsx("div",{className:"search-users-list",children:O.map(w=>{var j,R;return o.jsxs("div",{className:"search-user-item",onClick:()=>t.push(`/profile/${w._id}`),children:[o.jsx("div",{className:"search-user-avatar-large",children:w.avatar?o.jsx("img",{src:w.avatar,alt:w.name}):o.jsx("div",{className:"search-user-initials-large",children:((R=(j=w.name)==null?void 0:j.charAt(0))==null?void 0:R.toUpperCase())||"U"})}),o.jsxs("div",{className:"search-user-details",children:[o.jsx("div",{className:"search-user-name-main",children:w.name||w.email}),w.username&&o.jsxs("div",{className:"search-user-username",children:["@",w.username]})]}),o.jsx("button",{className:"search-user-action-btn",onClick:N=>{N.stopPropagation(),t.push(`/profile/${w._id}`)},children:"Xem trang c nhn"})]},w._id)})})]}),A.length>0&&o.jsxs("div",{className:"search-results-section",children:[o.jsx("h3",{className:"search-results-section-title",children:"Bi vit"}),o.jsx("div",{className:"search-posts-list",children:A.map(w=>o.jsx(F6,{post:w},w._id))})]}),O.length===0&&A.length===0&&o.jsxs("div",{className:"search-no-results",children:[o.jsx("div",{className:"search-no-results-icon",children:o.jsx(bu,{size:48,color:"currentColor"})}),o.jsx("h3",{children:"Khng tm thy kt qu"}),o.jsx("p",{children:"Th tm kim vi t kha khc hoc thay i b lc."})]})]}),!m&&!d&&!v&&o.jsxs("div",{className:"search-initial-state",children:[o.jsx("div",{className:"search-initial-icon",children:o.jsx(bu,{size:48,color:"currentColor"})}),o.jsx("h3",{children:"Tm kim trn Zola"}),o.jsx("p",{children:"Tm bn b, bi vit v nhiu ni dung khc..."})]})]})]})})]})},F6=({post:t})=>{var i,r;const e=_i(),n=t.author||{name:`User ${t.authorId}`,_id:t.authorId};return o.jsxs("article",{className:"search-post-item",onClick:()=>e.push(`/post/${t._id}`),children:[o.jsxs("div",{className:"search-post-author-row",children:[o.jsx("div",{className:"search-post-author-avatar",children:n.avatar?o.jsx("img",{src:n.avatar,alt:n.name}):o.jsx("div",{className:"search-post-author-initials",children:((r=(i=n.name)==null?void 0:i.charAt(0))==null?void 0:r.toUpperCase())||"U"})}),o.jsxs("div",{className:"search-post-author-info",children:[o.jsx("span",{className:"search-post-author-name",onClick:l=>{l.stopPropagation(),e.push(`/profile/${n._id}`)},children:n.name}),o.jsx("span",{className:"search-post-date",children:new Date(t.createdAt).toLocaleString("vi-VN")})]})]}),o.jsx("div",{className:"search-post-content",children:t.content}),t.media&&t.media.length>0&&o.jsx("div",{className:"search-post-media-grid",children:t.media.slice(0,4).map((l,u)=>o.jsxs("div",{className:"search-post-media-thumb",children:[l.type==="video"?o.jsx("video",{src:l.url,className:"search-post-video-thumb"}):o.jsx("img",{src:l.url,alt:`media-${u}`,className:"search-post-img-thumb"}),t.media.length>4&&u===3&&o.jsxs("div",{className:"search-post-media-more",children:["+",t.media.length-4]})]},u))}),o.jsxs("div",{className:"search-post-stats",children:[o.jsxs("span",{children:[" ",t.reactionsCount||0]}),o.jsxs("span",{children:[" ",t.commentsCount||0]})]})]})},Kr=({children:t,leftSidebar:e,rightSidebar:n,header:i,hideSidebars:r=!1})=>{const l=r;return o.jsxs("div",{className:"feed-root",children:[i,o.jsx("div",{className:"feed-main-layout",children:o.jsxs("div",{className:`feed-inner ${l?"feed-inner--full-width":""}`,children:[!l&&e&&o.jsx("aside",{className:"feed-sidebar feed-sidebar--left",children:e}),o.jsx("main",{className:`feed-center ${l?"feed-center--full-width":""}`,children:t}),!l&&n&&o.jsx("aside",{className:"feed-right feed-right--sidebar",children:n})]})})]})},z6=({currentUser:t,activeRoute:e="/feed"})=>{var u,d;const n=_i(),i=MC(),r=f=>{n.push(f)},l=f=>i===f||f==="/feed"&&(i==="/"||e==="/feed");return o.jsxs(o.Fragment,{children:[t&&o.jsxs("div",{className:"feed-nav-item feed-nav-item--user",onClick:()=>r(`/profile/${t._id}`),children:[o.jsx("div",{className:"feed-nav-avatar",children:t.avatar?o.jsx("img",{src:t.avatar,alt:t.name}):o.jsx("div",{className:"feed-nav-avatar-initials",children:((d=(u=t.name)==null?void 0:u.charAt(0))==null?void 0:d.toUpperCase())||"U"})}),o.jsx("span",{className:"feed-nav-user-name",children:t.name})]}),o.jsx("div",{className:"feed-nav-section-title",children:"Menu"}),o.jsxs("div",{className:`feed-nav-item ${l("/feed")?"feed-nav-item--active":""}`,onClick:()=>r("/feed"),children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M25.825 12.29C25.824 12.289 25.823 12.288 25.821 12.286L15.027 2.937C14.752 2.675 14.392 2.527 13.989 2.521 13.608 2.527 13.248 2.675 13.001 2.912L2.175 12.29C1.756 12.658 1.629 13.245 1.868 13.759 2.079 14.215 2.567 14.479 3.069 14.479L5 14.479 5 23.729C5 24.695 5.784 25.479 6.75 25.479L11 25.479C11.552 25.479 12 25.031 12 24.479L12 18.309C12 18.126 12.148 17.979 12.33 17.979L15.67 17.979C15.852 17.979 16 18.126 16 18.309L16 24.479C16 25.031 16.448 25.479 17 25.479L21.25 25.479C22.217 25.479 23 24.695 23 23.729L23 14.479 24.931 14.479C25.433 14.479 25.921 14.215 26.132 13.759 26.371 13.245 26.244 12.658 25.825 12.29"})})}),o.jsx("span",{children:"Bng tin"})]}),o.jsxs("div",{className:`feed-nav-item ${l("/conversations")?"feed-nav-item--active":""}`,onClick:()=>r("/conversations"),children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M10 0C4.477 0 0 4.145 0 9.25c0 2.9 1.434 5.483 3.675 7.184v3.316a.75.75 0 001.193.593l3.427-2.569a11.08 11.08 0 001.705.13c5.523 0 10-4.145 10-9.25S15.523 0 10 0zm1.061 12.44l-2.56-2.73-5.003 2.73 5.503-5.842 2.622 2.73 4.94-2.73-5.502 5.841z"})})}),o.jsx("span",{children:"Tin nhn"})]}),o.jsxs("div",{className:`feed-nav-item ${l("/friends")?"feed-nav-item--active":""}`,onClick:()=>r("/friends"),children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M25.5 14C25.5 7.649 20.351 2.5 14 2.5 7.649 2.5 2.5 7.649 2.5 14 2.5 20.351 7.649 25.5 14 25.5 20.351 25.5 25.5 20.351 25.5 14ZM27 14C27 21.18 21.18 27 14 27 6.82 27 1 21.18 1 14 1 6.82 6.82 1 14 1 21.18 1 27 6.82 27 14ZM7.479 14 7.631 14C7.933 14 8.102 14.338 7.934 14.591 7.334 15.491 6.983 16.568 6.983 17.724L6.983 18.221C6.983 18.342 6.99 18.461 7.004 18.578 7.03 18.802 6.862 19 6.637 19L6.123 19C5.228 19 4.5 18.25 4.5 17.327 4.5 15.492 5.727 14 7.479 14ZM20.521 14C22.274 14 23.5 15.491 23.5 17.327 23.5 18.25 22.772 19 21.878 19L21.364 19C21.139 19 20.971 18.802 20.997 18.578 21.011 18.461 21.017 18.342 21.017 18.221L21.017 17.724C21.017 15.395 20.667 14.591 20.067 14.591 19.899 14.338 20.068 14 20.369 14L20.521 14ZM8.25 13C7.147 13 6.25 11.991 6.25 10.75 6.25 9.384 7.035 8.5 8.25 8.5 9.465 8.5 10.25 9.384 10.25 10.75 10.25 11.991 9.353 13 8.25 13ZM19.75 13C18.647 13 17.75 11.991 17.75 10.75 17.75 9.384 18.535 8.5 19.75 8.5 20.965 8.5 21.75 9.384 21.75 10.75 21.75 11.991 20.853 13 19.75 13ZM15.172 13.5C17.558 13.5 19.5 15.395 19.5 17.724L19.5 18.221C19.5 19.202 18.683 20 17.677 20L10.323 20C9.317 20 8.5 19.202 8.5 18.221L8.5 17.724C8.5 15.395 10.442 13.5 12.828 13.5L15.172 13.5ZM16.75 9.75C16.75 11.483 15.517 12.5 14 12.5 12.484 12.5 11.25 11.483 11.25 9.75 11.25 8.017 12.484 7 14 7 15.517 7 16.75 8.017 16.75 9.75Z"})})}),o.jsx("span",{children:"Bn b"})]}),o.jsxs("div",{className:`feed-nav-item ${l("/search")?"feed-nav-item--active":""}`,onClick:()=>r("/search"),children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M10.743 10.743a6 6 0 1 1-1.06-1.06l4.158 4.157a.75.75 0 1 1-1.06 1.061l-4.158-4.158zM11.5 6a5.5 5.5 0 1 0-11 0 5.5 5.5 0 0 0 11 0z"})})}),o.jsx("span",{children:"Tm kim"})]}),o.jsxs("div",{className:`feed-nav-item ${l("/saved")?"feed-nav-item--active":""}`,onClick:()=>r("/saved"),children:[o.jsx("div",{className:"feed-nav-icon",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 28 28",fill:"currentColor",children:o.jsx("path",{d:"M19.5 2.5h-11C7.567 2.5 6.75 3.317 6.75 4.25v19.5c0 .933.817 1.75 1.75 1.75h11c.933 0 1.75-.817 1.75-1.75V4.25c0-.933-.817-1.75-1.75-1.75zm0 21.25h-11V4.25h11v19.5zM14 18.5l-4.5-2.5V4.25h9v11.75L14 18.5z"})})}),o.jsx("span",{children:"Bi vit  lu"})]})]})};function q6(){_i();const[t,e]=b.useState("personal"),[n,i]=b.useState(null),[r,l]=b.useState(!0);b.useEffect(()=>{(async()=>{try{const m=await Pl();if(m){const p=await so(m);i({_id:p._id,name:p.name||p.email||"User",email:p.email||"",username:p.username,avatar:p.avatar})}}catch(m){console.error("Failed to load user:",m)}finally{l(!1)}})()},[]);const u=o.jsx(Wa,{currentUser:n?{_id:n._id,name:n.name,avatar:n.avatar}:null}),d=o.jsx(z6,{currentUser:n?{_id:n._id,name:n.name,avatar:n.avatar}:null,activeRoute:"/settings"});return o.jsx(Kr,{header:u,leftSidebar:d,hideSidebars:!0,children:o.jsx("div",{className:"settings-container",children:o.jsxs("div",{className:"settings-layout",children:[o.jsxs("aside",{className:"settings-sidebar",children:[o.jsx("div",{className:"settings-sidebar-header",children:o.jsx("h2",{className:"settings-sidebar-title",children:"Ci t"})}),o.jsxs("nav",{className:"settings-nav",children:[o.jsxs("button",{className:`settings-nav-item ${t==="personal"?"settings-nav-item--active":""}`,onClick:()=>e("personal"),children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),o.jsx("span",{children:"Thng tin c nhn"})]}),o.jsxs("button",{className:`settings-nav-item ${t==="security"?"settings-nav-item--active":""}`,onClick:()=>e("security"),children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),o.jsx("span",{children:"Mt khu v bo mt"})]}),o.jsxs("button",{className:`settings-nav-item ${t==="privacy"?"settings-nav-item--active":""}`,onClick:()=>e("privacy"),children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 18c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm0-11c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"})}),o.jsx("span",{children:"Quyn ring t"})]}),o.jsxs("button",{className:`settings-nav-item ${t==="notifications"?"settings-nav-item--active":""}`,onClick:()=>e("notifications"),children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),o.jsx("span",{children:"Thng bo"})]})]})]}),o.jsx("main",{className:"settings-main",children:r?o.jsx("div",{className:"settings-loading",children:"ang ti..."}):o.jsxs(o.Fragment,{children:[t==="personal"&&o.jsx(V6,{user:n,onUpdate:i}),t==="security"&&o.jsx(H6,{}),t==="privacy"&&o.jsx($6,{}),t==="notifications"&&o.jsx(G6,{})]})})]})})})}function V6({user:t,onUpdate:e}){const[n,i]=b.useState((t==null?void 0:t.name)||""),[r,l]=b.useState((t==null?void 0:t.username)||""),[u,d]=b.useState((t==null?void 0:t.email)||""),[f,m]=b.useState(!1),[p,v]=b.useState(null);b.useEffect(()=>{t&&(i(t.name||""),l(t.username||""),d(t.email||""))},[t]);const C=async()=>{var x,S;if(t){m(!0),v(null);try{await d8({name:n.trim(),username:r.trim()||void 0}),e({...t,name:n.trim(),username:r.trim()}),v({type:"success",text:" cp nht thng tin thnh cng!"})}catch(k){v({type:"error",text:((S=(x=k==null?void 0:k.response)==null?void 0:x.data)==null?void 0:S.error)||"Khng th cp nht thng tin"})}finally{m(!1)}}};return o.jsxs("div",{className:"settings-section",children:[o.jsx("h1",{className:"settings-section-title",children:"Thng tin c nhn"}),o.jsx("p",{className:"settings-section-description",children:"Qun l thng tin c nhn ca bn. Thng tin ny s hin th vi ngi khc."}),o.jsxs("div",{className:"settings-form",children:[o.jsxs("div",{className:"settings-form-group",children:[o.jsx("label",{className:"settings-label",children:"Tn"}),o.jsx("input",{type:"text",className:"settings-input",value:n,onChange:x=>i(x.target.value),placeholder:"Nhp tn ca bn"})]}),o.jsxs("div",{className:"settings-form-group",children:[o.jsx("label",{className:"settings-label",children:"Tn ngi dng"}),o.jsx("input",{type:"text",className:"settings-input",value:r,onChange:x=>l(x.target.value),placeholder:"Nhp tn ngi dng"})]}),o.jsxs("div",{className:"settings-form-group",children:[o.jsx("label",{className:"settings-label",children:"Email"}),o.jsx("input",{type:"email",className:"settings-input settings-input--disabled",value:u,disabled:!0,placeholder:"Email"}),o.jsx("p",{className:"settings-hint",children:"Email khng th thay i"})]}),p&&o.jsx("div",{className:`settings-message settings-message--${p.type}`,children:p.text}),o.jsx("button",{className:"settings-button settings-button--primary",onClick:C,disabled:f,children:f?"ang lu...":"Lu thay i"})]})]})}function H6(){const[t,e]=b.useState(""),[n,i]=b.useState(""),[r,l]=b.useState(""),[u,d]=b.useState(!1),[f,m]=b.useState(null),p=async()=>{var v,C;if(!t||!n||!r){m({type:"error",text:"Vui lng in y  thng tin"});return}if(n!==r){m({type:"error",text:"Mt khu mi khng khp"});return}if(n.length<6){m({type:"error",text:"Mt khu phi c t nht 6 k t"});return}d(!0),m(null);try{await g8(t,n),m({type:"success",text:" i mt khu thnh cng!"}),e(""),i(""),l("")}catch(x){m({type:"error",text:((C=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:C.error)||"Khng th i mt khu"})}finally{d(!1)}};return o.jsxs("div",{className:"settings-section",children:[o.jsx("h1",{className:"settings-section-title",children:"Mt khu v bo mt"}),o.jsx("p",{className:"settings-section-description",children:"Thay i mt khu  bo v ti khon ca bn."}),o.jsxs("div",{className:"settings-form",children:[o.jsxs("div",{className:"settings-form-group",children:[o.jsx("label",{className:"settings-label",children:"Mt khu hin ti"}),o.jsx("input",{type:"password",className:"settings-input",value:t,onChange:v=>e(v.target.value),placeholder:"Nhp mt khu hin ti"})]}),o.jsxs("div",{className:"settings-form-group",children:[o.jsx("label",{className:"settings-label",children:"Mt khu mi"}),o.jsx("input",{type:"password",className:"settings-input",value:n,onChange:v=>i(v.target.value),placeholder:"Nhp mt khu mi"})]}),o.jsxs("div",{className:"settings-form-group",children:[o.jsx("label",{className:"settings-label",children:"Xc nhn mt khu mi"}),o.jsx("input",{type:"password",className:"settings-input",value:r,onChange:v=>l(v.target.value),placeholder:"Nhp li mt khu mi"})]}),f&&o.jsx("div",{className:`settings-message settings-message--${f.type}`,children:f.text}),o.jsx("button",{className:"settings-button settings-button--primary",onClick:p,disabled:u,children:u?"ang i...":"i mt khu"})]})]})}function $6(){return o.jsxs("div",{className:"settings-section",children:[o.jsx("h1",{className:"settings-section-title",children:"Quyn ring t"}),o.jsx("p",{className:"settings-section-description",children:"Qun l quyn ring t v cch ngi khc tm thy bn."}),o.jsx("div",{className:"settings-coming-soon",children:"Tnh nng ang c pht trin..."})]})}function G6(){return o.jsxs("div",{className:"settings-section",children:[o.jsx("h1",{className:"settings-section-title",children:"Thng bo"}),o.jsx("p",{className:"settings-section-description",children:"Qun l cch bn nhn thng bo."}),o.jsx("div",{className:"settings-coming-soon",children:"Tnh nng ang c pht trin..."})]})}const E9=({size:t=20,color:e,className:n=""})=>o.jsx("svg",{width:t,height:t,viewBox:"0 0 61 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:n,style:{display:"inline-block",verticalAlign:"middle",color:e||"currentColor"},children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M60.0003 30C60.0003 13.4315 46.5689 0 30.0003 0C13.4318 0 0.00030899 13.4315 0.00030899 30C0.00030899 46.5685 13.4318 60 30.0003 60C35.9253 60 41.455 58.2799 46.1097 55.312L55.6783 58.661C58.4678 59.6373 61.1369 56.9305 60.1215 54.155L56.4606 44.1484C58.7197 39.9314 60.0003 35.112 60.0003 30ZM30.0003 5C43.8074 5 55.0003 16.1929 55.0003 30C55.0003 34.6245 53.747 38.9486 51.5631 42.6596C51.1839 43.304 51.113 44.0843 51.3699 44.7865L54.336 52.8938L46.5842 50.1807C45.8245 49.9148 44.9833 50.0309 44.3241 50.4926C40.2682 53.3334 35.3326 55 30.0003 55C16.1932 55 5.00031 43.8071 5.00031 30C5.00031 16.1929 16.1932 5 30.0003 5Z",fill:"currentColor"})}),w9=({size:t=20,color:e,className:n=""})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:n,style:{display:"inline-block",verticalAlign:"middle",color:e||"#0966FF"},children:[o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.5 27.6963C27.2533 27.6963 23 31.9496 23 37.1963V67.1963C23 72.443 27.2533 76.6963 32.5 76.6963H62.5C67.7467 76.6963 72 72.443 72 67.1963V52.1963C72 50.8156 73.1193 49.6963 74.5 49.6963C75.8807 49.6963 77 50.8156 77 52.1963V67.1963C77 75.2044 70.5081 81.6963 62.5 81.6963H32.5C24.4919 81.6963 18 75.2044 18 67.1963V37.1963C18 29.1882 24.4919 22.6963 32.5 22.6963H49.5C50.8807 22.6963 52 23.8156 52 25.1963C52 26.577 50.8807 27.6963 49.5 27.6963H32.5Z",fill:"currentColor"}),o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M34.1263 56.0649C34.1317 55.409 34.3947 54.7816 34.8585 54.3178L67.7015 21.4748C69.0683 20.108 71.2844 20.108 72.6512 21.4748L79.7223 28.5459C81.0891 29.9127 81.0891 32.1288 79.7223 33.4956L46.8793 66.3386C46.4155 66.8024 45.788 67.0653 45.1322 67.0708L36.5762 67.1415C35.906 67.147 35.2617 66.8832 34.7878 66.4093C34.3138 65.9354 34.0501 65.2911 34.0556 64.6209L34.1263 56.0649ZM39.1177 57.1296L39.0764 62.1206L44.0674 62.0794L75.1261 31.0208L70.1763 26.071L39.1177 57.1296Z",fill:"currentColor"})]}),j9=({isOpen:t,onClose:e,postId:n,onShareSuccess:i,currentUser:r})=>{var E,_;const[l,u]=b.useState(""),[d,f]=b.useState("PUBLIC"),[m,p]=b.useState(!1),[v,C]=b.useState(!1),x=b.useRef(null),S=b.useRef(null);b.useEffect(()=>{t&&x.current&&x.current.focus()},[t]),b.useEffect(()=>{t||(u(""),C(!1))},[t]),b.useEffect(()=>{if(!v)return;const O=A=>{S.current&&!S.current.contains(A.target)&&C(!1)};return document.addEventListener("mousedown",O),()=>document.removeEventListener("mousedown",O)},[v]);const k=async()=>{try{p(!0),await S8(n,{content:l.trim()||void 0,visibility:d}),i==null||i(),e()}catch(O){console.error("Failed to share post:",O),alert("Li khi chia s bi vit")}finally{p(!1)}};return t?o.jsx("div",{className:"create-post-modal-overlay",onClick:e,children:o.jsxs("div",{className:"create-post-modal",onClick:O=>O.stopPropagation(),children:[o.jsxs("div",{className:"create-post-modal-header",children:[o.jsx("h2",{children:"Chia s bi vit"}),o.jsx("button",{className:"create-post-modal-close",onClick:e,children:""})]}),o.jsxs("div",{className:"create-post-modal-body",children:[o.jsx("div",{className:"create-post-modal-user",children:r?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"create-post-modal-avatar",children:r.avatar?o.jsx("img",{src:r.avatar,alt:r.name}):o.jsx("div",{className:"create-post-modal-avatar-initials",children:((_=(E=r.name)==null?void 0:E.charAt(0))==null?void 0:_.toUpperCase())||"U"})}),o.jsxs("div",{className:"create-post-modal-user-info",children:[o.jsx("div",{className:"create-post-modal-user-name",children:r.name}),o.jsxs("div",{className:"create-post-modal-privacy-wrapper",ref:S,children:[o.jsxs("button",{className:"create-post-modal-privacy",onClick:()=>C(!v),children:[d==="PUBLIC"?o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""})," Cng khai"]}):d==="FRIENDS"?o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""})," Bn b"]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""})," Ch mnh ti"]}),o.jsx("span",{children:""})]}),v&&o.jsxs("div",{className:"create-post-modal-privacy-menu",children:[o.jsxs("button",{onClick:()=>{f("PUBLIC"),C(!1)},className:d==="PUBLIC"?"active":"",children:[o.jsx("span",{children:""}),o.jsxs("div",{children:[o.jsx("div",{children:"Cng khai"}),o.jsx("div",{className:"create-post-modal-privacy-menu-desc",children:"Mi ngi u c th xem"})]})]}),o.jsxs("button",{onClick:()=>{f("FRIENDS"),C(!1)},className:d==="FRIENDS"?"active":"",children:[o.jsx("span",{children:""}),o.jsxs("div",{children:[o.jsx("div",{children:"Bn b"}),o.jsx("div",{className:"create-post-modal-privacy-menu-desc",children:"Ch bn b c th xem"})]})]}),o.jsxs("button",{onClick:()=>{f("ONLY_ME"),C(!1)},className:d==="ONLY_ME"?"active":"",children:[o.jsx("span",{children:""}),o.jsxs("div",{children:[o.jsx("div",{children:"Ch mnh ti"}),o.jsx("div",{className:"create-post-modal-privacy-menu-desc",children:"Ch bn c th xem"})]})]})]})]})]})]}):o.jsx("div",{children:"Loading..."})}),o.jsx("textarea",{ref:x,className:"create-post-modal-textarea",value:l,onChange:O=>u(O.target.value),placeholder:"Vit g  v bi vit ny...",rows:4})]}),o.jsx("div",{className:"create-post-modal-footer",children:o.jsx("button",{className:"create-post-modal-submit",onClick:k,disabled:m,children:m?"ang chia s...":"Chia s"})})]})}):null},R9=({size:t=24,className:e})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M59.9999 0C26.8499 0 0 26.85 0 59.9999C0 93.1498 26.8499 120 59.9999 120C93.1498 120 120 93.1498 120 59.9999C120 26.85 93.1498 0 59.9999 0Z",fill:"url(#like_grad)"}),o.jsx("path",{d:"M90.2999 55.05C94.3499 57.9 93.5999 63.9 89.2499 66.15C91.4999 69.8999 88.6499 74.8499 84.7499 75.8999C85.3499 76.9499 85.6499 77.8499 85.4999 78.8999C84.8999 83.2499 80.0999 83.9999 76.4999 83.9999H56.8499C49.05 83.9999 45.15 79.6499 45.15 76.0499V57.6C45.15 47.85 56.0999 39.6 56.0999 32.7L55.1999 24.3C55.1999 23.85 55.1999 22.5 55.6499 22.2C56.2499 21.6 58.0499 20.55 60.5999 20.55C62.2499 20.55 63.4499 20.8501 64.7999 21.6001C69.2999 23.85 69.8999 29.4 69.8999 33.9C69.8999 36 67.1999 42.45 66.8999 44.7C70.3499 43.5 78.4499 42.15 84.7499 43.05C92.0999 44.1 94.1999 49.05 90.2999 55.05ZM28.65 48H34.95C36.15 48 37.35 48.45 38.25 49.35C39.15 50.25 39.6 51.45 39.6 52.65V82.7999C39.6 83.9999 39.15 85.1999 38.25 86.0999C37.35 86.9999 36.15 87.4499 34.95 87.4499H28.65C27.45 87.4499 26.25 86.9999 25.35 86.0999C24.45 85.1999 24 83.9999 24 82.7999V52.65C24 51.45 24.45 50.25 25.35 49.35C26.25 48.45 27.45 48 28.65 48Z",fill:"white"}),o.jsx("defs",{children:o.jsxs("radialGradient",{id:"like_grad",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(41.8938 37.318) rotate(77.6772) scale(84.6968 84.6968)",children:[o.jsx("stop",{stopColor:"#18AFFF"}),o.jsx("stop",{offset:"1",stopColor:"#0062DF"})]})})]}),K6=({size:t=24,className:e})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M59.9999 0C26.8499 0 0 26.85 0 59.9999C0 93.1498 26.8499 120 59.9999 120C93.1498 120 120 93.1498 120 59.9999C120 26.85 93.1498 0 59.9999 0Z",fill:"url(#love_grad)"}),o.jsx("path",{d:"M78.6009 30C62.1009 30 60.0009 43.65 60.0009 43.65C60.0009 43.65 57.9009 30 41.401 30C25.501 30 20.851 46.65 22.801 55.6499C27.901 79.1999 59.8509 95.6999 59.8509 95.6999C59.8509 95.6999 91.8009 79.1999 96.9009 55.6499C99.0009 46.65 94.3508 30 78.6009 30Z",fill:"white"}),o.jsx("defs",{children:o.jsxs("radialGradient",{id:"love_grad",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(16.2437 63.5304 -63.5294 16.2438 53.436 53.3625)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#FF8297"}),o.jsx("stop",{offset:"0.1592",stopColor:"#FD7A90"}),o.jsx("stop",{offset:"0.4121",stopColor:"#F8637B"}),o.jsx("stop",{offset:"0.7251",stopColor:"#EF3D5B"}),o.jsx("stop",{offset:"1",stopColor:"#E61739"})]})})]}),W6=({size:t=24,className:e})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M119.55 59.9999C119.55 93.1657 92.8164 120 59.775 120C26.7335 120 0 93.1657 0 59.9999C0 26.8341 26.7335 0 59.775 0C92.6662 0 119.55 26.8341 119.55 59.9999Z",fill:"url(#haha_grad1)"}),o.jsx("path",{d:"M119.55 59.9999C119.55 93.1657 92.8164 120 59.775 120C26.7335 120 0 93.1657 0 59.9999C0 26.8341 26.7335 0 59.775 0C92.6662 0 119.55 26.8341 119.55 59.9999Z",fill:"url(#haha_grad2)"}),o.jsx("path",{d:"M95.9649 71.1555C96.4155 68.5927 95.3641 66.0299 92.9611 65.1254C87.5544 62.8641 76.5906 59.9998 59.6194 59.9998C42.7983 59.9998 31.8345 62.8641 26.2775 65.1254C23.8745 66.0299 22.8232 68.5927 23.2738 71.1555C26.2775 86.5324 35.8896 105.226 59.6194 105.226C83.3491 105.075 92.9611 86.3816 95.9649 71.1555Z",fill:"url(#haha_grad3)"}),o.jsx("path",{d:"M83.8003 95.7286C79.2947 91.5075 71.7852 88.1909 59.7702 88.1909C47.6049 88.1909 40.0955 91.5075 35.5898 95.7286C41.297 101.306 49.1068 105.075 59.62 105.075C70.2833 105.075 78.0931 101.306 83.8003 95.7286Z",fill:"url(#haha_grad4)"}),o.jsx("path",{d:"M28.6853 50.3518C26.7328 50.3518 25.2309 48.8442 24.9306 46.8844C24.1796 38.7437 30.1872 31.5076 38.4475 30.7538C46.5577 30 53.7667 36.0302 54.5177 44.3216C54.6679 46.4322 53.166 48.2412 51.2135 48.392C49.1109 48.5427 47.3086 47.0352 47.1584 45.0754C46.858 41.005 43.2535 37.99 39.1985 38.2915C35.1434 38.593 32.1396 42.2111 32.44 46.2814C32.5902 48.392 31.0883 50.201 29.1358 50.3518C28.8354 50.3518 28.6853 50.3518 28.6853 50.3518Z",fill:"#2C445F"}),o.jsx("path",{d:"M90.7126 50.3519C90.5624 50.3519 90.5624 50.3519 90.4122 50.3519C88.3096 50.2011 86.8078 48.3921 87.1082 46.2815C87.4085 42.2112 84.4048 38.5931 80.3497 38.2916C76.2946 37.9901 72.6901 40.8544 72.3897 45.0755C72.2395 47.186 70.4372 48.6936 68.3346 48.3921C66.2319 48.2413 64.7301 46.4323 65.0305 44.3217C65.7814 36.0303 72.9905 30.1509 81.1006 30.7539C89.2108 31.5077 95.2183 38.7438 94.6176 46.8845C94.167 48.8443 92.5149 50.3519 90.7126 50.3519Z",fill:"#2C445F"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"haha_grad1",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(-0.141675 81.2323 -83.6337 -0.146963 59.229 49.6661)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#FFED85"}),o.jsx("stop",{offset:"0.1898",stopColor:"#FFE180"}),o.jsx("stop",{offset:"0.5295",stopColor:"#FFC273"}),o.jsx("stop",{offset:"0.9773",stopColor:"#FF915E"}),o.jsx("stop",{offset:"1",stopColor:"#FF8E5D"})]}),o.jsxs("radialGradient",{id:"haha_grad2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(32.3913 29.692) scale(99.6575 100.032)",children:[o.jsx("stop",{stopColor:"#FFEA84",stopOpacity:"0"}),o.jsx("stop",{offset:"1",stopColor:"#F08423",stopOpacity:"0.34"})]}),o.jsxs("linearGradient",{id:"haha_grad3",x1:"59.6193",y1:"61.8679",x2:"59.6193",y2:"114.428",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("linearGradient",{id:"haha_grad4",x1:"59.6951",y1:"86.3056",x2:"59.6951",y2:"104.754",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#FC607C"}),o.jsx("stop",{offset:"1",stopColor:"#D91F3A"})]})]})]}),Z6=({size:t=24,className:e})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 26.85 120 59.9999Z",fill:"url(#wow_grad1)"}),o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 26.85 120 59.9999Z",fill:"url(#wow_grad2)"}),o.jsx("path",{d:"M42.4481 81.1498C41.2481 94.9497 47.8481 104.4 59.9981 104.4C72.1481 104.4 78.7481 94.9497 77.5481 81.1498C76.3481 67.3498 69.2981 59.5498 59.9981 59.5498C50.8481 59.6998 43.6481 67.4998 42.4481 81.1498Z",fill:"url(#wow_grad3)"}),o.jsx("path",{d:"M92.8482 24.1498C89.8482 20.2498 85.0482 18.8998 78.5982 22.1998C77.2482 22.9498 75.5982 22.3498 74.8482 20.9998C74.0982 19.6498 74.6982 17.9998 76.0482 17.2498C85.0482 12.7498 92.6981 14.9998 97.1981 20.8498C98.0981 22.0498 97.9481 23.8498 96.7481 24.7498C95.5481 25.4998 93.7482 25.3498 92.8482 24.1498Z",fill:"#E27421"}),o.jsx("path",{d:"M27.2977 24.1498C30.2977 20.2498 35.0977 18.8998 41.5477 22.1998C42.8977 22.9498 44.5477 22.3498 45.2977 20.9998C46.0477 19.6498 45.4477 17.9998 44.0977 17.2498C35.0978 12.7498 27.4477 14.9998 22.9477 20.8498C22.0477 22.0498 22.1977 23.8498 23.3977 24.7498C24.5977 25.4998 26.3977 25.3498 27.2977 24.1498Z",fill:"#E27421"}),o.jsx("path",{d:"M72.5996 42.8994C72.5996 36.7494 77.2496 31.6494 82.7996 31.6494C88.4996 31.6494 92.9995 36.5994 92.9995 42.8994C92.9995 49.0494 88.3496 54.1494 82.7996 54.1494C77.2496 54.1494 72.5996 49.0494 72.5996 42.8994Z",fill:"#2C445F"}),o.jsx("path",{d:"M77.0996 38.5495C77.0996 36.5995 78.2995 34.9495 79.6495 34.9495C80.9995 34.9495 82.1995 36.5995 82.1995 38.5495C82.1995 40.4995 80.9995 42.1495 79.6495 42.1495C78.2995 42.1495 77.0996 40.4995 77.0996 38.5495Z",fill:"#4E506A"}),o.jsx("path",{d:"M47.5504 42.8994C47.5504 36.7494 42.9004 31.6494 37.3504 31.6494C31.6505 31.6494 27.1504 36.5994 27.1504 42.8994C27.1504 49.0494 31.8005 54.1494 37.3504 54.1494C42.9004 54.1494 47.5504 49.0494 47.5504 42.8994Z",fill:"#2C445F"}),o.jsx("path",{d:"M35.5512 38.5495C35.5512 36.5995 34.3512 34.9495 33.0012 34.9495C31.6512 34.9495 30.4512 36.5995 30.4512 38.5495C30.4512 40.4995 31.6512 42.1495 33.0012 42.1495C34.3512 42.1495 35.5512 40.4995 35.5512 38.5495Z",fill:"#4E506A"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"wow_grad1",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(59.1578 49.6699) rotate(90.1003) scale(81.1448 83.858)",children:[o.jsx("stop",{stopColor:"#FFED85"}),o.jsx("stop",{offset:"0.1898",stopColor:"#FFE180"}),o.jsx("stop",{offset:"0.5295",stopColor:"#FFC273"}),o.jsx("stop",{offset:"0.9773",stopColor:"#FF915E"}),o.jsx("stop",{offset:"1",stopColor:"#FF8E5D"})]}),o.jsxs("radialGradient",{id:"wow_grad2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(32.7622 29.73) scale(99.9228 99.9228)",children:[o.jsx("stop",{stopColor:"#FFEA84",stopOpacity:"0"}),o.jsx("stop",{offset:"1",stopColor:"#F08423",stopOpacity:"0.34"})]}),o.jsxs("linearGradient",{id:"wow_grad3",x1:"59.9981",y1:"59.6782",x2:"59.9981",y2:"104.401",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]})]})]}),Y6=({size:t=24,className:e})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 27 120 59.9999Z",fill:"url(#sad_grad1)"}),o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 27 120 59.9999Z",fill:"url(#sad_grad2)"}),o.jsx("path",{d:"M43.1992 93.5998C43.1992 94.4998 43.7992 95.0998 44.6992 95.0998C46.9492 95.0998 49.9492 91.0498 59.8492 91.0498C69.7491 91.0498 72.8992 95.0998 74.9992 95.0998C76.0492 95.0998 76.4992 94.4998 76.4992 93.5998C76.4992 91.0498 71.2492 82.0498 59.6992 82.0498C48.5992 82.0498 43.1992 90.8998 43.1992 93.5998Z",fill:"url(#sad_grad3)"}),o.jsx("path",{d:"M10.6491 110.25C5.54913 105.15 5.09917 96.8998 9.74916 91.1998L19.4991 79.4998C19.9491 78.8998 20.9991 78.8998 21.4491 79.4998L31.1991 91.1998C35.8491 96.7498 35.549 105 30.299 110.25C25.0491 115.8 16.1991 115.8 10.6491 110.25Z",fill:"url(#sad_grad4)"}),o.jsx("path",{d:"M20.5492 112.5C17.2492 112.5 14.2492 111.3 11.8492 108.9C7.3492 104.4 7.0492 97.3501 11.0992 92.4001L20.5492 81.1501L29.9992 92.4001C34.0492 97.3501 33.7492 104.4 29.2492 108.9C26.9992 111.3 23.8491 112.5 20.5492 112.5Z",fill:"url(#sad_grad5)"}),o.jsx("path",{d:"M76.498 67.1997C76.498 60.8997 80.698 55.9497 85.798 55.9497C90.8979 55.9497 95.098 61.0497 95.098 67.1997C95.098 69.7497 94.348 72.1497 93.148 74.0997C92.848 74.5497 92.548 74.8497 92.098 75.1497C91.648 75.4497 91.198 75.5997 90.748 75.7497C87.598 76.4997 84.148 76.4997 80.998 75.7497C80.548 75.5997 79.948 75.4497 79.648 75.1497C79.198 74.8497 78.898 74.5497 78.598 74.0997C77.098 71.9997 76.498 69.5997 76.498 67.1997Z",fill:"#2C445F"}),o.jsx("path",{d:"M84.4507 60.1497C85.5007 61.3497 85.5007 63.7497 84.6007 65.5497C83.7007 67.3497 82.0507 67.6497 81.0007 66.4497C79.9507 65.2497 79.9507 62.8497 80.8507 61.0497C81.7507 59.2497 83.4007 58.9497 84.4507 60.1497Z",fill:"#4E506A"}),o.jsx("path",{d:"M43.6488 67.1997C43.6488 60.8997 39.4488 55.9497 34.3488 55.9497C29.2488 55.9497 25.0488 61.0497 25.0488 67.1997C25.0488 69.7497 25.7989 72.1497 26.9989 74.0997C27.2989 74.5497 27.5988 74.8497 28.0488 75.1497C28.4988 75.4497 28.9489 75.5997 29.3989 75.7497C32.5488 76.4997 35.9988 76.4997 39.1488 75.7497C39.5988 75.5997 40.1989 75.4497 40.4989 75.1497C40.9489 74.8497 41.2488 74.5497 41.5488 74.0997C42.8988 71.9997 43.6488 69.5997 43.6488 67.1997Z",fill:"#2C445F"}),o.jsx("path",{d:"M30.0007 60.1497C28.9507 61.3497 28.9507 63.7497 29.8507 65.5497C30.7507 67.3497 32.4007 67.6497 33.4507 66.4497C34.5007 65.2497 34.5007 62.8497 33.6007 61.0497C32.7007 59.2497 31.0507 58.9497 30.0007 60.1497Z",fill:"#4E506A"}),o.jsx("path",{d:"M82.0486 40.0502C90.4485 41.8502 95.2486 45.9002 100.649 51.3002C102.449 53.1002 100.049 56.5502 97.7985 54.4502C94.1985 51.1502 89.3986 47.5502 81.1486 45.9002C76.9486 45.0002 78.5986 39.3002 82.0486 40.0502Z",fill:"#E78E0D"}),o.jsx("path",{d:"M37.9494 40.0502C29.5494 41.8502 24.7494 45.9002 19.3494 51.3002C17.5494 53.1002 19.9494 56.5502 22.1994 54.4502C25.7994 51.1502 30.5994 47.5502 38.8494 45.9002C43.0494 45.0002 41.3994 39.3002 37.9494 40.0502Z",fill:"#E78E0D"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"sad_grad1",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(60.0584 27.0733) rotate(90.1003) scale(92.9773 133.486)",children:[o.jsx("stop",{stopColor:"#FFED85"}),o.jsx("stop",{offset:"0.1898",stopColor:"#FFE180"}),o.jsx("stop",{offset:"0.5295",stopColor:"#FFC273"}),o.jsx("stop",{offset:"0.9773",stopColor:"#FF915E"}),o.jsx("stop",{offset:"1",stopColor:"#FF8E5D"})]}),o.jsxs("radialGradient",{id:"sad_grad2",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(32.7396 29.7385) scale(99.9021 99.9021)",children:[o.jsx("stop",{stopColor:"#FFEA84",stopOpacity:"0"}),o.jsx("stop",{offset:"1",stopColor:"#F08423",stopOpacity:"0.34"})]}),o.jsxs("linearGradient",{id:"sad_grad3",x1:"59.9734",y1:"82.0513",x2:"59.8311",y2:"95.2637",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("linearGradient",{id:"sad_grad4",x1:"20.5002",y1:"114.363",x2:"20.5002",y2:"79.0402",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#20BBF2"}),o.jsx("stop",{offset:"1",stopColor:"#007EDB"})]}),o.jsxs("radialGradient",{id:"sad_grad5",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(19.7889 105.519) scale(23.1402 23.1402)",children:[o.jsx("stop",{offset:"0.0961217",stopColor:"#2FD7FC"}),o.jsx("stop",{offset:"1",stopColor:"#007EDB"})]})]})]}),J6=({size:t=24,className:e})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[o.jsx("path",{d:"M120 59.9999C120 93.1498 93.1498 120 59.9999 120C26.8499 120 0 93.1498 0 59.9999C0 26.85 26.8499 0 59.9999 0C93.1498 0 120 26.85 120 59.9999Z",fill:"url(#angry_grad)"}),o.jsx("path",{d:"M44.0996 92.2494C44.0996 95.5494 51.1496 94.9494 59.9996 94.9494C68.6996 94.9494 75.8996 95.3994 75.8996 92.2494C75.8996 88.3494 68.8496 85.6494 59.9996 85.6494C51.1496 85.7994 44.0996 88.3494 44.0996 92.2494Z",fill:"url(#angry_grad2)"}),o.jsx("path",{d:"M25.3516 68.2497C25.3516 61.4997 30.0016 55.9497 35.8515 55.9497C41.7015 55.9497 46.3515 61.4997 46.3515 68.2497C46.3515 71.0997 45.6015 73.6497 44.1015 75.7497C43.5015 76.6497 42.4516 77.3997 41.2516 77.6997C39.9016 77.9997 37.9516 78.2997 35.7016 78.2997C33.4516 78.2997 31.5016 77.9997 30.1516 77.6997C28.9516 77.3997 28.0516 76.7997 27.3016 75.7497C26.1016 73.4997 25.3516 70.9497 25.3516 68.2497Z",fill:"#2C445F"}),o.jsx("path",{d:"M73.502 68.2497C73.502 61.4997 78.1519 55.9497 84.0019 55.9497C89.8519 55.9497 94.5019 61.4997 94.5019 68.2497C94.5019 71.0997 93.6019 73.6497 92.2519 75.7497C91.6519 76.6497 90.6019 77.3997 89.4019 77.6997C87.6019 78.1497 85.8019 78.2997 83.8519 78.2997C81.6019 78.2997 79.652 77.9997 78.302 77.6997C77.102 77.3997 76.2019 76.7997 75.4519 75.7497C74.2519 73.4997 73.502 70.9497 73.502 68.2497Z",fill:"#2C445F"}),o.jsx("path",{d:"M37.2012 64.4997C37.2012 64.6497 37.2012 64.7997 37.2012 65.0997C37.2012 66.5997 35.8512 67.7997 34.2012 67.7997C32.5512 67.7997 31.2012 66.5997 31.2012 65.0997C31.2012 64.4997 31.3512 63.8997 31.8012 63.4497C33.6012 63.7497 35.4012 64.0497 37.2012 64.4997Z",fill:"#4F4F67"}),o.jsx("path",{d:"M81.6016 67.7997C79.9516 67.7997 78.7516 66.5997 78.6016 65.2497C80.5516 64.9497 82.5016 64.6497 84.3016 64.1997C84.4516 64.4997 84.4516 64.7997 84.4516 65.0997C84.6016 66.4497 83.2516 67.7997 81.6016 67.7997Z",fill:"#4F4F67"}),o.jsx("path",{d:"M49.5022 56.8504C52.8021 57.1504 52.2021 63.0004 49.3521 63.0004C37.3521 61.6504 25.9522 58.2004 21.3022 55.9504C19.8022 55.2004 19.3522 54.1504 19.6522 52.9504C19.9522 51.6004 21.3022 50.7004 22.0522 51.0004C33.7522 54.1504 37.9522 55.6504 49.5022 56.8504Z",fill:"url(#angry_grad3)"}),o.jsx("path",{d:"M70.353 56.8504C67.053 57.1504 67.6531 63.0004 70.5031 63.0004C82.5031 61.6504 93.9031 58.2004 98.553 55.9504C100.053 55.2004 100.503 54.1504 100.203 52.9504C99.903 51.6004 98.553 50.7004 97.803 51.0004C86.2531 54.1504 82.053 55.6504 70.353 56.8504Z",fill:"url(#angry_grad4)"}),o.jsxs("defs",{children:[o.jsxs("radialGradient",{id:"angry_grad",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(42.0603 40.1242) rotate(76.293) scale(78.6551 78.6551)",children:[o.jsx("stop",{stopColor:"#FFB06C"}),o.jsx("stop",{offset:"1",stopColor:"#FD4545"})]}),o.jsxs("linearGradient",{id:"angry_grad2",x1:"59.9996",y1:"87.027",x2:"59.9996",y2:"95.0839",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#3F1D04"}),o.jsx("stop",{offset:"1",stopColor:"#7E2307"})]}),o.jsxs("linearGradient",{id:"angry_grad3",x1:"35.6533",y1:"64.4563",x2:"35.6533",y2:"46.9588",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#9A2F00"}),o.jsx("stop",{offset:"1",stopColor:"#D44800"})]}),o.jsxs("linearGradient",{id:"angry_grad4",x1:"84.2019",y1:"64.4563",x2:"84.2019",y2:"46.9588",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{stopColor:"#9A2F00"}),o.jsx("stop",{offset:"1",stopColor:"#D44800"})]})]})]}),em=[{type:"LIKE",emoji:"",label:"Thch",IconComponent:R9},{type:"LOVE",emoji:"",label:"Yu thch",IconComponent:K6},{type:"HAHA",emoji:"",label:"Haha",IconComponent:W6},{type:"WOW",emoji:"",label:"Wow",IconComponent:Z6},{type:"SAD",emoji:"",label:"Bun",IconComponent:Y6},{type:"ANGRY",emoji:"",label:"Phn n",IconComponent:J6}],hd=({post:t,reaction:e=null,onSelectReaction:n,onClearReaction:i,onSavePost:r,onUnsavePost:l,onReportPost:u,isSaved:d=!1})=>{var be,Ue,et,At,mt,Dt;const f=_i(),[m,p]=b.useState(!1),{items:v,loadMore:C,createComment:x,isLoading:S,hasNext:k}=k9(t._id),[E,_]=b.useState(""),[O,A]=b.useState(!1),w=b.useRef(null),[j,R]=b.useState(!1),N=b.useRef(null),L=b.useRef(null),[F,D]=b.useState(!1),[I,B]=b.useState(null),G=t.author||{name:`User ${t.authorId}`,_id:t.authorId},Z=()=>{try{const Q=sessionStorage.getItem("post_detail_cache"),Ee=Q?JSON.parse(Q):{};Ee[t._id]=t,sessionStorage.setItem("post_detail_cache",JSON.stringify(Ee))}catch(Q){console.warn("post_detail_cache failed",Q)}f.push(`/post/${t._id}`)},ue=typeof n=="function",q=e,ee=async()=>{const Q=E.trim();Q&&(await x(Q),_(""))},re=t.savedAt?new Date(t.savedAt).toLocaleString("vi-VN",{hour:"2-digit",minute:"2-digit",day:"numeric",month:"numeric",year:"numeric"}):null;b.useEffect(()=>{if(!O)return;const Q=Ee=>{w.current&&!w.current.contains(Ee.target)&&A(!1)};return document.addEventListener("mousedown",Q),()=>document.removeEventListener("mousedown",Q)},[O]);const he=async()=>{r&&(await r(t._id),A(!1))},Se=async()=>{l&&(await l(t._id),A(!1))},P=()=>{u&&(u(t),A(!1))};b.useEffect(()=>{if(!j)return;const Q=Ee=>{N.current&&!N.current.contains(Ee.target)&&R(!1)};return document.addEventListener("mousedown",Q),()=>document.removeEventListener("mousedown",Q)},[j]);const K=()=>{ue&&(L.current&&clearTimeout(L.current),R(!0))},ae=()=>{L.current&&clearTimeout(L.current),L.current=setTimeout(()=>R(!1),150)},le=()=>{ue&&(q?i==null||i(t._id):n==null||n(t._id,"LIKE"))},Te=Q=>{n==null||n(t._id,Q),R(!1)},ce=t.reactionCounts||{},_e=t.likeCount||Object.values(ce).reduce((Q,Ee)=>Q+(Ee||0),0),V=em.filter(Q=>(ce[Q.type]||0)>0).slice(0,3),ve=()=>{f.push(`/profile/${G._id}`)};return b.useEffect(()=>{F&&(async()=>{try{const Ee=await Pl();if(Ee){const se=await so(Ee);B({_id:se._id,name:se.name||se.email||"User",avatar:se.avatar})}}catch(Ee){console.error("Failed to load current user:",Ee)}})()},[F]),o.jsxs("article",{className:"feed-card",style:{marginTop:8},children:[o.jsxs("div",{className:"feed-post-header",onClick:Z,style:{cursor:"pointer"},children:[o.jsxs("div",{className:"feed-post-author",children:[o.jsx("div",{className:"feed-post-avatar",onClick:ve,style:{cursor:"pointer"},children:G.avatar?o.jsx("img",{src:G.avatar,alt:G.name}):o.jsx("div",{className:"feed-post-avatar-initials",children:((Ue=(be=G.name)==null?void 0:be.charAt(0))==null?void 0:Ue.toUpperCase())||"U"})}),o.jsxs("div",{children:[o.jsxs("span",{className:"feed-post-author-name",onClick:ve,style:{cursor:"pointer",display:"inline-flex",alignItems:"center",gap:4},children:[G.name,G.isVerified&&o.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:16,height:16,borderRadius:"50%",background:"#1877f2",color:"white",fontSize:10,fontWeight:700,lineHeight:1},title:"Verified",children:""})]}),o.jsxs("div",{className:"feed-post-meta-wrapper",children:[o.jsx("span",{className:"feed-post-meta",children:new Date(t.createdAt).toLocaleString("vi-VN",{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),t.visibility&&o.jsx("span",{className:"feed-post-visibility-icon",title:t.visibility==="PUBLIC"?"Cng khai":t.visibility==="FRIENDS"?"Bn b":"Ch mnh ti",children:t.visibility==="PUBLIC"?"":t.visibility==="FRIENDS"?"":""}),t.taggedUsers&&t.taggedUsers.length>0&&o.jsxs("span",{className:"feed-post-tagged-info",children:["cng vi"," ",t.taggedUsers.map((Q,Ee)=>o.jsxs("span",{children:[o.jsx("a",{href:`/profile/${Q._id}`,onClick:se=>{se.preventDefault(),f.push(`/profile/${Q._id}`)},className:"feed-post-tagged-link",children:Q.name}),Ee<t.taggedUsers.length-1&&", "]},Q._id))]}),re&&o.jsxs("span",{className:"feed-post-meta feed-post-meta--saved",children:[" lu lc ",re]})]})]})]}),o.jsxs("div",{className:"feed-post-menu",ref:w,children:[o.jsx("button",{className:"feed-post-menu-button",onClick:Q=>{Q.stopPropagation(),A(Ee=>!Ee)},"aria-label":"Ty chn bi vit",children:""}),O&&o.jsxs("div",{className:"feed-post-menu-dropdown",children:[d?o.jsx("button",{onClick:Se,disabled:!l,children:"B lu bi vit"}):r&&o.jsx("button",{onClick:he,children:"Lu bi vit"}),u&&o.jsx("button",{className:"danger",onClick:P,children:"Bo co bi vit"})]})]})]}),t.sharedFrom&&o.jsxs(o.Fragment,{children:[t.content&&t.content!==" chia s bi vit"&&o.jsx("div",{className:"feed-post-content",style:{marginBottom:"var(--spacing-md)"},children:t.content.split(/(#\w+)/g).map((Q,Ee)=>{if(Q.startsWith("#")){const se=Q.substring(1);return o.jsx("a",{href:`/hashtag/${encodeURIComponent(se)}`,onClick:fe=>{fe.preventDefault(),f.push(`/hashtag/${encodeURIComponent(se)}`)},className:"feed-post-hashtag",children:Q},Ee)}return o.jsx("span",{children:Q},Ee)})}),o.jsx("div",{className:"feed-post-shared-container",onClick:()=>{typeof t.sharedFrom=="object"&&t.sharedFrom!==null&&t.sharedFrom._id},style:{cursor:"pointer"},children:typeof t.sharedFrom=="object"&&t.sharedFrom!==null?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"feed-post-shared-header",children:[o.jsx("div",{className:"feed-post-avatar",onClick:Q=>{Q.stopPropagation(),t.sharedFrom.authorId&&f.push(`/profile/${t.sharedFrom.authorId}`)},style:{cursor:"pointer"},children:t.sharedFrom.author&&t.sharedFrom.author.avatar?o.jsx("img",{src:t.sharedFrom.author.avatar,alt:t.sharedFrom.author.name}):o.jsx("div",{className:"feed-post-avatar-initials",children:((mt=(At=(et=t.sharedFrom.author)==null?void 0:et.name)==null?void 0:At.charAt(0))==null?void 0:mt.toUpperCase())||"U"})}),o.jsxs("div",{className:"feed-post-shared-header-info",children:[o.jsx("div",{className:"feed-post-author-name",onClick:Q=>{Q.stopPropagation(),t.sharedFrom.authorId&&f.push(`/profile/${t.sharedFrom.authorId}`)},style:{cursor:"pointer"},children:((Dt=t.sharedFrom.author)==null?void 0:Dt.name)||"User"}),o.jsx("div",{className:"feed-post-meta",children:new Date(t.sharedFrom.createdAt).toLocaleDateString("vi-VN",{day:"numeric",month:"long"})})]})]}),t.sharedFrom.content&&o.jsx("div",{className:"feed-post-shared-content",children:t.sharedFrom.content.split(/(#\w+)/g).map((Q,Ee)=>{if(Q.startsWith("#")){const se=Q.substring(1);return o.jsx("a",{href:`/hashtag/${encodeURIComponent(se)}`,onClick:fe=>{fe.stopPropagation(),f.push(`/hashtag/${encodeURIComponent(se)}`)},className:"feed-post-hashtag",children:Q},Ee)}return o.jsx("span",{children:Q},Ee)})}),t.sharedFrom.media&&t.sharedFrom.media.length>0&&o.jsx("div",{className:"feed-post-media",children:t.sharedFrom.media.map((Q,Ee)=>o.jsx("div",{className:"feed-post-media-item",children:Q.type==="image"?o.jsx("img",{src:Q.url,alt:"",className:"feed-post-image"}):Q.type==="video"?o.jsx("video",{src:Q.url,controls:!0,className:"feed-post-video"}):null},Ee))})]}):o.jsx("div",{className:"feed-post-shared-placeholder",children:"  chia s bi vit"})})]}),!t.sharedFrom&&o.jsx("div",{className:"feed-post-content",onClick:Z,style:{cursor:"pointer"},children:t.content.split(/(#\w+)/g).map((Q,Ee)=>{if(Q.startsWith("#")){const se=Q.substring(1);return o.jsx("a",{href:`/hashtag/${encodeURIComponent(se)}`,onClick:fe=>{fe.preventDefault(),f.push(`/hashtag/${encodeURIComponent(se)}`)},className:"feed-post-hashtag",children:Q},Ee)}return o.jsx("span",{children:Q},Ee)})}),t.media&&t.media.length>0&&o.jsx("div",{className:"feed-post-media",onClick:Z,style:{cursor:"pointer"},children:t.media.map((Q,Ee)=>o.jsx("div",{className:"feed-post-media-item",children:Q.type==="image"?o.jsx("img",{src:Q.url,alt:"",className:"feed-post-image"}):Q.type==="video"?o.jsx("video",{src:Q.url,controls:!0,className:"feed-post-video"}):o.jsx("div",{className:"feed-post-media-placeholder",children:o.jsxs("span",{children:[" ",Q.type]})})},Ee))}),o.jsxs("div",{className:"feed-post-social",children:[o.jsxs("div",{className:"feed-post-reaction-summary",children:[V.map(Q=>o.jsx("span",{className:"feed-post-reaction-icon",children:o.jsx(Q.IconComponent,{size:20})},Q.type)),_e>0&&o.jsx("span",{className:"feed-post-reaction-total",children:_e})]}),o.jsxs("div",{className:"feed-post-comment-count",children:[t.commentCount||0," bnh lun"]})]}),o.jsxs("div",{className:"feed-post-actions",children:[o.jsxs("div",{className:`feed-post-action-btn ${q?"feed-post-action-btn--liked":""}`,onMouseEnter:K,onMouseLeave:ae,children:[o.jsx("button",{className:"feed-post-reaction-button",onClick:le,children:(()=>{const Q=q?em.find(fe=>fe.type===q):null,Ee=(Q==null?void 0:Q.IconComponent)||R9,se=(Q==null?void 0:Q.label)||"Thch";return o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"feed-post-reaction-btn-icon",children:o.jsx(Ee,{size:18})}),o.jsx("span",{children:se})]})})()}),j&&o.jsx("div",{className:"reaction-picker reaction-picker--svg",ref:N,children:em.map(Q=>o.jsx("button",{type:"button",onClick:()=>Te(Q.type),title:Q.label,children:o.jsx("span",{className:"reaction-emoji",children:o.jsx(Q.IconComponent,{size:32})})},Q.type))})]}),o.jsxs("button",{className:"feed-post-action-btn",type:"button",onClick:()=>p(Q=>!Q),children:[o.jsx(E9,{size:18}),o.jsx("span",{children:"Bnh lun"})]}),o.jsxs("button",{className:"feed-post-action-btn",type:"button",onClick:()=>D(!0),children:[o.jsx(w9,{size:18}),o.jsxs("span",{children:["Chia s ",t.shareCount?`(${t.shareCount})`:""]})]})]}),m&&o.jsxs("div",{className:"feed-comments",children:[o.jsxs("div",{children:[v.map(Q=>{var Ee;return o.jsxs("div",{className:"feed-comment-item",children:[o.jsxs("div",{className:"feed-comment-author",children:[o.jsx("strong",{children:((Ee=Q.author)==null?void 0:Ee.name)??"User"}),o.jsx("span",{className:"feed-post-meta",children:new Date(Q.createdAt).toLocaleString("vi-VN",{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),o.jsx("div",{className:"feed-comment-content",children:Q.content})]},Q._id)}),k&&o.jsx("button",{className:"feed-primary-button",type:"button",onClick:()=>C(),disabled:S,children:"Xem thm bnh lun"})]}),o.jsx("div",{style:{marginTop:12},children:o.jsx("input",{className:"feed-comment-input",placeholder:"Vit bnh lun...",value:E,onChange:Q=>_(Q.target.value),onKeyDown:Q=>{Q.key==="Enter"&&!Q.shiftKey&&(Q.preventDefault(),ee())}})})]}),F&&o.jsx(j9,{isOpen:F,onClose:()=>D(!1),postId:t._id,onShareSuccess:()=>{window.location.reload()},currentUser:I})]})};function Q6(){const t=wl();_i();const e=t==null?void 0:t.tag,[n,i]=b.useState([]),[r,l]=b.useState(!0),[u,d]=b.useState(!1),[f,m]=b.useState(null);b.useEffect(()=>{e&&p()},[e]);const p=async(C=!1)=>{if(e)try{l(!0);const x=await C8(e,C&&f||void 0);i(C?S=>[...S,...x.items]:x.items),d(x.hasNext),m(x.nextCursor||null)}catch(x){console.error("Failed to load posts:",x)}finally{l(!1)}},v=e?decodeURIComponent(e):"";return o.jsxs(Kr,{children:[o.jsx(Wa,{}),o.jsx("div",{className:"feed-root",children:o.jsx("div",{className:"feed-main-layout",children:o.jsxs("div",{className:"feed-inner",style:{maxWidth:680,margin:"0 auto",padding:"var(--spacing-lg) var(--spacing-md)"},children:[o.jsxs("div",{style:{marginBottom:"var(--spacing-xl)"},children:[o.jsxs("h1",{style:{fontSize:32,fontWeight:700,marginBottom:"var(--spacing-sm)",color:"var(--text-primary)"},children:["#",v]}),o.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:15},children:[n.length," ",(n.length===1,"bi vit")]})]}),r&&n.length===0?o.jsx("div",{style:{textAlign:"center",padding:"var(--spacing-xl)",color:"var(--text-secondary)"},children:"ang ti..."}):n.length===0?o.jsx("div",{style:{textAlign:"center",padding:"var(--spacing-xl)",color:"var(--text-secondary)"},children:"Khng c bi vit no vi hashtag ny"}):o.jsxs(o.Fragment,{children:[n.map(C=>o.jsx(hd,{post:C,onSelectReaction:async(x,S)=>{},onClearReaction:async x=>{}},C._id)),u&&o.jsx("button",{className:"feed-primary-button",onClick:()=>p(!0),disabled:r,style:{marginTop:"var(--spacing-lg)",width:"100%"},children:r?"ang ti...":"Xem thm"})]})]})})})]})}const X6={none:{label:"Gc",emoji:""},beauty:{label:"Mn",emoji:"",cssFilter:"brightness(1.08) contrast(1.05) saturate(1.25)"},warm:{label:"m",emoji:"",cssFilter:"brightness(1.05) saturate(1.25) hue-rotate(-5deg)"},cool:{label:"Mt",emoji:"",cssFilter:"brightness(1.08) saturate(1.15) hue-rotate(185deg)"},party:{label:"Party",emoji:"",cssFilter:"brightness(1.05) saturate(1.25)",overlay:(t,e,n,i)=>{t.save(),t.globalAlpha=.35;for(let r=0;r<20;r+=1){const l=(r*73+i/12%e)%e,u=(r*41+i/18%n)%n,d=12+r%5*3;t.fillStyle=["#ff6b6b","#ffd93d","#6bc2ff","#b070ff"][r%4],t.beginPath(),t.arc(l,u,d,0,Math.PI*2),t.fill()}t.restore()}},birthday:{label:"Sinh nht",emoji:"",cssFilter:"brightness(1.05) saturate(1.15)",overlay:(t,e,n)=>{t.save(),["#ff7eb6","#7dbbff","#ffd966"].forEach((l,u)=>{const d=u===0?e*.15:u===1?e*.85:e*.5,f=u===2?n*.2:n*.15,m=u===2?80:70,p=t.createRadialGradient(d-20,f-30,20,d,f,m);p.addColorStop(0,"#ffffff"),p.addColorStop(.2,"#ffffff"),p.addColorStop(1,l),t.fillStyle=p,t.beginPath(),t.ellipse(d,f,m*.75,m,0,0,Math.PI*2),t.fill(),t.strokeStyle="#ffffff",t.lineWidth=2,t.beginPath(),t.moveTo(d,f+m),t.quadraticCurveTo(d-10,f+m+60,d,f+m+110),t.stroke()}),t.fillStyle="#ff8ce6",t.beginPath(),t.moveTo(e/2,n*.02),t.lineTo(e/2-80,n*.28),t.lineTo(e/2+80,n*.28),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,0.45)";for(let l=-60;l<=60;l+=30)t.beginPath(),t.arc(e/2+l,n*.18,18,0,Math.PI*2),t.fill();const r=90;t.fillStyle="#ffd1dc",t.fillRect(e*.2,n-r-20,e*.6,r),t.fillStyle="#ff9ebe",t.fillRect(e*.2,n-r-20,e*.6,25);for(let l=-1;l<=1;l++){const u=e/2+l*35;t.fillStyle="#5dade2",t.fillRect(u-6,n-r-60,12,40),t.fillStyle="#ffd966",t.beginPath(),t.ellipse(u,n-r-68,7,10,0,0,Math.PI*2),t.fill()}t.restore()}}},ej=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"}];function tj({callId:t,conversationId:e,isInitiator:n,localUserId:i,remoteUserId:r,videoDeviceId:l,audioDeviceId:u}){const[d,f]=b.useState(null),[m,p]=b.useState(null),[v,C]=b.useState(!1),[x,S]=b.useState(null),[k,E]=b.useState(!0),[_,O]=b.useState(!0),[A,w]=b.useState("none"),[j,R]=b.useState(!1),N=b.useRef(null),L=b.useRef(hi()),F=b.useRef(null),D=b.useRef(null),I=b.useRef([]),B=b.useRef(!1),G=b.useRef(null),Z=b.useRef(null),ue=b.useRef(null),q=b.useRef(null),ee=b.useRef(null),re=b.useRef(null),he=b.useRef(null),Se=b.useRef("none"),P=b.useRef(null),K=b.useRef(null);b.useEffect(()=>{const se=()=>{const Ae=hi();Ae&&Ae.connected?(L.current=Ae,console.log("[useWebRTC] Socket synced, connected:",Ae.id)):(!L.current||!L.current.connected)&&(L.current=Ae)};se();const fe=setInterval(se,500);return()=>clearInterval(fe)},[]),b.useEffect(()=>{Se.current=A},[A]);const ae=b.useCallback(async se=>{if(!se)return;const fe=N.current;if(!fe)return;const Ae=fe.getSenders().find(He=>He.track&&He.track.kind==="video");Ae&&await Ae.replaceTrack(se)},[]),le=b.useCallback(()=>{if(he.current&&(cancelAnimationFrame(he.current),he.current=null),q.current&&(q.current.getTracks().forEach(se=>se.stop()),q.current=null),re.current){try{re.current.pause()}catch{}re.current.srcObject=null,re.current=null}ee.current=null},[]),Te=b.useCallback(se=>{const fe=Z.current;if(!fe)return;le();const Ae=document.createElement("video");Ae.srcObject=fe,Ae.muted=!0,Ae.playsInline=!0,Ae.autoplay=!0,Ae.play().catch(()=>{}),re.current=Ae;const He=document.createElement("canvas"),Me=He.getContext("2d");if(!Me){console.error("[Filter] Canvas context unavailable");return}ee.current=He;const Be=()=>{if(!re.current)return;const Ne=re.current,Ke=Ne.videoWidth||640,ft=Ne.videoHeight||480;if(Ke===0||ft===0){he.current=requestAnimationFrame(Be);return}(He.width!==Ke||He.height!==ft)&&(He.width=Ke,He.height=ft),Me.clearRect(0,0,Ke,ft);const zt=X6[se];Me.filter=zt.cssFilter||"none",Me.drawImage(Ne,0,0,Ke,ft),Me.filter="none",zt.overlay&&zt.overlay(Me,Ke,ft,performance.now()),he.current=requestAnimationFrame(Be)};Be();const Je=He.captureStream(30);q.current=Je;const xe=Je.getVideoTracks()[0];ae(xe),f(Je)},[ae,le]),ce=b.useCallback(async()=>{if(!ue.current)return;ue.current.getTracks().forEach(fe=>fe.stop()),ue.current=null,R(!1);const se=Z.current;if(se)if(Se.current!=="none")Te(Se.current);else{const fe=se.getVideoTracks()[0];await ae(fe),f(se)}},[ae,Te]),_e=b.useCallback(async()=>{var se;if(!j)try{const fe=typeof window<"u"?window.electronAPI:void 0;let Ae=null;if(fe!=null&&fe.selectScreenSource){const Me=await fe.selectScreenSource();if(!Me){S("Khng tm thy mn hnh  chia s.");return}const Be={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:Me,maxFrameRate:30,minFrameRate:5}}};Ae=await navigator.mediaDevices.getUserMedia(Be)}else if((se=navigator.mediaDevices)!=null&&se.getDisplayMedia)Ae=await navigator.mediaDevices.getDisplayMedia({video:{frameRate:30,width:{ideal:1920},height:{ideal:1080},displaySurface:"monitor"},audio:!1});else throw new Error("SCREEN_SHARE_NOT_SUPPORTED");ue.current=Ae;const He=Ae.getVideoTracks()[0];He.onended=()=>{ce().catch(()=>{})},le(),f(Ae),await ae(He),R(!0)}catch(fe){throw console.error("[ScreenShare] Error starting screen share:",fe),(fe==null?void 0:fe.name)==="NotAllowedError"?S("Bn  t chi quyn chia s mn hnh."):(fe==null?void 0:fe.name)==="NotFoundError"?S("Khng tm thy mn hnh ph hp  chia s."):S("Chia s mn hnh cha c h tr trong mi trng ny."),fe}},[j,ae,le,ce]),V=b.useCallback(async se=>{if(w(se),j){console.warn("[Filter] Cannot apply filter while sharing screen");return}if(Z.current){if(se==="none"){le();const fe=Z.current.getVideoTracks()[0];await ae(fe),f(Z.current);return}Te(se)}},[j,ae,Te,le]),ve=b.useCallback(se=>{const fe=new Date().toISOString();switch(console.error(`[getUserMedia ERROR] ${fe}`),console.error(`[getUserMedia ERROR] Error name: ${se.name}`),console.error(`[getUserMedia ERROR] Error message: ${se.message}`),console.error("[getUserMedia ERROR] Full error:",se),se.name){case"NotAllowedError":return console.error("[getUserMedia ERROR] NotAllowedError: Permission denied by user or system"),"Camera/microphone permission denied. Please allow access in Windows Settings (Privacy  Camera/Microphone).";case"NotFoundError":return console.error("[getUserMedia ERROR] NotFoundError: No media device found"),"No camera/microphone found. Please connect a device.";case"NotReadableError":return console.error("[getUserMedia ERROR] NotReadableError: Device is already in use"),"Camera/microphone is already in use by another application.";case"OverconstrainedError":return console.error("[getUserMedia ERROR] OverconstrainedError: Constraints cannot be satisfied"),"Camera/microphone constraints cannot be satisfied. Please try different settings.";case"SecurityError":return console.error("[getUserMedia ERROR] SecurityError: Not in secure context"),"Security error: App must run in secure context.";case"TypeError":return console.error("[getUserMedia ERROR] TypeError: Invalid constraints or API not available"),"Invalid media constraints or API not available.";default:return console.error(`[getUserMedia ERROR] Unknown error: ${se.name}`),se.message||"Failed to access camera/microphone."}},[]),be=b.useCallback(async(se,fe)=>{const Ae=new Date().toISOString();if(console.log(`[getUserMedia] ${Ae} - Starting request`),console.log(`[getUserMedia] Video: ${se}, Audio: ${fe}`),!navigator.mediaDevices){const Me="MediaDevices API is not available in this browser.";throw console.error(`[getUserMedia ERROR] ${Me}`),new Error(Me)}if(!navigator.mediaDevices.getUserMedia){const Me="getUserMedia is not supported in this browser.";throw console.error(`[getUserMedia ERROR] ${Me}`),new Error(Me)}console.log("[getUserMedia] Environment info:"),console.log(`[getUserMedia] Origin: ${window.location.origin}`),console.log(`[getUserMedia] URL: ${window.location.href}`),console.log(`[getUserMedia] Is secure context: ${window.isSecureContext}`),console.log(`[getUserMedia] MediaDevices available: ${!!navigator.mediaDevices}`);const He={video:se?l?{deviceId:{exact:l},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"}:!1,audio:fe?u?{deviceId:{exact:u},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:!1};l&&console.log(`[getUserMedia] Using selected video device: ${l}`),u&&console.log(`[getUserMedia] Using selected audio device: ${u}`),console.log("[getUserMedia] Constraints:",JSON.stringify(He,null,2));try{console.log("[getUserMedia] Calling navigator.mediaDevices.getUserMedia...");const Me=await navigator.mediaDevices.getUserMedia(He);return console.log("[getUserMedia]  Success! Stream obtained"),console.log(`[getUserMedia] Stream ID: ${Me.id}`),console.log(`[getUserMedia] Stream active: ${Me.active}`),console.log("[getUserMedia] Tracks:",Me.getTracks().map(Be=>({kind:Be.kind,id:Be.id,label:Be.label,enabled:Be.enabled,muted:Be.muted,readyState:Be.readyState}))),Z.current&&Z.current!==Me&&Z.current.getTracks().forEach(Be=>Be.stop()),Z.current=Me,!j&&Se.current==="none"&&f(Me),S(null),N.current&&Me.getTracks().forEach(Be=>{var Je;console.log(`[getUserMedia] Adding ${Be.kind} track to peer connection`),(Je=N.current)==null||Je.addTrack(Be,Me)}),!j&&Se.current!=="none"&&Te(Se.current),Me}catch(Me){const Be=ve(Me);throw S(Be),Me}},[ve,j,Te]);b.useEffect(()=>{K.current=be},[be]);const Ue=b.useCallback(()=>{console.log("[PeerConnection] Initializing..."),N.current&&(console.log("[PeerConnection] Closing existing connection"),N.current.close());const se=new RTCPeerConnection({iceServers:ej});return console.log("[PeerConnection] Created new RTCPeerConnection"),se.onicecandidate=fe=>{if(fe.candidate){console.log("[PeerConnection] ICE candidate:",fe.candidate);const Ae=L.current;Ae&&Ae.emit("webrtc:ice-candidate",{callId:t,candidate:fe.candidate,targetUserId:r})}else console.log("[PeerConnection] ICE gathering complete")},se.onconnectionstatechange=()=>{const fe=se.connectionState;console.log(`[PeerConnection] Connection state: ${fe}`),fe==="connected"?(C(!0),S(null)):(fe==="disconnected"||fe==="failed"||fe==="closed")&&C(!1)},se.ontrack=fe=>{console.log("[PeerConnection] Received remote track:",fe.track.kind),fe.streams&&fe.streams[0]&&(console.log("[PeerConnection] Setting remote stream"),p(fe.streams[0]))},se.oniceconnectionstatechange=()=>{const fe=se.iceConnectionState;console.log(`[PeerConnection] ICE connection state: ${fe}`),fe==="failed"&&(console.error("[PeerConnection] ICE connection failed"),S("Connection failed. Please try again."))},N.current=se,se},[t,r]);b.useEffect(()=>{P.current=Ue},[Ue]);const et=b.useCallback(se=>{const fe=L.current;if(!fe){console.warn("[Socket] Cannot request offer - socket not available");return}console.log(`[Socket] Requesting offer (${se}) for callId ${t}`),fe.emit("webrtc:request-offer",{callId:t,fromUserId:i,targetUserId:r})},[t,i,r]);b.useEffect(()=>()=>{G.current&&(clearInterval(G.current),G.current=null)},[]);const At=b.useCallback(async()=>{var fe;const se=new Date().toISOString();console.log(`[startCall] ${se} - Starting call`),console.log(`[startCall] Call ID: ${t}`),console.log(`[startCall] Is initiator: ${n}`);try{S(null);const Ae=L.current;if(!Ae)throw new Error("Socket not connected");const He=Ue();if(console.log("[startCall] Requesting user media..."),await be(k,_),n){console.log("[startCall] Creating offer..."),console.log("[startCall] Initiator details:",{callId:t,remoteUserId:r,socketConnected:Ae.connected,socketId:Ae.id});const Me=await He.createOffer();console.log("[startCall] Offer created:",{type:Me.type,sdpLength:(fe=Me.sdp)==null?void 0:fe.length}),await He.setLocalDescription(Me),console.log("[startCall] Local description set, signalingState:",He.signalingState),console.log("[startCall] Sending offer via socket...");const Be={callId:t,offer:Me,targetUserId:r};console.log("[startCall] Offer data to send:",{callId:Be.callId,targetUserId:Be.targetUserId,offerType:Be.offer.type}),Ae.emit("webrtc:offer",Be),console.log("[startCall]  Offer emitted to socket"),Ae.connected||console.error("[startCall]  Socket not connected when sending offer!")}else console.log("[startCall] Non-initiator: Peer connection ready, waiting for offer..."),console.log("[startCall] Socket listeners should be set up to receive offer"),B.current=!1,et("start"),G.current&&clearInterval(G.current),G.current=setInterval(()=>{if(B.current){G.current&&(clearInterval(G.current),G.current=null);return}et("retry")},2e3)}catch(Ae){console.error("[startCall] Error:",Ae);const He=Ae.message||"Failed to start call";S(He)}},[t,n,r,k,_,Ue,be,et]),mt=b.useCallback(()=>{console.log("[endCall] Ending call..."),le(),ce().catch(()=>{}),d&&(console.log("[endCall] Stopping local stream tracks"),d.getTracks().forEach(se=>{se.stop(),console.log(`[endCall] Stopped ${se.kind} track`)}),f(null)),Z.current&&(Z.current.getTracks().forEach(se=>se.stop()),Z.current=null),m&&(console.log("[endCall] Stopping remote stream tracks"),m.getTracks().forEach(se=>{se.stop()}),p(null)),N.current&&(console.log("[endCall] Closing peer connection"),N.current.close(),N.current=null),C(!1),S(null),console.log("[endCall] Call ended")},[d,m,le,ce]),Dt=b.useCallback(()=>{console.log(`[toggleVideo] Current state: ${k}, toggling...`),E(!k),d&&d.getVideoTracks().forEach(fe=>{fe.enabled=!k,console.log(`[toggleVideo] Video track ${fe.id} enabled: ${fe.enabled}`)})},[k,d]),Q=b.useCallback(()=>{console.log(`[toggleAudio] Current state: ${_}, toggling...`),O(!_),d&&d.getAudioTracks().forEach(fe=>{fe.enabled=!_,console.log(`[toggleAudio] Audio track ${fe.id} enabled: ${fe.enabled}`)})},[_,d]);b.useEffect(()=>{const se=L.current;if(!se){console.log("[Socket] Socket not available, skipping listener setup");return}console.log("[Socket] Setting up WebRTC listeners for callId:",t);const fe=async Me=>{var Be,Je,xe;if(console.log("[Socket] ===== OFFER RECEIVED ====="),console.log("[Socket] Offer data:",{callId:Me.callId,expectedCallId:t,fromUserId:Me.fromUserId,offerType:(Be=Me.offer)==null?void 0:Be.type,offerSdpLength:(xe=(Je=Me.offer)==null?void 0:Je.sdp)==null?void 0:xe.length}),B.current=!0,G.current&&(clearInterval(G.current),G.current=null),Me.callId!==t){console.log("[Socket]  Offer callId mismatch:",Me.callId,"expected:",t);return}console.log("[Socket]  Offer callId matches, processing...");try{let Ne=N.current;if(!Ne||Ne.signalingState==="closed"||Ne.connectionState==="closed"){if(console.log("[Socket] Peer connection not found or closed, creating new one..."),!P.current){console.error("[Socket] initPeerConnection not available");return}if(Ne=P.current(),!d){if(console.log("[Socket] Getting user media for answer..."),!K.current){console.error("[Socket] getUserMedia not available");return}await K.current(k,_)}if(Ne.signalingState==="closed"||Ne.connectionState==="closed"){console.error("[Socket] Peer connection was closed immediately after creation");return}}if(!Ne){console.error("[Socket] Peer connection is null after creation");return}if(Ne.signalingState==="closed"||Ne.connectionState==="closed"){console.error("[Socket] Cannot set remote description: peer connection is closed"),console.error("[Socket] Signaling state:",Ne.signalingState,"Connection state:",Ne.connectionState);return}if(await Ne.setRemoteDescription(new RTCSessionDescription(Me.offer)),console.log("[Socket] Remote description set"),I.current.length>0){console.log(`[Socket] Processing ${I.current.length} queued ICE candidates`);for(const dn of I.current)try{await Ne.addIceCandidate(new RTCIceCandidate(dn)),console.log("[Socket] Queued ICE candidate added")}catch(hn){console.error("[Socket] Error adding queued ICE candidate:",hn)}I.current=[]}const ft=await Ne.createAnswer();await Ne.setLocalDescription(ft),console.log("[Socket] Answer created and set, signalingState:",Ne.signalingState);const zt={callId:t,answer:ft,targetUserId:Me.fromUserId};console.log("[Socket] Sending answer:",{callId:zt.callId,targetUserId:zt.targetUserId,answerType:zt.answer.type,socketConnected:se.connected,socketId:se.id}),se.emit("webrtc:answer",zt),console.log("[Socket]  Answer emitted to socket"),se.connected||console.error("[Socket]  Socket not connected when sending answer!")}catch(Ne){console.error("[Socket] Error handling offer:",Ne),S("Failed to handle incoming call")}},Ae=async Me=>{var Be,Je,xe;if(console.log("[Socket] ===== ANSWER RECEIVED ====="),console.log("[Socket] Answer data:",{callId:Me.callId,expectedCallId:t,fromUserId:Me.fromUserId,answerType:(Be=Me.answer)==null?void 0:Be.type,answerSdpLength:(xe=(Je=Me.answer)==null?void 0:Je.sdp)==null?void 0:xe.length}),Me.callId!==t){console.log("[Socket]  Answer callId mismatch:",Me.callId,"expected:",t);return}console.log("[Socket]  Answer callId matches, processing...");try{const Ne=N.current;if(!Ne)return;if(await Ne.setRemoteDescription(new RTCSessionDescription(Me.answer)),console.log("[Socket] Remote description set from answer"),I.current.length>0){console.log(`[Socket] Processing ${I.current.length} queued ICE candidates`);for(const Ke of I.current)try{await Ne.addIceCandidate(new RTCIceCandidate(Ke)),console.log("[Socket] Queued ICE candidate added")}catch(ft){console.error("[Socket] Error adding queued ICE candidate:",ft)}I.current=[]}}catch(Ne){console.error("[Socket] Error handling answer:",Ne),S("Failed to handle call answer")}},He=async Me=>{if(Me.callId===t){console.log("[Socket] Received ICE candidate:",Me);try{const Be=N.current;if(!Be){console.log("[Socket] Peer connection not ready, queueing ICE candidate"),I.current.push(Me.candidate);return}if(!Be.remoteDescription){console.log("[Socket] Remote description not set yet, queueing ICE candidate"),I.current.push(Me.candidate);return}await Be.addIceCandidate(new RTCIceCandidate(Me.candidate)),console.log("[Socket] ICE candidate added")}catch(Be){Be instanceof Error&&Be.message.includes("remote description")?(console.log("[Socket] Remote description not set, queueing ICE candidate"),I.current.push(Me.candidate)):console.error("[Socket] Error handling ICE candidate:",Be)}}};return se.on("webrtc:offer",fe),se.on("webrtc:answer",Ae),se.on("webrtc:ice-candidate",He),()=>{console.log("[Socket] Cleaning up WebRTC listeners"),se.off("webrtc:offer",fe),se.off("webrtc:answer",Ae),se.off("webrtc:ice-candidate",He)}},[t]),b.useEffect(()=>{F.current&&d&&(console.log("[Video] Attaching local stream to video element"),F.current.srcObject=d)},[d]),b.useEffect(()=>{D.current&&m&&(console.log("[Video] Attaching remote stream to video element"),D.current.srcObject=m)},[m]);const Ee=b.useRef(mt);return b.useEffect(()=>{Ee.current=mt},[mt]),b.useEffect(()=>()=>{console.log("[Cleanup] Component unmounting, cleaning up..."),Ee.current()},[]),{localStream:d,remoteStream:m,isConnected:v,error:x,startCall:At,endCall:mt,toggleVideo:Dt,toggleAudio:Q,isVideoEnabled:k,isAudioEnabled:_,applyFilter:V,currentFilter:A,startScreenShare:_e,stopScreenShare:ce,isScreenSharing:j,localVideoRef:F,remoteVideoRef:D}}var hb={};function nj(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var ij=Object.defineProperty,sj=(t,e,n)=>e in t?ij(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fb=(t,e,n)=>sj(t,typeof e!="symbol"?e+"":e,n);class Bn{constructor(){fb(this,"_locking"),fb(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function Gt(t,e){if(!t)throw new Error(e)}const aj=34028234663852886e22,rj=-34028234663852886e22,oj=4294967295,lj=2147483647,cj=-2147483648;function Cu(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>lj||t<cj)throw new Error("invalid int 32: "+t)}function $m(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>oj||t<0)throw new Error("invalid uint 32: "+t)}function N9(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>aj||t<rj))throw new Error("invalid float 32: "+t)}const _9=Symbol("@bufbuild/protobuf/enum-type");function uj(t){const e=t[_9];return Gt(e,"missing enum type on enum object"),e}function A9(t,e,n,i){t[_9]=M9(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function M9(t,e,n){const i=Object.create(null),r=Object.create(null),l=[];for(const u of e){const d=O9(u);l.push(d),i[u.name]=d,r[u.no]=d}return{typeName:t,values:l,findName(u){return i[u]},findNumber(u){return r[u]}}}function dj(t,e,n){const i={};for(const r of e){const l=O9(r);i[l.localName]=l.no,i[l.no]=l.localName}return A9(i,t,e),i}function O9(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class zp{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,l=r.makeReadOptions(n);return r.readMessage(this,l.readerFactory(e),e.byteLength,l),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,l=r.makeReadOptions(n);return r.readMessage(i,e,l,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),l=r.writerFactory();return i.writeMessage(this,l,r),l.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function hj(t,e,n,i){var r;const l=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),u={[l]:function(d){t.util.initFields(this),t.util.initPartial(d,this)}}[l];return Object.setPrototypeOf(u.prototype,new zp),Object.assign(u,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(d,f){return new u().fromBinary(d,f)},fromJson(d,f){return new u().fromJson(d,f)},fromJsonString(d,f){return new u().fromJsonString(d,f)},equals(d,f){return t.util.equals(u,d,f)}}),u}function fj(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function tm(t,e,n){for(let l=0;l<28;l=l+7){const u=t>>>l,d=!(!(u>>>7)&&e==0),f=(d?u|128:u)&255;if(n.push(f),!d)return}const i=t>>>28&15|(e&7)<<4,r=e>>3!=0;if(n.push((r?i|128:i)&255),!!r){for(let l=3;l<31;l=l+7){const u=e>>>l,d=!!(u>>>7),f=(d?u|128:u)&255;if(n.push(f),!d)return}n.push(e>>>31&1)}}const xu=4294967296;function mb(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function l(u,d){const f=Number(t.slice(u,d));r*=n,i=i*n+f,i>=xu&&(r=r+(i/xu|0),i=i%xu)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),e?L9(i,r):qp(i,r)}function mj(t,e){let n=qp(t,e);const i=n.hi&2147483648;i&&(n=L9(n.lo,n.hi));const r=D9(n.lo,n.hi);return i?"-"+r:r}function D9(t,e){if({lo:t,hi:e}=pj(t,e),e<=2097151)return String(xu*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let l=n+i*6777216+r*6710656,u=i+r*8147497,d=r*2;const f=1e7;return l>=f&&(u+=Math.floor(l/f),l%=f),u>=f&&(d+=Math.floor(u/f),u%=f),d.toString()+pb(u)+pb(l)}function pj(t,e){return{lo:t>>>0,hi:e>>>0}}function qp(t,e){return{lo:t|0,hi:e|0}}function L9(t,e){return e=~e,t?t=~t+1:e+=1,qp(t,e)}const pb=t=>{const e=String(t);return"0000000".slice(e.length)+e};function gb(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function gj(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function vj(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof hb!="object"||hb.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),l=BigInt("9223372036854775807"),u=BigInt("0"),d=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const m=typeof f=="bigint"?f:BigInt(f);if(m>l||m<r)throw new Error("int64 invalid: ".concat(f));return m},uParse(f){const m=typeof f=="bigint"?f:BigInt(f);if(m>d||m<u)throw new Error("uint64 invalid: ".concat(f));return m},enc(f){return t.setBigInt64(0,this.parse(f),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(f){return t.setBigInt64(0,this.uParse(f),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(f,m){return t.setInt32(0,f,!0),t.setInt32(4,m,!0),t.getBigInt64(0,!0)},uDec(f,m){return t.setInt32(0,f,!0),t.setInt32(4,m,!0),t.getBigUint64(0,!0)}}}const n=r=>Gt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Gt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),mb(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),mb(r)},dec(r,l){return mj(r,l)},uDec(r,l){return D9(r,l)}}}const It=vj();var ge;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(ge||(ge={}));var fa;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(fa||(fa={}));function sa(t,e,n){if(e===n)return!0;if(t==ge.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case ge.UINT64:case ge.FIXED64:case ge.INT64:case ge.SFIXED64:case ge.SINT64:return e==n}return!1}function Wr(t,e){switch(t){case ge.BOOL:return!1;case ge.UINT64:case ge.FIXED64:case ge.INT64:case ge.SFIXED64:case ge.SINT64:return e==0?It.zero:"0";case ge.DOUBLE:case ge.FLOAT:return 0;case ge.BYTES:return new Uint8Array(0);case ge.STRING:return"";default:return 0}}function P9(t,e){switch(t){case ge.BOOL:return e===!1;case ge.STRING:return e==="";case ge.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Xt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Xt||(Xt={}));class yj{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for($m(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Cu(e),gb(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){N9(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){$m(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Cu(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Cu(e),e=(e<<1^e>>31)>>>0,gb(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=It.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=It.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=It.enc(e);return tm(n.lo,n.hi,this.buf),this}sint64(e){let n=It.enc(e),i=n.hi>>31,r=n.lo<<1^i,l=(n.hi<<1|n.lo>>>31)^i;return tm(r,l,this.buf),this}uint64(e){let n=It.uEnc(e);return tm(n.lo,n.hi,this.buf),this}}class bj{constructor(e,n){this.varint64=fj,this.uint32=gj,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Xt.Varint:for(;this.buf[this.pos++]&128;);break;case Xt.Bit64:this.pos+=4;case Xt.Bit32:this.pos+=4;break;case Xt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Xt.StartGroup:for(;;){const[l,u]=this.tag();if(u===Xt.EndGroup){if(n!==void 0&&l!==n)throw new Error("invalid end group tag");break}this.skip(u,l)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return It.dec(...this.varint64())}uint64(){return It.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,It.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return It.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return It.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function Cj(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const l=typeof i=="function"?i():i;l.name=e.split(".").pop(),l.jsonName="[".concat(e,"]"),r=t.util.newFieldList([l]).list()[0]}return r},runtime:t}}function I9(t){const e=t.field.localName,n=Object.create(null);return n[e]=xj(t),[n,()=>n[e]]}function xj(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Wr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function Sj(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Es="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),fd=[];for(let t=0;t<Es.length;t++)fd[Es[t].charCodeAt(0)]=t;fd[45]=Es.indexOf("+");fd[95]=Es.indexOf("/");const U9={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,l,u=0;for(let d=0;d<t.length;d++){if(l=fd[t.charCodeAt(d)],l===void 0)switch(t[d]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:u=l,r=1;break;case 1:n[i++]=u<<2|(l&48)>>4,u=l,r=2;break;case 2:n[i++]=(u&15)<<4|(l&60)>>2,u=l,r=3;break;case 3:n[i++]=(u&3)<<6|l,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let l=0;l<t.length;l++)switch(i=t[l],n){case 0:e+=Es[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Es[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Es[r|i>>6],e+=Es[i&63],n=0;break}return n&&(e+=Es[r],e+="=",n==1&&(e+="=")),e}};function kj(t,e,n){F9(e,t);const i=e.runtime.bin.makeReadOptions(n),r=Sj(t.getType().runtime.bin.listUnknownFields(t),e.field),[l,u]=I9(e);for(const d of r)e.runtime.bin.readField(l,i.readerFactory(d.data),e.field,d.wireType,i);return u()}function Tj(t,e,n,i){F9(e,t);const r=e.runtime.bin.makeReadOptions(i),l=e.runtime.bin.makeWriteOptions(i);if(B9(t,e)){const m=t.getType().runtime.bin.listUnknownFields(t).filter(p=>p.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const p of m)t.getType().runtime.bin.onUnknownField(t,p.no,p.wireType,p.data)}const u=l.writerFactory();let d=e.field;!d.opt&&!d.repeated&&(d.kind=="enum"||d.kind=="scalar")&&(d=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(d,n,u,l);const f=r.readerFactory(u.finish());for(;f.pos<f.len;){const[m,p]=f.tag(),v=f.skip(p,m);t.getType().runtime.bin.onUnknownField(t,m,p,v)}}function B9(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function F9(t,e){Gt(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function z9(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!P9(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function vb(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Wr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function ws(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(zp.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function q9(t,e){return ws(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}ge.DOUBLE,ge.FLOAT,ge.INT64,ge.UINT64,ge.INT32,ge.UINT32,ge.BOOL,ge.STRING,ge.BYTES;const yb={ignoreUnknownFields:!1},bb={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Ej(t){return t?Object.assign(Object.assign({},yb),t):yb}function wj(t){return t?Object.assign(Object.assign({},bb),t):bb}const Bu=Symbol(),Su=Symbol();function jj(){return{makeReadOptions:Ej,makeWriteOptions:wj,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Xi(e)));i=i??new t;const r=new Map,l=n.typeRegistry;for(const[u,d]of Object.entries(e)){const f=t.fields.findJsonName(u);if(f){if(f.oneof){if(d===null&&f.kind=="scalar")continue;const m=r.get(f.oneof);if(m!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(f.oneof.name,'" present: "').concat(m,'", "').concat(u,'"'));r.set(f.oneof,u)}Cb(i,d,f,n,t)}else{let m=!1;if(l!=null&&l.findExtension&&u.startsWith("[")&&u.endsWith("]")){const p=l.findExtension(u.substring(1,u.length-1));if(p&&p.extendee.typeName==t.typeName){m=!0;const[v,C]=I9(p);Cb(v,d,p.field,n,p),Tj(i,p,C(),n)}}if(!m&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(u,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!z9(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!Nj(r))continue}const u=r.oneof?t[r.oneof.localName].value:t[r.localName],d=xb(r,u,e);d!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=d)}const l=e.typeRegistry;if(l!=null&&l.findExtensionFor)for(const u of n.runtime.bin.listUnknownFields(t)){const d=l.findExtensionFor(n.typeName,u.no);if(d&&B9(t,d)){const f=kj(t,d,e),m=xb(d.field,f,e);m!==void 0&&(i[d.field.jsonName]=m)}}}catch(l){const u=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),d=l instanceof Error?l.message:String(l);throw new Error(u+(d.length>0?": ".concat(d):""))}return i},readScalar(t,e,n){return dl(t,e,n??fa.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||P9(t,e)))return ku(t,e)},debug:Xi}}function Xi(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Cb(t,e,n,i,r){let l=n.localName;if(n.repeated){if(Gt(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xi(e)));const u=t[l];for(const d of e){if(d===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xi(d)));switch(n.kind){case"message":u.push(n.T.fromJson(d,i));break;case"enum":const f=nm(n.T,d,i.ignoreUnknownFields,!0);f!==Su&&u.push(f);break;case"scalar":try{u.push(dl(n.T,d,n.L,!0))}catch(m){let p="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xi(d));throw m instanceof Error&&m.message.length>0&&(p+=": ".concat(m.message)),new Error(p)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xi(e)));const u=t[l];for(const[d,f]of Object.entries(e)){if(f===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let m;try{m=Rj(n.K,d)}catch(p){let v="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xi(e));throw p instanceof Error&&p.message.length>0&&(v+=": ".concat(p.message)),new Error(v)}switch(n.V.kind){case"message":u[m]=n.V.T.fromJson(f,i);break;case"enum":const p=nm(n.V.T,f,i.ignoreUnknownFields,!0);p!==Su&&(u[m]=p);break;case"scalar":try{u[m]=dl(n.V.T,f,fa.BIGINT,!0)}catch(v){let C="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xi(e));throw v instanceof Error&&v.message.length>0&&(C+=": ".concat(v.message)),new Error(C)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:l},l="value"),n.kind){case"message":const u=n.T;if(e===null&&u.typeName!="google.protobuf.Value")return;let d=t[l];ws(d)?d.fromJson(e,i):(t[l]=d=u.fromJson(e,i),u.fieldWrapper&&!n.oneof&&(t[l]=u.fieldWrapper.unwrapField(d)));break;case"enum":const f=nm(n.T,e,i.ignoreUnknownFields,!1);switch(f){case Bu:vb(n,t);break;case Su:break;default:t[l]=f;break}break;case"scalar":try{const m=dl(n.T,e,n.L,!1);switch(m){case Bu:vb(n,t);break;default:t[l]=m;break}}catch(m){let p="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xi(e));throw m instanceof Error&&m.message.length>0&&(p+=": ".concat(m.message)),new Error(p)}break}}function Rj(t,e){if(t===ge.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return dl(t,e,fa.BIGINT,!0).toString()}function dl(t,e,n,i){if(e===null)return i?Wr(t,n):Bu;switch(t){case ge.DOUBLE:case ge.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==ge.FLOAT&&N9(r),r;case ge.INT32:case ge.FIXED32:case ge.SFIXED32:case ge.SINT32:case ge.UINT32:let l;if(typeof e=="number"?l=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(l=Number(e)),l===void 0)break;return t==ge.UINT32||t==ge.FIXED32?$m(l):Cu(l),l;case ge.INT64:case ge.SFIXED64:case ge.SINT64:if(typeof e!="number"&&typeof e!="string")break;const u=It.parse(e);return n?u.toString():u;case ge.FIXED64:case ge.UINT64:if(typeof e!="number"&&typeof e!="string")break;const d=It.uParse(e);return n?d.toString():d;case ge.BOOL:if(typeof e!="boolean")break;return e;case ge.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case ge.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return U9.dec(e)}throw new Error}function nm(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Bu;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Su;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Xi(e)))}function Nj(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function xb(t,e,n){if(t.kind=="map"){Gt(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[u,d]of r)i[u.toString()]=ku(t.V.T,d);break;case"message":for(const[u,d]of r)i[u.toString()]=d.toJson(n);break;case"enum":const l=t.V.T;for(const[u,d]of r)i[u.toString()]=im(l,d,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Gt(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(ku(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(im(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return ku(t.T,e);case"enum":return im(t.T,e,n.enumAsInteger);case"message":return q9(t.T,e).toJson(n)}}function im(t,e,n){var i;if(Gt(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function ku(t,e){switch(t){case ge.INT32:case ge.SFIXED32:case ge.SINT32:case ge.FIXED32:case ge.UINT32:return Gt(typeof e=="number"),e;case ge.FLOAT:case ge.DOUBLE:return Gt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case ge.STRING:return Gt(typeof e=="string"),e;case ge.BOOL:return Gt(typeof e=="boolean"),e;case ge.UINT64:case ge.FIXED64:case ge.INT64:case ge.SFIXED64:case ge.SINT64:return Gt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case ge.BYTES:return Gt(e instanceof Uint8Array),U9.enc(e)}}const Or=Symbol("@bufbuild/protobuf/unknown-fields"),Sb={readUnknownFields:!0,readerFactory:t=>new bj(t)},kb={writeUnknownFields:!0,writerFactory:()=>new yj};function _j(t){return t?Object.assign(Object.assign({},Sb),t):Sb}function Aj(t){return t?Object.assign(Object.assign({},kb),t):kb}function Mj(){return{makeReadOptions:_j,makeWriteOptions:Aj,listUnknownFields(t){var e;return(e=t[Or])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Or]},writeUnknownFields(t,e){const i=t[Or];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Or])||(r[Or]=[]),r[Or].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const l=t.getType(),u=r?e.len:e.pos+n;let d,f;for(;e.pos<u&&([d,f]=e.tag(),!(r===!0&&f==Xt.EndGroup));){const m=l.fields.find(d);if(!m){const p=e.skip(f,d);i.readUnknownFields&&this.onUnknownField(t,d,f,p);continue}Tb(t,e,m,f,i)}if(r&&(f!=Xt.EndGroup||d!==n))throw new Error("invalid end group tag")},readField:Tb,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!z9(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const l=r.oneof?t[r.oneof.localName].value:t[r.localName];Eb(r,l,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Eb(t,e,n,i)}}}function Tb(t,e,n,i,r){let{repeated:l,localName:u}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=u&&delete t.value,t.case=u,u="value"),n.kind){case"scalar":case"enum":const d=n.kind=="enum"?ge.INT32:n.T;let f=Fu;if(n.kind=="scalar"&&n.L>0&&(f=Dj),l){let C=t[u];if(i==Xt.LengthDelimited&&d!=ge.STRING&&d!=ge.BYTES){let S=e.uint32()+e.pos;for(;e.pos<S;)C.push(f(e,d))}else C.push(f(e,d))}else t[u]=f(e,d);break;case"message":const m=n.T;l?t[u].push(Tu(e,new m,r,n)):ws(t[u])?Tu(e,t[u],r,n):(t[u]=Tu(e,new m,r,n),m.fieldWrapper&&!n.oneof&&!n.repeated&&(t[u]=m.fieldWrapper.unwrapField(t[u])));break;case"map":let[p,v]=Oj(n,e,r);t[u][p]=v;break}}function Tu(t,e,n,i){const r=e.getType().runtime.bin,l=i==null?void 0:i.delimited;return r.readMessage(e,t,l?i.no:t.uint32(),n,l),e}function Oj(t,e,n){const i=e.uint32(),r=e.pos+i;let l,u;for(;e.pos<r;){const[d]=e.tag();switch(d){case 1:l=Fu(e,t.K);break;case 2:switch(t.V.kind){case"scalar":u=Fu(e,t.V.T);break;case"enum":u=e.int32();break;case"message":u=Tu(e,new t.V.T,n,void 0);break}break}}if(l===void 0&&(l=Wr(t.K,fa.BIGINT)),typeof l!="string"&&typeof l!="number"&&(l=l.toString()),u===void 0)switch(t.V.kind){case"scalar":u=Wr(t.V.T,fa.BIGINT);break;case"enum":u=t.V.T.values[0].no;break;case"message":u=new t.V.T;break}return[l,u]}function Dj(t,e){const n=Fu(t,e);return typeof n=="bigint"?n.toString():n}function Fu(t,e){switch(e){case ge.STRING:return t.string();case ge.BOOL:return t.bool();case ge.DOUBLE:return t.double();case ge.FLOAT:return t.float();case ge.INT32:return t.int32();case ge.INT64:return t.int64();case ge.UINT64:return t.uint64();case ge.FIXED64:return t.fixed64();case ge.BYTES:return t.bytes();case ge.FIXED32:return t.fixed32();case ge.SFIXED32:return t.sfixed32();case ge.SFIXED64:return t.sfixed64();case ge.SINT64:return t.sint64();case ge.UINT32:return t.uint32();case ge.SINT32:return t.sint32()}}function Eb(t,e,n,i){Gt(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let l=t.kind=="enum"?ge.INT32:t.T;if(r)if(Gt(Array.isArray(e)),t.packed)Pj(n,l,t.no,e);else for(const u of e)hl(n,l,t.no,u);else hl(n,l,t.no,e);break;case"message":if(r){Gt(Array.isArray(e));for(const u of e)wb(n,i,t,u)}else wb(n,i,t,e);break;case"map":Gt(typeof e=="object"&&e!=null);for(const[u,d]of Object.entries(e))Lj(n,i,t,u,d);break}}function Lj(t,e,n,i,r){t.tag(n.no,Xt.LengthDelimited),t.fork();let l=i;switch(n.K){case ge.INT32:case ge.FIXED32:case ge.UINT32:case ge.SFIXED32:case ge.SINT32:l=Number.parseInt(i);break;case ge.BOOL:Gt(i=="true"||i=="false"),l=i=="true";break}switch(hl(t,n.K,1,l),n.V.kind){case"scalar":hl(t,n.V.T,2,r);break;case"enum":hl(t,ge.INT32,2,r);break;case"message":Gt(r!==void 0),t.tag(2,Xt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function wb(t,e,n,i){const r=q9(n.T,i);n.delimited?t.tag(n.no,Xt.StartGroup).raw(r.toBinary(e)).tag(n.no,Xt.EndGroup):t.tag(n.no,Xt.LengthDelimited).bytes(r.toBinary(e))}function hl(t,e,n,i){Gt(i!==void 0);let[r,l]=V9(e);t.tag(n,r)[l](i)}function Pj(t,e,n,i){if(!i.length)return;t.tag(n,Xt.LengthDelimited).fork();let[,r]=V9(e);for(let l=0;l<i.length;l++)t[r](i[l]);t.join()}function V9(t){let e=Xt.Varint;switch(t){case ge.BYTES:case ge.STRING:e=Xt.LengthDelimited;break;case ge.DOUBLE:case ge.FIXED64:case ge.SFIXED64:e=Xt.Bit64;break;case ge.FIXED32:case ge.SFIXED32:case ge.FLOAT:e=Xt.Bit32;break}const n=ge[t].toLowerCase();return[e,n]}function Ij(){return{setEnumType:A9,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,l=e,u=t;if(u[r]!=null)switch(i.kind){case"oneof":const d=u[r].case;if(d===void 0)continue;const f=i.findField(d);let m=u[r].value;f&&f.kind=="message"&&!ws(m,f.T)?m=new f.T(m):f&&f.kind==="scalar"&&f.T===ge.BYTES&&(m=nl(m)),l[r]={case:d,value:m};break;case"scalar":case"enum":let p=u[r];i.T===ge.BYTES&&(p=i.repeated?p.map(nl):nl(p)),l[r]=p;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===ge.BYTES)for(const[x,S]of Object.entries(u[r]))l[r][x]=nl(S);else Object.assign(l[r],u[r]);break;case"message":const C=i.V.T;for(const x of Object.keys(u[r])){let S=u[r][x];C.fieldWrapper||(S=new C(S)),l[r][x]=S}break}break;case"message":const v=i.T;if(i.repeated)l[r]=u[r].map(C=>ws(C,v)?C:new v(C));else{const C=u[r];v.fieldWrapper?v.typeName==="google.protobuf.BytesValue"?l[r]=nl(C):l[r]=C:l[r]=ws(C,v)?C:new v(C)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],l=n[i.localName];if(i.repeated){if(r.length!==l.length)return!1;switch(i.kind){case"message":return r.every((u,d)=>i.T.equals(u,l[d]));case"scalar":return r.every((u,d)=>sa(i.T,u,l[d]));case"enum":return r.every((u,d)=>sa(ge.INT32,u,l[d]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let u=r,d=l;return i.T.fieldWrapper&&(u!==void 0&&!ws(u)&&(u=i.T.fieldWrapper.wrapField(u)),d!==void 0&&!ws(d)&&(d=i.T.fieldWrapper.wrapField(d))),i.T.equals(u,d);case"enum":return sa(ge.INT32,r,l);case"scalar":return sa(i.T,r,l);case"oneof":if(r.case!==l.case)return!1;const f=i.findField(r.case);if(f===void 0)return!0;switch(f.kind){case"message":return f.T.equals(r.value,l.value);case"enum":return sa(ge.INT32,r.value,l.value);case"scalar":return sa(f.T,r.value,l.value)}throw new Error("oneof cannot contain ".concat(f.kind));case"map":const m=Object.keys(r).concat(Object.keys(l));switch(i.V.kind){case"message":const p=i.V.T;return m.every(C=>p.equals(r[C],l[C]));case"enum":return m.every(C=>sa(ge.INT32,r[C],l[C]));case"scalar":const v=i.V.T;return m.every(C=>sa(v,r[C],l[C]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const l=t[r.localName];let u;if(r.repeated)u=l.map(iu);else if(r.kind=="map"){u=i[r.localName];for(const[d,f]of Object.entries(l))u[d]=iu(f)}else r.kind=="oneof"?u=r.findField(l.case)?{case:l.case,value:iu(l.value)}:{case:void 0}:u=iu(l);i[r.localName]=u}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function iu(t){if(t===void 0)return t;if(ws(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function nl(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Uj(t,e,n){return{syntax:t,json:jj(),bin:Mj(),util:Object.assign(Object.assign({},Ij()),{newFieldList:e,initFields:n}),makeMessageType(i,r,l){return hj(this,i,r,l)},makeEnum:dj,makeEnumType:M9,getEnumType:uj,makeExtension(i,r,l){return Cj(this,i,r,l)}}}class Bj{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function H9(t,e){const n=$9(t);return e?n:$j(Hj(n))}function Fj(t){return H9(t,!1)}const zj=$9;function $9(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const qj=new Set(["constructor","toString","toJSON","valueOf"]),Vj=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),G9=t=>"".concat(t,"$"),Hj=t=>Vj.has(t)?G9(t):t,$j=t=>qj.has(t)?G9(t):t;class Gj{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Fj(e)}addField(e){Gt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function Kj(t,e){var n,i,r,l,u,d;const f=[];let m;for(const p of typeof t=="function"?t():t){const v=p;if(v.localName=H9(p.name,p.oneof!==void 0),v.jsonName=(n=p.jsonName)!==null&&n!==void 0?n:zj(p.name),v.repeated=(i=p.repeated)!==null&&i!==void 0?i:!1,p.kind=="scalar"&&(v.L=(r=p.L)!==null&&r!==void 0?r:fa.BIGINT),v.delimited=(l=p.delimited)!==null&&l!==void 0?l:!1,v.req=(u=p.req)!==null&&u!==void 0?u:!1,v.opt=(d=p.opt)!==null&&d!==void 0?d:!1,p.packed===void 0&&(v.packed=p.kind=="enum"||p.kind=="scalar"&&p.T!=ge.BYTES&&p.T!=ge.STRING),p.oneof!==void 0){const C=typeof p.oneof=="string"?p.oneof:p.oneof.name;(!m||m.name!=C)&&(m=new Gj(C)),v.oneof=m,m.addField(v)}f.push(v)}return f}const J=Uj("proto3",t=>new Bj(t,e=>Kj(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Wr(e.T,e.L);break}}});class Zn extends zp{constructor(e){super(),this.seconds=It.zero,this.nanos=0,J.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(J.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=It.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Zn.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Zn({seconds:It.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Zn().fromBinary(e,n)}static fromJson(e,n){return new Zn().fromJson(e,n)}static fromJsonString(e,n){return new Zn().fromJsonString(e,n)}static equals(e,n){return J.util.equals(Zn,e,n)}}Zn.runtime=J;Zn.typeName="google.protobuf.Timestamp";Zn.fields=J.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const Wj=J.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Zn},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Zj,repeated:!0},{no:5,name:"events",kind:"message",T:Jj,repeated:!0}]),Zj=J.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Yj,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Yj=J.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Zn},{no:3,name:"value",kind:"scalar",T:2}]),Jj=J.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Zn},{no:7,name:"normalized_end_timestamp",kind:"message",T:Zn,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),K9=J.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Ui=J.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),cn=J.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Vp=J.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),cl=J.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),vl=J.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),zi=J.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Pa=J.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Qj=J.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Sn=J.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),md=J.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:zu,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:r5}]),zu=J.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Xj=J.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:J.getEnumType(cn),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ha=J.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:J.getEnumType(Br)},{no:4,name:"tracks",kind:"message",T:Lr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Xj},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:J.getEnumType(yl)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:J.getEnumType(zi)},{no:18,name:"kind_details",kind:"enum",T:J.getEnumType(eR),repeated:!0}]),Br=J.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),yl=J.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),eR=J.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),vn=J.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),tR=J.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ua,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:J.getEnumType(W9)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Lr=J.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:J.getEnumType(Ui)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:J.getEnumType(cn)},{no:10,name:"layers",kind:"message",T:ua,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:tR,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:J.getEnumType(vn)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:r5},{no:19,name:"audio_features",kind:"enum",T:J.getEnumType(Sn),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:J.getEnumType(K9)}]),ua=J.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:J.getEnumType(Vp)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),W9=J.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Un=J.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:J.getEnumType(st)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Hp,oneof:"value"},{no:3,name:"speaker",kind:"message",T:nR,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Q9,oneof:"value"},{no:7,name:"transcription",kind:"message",T:iR,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Wj,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:qu,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:$p,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Gp,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Kp,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Vu,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Hu,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:$u,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Z9,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),st=J.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Z9=J.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:J.getEnumType(vn)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Y9=J.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Hp,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:qu,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:$p,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Gp,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Kp,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Vu,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Hu,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:$u,oneof:"value"}]),nR=J.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:J9,repeated:!0}]),J9=J.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Hp=J.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Q9=J.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),iR=J.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:sR,repeated:!0}]),sR=J.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),qu=J.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),$p=J.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Gp=J.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Kp=J.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:X9,oneof:"value"}]),X9=J.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),e5=J.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),t5=J.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:J.getEnumType(n5)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),n5=J.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),i5=J.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:J.getEnumType(s5)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),s5=J.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),a5=J.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:jb},{no:2,name:"screen",kind:"message",T:jb},{no:3,name:"resume_connection",kind:"enum",T:J.getEnumType(vl)},{no:4,name:"disabled_codecs",kind:"message",T:aR},{no:5,name:"force_relay",kind:"enum",T:J.getEnumType(vl)}]),jb=J.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:J.getEnumType(vl)}]),aR=J.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:zu,repeated:!0},{no:2,name:"publish",kind:"message",T:zu,repeated:!0}]),r5=J.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Gm=J.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),o5=J.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:J.getEnumType(Gm)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),l5=J.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Vu=J.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:J.getEnumType(vn)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:o5,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:l5,oneof:"content_header"}],{localName:"DataStream_Header"}),Hu=J.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),$u=J.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),rR=J.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Bi=J.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Km=J.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),oR=J.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),lR=J.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:ma,oneof:"message"},{no:2,name:"answer",kind:"message",T:ma,oneof:"message"},{no:3,name:"trickle",kind:"message",T:pd,oneof:"message"},{no:4,name:"add_track",kind:"message",T:bl,oneof:"message"},{no:5,name:"mute",kind:"message",T:gd,oneof:"message"},{no:6,name:"subscription",kind:"message",T:vd,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:c5,oneof:"message"},{no:8,name:"leave",kind:"message",T:yd,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:d5,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:m5,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Qp,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Qi,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Yp,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:v5,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Zp,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:u5,oneof:"message"}]),Rb=J.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:cR,oneof:"message"},{no:2,name:"answer",kind:"message",T:ma,oneof:"message"},{no:3,name:"offer",kind:"message",T:ma,oneof:"message"},{no:4,name:"trickle",kind:"message",T:pd,oneof:"message"},{no:5,name:"update",kind:"message",T:hR,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Wp,oneof:"message"},{no:8,name:"leave",kind:"message",T:yd,oneof:"message"},{no:9,name:"mute",kind:"message",T:gd,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:fR,oneof:"message"},{no:11,name:"room_update",kind:"message",T:mR,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:gR,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:yR,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:CR,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:SR,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:dR,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:uR,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:TR,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:jR,oneof:"message"},{no:22,name:"request_response",kind:"message",T:RR,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:NR,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:kR,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:OR,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:xR,oneof:"message"}]),Wm=J.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ua,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:J.getEnumType(W9)}]),bl=J.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:J.getEnumType(Ui)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:J.getEnumType(cn)},{no:9,name:"layers",kind:"message",T:ua,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Wm,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:J.getEnumType(vn)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:J.getEnumType(K9)},{no:17,name:"audio_features",kind:"enum",T:J.getEnumType(Sn),repeated:!0}]),pd=J.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:J.getEnumType(Bi)},{no:3,name:"final",kind:"scalar",T:8}]),gd=J.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),cR=J.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:md},{no:2,name:"participant",kind:"message",T:Ha},{no:3,name:"other_participants",kind:"message",T:Ha,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:h5,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:a5},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:t5},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:zu,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),uR=J.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:h5,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:a5},{no:3,name:"server_info",kind:"message",T:t5},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Wp=J.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Lr}]),dR=J.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),ma=J.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),hR=J.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ha,repeated:!0}]),vd=J.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:e5,repeated:!0}]),c5=J.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:J.getEnumType(Vp)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Zp=J.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:J.getEnumType(Sn),repeated:!0}]),u5=J.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),yd=J.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:J.getEnumType(zi)},{no:3,name:"action",kind:"enum",T:J.getEnumType(Fr)},{no:4,name:"regions",kind:"message",T:ER}]),Fr=J.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),d5=J.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ua,repeated:!0}]),Yp=J.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),h5=J.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),fR=J.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:J9,repeated:!0}]),mR=J.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:md}]),pR=J.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:J.getEnumType(cl)},{no:3,name:"score",kind:"scalar",T:2}]),gR=J.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:pR,repeated:!0}]),vR=J.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:J.getEnumType(Km)}]),yR=J.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:vR,repeated:!0}]),Jp=J.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:J.getEnumType(Vp)},{no:2,name:"enabled",kind:"scalar",T:8}]),bR=J.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Jp,repeated:!0}]),CR=J.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Jp,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:bR,repeated:!0}]),xR=J.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:rR,repeated:!0}]),f5=J.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),m5=J.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:f5,repeated:!0}]),SR=J.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),kR=J.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:md},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ha},{no:4,name:"other_participants",kind:"message",T:Ha,repeated:!0}]),Qp=J.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:ma},{no:2,name:"subscription",kind:"message",T:vd},{no:3,name:"publish_tracks",kind:"message",T:Wp,repeated:!0},{no:4,name:"data_channels",kind:"message",T:g5,repeated:!0},{no:5,name:"offer",kind:"message",T:ma},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:p5,repeated:!0}]),p5=J.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),g5=J.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:J.getEnumType(Bi)}]),Qi=J.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:J.getEnumType(oR),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),v5=J.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),TR=J.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),ER=J.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:wR,repeated:!0}]),wR=J.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),jR=J.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:J.getEnumType(Qj)}]),RR=J.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:J.getEnumType(Xp)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:pd,oneof:"request"},{no:5,name:"add_track",kind:"message",T:bl,oneof:"request"},{no:6,name:"mute",kind:"message",T:gd,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Yp,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Zp,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:u5,oneof:"request"}]),Xp=J.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),NR=J.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),y5=J.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),_R=J.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:i5},{no:2,name:"connection_settings",kind:"message",T:y5},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:bl,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:ma},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:J.getEnumType(Pa)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Qp}]),AR=J.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:J.getEnumType(MR)},{no:2,name:"join_request",kind:"scalar",T:12}]),MR=J.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),OR=J.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function DR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Eu={exports:{}},LR=Eu.exports,Nb;function PR(){return Nb||(Nb=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(LR,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],l={},u=null;function d(k,E){var _=k[E];if(typeof _.bind=="function")return _.bind(k);try{return Function.prototype.bind.call(_,k)}catch{return function(){return Function.prototype.apply.apply(_,[k,arguments])}}}function f(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function m(k){return k==="debug"&&(k="log"),typeof console===n?!1:k==="trace"&&i?f:console[k]!==void 0?d(console,k):console.log!==void 0?d(console,"log"):e}function p(){for(var k=this.getLevel(),E=0;E<r.length;E++){var _=r[E];this[_]=E<k?e:this.methodFactory(_,k,this.name)}if(this.log=this.debug,typeof console===n&&k<this.levels.SILENT)return"No console available for logging"}function v(k){return function(){typeof console!==n&&(p.call(this),this[k].apply(this,arguments))}}function C(k,E,_){return m(k)||v.apply(this,arguments)}function x(k,E){var _=this,O,A,w,j="loglevel";typeof k=="string"?j+=":"+k:typeof k=="symbol"&&(j=void 0);function R(I){var B=(r[I]||"silent").toUpperCase();if(!(typeof window===n||!j)){try{window.localStorage[j]=B;return}catch{}try{window.document.cookie=encodeURIComponent(j)+"="+B+";"}catch{}}}function N(){var I;if(!(typeof window===n||!j)){try{I=window.localStorage[j]}catch{}if(typeof I===n)try{var B=window.document.cookie,G=encodeURIComponent(j),Z=B.indexOf(G+"=");Z!==-1&&(I=/^([^;]+)/.exec(B.slice(Z+G.length+1))[1])}catch{}return _.levels[I]===void 0&&(I=void 0),I}}function L(){if(!(typeof window===n||!j)){try{window.localStorage.removeItem(j)}catch{}try{window.document.cookie=encodeURIComponent(j)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function F(I){var B=I;if(typeof B=="string"&&_.levels[B.toUpperCase()]!==void 0&&(B=_.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=_.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+I)}_.name=k,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=E||C,_.getLevel=function(){return w??A??O},_.setLevel=function(I,B){return w=F(I),B!==!1&&R(w),p.call(_)},_.setDefaultLevel=function(I){A=F(I),N()||_.setLevel(I,!1)},_.resetLevel=function(){w=null,L(),p.call(_)},_.enableAll=function(I){_.setLevel(_.levels.TRACE,I)},_.disableAll=function(I){_.setLevel(_.levels.SILENT,I)},_.rebuild=function(){if(u!==_&&(O=F(u.getLevel())),p.call(_),u===_)for(var I in l)l[I].rebuild()},O=F(u?u.getLevel():"WARN");var D=N();D!=null&&(w=F(D)),p.call(_)}u=new x,u.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var _=l[E];return _||(_=l[E]=new x(E,u.methodFactory)),_};var S=typeof window!==n?window.log:void 0;return u.noConflict=function(){return typeof window!==n&&window.log===u&&(window.log=S),u},u.getLoggers=function(){return l},u.default=u,u})})(Eu)),Eu.exports}var bd=PR(),Zm;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Zm||(Zm={}));var qi;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(qi||(qi={}));let Xe=bd.getLogger("livekit");Object.values(qi).map(t=>bd.getLogger(t));Xe.setDefaultLevel(Zm.info);function As(t){const e=bd.getLogger(t);return e.setDefaultLevel(Xe.getLevel()),e}const IR=bd.getLogger("lk-e2ee"),il=7e3,UR=[0,300,4*300,9*300,16*300,il,il,il,il,il];class BR{constructor(e){this._retryDelays=e!==void 0?[...e]:UR}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function FR(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function U(t,e,n,i){function r(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function d(p){try{m(i.next(p))}catch(v){u(v)}}function f(p){try{m(i.throw(p))}catch(v){u(v)}}function m(p){p.done?l(p.value):r(p.value).then(d,f)}m((i=i.apply(t,e||[])).next())})}function _b(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function js(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof _b=="function"?_b(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(l){n[l]=t[l]&&function(u){return new Promise(function(d,f){u=t[l](u),r(d,f,u.done,u.value)})}}function r(l,u,d,f){Promise.resolve(f).then(function(m){l({value:m,done:d})},u)}}var su={exports:{}},Ab;function zR(){if(Ab)return su.exports;Ab=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(j,R,N){return Function.prototype.apply.call(j,R,N)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(j){return Object.getOwnPropertyNames(j).concat(Object.getOwnPropertySymbols(j))}:n=function(j){return Object.getOwnPropertyNames(j)};function i(w){console&&console.warn&&console.warn(w)}var r=Number.isNaN||function(j){return j!==j};function l(){l.init.call(this)}su.exports=l,su.exports.once=_,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var u=10;function d(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(w){if(typeof w!="number"||w<0||r(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");u=w}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(j){if(typeof j!="number"||j<0||r(j))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+j+".");return this._maxListeners=j,this};function f(w){return w._maxListeners===void 0?l.defaultMaxListeners:w._maxListeners}l.prototype.getMaxListeners=function(){return f(this)},l.prototype.emit=function(j){for(var R=[],N=1;N<arguments.length;N++)R.push(arguments[N]);var L=j==="error",F=this._events;if(F!==void 0)L=L&&F.error===void 0;else if(!L)return!1;if(L){var D;if(R.length>0&&(D=R[0]),D instanceof Error)throw D;var I=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw I.context=D,I}var B=F[j];if(B===void 0)return!1;if(typeof B=="function")e(B,this,R);else for(var G=B.length,Z=S(B,G),N=0;N<G;++N)e(Z[N],this,R);return!0};function m(w,j,R,N){var L,F,D;if(d(R),F=w._events,F===void 0?(F=w._events=Object.create(null),w._eventsCount=0):(F.newListener!==void 0&&(w.emit("newListener",j,R.listener?R.listener:R),F=w._events),D=F[j]),D===void 0)D=F[j]=R,++w._eventsCount;else if(typeof D=="function"?D=F[j]=N?[R,D]:[D,R]:N?D.unshift(R):D.push(R),L=f(w),L>0&&D.length>L&&!D.warned){D.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(j)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=w,I.type=j,I.count=D.length,i(I)}return w}l.prototype.addListener=function(j,R){return m(this,j,R,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(j,R){return m(this,j,R,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(w,j,R){var N={fired:!1,wrapFn:void 0,target:w,type:j,listener:R},L=p.bind(N);return L.listener=R,N.wrapFn=L,L}l.prototype.once=function(j,R){return d(R),this.on(j,v(this,j,R)),this},l.prototype.prependOnceListener=function(j,R){return d(R),this.prependListener(j,v(this,j,R)),this},l.prototype.removeListener=function(j,R){var N,L,F,D,I;if(d(R),L=this._events,L===void 0)return this;if(N=L[j],N===void 0)return this;if(N===R||N.listener===R)--this._eventsCount===0?this._events=Object.create(null):(delete L[j],L.removeListener&&this.emit("removeListener",j,N.listener||R));else if(typeof N!="function"){for(F=-1,D=N.length-1;D>=0;D--)if(N[D]===R||N[D].listener===R){I=N[D].listener,F=D;break}if(F<0)return this;F===0?N.shift():k(N,F),N.length===1&&(L[j]=N[0]),L.removeListener!==void 0&&this.emit("removeListener",j,I||R)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(j){var R,N,L;if(N=this._events,N===void 0)return this;if(N.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):N[j]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete N[j]),this;if(arguments.length===0){var F=Object.keys(N),D;for(L=0;L<F.length;++L)D=F[L],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(R=N[j],typeof R=="function")this.removeListener(j,R);else if(R!==void 0)for(L=R.length-1;L>=0;L--)this.removeListener(j,R[L]);return this};function C(w,j,R){var N=w._events;if(N===void 0)return[];var L=N[j];return L===void 0?[]:typeof L=="function"?R?[L.listener||L]:[L]:R?E(L):S(L,L.length)}l.prototype.listeners=function(j){return C(this,j,!0)},l.prototype.rawListeners=function(j){return C(this,j,!1)},l.listenerCount=function(w,j){return typeof w.listenerCount=="function"?w.listenerCount(j):x.call(w,j)},l.prototype.listenerCount=x;function x(w){var j=this._events;if(j!==void 0){var R=j[w];if(typeof R=="function")return 1;if(R!==void 0)return R.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function S(w,j){for(var R=new Array(j),N=0;N<j;++N)R[N]=w[N];return R}function k(w,j){for(;j+1<w.length;j++)w[j]=w[j+1];w.pop()}function E(w){for(var j=new Array(w.length),R=0;R<j.length;++R)j[R]=w[R].listener||w[R];return j}function _(w,j){return new Promise(function(R,N){function L(D){w.removeListener(j,F),N(D)}function F(){typeof w.removeListener=="function"&&w.removeListener("error",L),R([].slice.call(arguments))}A(w,j,F,{once:!0}),j!=="error"&&O(w,L,{once:!0})})}function O(w,j,R){typeof w.on=="function"&&A(w,"error",j,R)}function A(w,j,R,N){if(typeof w.on=="function")N.once?w.once(j,R):w.on(j,R);else if(typeof w.addEventListener=="function")w.addEventListener(j,function L(F){N.once&&w.removeEventListener(j,L),R(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return su.exports}var ss=zR();let b5=!0,C5=!0;function ul(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Za(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(u,d){if(u!==e)return r.apply(this,arguments);const f=m=>{const p=n(m);p&&(d.handleEvent?d.handleEvent(p):d(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(d,f),r.apply(this,[u,f])};const l=i.removeEventListener;i.removeEventListener=function(u,d){if(u!==e||!this._eventMap||!this._eventMap[e])return l.apply(this,arguments);if(!this._eventMap[e].has(d))return l.apply(this,arguments);const f=this._eventMap[e].get(d);return this._eventMap[e].delete(d),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,f])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(u){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),u&&this.addEventListener(e,this["_on"+e]=u)},enumerable:!0,configurable:!0})}function qR(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(b5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function VR(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(C5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function x5(){if(typeof window=="object"){if(b5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function eg(t,e){C5&&console.warn(t+" is deprecated, please use "+e+" instead.")}function HR(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ul(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ul(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ul(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ul(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Mb(t){return Object.prototype.toString.call(t)==="[object Object]"}function S5(t){return Mb(t)?Object.keys(t).reduce(function(e,n){const i=Mb(t[n]),r=i?S5(t[n]):t[n],l=i&&!Object.keys(r).length;return r===void 0||l?e:Object.assign(e,{[n]:r})},{}):t}function Ym(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Ym(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Ym(t,t.get(r),n)})}))}function Ob(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const l=[];return t.forEach(u=>{u.type==="track"&&u.trackIdentifier===e.id&&l.push(u)}),l.forEach(u=>{t.forEach(d=>{d.type===i&&d.trackId===u.id&&Ym(t,d,r)})}),r}const Db=x5;function k5(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const f={};return Object.keys(d).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const p=typeof d[m]=="object"?d[m]:{ideal:d[m]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const v=function(C,x){return C?C+x.charAt(0).toUpperCase()+x.slice(1):x==="deviceId"?"sourceId":x};if(p.ideal!==void 0){f.optional=f.optional||[];let C={};typeof p.ideal=="number"?(C[v("min",m)]=p.ideal,f.optional.push(C),C={},C[v("max",m)]=p.ideal,f.optional.push(C)):(C[v("",m)]=p.ideal,f.optional.push(C))}p.exact!==void 0&&typeof p.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[v("",m)]=p.exact):["min","max"].forEach(C=>{p[C]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[v(C,m)]=p[C])})}),d.advanced&&(f.optional=(f.optional||[]).concat(d.advanced)),f},r=function(d,f){if(e.version>=61)return f(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const m=function(p,v,C){v in p&&!(C in p)&&(p[C]=p[v],delete p[v])};d=JSON.parse(JSON.stringify(d)),m(d.audio,"autoGainControl","googAutoGainControl"),m(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=i(d.audio)}if(d&&typeof d.video=="object"){let m=d.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const p=e.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete d.video.facingMode;let v;if(m.exact==="environment"||m.ideal==="environment"?v=["back","rear"]:(m.exact==="user"||m.ideal==="user")&&(v=["front"]),v)return n.mediaDevices.enumerateDevices().then(C=>{C=C.filter(S=>S.kind==="videoinput");let x=C.find(S=>v.some(k=>S.label.toLowerCase().includes(k)));return!x&&C.length&&v.includes("back")&&(x=C[C.length-1]),x&&(d.video.deviceId=m.exact?{exact:x.deviceId}:{ideal:x.deviceId}),d.video=i(d.video),Db("chrome: "+JSON.stringify(d)),f(d)})}d.video=i(d.video)}return Db("chrome: "+JSON.stringify(d)),f(d)},l=function(d){return e.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},u=function(d,f,m){r(d,p=>{n.webkitGetUserMedia(p,f,v=>{m&&m(l(v))})})};if(n.getUserMedia=u.bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(f){return r(f,m=>d(m).then(p=>{if(m.audio&&!p.getAudioTracks().length||m.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(l(p))))}}}function T5(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function E5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let l;t.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===r.track.id):l={track:r.track};const u=new Event("track");u.track=r.track,u.receiver=l,u.transceiver={receiver:l},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(r=>{let l;t.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===r.id):l={track:r};const u=new Event("track");u.track=r,u.receiver=l,u.transceiver={receiver:l},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Za(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function w5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=r.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,f){let m=r.apply(this,arguments);return m||(m=e(this,d),this._senders.push(m)),m};const l=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){l.apply(this,arguments);const f=this._senders.indexOf(d);f!==-1&&this._senders.splice(f,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],n.apply(this,[l]),l.getTracks().forEach(u=>{this._senders.push(e(this,u))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],i.apply(this,[l]),l.getTracks().forEach(u=>{const d=this._senders.find(f=>f.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function j5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const l=n.apply(this,[]);return l.forEach(u=>u._pc=this),l});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const l=i.apply(this,arguments);return l._pc=this,l}),t.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(u=>Ob(u,l.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(l=>l._pc=this),r}),Za(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(l=>Ob(l,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,l,u;return this.getSenders().forEach(d=>{d.track===i&&(r?u=!0:r=d)}),this.getReceivers().forEach(d=>(d.track===i&&(l?u=!0:l=d),d.track===i)),u||r&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function R5(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=e.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(f)===-1&&this._shimmedLocalStreams[d.id].push(f):this._shimmedLocalStreams[d.id]=[d,f],f};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(m=>{if(this.getSenders().find(v=>v.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const f=this.getSenders().filter(m=>d.indexOf(m)===-1);this._shimmedLocalStreams[u.id]=[u].concat(f)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const f=this._shimmedLocalStreams[d].indexOf(u);f!==-1&&this._shimmedLocalStreams[d].splice(f,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),r.apply(this,arguments)}}function N5(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return R5(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(v=>this._reverseStreams[v.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(v=>{if(this.getSenders().find(x=>x.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const v=new t.MediaStream(p.getTracks());this._streams[p.id]=v,this._reverseStreams[v.id]=p,p=v}i.apply(this,[p])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},t.RTCPeerConnection.prototype.addTrack=function(p,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const C=[].slice.call(arguments,1);if(C.length!==1||!C[0].getTracks().find(k=>k===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[v.id];if(S)S.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([p]);this._streams[v.id]=k,this._reverseStreams[k.id]=v,this.addStream(k)}return this.getSenders().find(k=>k.track===p)};function l(m,p){let v=p.sdp;return Object.keys(m._reverseStreams||[]).forEach(C=>{const x=m._reverseStreams[C],S=m._streams[x.id];v=v.replace(new RegExp(S.id,"g"),x.id)}),new RTCSessionDescription({type:p.type,sdp:v})}function u(m,p){let v=p.sdp;return Object.keys(m._reverseStreams||[]).forEach(C=>{const x=m._reverseStreams[C],S=m._streams[x.id];v=v.replace(new RegExp(x.id,"g"),S.id)}),new RTCSessionDescription({type:p.type,sdp:v})}["createOffer","createAnswer"].forEach(function(m){const p=t.RTCPeerConnection.prototype[m],v={[m](){const C=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[S=>{const k=l(this,S);C[0].apply(null,[k])},S=>{C[1]&&C[1].apply(null,S)},arguments[2]]):p.apply(this,arguments).then(S=>l(this,S))}};t.RTCPeerConnection.prototype[m]=v[m]});const d=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=u(this,arguments[0]),d.apply(this,arguments))};const f=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const m=f.get.apply(this);return m.type===""?m:l(this,m)}}),t.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let C;Object.keys(this._streams).forEach(x=>{this._streams[x].getTracks().find(k=>p.track===k)&&(C=this._streams[x])}),C&&(C.getTracks().length===1?this.removeStream(this._reverseStreams[C.id]):C.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Jm(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function _5(t,e){Za(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Lb=Object.freeze({__proto__:null,fixNegotiationNeeded:_5,shimAddTrackRemoveTrack:N5,shimAddTrackRemoveTrackWithNative:R5,shimGetSendersWithDtmf:w5,shimGetUserMedia:k5,shimMediaStream:T5,shimOnTrack:E5,shimPeerConnection:Jm,shimSenderReceiverGetStats:j5});function A5(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,l,u){eg("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(l,u)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),r(u.audio,"autoGainControl","mozAutoGainControl"),r(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},i&&i.prototype.getSettings){const u=i.prototype.getSettings;i.prototype.getSettings=function(){const d=u.apply(this,arguments);return r(d,"mozAutoGainControl","autoGainControl"),r(d,"mozNoiseSuppression","noiseSuppression"),d}}if(i&&i.prototype.applyConstraints){const u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),r(d,"autoGainControl","mozAutoGainControl"),r(d,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[d])}}}}function $R(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function M5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qm(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const l=t.RTCPeerConnection.prototype[r],u={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=u[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[l,u,d]=arguments;return i.apply(this,[l||null]).then(f=>{if(e.version<53&&!u)try{f.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;f.forEach((p,v)=>{f.set(v,Object.assign({},p,{type:n[p.type]||p.type}))})}return f}).then(u,d)}}function O5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(l=>l._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function D5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Za(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function L5(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){eg("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function P5(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function I5(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=e.apply(this,arguments);if(r){const{sender:u}=l,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return l})}function U5(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function B5(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function F5(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Pb=Object.freeze({__proto__:null,shimAddTransceiver:I5,shimCreateAnswer:F5,shimCreateOffer:B5,shimGetDisplayMedia:$R,shimGetParameters:U5,shimGetUserMedia:A5,shimOnTrack:M5,shimPeerConnection:Qm,shimRTCDataChannel:P5,shimReceiverGetStats:D5,shimRemoveStream:L5,shimSenderGetStats:O5});function z5(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,l=new Array(r>1?r-1:0),u=1;u<r;u++)l[u-1]=arguments[u];return l&&l.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(l=>{r.includes(l.track)&&this.removeTrack(l)})})}}function q5(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const l=new Event("addstream");l.stream=r,this.dispatchEvent(l)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(l=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(l)>=0)return;i._remoteStreams.push(l);const u=new Event("addstream");u.stream=l,i.dispatchEvent(u)})}),e.apply(i,arguments)}}}function V5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,l=e.setRemoteDescription,u=e.addIceCandidate;e.createOffer=function(m,p){const v=arguments.length>=2?arguments[2]:arguments[0],C=n.apply(this,[v]);return p?(C.then(m,p),Promise.resolve()):C},e.createAnswer=function(m,p){const v=arguments.length>=2?arguments[2]:arguments[0],C=i.apply(this,[v]);return p?(C.then(m,p),Promise.resolve()):C};let d=function(f,m,p){const v=r.apply(this,[f]);return p?(v.then(m,p),Promise.resolve()):v};e.setLocalDescription=d,d=function(f,m,p){const v=l.apply(this,[f]);return p?(v.then(m,p),Promise.resolve()):v},e.setRemoteDescription=d,d=function(f,m,p){const v=u.apply(this,[f]);return p?(v.then(m,p),Promise.resolve()):v},e.addIceCandidate=d}function H5(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i($5(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,l){e.mediaDevices.getUserMedia(i).then(r,l)}).bind(e))}function $5(t){return t&&t.video!==void 0?Object.assign({},t,{video:S5(t.video)}):t}function G5(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const l=[];for(let u=0;u<i.iceServers.length;u++){let d=i.iceServers[u];d.urls===void 0&&d.url?(eg("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,l.push(d)):l.push(i.iceServers[u])}i.iceServers=l}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function K5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function W5(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const l=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):i.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Z5(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Ib=Object.freeze({__proto__:null,shimAudioContext:Z5,shimCallbacksAPI:V5,shimConstraints:$5,shimCreateOfferLegacy:W5,shimGetUserMedia:H5,shimLocalStreamsAPI:z5,shimRTCIceServerUrls:G5,shimRemoteStreamsAPI:q5,shimTrackEventTransceiver:K5}),sm={exports:{}},Ub;function GR(){return Ub||(Ub=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,l)=>(l>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let l=8;l<i.length;l+=2)switch(i[l]){case"raddr":r.relatedAddress=i[l+1];break;case"rport":r.relatedPort=parseInt(i[l+1],10);break;case"tcptype":r.tcpType=i[l+1];break;case"ufrag":r.ufrag=i[l+1],r.usernameFragment=i[l+1];break;default:r[i[l]]===void 0&&(r[i[l]]=i[l+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const l=n.type;return i.push("typ"),i.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const l=n.substring(n.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)r=l[u].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(u=>{n.parameters[u]!==void 0?l.push(u+"="+n.parameters[u]):l.push(u)}),i+="a=fmtp:"+r+" "+l.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{i+="a=rtcp-fb:"+r+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},l=n.indexOf(":",i);return l>-1?(r.attribute=n.substring(i+1,l),r.value=n.substring(l+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(l=>{r+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],l=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&l?{usernameFragment:r.substring(12),password:l.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=e.splitLines(n)[0].split(" ");i.profile=l[2];for(let d=3;d<l.length;d++){const f=l[d],m=e.matchPrefix(n,"a=rtpmap:"+f+" ")[0];if(m){const p=e.parseRtpMap(m),v=e.matchPrefix(n,"a=fmtp:"+f+" ");switch(p.parameters=v.length?e.parseFmtp(v[0]):{},p.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+f+" ").map(e.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(d=>{i.headerExtensions.push(e.parseExtmap(d))});const u=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(d=>{u.forEach(f=>{d.rtcpFeedback.find(p=>p.type===f.type&&p.parameter===f.parameter)||d.rtcpFeedback.push(f)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(u=>{r+=e.writeRtpMap(u),r+=e.writeFmtp(u),r+=e.writeRtcpFb(u)});let l=0;return i.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(r+="a=maxptime:"+l+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(u=>{r+=e.writeExtmap(u)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),l=r.fecMechanisms.indexOf("RED")!==-1,u=r.fecMechanisms.indexOf("ULPFEC")!==-1,d=e.matchPrefix(n,"a=ssrc:").map(C=>e.parseSsrcMedia(C)).filter(C=>C.attribute==="cname"),f=d.length>0&&d[0].ssrc;let m;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(C=>C.substring(17).split(" ").map(S=>parseInt(S,10)));p.length>0&&p[0].length>1&&p[0][0]===f&&(m=p[0][1]),r.codecs.forEach(C=>{if(C.name.toUpperCase()==="RTX"&&C.parameters.apt){let x={ssrc:f,codecPayloadType:parseInt(C.parameters.apt,10)};f&&m&&(x.rtx={ssrc:m}),i.push(x),l&&(x=JSON.parse(JSON.stringify(x)),x.fec={ssrc:f,mechanism:u?"red+ulpfec":"red"},i.push(x))}}),i.length===0&&f&&i.push({ssrc:f});let v=e.matchPrefix(n,"b=");return v.length&&(v[0].indexOf("b=TIAS:")===0?v=parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?v=parseInt(v[0].substring(5),10)*1e3*.95-2e3*8:v=void 0,i.forEach(C=>{C.maxBitrate=v})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const l=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=l.length>0,i.compound=l.length===0;const u=e.matchPrefix(n,"a=rtcp-mux");return i.mux=u.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const l=e.matchPrefix(n,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");if(l.length>0)return i=l[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let l;r.length>0&&(l=parseInt(r[0].substring(19),10)),isNaN(l)&&(l=65536);const u=e.matchPrefix(n,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:i.fmt,maxMessageSize:l};const d=e.matchPrefix(n,"a=sctpmap:");if(d.length>0){const f=d[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:l}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let l;const u=i!==void 0?i:2;return n?l=n:l=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let l=0;l<r.length;l++)switch(r[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[l].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(sm)),sm.exports}var Y5=GR(),zr=DR(Y5),KR=nj({__proto__:null,default:zr},[Y5]);function wu(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),l=zr.parseCandidate(i.candidate);for(const u in l)u in r||Object.defineProperty(r,u,{value:l[u]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Za(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Xm(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Za(t,"icecandidate",e=>{if(e.candidate){const n=zr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function ju(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(d){if(!d||!d.sdp)return!1;const f=zr.splitSections(d.sdp);return f.shift(),f.some(m=>{const p=zr.parseMLine(m);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(d){const f=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const m=parseInt(f[1],10);return m!==m?-1:m},r=function(d){let f=65536;return e.browser==="firefox"&&(e.version<57?d===-1?f=16384:f=2147483637:e.version<60?f=e.version===57?65535:65536:f=2147483637),f},l=function(d,f){let m=65536;e.browser==="firefox"&&e.version===57&&(m=65535);const p=zr.matchPrefix(d.sdp,"a=max-message-size:");return p.length>0?m=parseInt(p[0].substring(19),10):e.browser==="firefox"&&f!==-1&&(m=2147483637),m},u=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const f=i(arguments[0]),m=r(f),p=l(arguments[0],f);let v;m===0&&p===0?v=Number.POSITIVE_INFINITY:m===0||p===0?v=Math.max(m,p):v=Math.min(m,p);const C={};Object.defineProperty(C,"maxMessageSize",{get(){return v}}),this._sctp=C}return u.apply(this,arguments)}}function Ru(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const l=i.send;i.send=function(){const d=arguments[0],f=d.length||d.size||d.byteLength;if(i.readyState==="open"&&r.sctp&&f>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return l.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Za(t,"datachannel",i=>(e(i.channel,i.target),i))}function ep(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const l=r.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const u=new Event("connectionstatechange",r);l.dispatchEvent(u)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function tp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=r.sdp.split(`
`).filter(u=>u.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:l}):r.sdp=l}return n.apply(this,arguments)}}function Nu(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function _u(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>n.apply(this,[u]))})}var WR=Object.freeze({__proto__:null,removeExtmapAllowMixed:tp,shimAddIceCandidateNullOrEmpty:Nu,shimConnectionState:ep,shimMaxMessageSize:ju,shimParameterlessSetLocalDescription:_u,shimRTCIceCandidate:wu,shimRTCIceCandidateRelayProtocol:Xm,shimSendThrowTypeError:Ru});function ZR(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=x5,i=HR(t),r={browserDetails:i,commonShim:WR,extractVersion:ul,disableLog:qR,disableWarnings:VR,sdp:KR};switch(i.browser){case"chrome":if(!Lb||!Jm||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Lb,Nu(t,i),_u(t),k5(t,i),T5(t),Jm(t,i),E5(t),N5(t,i),w5(t),j5(t),_5(t,i),wu(t),Xm(t),ep(t),ju(t,i),Ru(t),tp(t,i);break;case"firefox":if(!Pb||!Qm||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Pb,Nu(t,i),_u(t),A5(t,i),Qm(t,i),M5(t),L5(t),O5(t),D5(t),P5(t),I5(t),U5(t),B5(t),F5(t),wu(t),ep(t),ju(t,i),Ru(t);break;case"safari":if(!Ib||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Ib,Nu(t,i),_u(t),G5(t),W5(t),V5(t),z5(t),q5(t),K5(t),H5(t),Z5(t),wu(t),Xm(t),ju(t,i),Ru(t),tp(t,i);break;default:n("Unsupported browser!");break}return r}ZR({window:typeof window>"u"?void 0:window});const YR=10,sl="lk_e2ee",JR="LKFrameEncryptionKey",QR={sharedKey:!1,ratchetSalt:JR,ratchetWindowSize:8,failureTolerance:YR,keyringSize:16};var da;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(da||(da={}));var Bb;(function(t){t.KeyRatcheted="keyRatcheted"})(Bb||(Bb={}));var la;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(la||(la={}));var Fb;(function(t){t.Error="cryptorError"})(Fb||(Fb={}));function XR(){return eN()||np()}function np(){return typeof window.RTCRtpScriptTransform<"u"}function eN(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function tN(t){var e,n,i,r,l;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((l=t.value)===null||l===void 0?void 0:l.case)!=="encryptedPacket")return new Y9({value:t.value})}class RM extends ss.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Xe.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},QR),e),this.on(da.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(da.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(da.RatchetRequest,e,n)}}class Ms extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Ge;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(Ge||(Ge={}));class ut extends Ms{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=Ge[n]}}class tg extends Ms{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Rs extends Ms{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class nN extends Ms{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class gn extends Ms{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ip extends Ms{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class zb extends Ms{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class qb extends Ms{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Xp[n]}}var In;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(In||(In={}));class wi extends Ms{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=In[n]}}var Gu;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Gu||(Gu={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Gu||(Gu={}));var Vb;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(Vb||(Vb={}));var ye;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(ye||(ye={}));var Re;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(Re||(Re={}));var je;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(je||(je={}));var Ce;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(Ce||(Ce={}));function iN(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const sN=/version\/(\d+(\.?_?\d+)+)/i;let am;function ti(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(am===void 0||e){const i=aN.find(r=>{let{test:l}=r;return l.test(n)});am=i==null?void 0:i.describe(n)}return am}const aN=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Au(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:rm(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Au(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:rm(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Au(sN,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:rm(t)}}}];function Au(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function rm(t){return t.includes("mac os")?Au(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var rN="2.16.0";const oN=rN,lN=16;class Nn{}Nn.setTimeout=function(){return setTimeout(...arguments)};Nn.setInterval=function(){return setInterval(...arguments)};Nn.clearTimeout=function(){return clearTimeout(...arguments)};Nn.clearInterval=function(){return clearInterval(...arguments)};const cN=5e3,al=[];var di;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(di||(di={}));class pe extends ss.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=pe.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Xe,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),cN):this.handleAppVisibilityChanged()},this.log=As((r=i.loggerName)!==null&&r!==void 0?r:qi.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=pe.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),it(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===pe.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===pe.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(al.forEach(l=>{l.parentElement===null&&!e&&(e=l)}),e&&al.splice(al.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Pr(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(l=>l.kind==="audio");return e.play().then(()=>{this.emit(r?Ce.AudioPlaybackStarted:Ce.VideoPlaybackStarted)}).catch(l=>{l.name==="NotAllowedError"?this.emit(r?Ce.AudioPlaybackFailed:Ce.VideoPlaybackFailed,l):l.name==="AbortError"?Xe.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Xe.warn("could not playback ".concat(r?"audio":"video"),l),r&&e&&i.some(u=>u.kind==="video")&&l.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Ce.ElementAttached,e),e}detach(e){try{if(e){qr(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(Ce.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{qr(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(Ce.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=As(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),al.forEach(i=>{i.parentElement||(n=!1)}),n&&al.push(e)}}handleAppVisibilityChanged(){return U(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===pe.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Yn()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Yn()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Pr(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Ga()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Ga()||$a())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function qr(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(m){m.Audio="audio",m.Video="video",m.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(m){m.Camera="camera",m.Microphone="microphone",m.ScreenShare="screen_share",m.ScreenShareAudio="screen_share_audio",m.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(m){m.Active="active",m.Paused="paused",m.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(m){switch(m){case e.Audio:return Ui.AUDIO;case e.Video:return Ui.VIDEO;default:return Ui.DATA}}t.kindToProto=r;function l(m){switch(m){case Ui.AUDIO:return e.Audio;case Ui.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=l;function u(m){switch(m){case n.Camera:return cn.CAMERA;case n.Microphone:return cn.MICROPHONE;case n.ScreenShare:return cn.SCREEN_SHARE;case n.ScreenShareAudio:return cn.SCREEN_SHARE_AUDIO;default:return cn.UNKNOWN}}t.sourceToProto=u;function d(m){switch(m){case cn.CAMERA:return n.Camera;case cn.MICROPHONE:return n.Microphone;case cn.SCREEN_SHARE:return n.ScreenShare;case cn.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=d;function f(m){switch(m){case Km.ACTIVE:return i.Active;case Km.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=f})(pe||(pe={}));class Rt{constructor(e,n,i,r,l){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:l};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const uN=["vp8","h264"],dN=["vp8","h264","vp9","av1","h265"];function hN(t){return!!uN.find(e=>e===t)}const fN=hN;var Hb;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Hb||(Hb={}));var sp;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(sp||(sp={}));const Cl={h90:new Rt(160,90,9e4,20),h180:new Rt(320,180,16e4,20),h216:new Rt(384,216,18e4,20),h360:new Rt(640,360,45e4,20),h540:new Rt(960,540,8e5,25),h720:new Rt(1280,720,17e5,30),h1080:new Rt(1920,1080,3e6,30),h1440:new Rt(2560,1440,5e6,30),h2160:new Rt(3840,2160,8e6,30)},ap={h120:new Rt(160,120,7e4,20),h180:new Rt(240,180,125e3,20),h240:new Rt(320,240,14e4,20),h360:new Rt(480,360,33e4,20),h480:new Rt(640,480,5e5,20),h540:new Rt(720,540,6e5,25),h720:new Rt(960,720,13e5,30),h1080:new Rt(1440,1080,23e5,30),h1440:new Rt(1920,1440,38e5,30)},ng={h360fps3:new Rt(640,360,2e5,3,"medium"),h360fps15:new Rt(640,360,4e5,15,"medium"),h720fps5:new Rt(1280,720,8e5,5,"medium"),h720fps15:new Rt(1280,720,15e5,15,"medium"),h720fps30:new Rt(1280,720,2e6,30,"medium"),h1080fps15:new Rt(1920,1080,25e5,15,"medium"),h1080fps30:new Rt(1920,1080,5e6,30,"medium"),original:new Rt(0,0,7e6,30,"medium")},mN="|",$b="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function pN(t){const e=t.split(mN);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function _n(t){return U(this,void 0,void 0,function*(){return new Promise(e=>Nn.setTimeout(e,t))})}function rp(){return"addTransceiver"in RTCPeerConnection.prototype}function op(){return"addTrack"in RTCPeerConnection.prototype}function gN(){if(!("getCapabilities"in RTCRtpSender)||Ga()||$a())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function vN(){if(!("getCapabilities"in RTCRtpSender)||$a())return!1;if(Ga()){const n=ti();if(n!=null&&n.version&&is(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&is(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Fi(t){return t==="av1"||t==="vp9"}function lp(t){return!document||xl()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function yN(){return typeof RTCPeerConnection>"u"?!1:rp()||op()}function $a(){var t;return((t=ti())===null||t===void 0?void 0:t.name)==="Firefox"}function Gb(){const t=ti();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Ga(){var t;return((t=ti())===null||t===void 0?void 0:t.name)==="Safari"}function xl(){const t=ti();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function bN(){const t=ti();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&is(t.osVersion,"17")>=0}function CN(t){return t||(t=ti()),(t==null?void 0:t.name)==="Safari"&&is(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&is(t.osVersion,"18.3")>0}function J5(){var t,e;return Yn()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function xN(){const t=ti(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&is(t.osVersion,e)>=0?!0:t.name==="Safari"&&is(t.version,e)>=0}function Yn(){return typeof document<"u"}function ns(){return navigator.product=="ReactNative"}function Ku(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function om(t){return Ku(t)?t.hostname.split(".")[0]:null}function Q5(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function X5(){if(!ns())return;let t=Q5();if(t)return t.platform}function Kb(){if(Yn())return window.devicePixelRatio;if(ns()){let t=Q5();if(t)return t.devicePixelRatio}return 1}function is(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let l=0;l<r;++l){const u=parseInt(n[l],10),d=parseInt(i[l],10);if(u>d)return 1;if(u<d)return-1;if(l===r-1&&u===d)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function SN(t){for(const e of t)e.target.handleResize(e)}function kN(t){for(const e of t)e.target.handleVisibilityChanged(e)}let lm=null;const Wb=()=>(lm||(lm=new ResizeObserver(SN)),lm);let cm=null;const Zb=()=>(cm||(cm=new IntersectionObserver(kN,{root:null,rootMargin:"0px"})),cm);function TN(){var t;const e=new i5({sdk:s5.JS,protocol:lN,version:oN});return ns()&&(e.os=(t=X5())!==null&&t!==void 0?t:""),e}function Yb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const l=r.getContext("2d");l==null||l.fillRect(0,0,r.width,r.height),i&&l&&(l.beginPath(),l.arc(t/2,e/2,50,0,Math.PI*2,!0),l.closePath(),l.fillStyle="grey",l.fill());const u=r.captureStream(),[d]=u.getTracks();if(!d)throw Error("Could not get empty media stream video track");return d.enabled=n,d}let rl;function um(){if(!rl){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[rl]=i.stream.getAudioTracks(),!rl)throw Error("Could not get empty media stream audio track");rl.enabled=!1}return rl.clone()}class Ri{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>U(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function EN(t){return dN.includes(t)}function ha(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function wN(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Sl(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function jN(t,e){return t.segments.map(n=>{let{id:i,text:r,language:l,startTime:u,endTime:d,final:f}=n;var m;const p=(m=e.get(i))!==null&&m!==void 0?m:Date.now(),v=Date.now();return f?e.delete(i):e.set(i,p),{id:i,text:r,startTime:Number.parseInt(u.toString()),endTime:Number.parseInt(d.toString()),final:f,language:l,firstReceivedTime:p,lastReceivedTime:v}})}function RN(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Jb(t){switch(t.reason){case Ge.LeaveRequest:return t.context;case Ge.Cancelled:return zi.CLIENT_INITIATED;case Ge.NotAllowed:return zi.USER_REJECTED;case Ge.ServerUnreachable:return zi.JOIN_FAILURE;default:return zi.UNKNOWN_REASON}}function Mu(t){return t!==void 0?Number(t):void 0}function Ia(t){return t!==void 0?BigInt(t):void 0}function Vr(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function es(t){return!!t&&t.kind==pe.Kind.Audio}function pa(t){return!!t&&t.kind==pe.Kind.Video}function aa(t){return Vr(t)&&pa(t)}function ks(t){return Vr(t)&&es(t)}function cp(t){return!!t&&!t.isLocal}function NN(t){return!!t&&!t.isLocal}function dm(t){return cp(t)&&pa(t)}function _N(t){return t.isLocal}function AN(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const l=i[r];if(l!==void 0&&(l&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function MN(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function e4(t,e,n){var i,r,l,u;const{optionsWithoutProcessor:d,audioProcessor:f,videoProcessor:m}=i4(t??{}),p=e==null?void 0:e.processor,v=n==null?void 0:n.processor,C=d??{};return C.audio===!0&&(C.audio={}),C.video===!0&&(C.video={}),C.audio&&(up(C.audio,e),(i=(l=C.audio).deviceId)!==null&&i!==void 0||(l.deviceId={ideal:"default"}),(f||p)&&(C.audio.processor=f??p)),C.video&&(up(C.video,n),(r=(u=C.video).deviceId)!==null&&r!==void 0||(u.deviceId={ideal:"default"}),(m||v)&&(C.video.processor=m??v)),C}function up(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function ig(t){var e,n,i,r;const l={};if(t.video)if(typeof t.video=="object"){const u={},d=u,f=t.video;Object.keys(f).forEach(m=>{switch(m){case"resolution":up(d,f.resolution);break;default:d[m]=f[m]}}),l.video=u,(e=(i=l.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else l.video=t.video?{deviceId:{ideal:"default"}}:!1;else l.video=!1;return t.audio?typeof t.audio=="object"?(l.audio=t.audio,(n=(r=l.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):l.audio={deviceId:{ideal:"default"}}:l.audio=!1,l}function t4(t){return U(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=n4();if(i){const r=i.createAnalyser();r.fftSize=2048;const l=r.frequencyBinCount,u=new Uint8Array(l);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield _n(n),r.getByteTimeDomainData(u);const f=u.some(m=>m!==128&&m!==0);return i.close(),!f}return!1})()})}function n4(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>U(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(l){console.warn("Error trying to auto-resume audio context",l)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function ON(t){return t==="audioinput"?pe.Source.Microphone:t==="videoinput"?pe.Source.Camera:pe.Source.Unknown}function dp(t){return t===pe.Source.Microphone?"audioinput":t===pe.Source.Camera?"videoinput":void 0}function DN(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Ga()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function fl(t){return t.split("/")[1].toLowerCase()}function LN(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Wp({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function it(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?it(t.track):{})}}function PN(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function IN(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const l of i)t[l]!==e[l]&&(r[l]=(n=e[l])!==null&&n!==void 0?n:"");return r}function i4(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:iN(e)}}function UN(t){switch(t){case cn.CAMERA:return pe.Source.Camera;case cn.MICROPHONE:return pe.Source.Microphone;case cn.SCREEN_SHARE:return pe.Source.ScreenShare;case cn.SCREEN_SHARE_AUDIO:return pe.Source.ScreenShareAudio;default:return pe.Source.Unknown}}function Qb(t,e){return t.width*t.height<e.width*e.height}function BN(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class FN extends ss.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,l;const{kind:u,data:d}=i.data;switch(u){case"error":if(Xe.error(d.error.message),d.uuid){const p=this.decryptDataRequests.get(d.uuid);if(p!=null&&p.reject){p.reject(d.error);break}const v=this.encryptDataRequests.get(d.uuid);if(v!=null&&v.reject){v.reject(d.error);break}}this.emit(la.EncryptionError,d.error,d.participantIdentity);break;case"initAck":d.enabled&&this.keyProvider.getKeys().forEach(p=>{this.postKey(p)});break;case"enable":if(d.enabled&&this.keyProvider.getKeys().forEach(p=>{this.postKey(p)}),this.encryptionEnabled!==d.enabled&&d.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(la.ParticipantEncryptionStatusChanged,d.enabled,this.room.localParticipant),this.encryptionEnabled=d.enabled;else if(d.participantIdentity){const p=(l=this.room)===null||l===void 0?void 0:l.getParticipantByIdentity(d.participantIdentity);if(!p)throw TypeError("couldn't set encryption status, participant not found".concat(d.participantIdentity));this.emit(la.ParticipantEncryptionStatusChanged,d.enabled,p)}break;case"ratchetKey":this.keyProvider.emit(da.KeyRatcheted,d.ratchetResult,d.participantIdentity,d.keyIndex);break;case"decryptDataResponse":const f=this.decryptDataRequests.get(d.uuid);f!=null&&f.resolve&&f.resolve(d);break;case"encryptDataResponse":const m=this.encryptDataRequests.get(d.uuid);m!=null&&m.resolve&&m.resolve(d);break}},this.onWorkerError=i=>{Xe.error("e2ee worker encountered an error:",{error:i.error}),this.emit(la.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!XR())throw new tg("tried to setup end-to-end encryption on an unsupported browser");if(Xe.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:IR.getLevel()}};this.worker&&(Xe.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Xe.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Xe.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(je.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(ye.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==vn.NONE,r.identity)),e.on(ye.ConnectionStateChanged,i=>{i===Ct.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(l=>{this.setParticipantCryptorEnabled(l.trackInfo.encryption!==vn.NONE,r.identity)})})}).on(ye.TrackUnsubscribed,(i,r,l)=>{var u;const d={kind:"removeTransform",data:{participantIdentity:l.identity,trackId:i.mediaStreamID}};(u=this.worker)===null||u===void 0||u.postMessage(d)}).on(ye.TrackSubscribed,(i,r,l)=>{this.setupE2EEReceiver(i,l.identity,r.trackInfo)}).on(ye.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Re.LocalSenderCreated,(i,r)=>U(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(Re.LocalTrackPublished,i=>{if(!pa(i.track)||!xl())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:fl(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(da.SetKey,i=>this.postKey(i)).on(da.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return U(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Ri;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const l=crypto.randomUUID(),u={kind:"decryptDataRequest",data:{uuid:l,payload:e,iv:n,participantIdentity:i,keyIndex:r}},d=new Ri;return d.onFinally=()=>{this.decryptDataRequests.delete(l)},this.decryptDataRequests.set(l,d),this.worker.postMessage(u),d.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var l;if(!this.worker)throw Error("could not set key, worker is missing");const u={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((l=this.room)===null||l===void 0?void 0:l.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(u)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?fl(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Vr(e)||!n){n||Xe.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return U(this,void 0,void 0,function*(){if(this.worker){if(np()&&!Gb()){const l={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,l)}else{if(sl in e&&r){const f={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(f);return}let l=e.writableStream,u=e.readableStream;if(!l||!u){const f=e.createEncodedStreams();e.writableStream=f.writable,l=f.writable,e.readableStream=f.readable,u=f.readable}const d={kind:"decode",data:{readableStream:u,writableStream:l,trackId:n,codec:r,participantIdentity:i,isReuse:sl in e}};this.worker.postMessage(d,[u,l])}e[sl]=!0}})}handleSender(e,n,i){var r;if(!(sl in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(np()&&!Gb()){Xe.info("initialize script transform");const l={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,l)}else{Xe.info("initialize encoded streams");const l=e.createEncodedStreams(),u={kind:"encode",data:{readableStream:l.readable,writableStream:l.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(u,[l.readable,l.writable])}e[sl]=!0}}}const zN=500,qN=15e3;class Hr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Hr),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=om(i);if(!r)return;let l=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,l+1),this.backOffPromises.set(r,_n(Math.min(zN*Math.pow(2,l),qN)))}getBackOffPromise(e){const n=new URL(e),i=n&&om(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&om(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Hr._instance=null;const hm="default";class kn{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new kn),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return U(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;if(((l=kn.userMediaPromiseMap)===null||l===void 0?void 0:l.size)>0){Xe.debug("awaiting getUserMedia promise");try{n?yield kn.userMediaPromiseMap.get(n):yield Promise.all(kn.userMediaPromiseMap.values())}catch{Xe.warn("error waiting for media permissons")}}let u=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Ga()&&i.hasDeviceInUse(n))&&(u.filter(f=>f.kind===n).length===0||u.some(f=>{const m=f.label==="",p=n?f.kind===n:!0;return m&&p}))){const f={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},m=yield navigator.mediaDevices.getUserMedia(f);u=yield navigator.mediaDevices.enumerateDevices(),m.getTracks().forEach(p=>{p.stop()})}return i._previousDevices=u,n&&(u=u.filter(d=>d.kind===n)),u})()})}normalizeDeviceId(e,n,i){return U(this,void 0,void 0,function*(){if(n!==hm)return n;const r=yield this.getDevices(e),l=r.find(d=>d.deviceId===hm);if(!l){Xe.warn("could not reliably determine default device");return}const u=r.find(d=>d.deviceId!==hm&&d.groupId===(i??l.groupId));if(!u){Xe.warn("could not reliably determine default device");return}return u==null?void 0:u.deviceId})}hasDeviceInUse(e){return e?kn.userMediaPromiseMap.has(e):kn.userMediaPromiseMap.size>0}}kn.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];kn.userMediaPromiseMap=new Map;var ml;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(ml||(ml={}));class VN{constructor(){this.pendingTasks=new Map,this.taskMutex=new Bn,this.nextTaskIndex=0}run(e){return U(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ml.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=ml.RUNNING,yield e()}finally{n.status=ml.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return U(this,void 0,void 0,function*(){return this.run(()=>U(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class HN{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const l=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);l.binaryType="arraybuffer",this.ws=l;const u=function(){let{closeCode:d,reason:f}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return l.close(d,f)};this.opened=new Promise((d,f)=>{l.onopen=()=>{d({readable:new ReadableStream({start(m){l.onmessage=p=>{let{data:v}=p;return m.enqueue(v)},l.onerror=p=>m.error(p)},cancel:u}),writable:new WritableStream({write(m){l.send(m)},abort(){l.close()},close:u}),protocol:l.protocol,extensions:l.extensions}),l.removeEventListener("error",f)},l.addEventListener("error",f)}),this.closed=new Promise((d,f)=>{const m=()=>U(this,void 0,void 0,function*(){const p=new Promise(C=>{l.readyState!==WebSocket.CLOSED&&l.addEventListener("close",x=>{C(x)},{once:!0})}),v=yield Promise.race([_n(250),p]);v?d(v):f(new Error("Encountered unspecified websocket error without a timely close event"))});l.onclose=p=>{let{code:v,reason:C}=p;d({closeCode:v,reason:C}),l.removeEventListener("error",m)},l.addEventListener("error",m)}),n.signal&&(n.signal.onabort=()=>l.close()),this.close=u}}function $N(t,e){const n=new URL(wN(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),s4(n,"rtc")}function GN(t){const e=new URL(Sl(t));return s4(e,"validate")}function KN(t){return t.endsWith("/")?t:"".concat(t,"/")}function s4(t,e){return t.pathname="".concat(KN(t.pathname)).concat(e),t.toString()}function Xb(t){if(typeof t=="string")return Rb.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Rb.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function WN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const ZN=["syncState","trickle","offer","answer","simulate","leave"];function YN(t){const e=ZN.indexOf(t.case)>=0;return Xe.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var _t;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(_t||(_t={}));const JN=250;class sg{get currentState(){return this.state}get isDisconnected(){return this.state===_t.DISCONNECTING||this.state===_t.DISCONNECTED}get isEstablishingConnection(){return this.state===_t.CONNECTING||this.state===_t.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=_t.DISCONNECTED,this.log=Xe,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=As((i=n.loggerName)!==null&&i!==void 0?i:qi.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new VN,this.queuedRequests=[],this.closingLock=new Bn,this.connectionLock=new Bn,this.state=_t.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return U(this,void 0,void 0,function*(){return this.state=_t.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return U(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=_t.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return U(this,void 0,void 0,function*(){const l=yield this.connectionLock.lock();this.connectOptions=i;const u=TN(),d=i.singlePeerConnection?XN(n,u,i):QN(n,u,i),f=$N(e,d),m=GN(f);return new Promise((p,v)=>U(this,void 0,void 0,function*(){var C,x;try{let S=!1;const k=w=>U(this,void 0,void 0,function*(){if(S)return;S=!0;const j=w instanceof Event?w.currentTarget:w,R=WN(j,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(R)).catch(N=>{this.log.error(N),this.close()}):this.close(),E(),v(j instanceof AbortSignal?j.reason:j)});r==null||r.addEventListener("abort",k);const E=()=>{clearTimeout(_),r==null||r.removeEventListener("abort",k)},_=setTimeout(()=>{k(new ut("room connection has timed out (signal)",Ge.ServerUnreachable))},i.websocketTimeout),O=(w,j)=>{this.handleSignalConnected(w,_,j)},A=new URL(f);A.searchParams.has("access_token")&&A.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(A),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new HN(f);try{this.ws.closed.then(D=>{var I;this.isEstablishingConnection&&v(new ut("Websocket got closed during a (re)connection attempt: ".concat(D.reason),Ge.InternalError)),D.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:D.reason,code:D.closeCode,wasClean:D.closeCode===1e3,state:this.state})),this.state===_t.CONNECTED&&this.handleOnClose((I=D.reason)!==null&&I!==void 0?I:"Unexpected WS error"))}).catch(D=>{this.isEstablishingConnection&&v(new ut("Websocket error during a (re)connection attempt: ".concat(D),Ge.InternalError))});const w=yield this.ws.opened.catch(D=>U(this,void 0,void 0,function*(){if(this.state!==_t.CONNECTED){this.state=_t.DISCONNECTED,clearTimeout(_);const I=yield this.handleConnectionError(D,m);v(I);return}this.handleWSError(D),v(D)}));if(clearTimeout(_),!w)return;const j=w.readable.getReader();this.streamWriter=w.writable.getWriter();const R=yield j.read();if(j.releaseLock(),!R.value)throw new ut("no message received as first message",Ge.InternalError);const N=Xb(R.value),L=this.validateFirstMessage(N,(C=i.reconnect)!==null&&C!==void 0?C:!1);if(!L.isValid){v(L.error);return}((x=N.message)===null||x===void 0?void 0:x.case)==="join"&&(this.pingTimeoutDuration=N.message.value.pingTimeout,this.pingIntervalDuration=N.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const F=L.shouldProcessFirstMessage?N:void 0;O(w,F),p(L.response)}catch(w){v(w)}finally{E()}}finally{l()}}))})}startReadingLoop(e,n){return U(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield _n(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const l=Xb(r);this.handleSignalResponse(l)}})}close(){return U(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([_t.DISCONNECTING||_t.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=_t.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const l=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([l,_n(JN)])}}catch(l){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:l}))}finally{n&&(e.state=_t.DISCONNECTED),r()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ir(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ir(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new pd({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new gd({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return U(this,arguments,void 0,function(i,r){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const d=l.getNextRequestId();return yield l.sendRequest({case:"updateMetadata",value:new Yp({requestId:d,metadata:i,name:r,attributes:u})}),d})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new d5({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new m5({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:It.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new v5({timestamp:It.parse(Date.now()),rtt:It.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Zp({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new yd({reason:zi.CLIENT_INITIATED,action:Fr.DISCONNECT})})}sendRequest(e){return U(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!YN(n)&&i.state===_t.RECONNECTING){i.queuedRequests.push(()=>U(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield _n(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const u=new lR({message:n});try{i.useJSON?yield i.streamWriter.write(u.toJsonString()):yield i.streamWriter.write(u.toBinary())}catch(d){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:d}))}})()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let l=!1;if(r.case==="answer"){const u=e2(r.value);this.onAnswer&&this.onAnswer(u,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const u=e2(r.value);this.onOffer&&this.onOffer(u,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const u=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(u,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),l=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));l||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return U(this,void 0,void 0,function*(){if(this.state===_t.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Nn.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Nn.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Nn.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Nn.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=_t.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,l,u,d;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===_t.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((l=e.message)===null||l===void 0?void 0:l.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((u=e.message)===null||u===void 0?void 0:u.case)==="leave"?{isValid:!1,error:new ut("Received leave request while trying to (re)connect",Ge.LeaveRequest,void 0,e.message.value.reason)}:n?{isValid:!1,error:new ut("Unexpected first message",Ge.InternalError)}:{isValid:!1,error:new ut("did not receive join response, got ".concat((d=e.message)===null||d===void 0?void 0:d.case," instead"),Ge.InternalError)}}handleConnectionError(e,n){return U(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return new ut(r,Ge.NotAllowed,i.status)}else return e instanceof ut?e:new ut("Encountered unknown websocket error during connection: ".concat(e),Ge.InternalError,i.status)}catch(i){return i instanceof ut?i:new ut(i instanceof Error?i.message:"server was not reachable",Ge.ServerUnreachable)}})}}function e2(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Ir(t,e){return new ma({sdp:t.sdp,type:t.type,id:e})}function QN(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",ns()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function XN(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new _R({clientInfo:e,connectionSettings:new y5({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const l=new AR({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(l.toBinary()))),i}class t2{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class e_{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,l]of i.entries())n.push(e(l,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Di={},fm={},mm={exports:{}},n2;function ag(){if(n2)return mm.exports;n2=1;var t=mm.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),mm.exports}var i2;function t_(){return i2||(i2=1,(function(t){var e=function(d){return String(Number(d))===d?Number(d):d},n=function(d,f,m,p){if(p&&!m)f[p]=e(d[1]);else for(var v=0;v<m.length;v+=1)d[v+1]!=null&&(f[m[v]]=e(d[v+1]))},i=function(d,f,m){var p=d.name&&d.names;d.push&&!f[d.push]?f[d.push]=[]:p&&!f[d.name]&&(f[d.name]={});var v=d.push?{}:p?f[d.name]:f;n(m.match(d.reg),v,d.names,d.name),d.push&&f[d.push].push(v)},r=ag(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(d){var f={},m=[],p=f;return d.split(/(\r\n|\r|\n)/).filter(l).forEach(function(v){var C=v[0],x=v.slice(2);C==="m"&&(m.push({rtp:[],fmtp:[]}),p=m[m.length-1]);for(var S=0;S<(r[C]||[]).length;S+=1){var k=r[C][S];if(k.reg.test(x))return i(k,p,x)}}),f.media=m,f};var u=function(d,f){var m=f.split(/=(.+)/,2);return m.length===2?d[m[0]]=e(m[1]):m.length===1&&f.length>1&&(d[m[0]]=void 0),d};t.parseParams=function(d){return d.split(/;\s?/).reduce(u,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(d){return d.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(d){for(var f=[],m=d.split(" ").map(e),p=0;p<m.length;p+=3)f.push({component:m[p],ip:m[p+1],port:m[p+2]});return f},t.parseImageAttributes=function(d){return d.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(u,{})})},t.parseSimulcastStreamList=function(d){return d.split(";").map(function(f){return f.split(",").map(function(m){var p,v=!1;return m[0]!=="~"?p=e(m):(p=e(m.substring(1,m.length)),v=!0),{scid:p,paused:v}})})}})(fm)),fm}var pm,s2;function n_(){if(s2)return pm;s2=1;var t=ag(),e=/%[sdv%]/g,n=function(u){var d=1,f=arguments,m=f.length;return u.replace(e,function(p){if(d>=m)return p;var v=f[d];switch(d+=1,p){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},i=function(u,d,f){var m=d.format instanceof Function?d.format(d.push?f:f[d.name]):d.format,p=[u+"="+m];if(d.names)for(var v=0;v<d.names.length;v+=1){var C=d.names[v];d.name?p.push(f[d.name][C]):p.push(f[d.names[v]])}else p.push(f[d.name]);return n.apply(null,p)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];return pm=function(u,d){d=d||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var f=d.outerOrder||r,m=d.innerOrder||l,p=[];return f.forEach(function(v){t[v].forEach(function(C){C.name in u&&u[C.name]!=null?p.push(i(v,C,u)):C.push in u&&u[C.push]!=null&&u[C.push].forEach(function(x){p.push(i(v,C,x))})})}),u.media.forEach(function(v){p.push(i("m",t.m[0],v)),m.forEach(function(C){t[C].forEach(function(x){x.name in v&&v[x.name]!=null?p.push(i(C,x,v)):x.push in v&&v[x.push]!=null&&v[x.push].forEach(function(S){p.push(i(C,x,S))})})})}),p.join(`\r
`)+`\r
`},pm}var a2;function i_(){if(a2)return Di;a2=1;var t=t_(),e=n_(),n=ag();return Di.grammar=n,Di.write=e,Di.parse=t.parse,Di.parseParams=t.parseParams,Di.parseFmtpConfig=t.parseFmtpConfig,Di.parsePayloads=t.parsePayloads,Di.parseRemoteCandidates=t.parseRemoteCandidates,Di.parseImageAttributes=t.parseImageAttributes,Di.parseSimulcastStreamList=t.parseSimulcastStreamList,Di}var ra=i_();function rg(t,e,n){var i,r,l;e===void 0&&(e=50),n===void 0&&(n={});var u=(i=n.isImmediate)!=null&&i,d=(r=n.callback)!=null&&r,f=n.maxWait,m=Date.now(),p=[];function v(){if(f!==void 0){var x=Date.now()-m;if(x+e>=f)return f-x}return e}var C=function(){var x=[].slice.call(arguments),S=this;return new Promise(function(k,E){var _=u&&l===void 0;if(l!==void 0&&clearTimeout(l),l=setTimeout(function(){if(l=void 0,m=Date.now(),!u){var A=t.apply(S,x);d&&d(A),p.forEach(function(w){return(0,w.resolve)(A)}),p=[]}},v()),_){var O=t.apply(S,x);return d&&d(O),k(O)}p.push({resolve:k,reject:E})})};return C.cancel=function(x){l!==void 0&&clearTimeout(l),p.forEach(function(S){return(0,S.reject)(x)}),p=[]},C}const s_=.7,a_=20,$r={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class r2 extends ss.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Xe,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=rg(r=>U(this,void 0,void 0,function*(){this.emit($r.NegotiationStarted);try{yield this.createAndSendOffer()}catch(l){if(r)r(l);else throw l}}),a_),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=As((i=n.loggerName)!==null&&i!==void 0?i:qi.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Bn}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return U(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return U(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:l,nackMids:u}=r_(e);this.remoteStereoMids=l,this.remoteNackMids=u}else if(e.type==="answer"){const l=ra.parse((i=e.sdp)!==null&&i!==void 0?i:"");l.media.forEach(u=>{const d=og(u.mid);u.type==="audio"&&this.trackBitrates.some(f=>{if(!f.transceiver||d!=f.transceiver.mid)return!1;let m=0;if(u.rtp.some(v=>v.codec.toUpperCase()===f.codec.toUpperCase()?(m=v.payload,!0):!1),m===0)return!0;let p=!1;for(const v of u.fmtp)if(v.payload===m){v.config=v.config.split(";").filter(C=>!C.includes("maxaveragebitrate")).join(";"),f.maxbr>0&&(v.config+=";maxaveragebitrate=".concat(f.maxbr*1e3)),p=!0;break}return p||f.maxbr>0&&u.fmtp.push({payload:m,config:"maxaveragebitrate=".concat(f.maxbr*1e3)}),!0})}),r=ra.write(l)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(l=>{this.pc.addIceCandidate(l)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit($r.NegotiationComplete),e.sdp&&ra.parse(e.sdp).media.forEach(u=>{u.type==="video"&&this.emit($r.RTPVideoPayloadTypes,u.rtp)})),!0})}createAndSendOffer(e){return U(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const d=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&d)yield this._pc.setRemoteDescription(d);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const l=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:l.sdp},this.logContext));const u=ra.parse((n=l.sdp)!==null&&n!==void 0?n:"");if(u.media.forEach(d=>{l2(d),d.type==="audio"?o2(d,["all"],[]):d.type==="video"&&this.trackBitrates.some(f=>{if(!d.msid||!f.cid||!d.msid.includes(f.cid))return!1;let m=0;if(d.rtp.some(v=>v.codec.toUpperCase()===f.codec.toUpperCase()?(m=v.payload,!0):!1),m===0||(Fi(f.codec)&&!Ga()&&this.ensureVideoDDExtensionForSVC(d,u),!Fi(f.codec)))return!0;const p=Math.round(f.maxbr*s_);for(const v of d.fmtp)if(v.payload===m){v.config.includes("x-google-start-bitrate")||(v.config+=";x-google-start-bitrate=".concat(p));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(l,ra.write(u)),this.onOffer(l,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return U(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=ra.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{l2(r),r.type==="audio"&&o2(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,ra.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new gn("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new gn("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return U(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(d=>{switch(d.type){case"transport":n=d.selectedCandidatePairId;break;case"candidate-pair":n===""&&d.selected&&(n=d.id),i.set(d.id,d);break;case"remote-candidate":r.set(d.id,"".concat(d.address,":").concat(d.port));break}}),n==="")return;const u=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(u!==void 0)return r.get(u)})}setMungedSDP(e,n,i){return U(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(l){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let l="unknown error";r instanceof Error?l=r.message:typeof r=="string"&&(l=r);const u={error:l,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(u.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:u})),new ip(l)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(u=>u.uri===$b))){if(this.ddExtID===0){let u=0;n.media.forEach(d=>{var f;d.type==="video"&&((f=d.ext)===null||f===void 0||f.forEach(m=>{m.value>u&&(u=m.value)}))}),this.ddExtID=u+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:$b})}}}function o2(t,e,n){const i=og(t.mid);let r=0;t.rtp.some(l=>l.codec==="opus"?(r=l.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(l=>l.payload===r&&l.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(l=>l.payload===r?(l.config.includes("stereo=1")||(l.config+=";stereo=1"),!0):!1))}function r_(t){var e;const n=[],i=[],r=ra.parse((e=t.sdp)!==null&&e!==void 0?e:"");let l=0;return r.media.forEach(u=>{var d;const f=og(u.mid);u.type==="audio"&&(u.rtp.some(m=>m.codec==="opus"?(l=m.payload,!0):!1),!((d=u.rtcpFb)===null||d===void 0)&&d.some(m=>m.payload===l&&m.type==="nack")&&i.push(f),u.fmtp.some(m=>m.payload===l?(m.config.includes("sprop-stereo=1")&&n.push(f),!0):!1))}),{stereoMids:n,nackMids:i}}function l2(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function og(t){return typeof t=="number"?t.toFixed(0):t}const hp="vp8",o_={audioPreset:sp.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ng.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:hp,backupCodec:!0,preConnectBuffer:!1},a4={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},r4={deviceId:{ideal:"default"},resolution:Cl.h720.resolution},l_={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new BR,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},lg={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var $t;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})($t||($t={}));class c_{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=lg.peerConnectionTimeout,this.log=Xe,this.updateState=()=>{var l,u;const d=this.state,f=this.requiredTransports.map(m=>m.getConnectionState());f.every(m=>m==="connected")?this.state=$t.CONNECTED:f.some(m=>m==="failed")?this.state=$t.FAILED:f.some(m=>m==="connecting")?this.state=$t.CONNECTING:f.every(m=>m==="closed")?this.state=$t.CLOSED:f.some(m=>m==="closed")?this.state=$t.CLOSING:f.every(m=>m==="new")&&(this.state=$t.NEW),d!==this.state&&(this.log.debug("pc state change: from ".concat($t[d]," to ").concat($t[this.state]),this.logContext),(l=this.onStateChange)===null||l===void 0||l.call(this,this.state,this.publisher.getConnectionState(),(u=this.subscriber)===null||u===void 0?void 0:u.getConnectionState()))},this.log=As((r=i.loggerName)!==null&&r!==void 0?r:qi.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new r2(e,i),n!=="publisher-only"&&(this.subscriber=new r2(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,Bi.SUBSCRIBER)},this.subscriber.onDataChannel=l=>{var u;(u=this.onDataChannel)===null||u===void 0||u.call(this,l)},this.subscriber.onTrack=l=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,l)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,Bi.PUBLISHER)},this.publisher.onTrack=l=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,l)},this.publisher.onOffer=(l,u)=>{var d;(d=this.onPublisherOffer)===null||d===void 0||d.call(this,l,u)},this.state=$t.NEW,this.connectionLock=new Bn,this.remoteOfferLock=new Bn}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return U(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return U(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return U(this,void 0,void 0,function*(){var i;n===Bi.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return U(this,void 0,void 0,function*(){var i,r,l;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const u=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(l=this.subscriber)===null||l===void 0?void 0:l.createAndSetAnswer():void 0}finally{u()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return U(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(l=>this.ensureTransportConnected(l,e,n)))}finally{r()}})}negotiate(e){return U(this,void 0,void 0,function*(){return new Promise((n,i)=>U(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),l=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",l),this.publisher.once($r.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once($r.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(u=>{clearTimeout(r),i(u)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Bi.PUBLISHER?this.publisher.getConnectedAddress():e===Bi.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return U(this,arguments,void 0,function(i,r){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((f,m)=>U(l,void 0,void 0,function*(){const p=()=>{this.log.warn("abort transport connection",this.logContext),Nn.clearTimeout(v),m(new ut("room connection has been cancelled",Ge.Cancelled))};r!=null&&r.signal.aborted&&p(),r==null||r.signal.addEventListener("abort",p);const v=Nn.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",p),m(new ut("could not establish pc connection",Ge.InternalError))},u);for(;this.state!==$t.CONNECTED;)if(yield _n(50),r!=null&&r.signal.aborted){m(new ut("room connection has been cancelled",Ge.Cancelled));return}Nn.clearTimeout(v),r==null||r.signal.removeEventListener("abort",p),f()}))})()})}}const o4=5e3,u_=3e4;class xt{static fetchRegionSettings(e,n,i){return U(this,void 0,void 0,function*(){const r=yield xt.fetchLock.lock();try{const l=yield fetch("".concat(d_(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(l.ok){const u=MN(l.headers),d=u?u*1e3:o4;return{regionSettings:yield l.json(),updatedAtInMs:Date.now(),maxAgeInMs:d}}else throw new ut("Could not fetch region settings: ".concat(l.statusText),l.status===401?Ge.NotAllowed:Ge.InternalError,l.status)}catch(l){throw l instanceof ut?l:i!=null&&i.aborted?new ut("Region fetching was aborted",Ge.Cancelled):new ut("Could not fetch region settings, ".concat(l instanceof Error?"".concat(l.name,": ").concat(l.message):l),Ge.ServerUnreachable,500)}finally{r()}})}static scheduleRefetch(e,n,i){return U(this,void 0,void 0,function*(){const r=xt.settingsTimeouts.get(e.hostname);clearTimeout(r),xt.settingsTimeouts.set(e.hostname,setTimeout(()=>U(this,void 0,void 0,function*(){try{const l=yield xt.fetchRegionSettings(e,n);xt.updateCachedRegionSettings(e,n,l)}catch(l){if(l instanceof ut&&l.reason===Ge.NotAllowed){Xe.debug("token is not valid, cancelling auto region refresh");return}Xe.debug("auto refetching of region settings failed",{error:l}),xt.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){xt.cache.set(e.hostname,i),xt.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=xt.settingsTimeouts.get(e);n&&(clearTimeout(n),xt.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=xt.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=xt.connectionTrackers.get(e);i&&i.connectionCount===0&&(Xe.debug("stopping region refetch after disconnect delay",{hostname:e}),xt.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},u_))}static cancelCleanup(e){const n=xt.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=xt.connectionTrackers.get(e);n||(n={connectionCount:0},xt.connectionTrackers.set(e,n)),n.connectionCount++,xt.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=xt.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&xt.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Ku(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return U(this,void 0,void 0,function*(){return xt.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return U(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=xt.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),xt.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(l=>l.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),Xe.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){xt.updateCachedRegionSettings(this.serverUrl,this.token,e)}}xt.cache=new Map;xt.settingsTimeouts=new Map;xt.connectionTrackers=new Map;xt.fetchLock=new Bn;function d_(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Kt extends Error{constructor(e,n,i){super(n),this.code=e,this.message=c2(n,Kt.MAX_MESSAGE_BYTES),this.data=i?c2(i,Kt.MAX_DATA_BYTES):void 0}static fromProto(e){return new Kt(e.code,e.message,e.data)}toProto(){return new X9({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Kt(Kt.ErrorCode[e],Kt.ErrorMessage[e],n)}}Kt.MAX_MESSAGE_BYTES=256;Kt.MAX_DATA_BYTES=15360;Kt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Kt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const l4=15360;function cg(t){return new TextEncoder().encode(t).length}function c2(t,e){if(cg(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const l=Math.floor((n+i+1)/2);r.encode(t.slice(0,l)).length<=e?n=l:i=l-1}return t.slice(0,n)}const ug=2e3;function Cd(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const dg=typeof MediaRecorder<"u";class h_{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const f_=dg?MediaRecorder:h_;class m_ extends f_{constructor(e,n){if(!dg)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const l=()=>r===void 0,u=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",u),this.removeEventListener("error",d),r==null||r.close(),r=void 0},d=f=>{r==null||r.error(f),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",u),this.removeEventListener("error",d),r=void 0};this.byteStream=new ReadableStream({start:f=>{r=f,i=m=>U(this,void 0,void 0,function*(){let p;if(m.data.arrayBuffer){const v=yield m.data.arrayBuffer();p=new Uint8Array(v)}else if(m.data.byteArray)p=m.data.byteArray;else throw new Error("no data available!");l()||f.enqueue(p)}),this.addEventListener("dataavailable",i)},cancel:()=>{u()}}),this.addEventListener("stop",u),this.addEventListener("error",d)}}function p_(){return dg}const g_=1e3,v_=1e4;class c4 extends pe{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4?arguments[4]:void 0;super(e,n,l),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=rg(()=>U(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>U(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Ce.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Bn,this.pauseUpstreamLock=new Bn,this.trackChangeLock=new Bn,this.trackChangeLock.lock().then(u=>U(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{u()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==pe.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return U(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(l=>{qr(this._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Pr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(l=>{Pr(r??e,l)}))})}waitForDimensions(){return U(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:g_;return(function*(){var i;if(e.kind===pe.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ti())===null||i===void 0?void 0:i.os)==="iOS"&&(yield _n(10));const r=Date.now();for(;Date.now()-r<n;){const l=e.dimensions;if(l)return l;yield _n(50)}throw new Rs("unable to get track dimensions after timeout")})()})}setDeviceId(e){return U(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ha(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),ha(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return U(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===pe.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),l=e.kind===pe.Kind.Audio?"audioinput":"videoinput";return n?kn.getInstance().normalizeDeviceId(l,i,r):i})()})}mute(){return U(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return U(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return U(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Rs("unable to replace an unpublished track");let r,l;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,l=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),l&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return U(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,l=FR(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const u={audio:!1,video:!1};this.kind===pe.Kind.Video?u.video=i||r?{deviceId:i,facingMode:r}:!0:u.audio=i?Object.assign({deviceId:i},l):!0,this.attachedElements.forEach(m=>{qr(this.mediaStreamTrack,m)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const f=(yield navigator.mediaDevices.getUserMedia(u)).getTracks()[0];return this.kind===pe.Kind.Video&&(yield f.applyConstraints(l)),f.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(f),this._constraints=e,this.emit(Ce.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ce.Muted:Ce.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return U(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),J5()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return U(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Ce.UpstreamPaused,this);const i=ti();if((i==null?void 0:i.name)==="Safari"&&is(i.version,"12.0")<0)throw new tg("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return U(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Ce.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return U(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return U(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;const u=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const d=document.createElement(i.kind),f={kind:i.kind,track:i._mediaStreamTrack,element:d,audioContext:i.audioContext};if(yield n.init(f),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Pr(i._mediaStreamTrack,d),d.muted=!0,d.play().catch(m=>{m instanceof DOMException&&m.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:m})),setTimeout(()=>{d.play().catch(p=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:p}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:m}))}),i.processor=n,i.processorElement=d,i.processor.processedTrack){for(const m of i.attachedElements)m!==i.processorElement&&r&&(qr(i._mediaStreamTrack,m),Pr(i.processor.processedTrack,m));yield(l=i.sender)===null||l===void 0?void 0:l.replaceTrack(i.processor.processedTrack)}i.emit(Ce.TrackProcessorUpdate,i.processor)}finally{u()}})()})}getProcessor(){return this.processor}stopProcessor(){return U(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return U(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Ce.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!p_()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new m_(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},v_)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class kl extends c4{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;super(e,pe.Kind.Audio,n,i,l),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>U(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let u;try{u=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}u&&this.prevStats&&(this._currentBitrate=Cd(u,this.prevStats)),this.prevStats=u}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Ce.AudioTrackFeatureUpdate,this,Sn.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Ce.AudioTrackFeatureUpdate,this,Sn.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return U(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return U(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ha(this._constraints.deviceId);return this.source===pe.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return U(this,void 0,void 0,function*(){let n;if(e){const i=ig({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return U(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){Yn()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},ug)))}setProcessor(e){return U(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!ns()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Ce.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return U(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return U(this,void 0,void 0,function*(){const e=yield t4(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(Ce.AudioSilenceDetected)),e})}}function y_(t,e,n){switch(t.kind){case"audio":return new kl(t,e,!1,void 0,n);case"video":return new Tl(t,e,!1,n);default:throw new Rs("unsupported track type: ".concat(t.kind))}}const b_=Object.values(Cl),C_=Object.values(ap),x_=Object.values(ng),S_=[Cl.h180,Cl.h360],k_=[ap.h180,ap.h360],T_=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new Rt(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),fp=["q","h","f"];function mp(t,e,n,i){var r,l;let u=i==null?void 0:i.videoEncoding;t&&(u=i==null?void 0:i.screenShareEncoding);const d=i==null?void 0:i.simulcast,f=i==null?void 0:i.scalabilityMode,m=i==null?void 0:i.videoCodec;if(!u&&!d&&!f||!e||!n)return[{}];u||(u=w_(t,e,n,m),Xe.debug("using video encoding",u));const p=u.maxFramerate,v=new Rt(e,n,u.maxBitrate,u.maxFramerate,u.priority);if(f&&Fi(m)){const S=new u4(f),k=[];if(S.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(f));const E=ti();if(xl()||ns()||(E==null?void 0:E.name)==="Chrome"&&is(E==null?void 0:E.version,"113")<0){const _=S.suffix=="h"?2:3,O=CN(E);for(let A=0;A<S.spatial;A+=1)k.push({rid:fp[2-A],maxBitrate:u.maxBitrate/Math.pow(_,A),maxFramerate:v.encoding.maxFramerate,scaleResolutionDownBy:O?Math.pow(2,A):void 0});k[0].scalabilityMode=f}else k.push({maxBitrate:u.maxBitrate,maxFramerate:v.encoding.maxFramerate,scalabilityMode:f});return v.encoding.priority&&(k[0].priority=v.encoding.priority,k[0].networkPriority=v.encoding.priority),Xe.debug("using svc encoding",{encodings:k}),k}if(!d)return[u];let C=[];t?C=(r=d2(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:u2(t,v):C=(l=d2(i==null?void 0:i.videoSimulcastLayers))!==null&&l!==void 0?l:u2(t,v);let x;if(C.length>0){const S=C[0];C.length>1&&([,x]=C);const k=Math.max(e,n);if(k>=960&&x)return gm(e,n,[S,x,v],p);if(k>=480)return gm(e,n,[S,v],p)}return gm(e,n,[v])}function E_(t,e,n){var i,r,l,u;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Xe.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const d=t.mediaStreamTrack.getSettings(),f=(i=d.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,m=(l=d.height)!==null&&l!==void 0?l:(u=t.dimensions)===null||u===void 0?void 0:u.height;return t.source===pe.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),mp(t.source===pe.Source.ScreenShare,f,m,n)}function w_(t,e,n,i){const r=j_(t,e,n);let{encoding:l}=r[0];const u=Math.max(e,n);for(let d=0;d<r.length;d+=1){const f=r[d];if(l=f.encoding,f.width>=u)break}if(i)switch(i){case"av1":case"h265":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.7;break;case"vp9":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.85;break}return l}function j_(t,e,n){if(t)return x_;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?b_:C_}function u2(t,e){if(t)return T_(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?S_:k_}function gm(t,e,n,i){const r=[];if(n.forEach((l,u)=>{if(u>=fp.length)return;const d=Math.min(t,e),m={rid:fp[u],scaleResolutionDownBy:Math.max(1,d/Math.min(l.width,l.height)),maxBitrate:l.encoding.maxBitrate},p=i&&l.encoding.maxFramerate?Math.min(i,l.encoding.maxFramerate):l.encoding.maxFramerate;p&&(m.maxFramerate=p);const v=$a()||u===0;l.encoding.priority&&v&&(m.priority=l.encoding.priority,m.networkPriority=l.encoding.priority),r.push(m)}),ns()&&X5()==="ios"){let l;r.forEach(d=>{l?d.maxFramerate&&d.maxFramerate>l&&(l=d.maxFramerate):l=d.maxFramerate});let u=!0;r.forEach(d=>{var f;d.maxFramerate!=l&&(u&&(u=!1,Xe.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Xe.info('Setting framerate of encoding "'.concat((f=d.rid)!==null&&f!==void 0?f:"",'" to ').concat(l)),d.maxFramerate=l)})}return r}function d2(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class u4{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function R_(t){return t.source===pe.Source.ScreenShare||t.constraints.height&&ha(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const N_=5e3;class Tl extends c4{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,pe.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>U(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(f){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:f}));return}const u=new Map(l.map(f=>[f.rid,f])),d=l.some(f=>f.qualityLimitationReason==="cpu");if(d!==this.isCpuConstrained&&(this.isCpuConstrained=d,this.isCpuConstrained&&this.emit(Ce.CpuConstrained)),this.prevStats){let f=0;u.forEach((m,p)=>{var v;const C=(v=this.prevStats)===null||v===void 0?void 0:v.get(p);f+=Cd(m,C)}),this._currentBitrate=f}this.prevStats=u}),this.senderLock=new Bn}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Yn())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},ug))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return U(this,void 0,void 0,function*(){var n,i,r,l,u;yield e.pauseUpstream.call(this);try{for(var d=!0,f=js(this.simulcastCodecs.values()),m;m=yield f.next(),n=m.done,!n;d=!0)l=m.value,d=!1,yield(u=l.sender)===null||u===void 0?void 0:u.replaceTrack(null)}catch(p){i={error:p}}finally{try{!d&&!n&&(r=f.return)&&(yield r.call(f))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return U(this,void 0,void 0,function*(){var n,i,r,l,u;yield e.resumeUpstream.call(this);try{for(var d=!0,f=js(this.simulcastCodecs.values()),m;m=yield f.next(),n=m.done,!n;d=!0){l=m.value,d=!1;const p=l;yield(u=p.sender)===null||u===void 0?void 0:u.replaceTrack(p.mediaStreamTrack)}}catch(p){i={error:p}}finally{try{!d&&!n&&(r=f.return)&&(yield r.call(f))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return U(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return U(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return U(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var l;if(r.type==="outbound-rtp"){const u={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(l=r.rid)!==null&&l!==void 0?l:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},d=i.get(r.remoteId);d&&(u.jitter=d.jitter,u.packetsLost=d.packetsLost,u.roundTripTime=d.roundTripTime),n.push(u)}}),n.sort((r,l)=>{var u,d;return((u=l.frameWidth)!==null&&u!==void 0?u:0)-((d=r.frameWidth)!==null&&d!==void 0?d:0)}),n})}setPublishingQuality(e){const n=[];for(let i=di.LOW;i<=di.HIGH;i+=1)n.push(new Jp({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Fi(this.codec),n)}restartTrack(e){return U(this,void 0,void 0,function*(){var n,i,r,l,u;let d;if(e){const v=ig({video:e});typeof v.video!="boolean"&&(d=v.video)}yield this.restart(d),this.isCpuConstrained=!1;try{for(var f=!0,m=js(this.simulcastCodecs.values()),p;p=yield m.next(),n=p.done,!n;f=!0){l=p.value,f=!1;const v=l;v.sender&&((u=v.sender.transport)===null||u===void 0?void 0:u.state)!=="closed"&&(v.mediaStreamTrack=this.mediaStreamTrack.clone(),yield v.sender.replaceTrack(v.mediaStreamTrack))}}catch(v){i={error:v}}finally{try{!f&&!n&&(r=m.return)&&(yield r.call(m))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return U(this,arguments,void 0,function(i){var r=this;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var u,d,f,m,p,v;if(yield n.setProcessor.call(r,i,l),!((p=r.processor)===null||p===void 0)&&p.processedTrack)try{for(var C=!0,x=js(r.simulcastCodecs.values()),S;S=yield x.next(),u=S.done,!u;C=!0)m=S.value,C=!1,yield(v=m.sender)===null||v===void 0?void 0:v.replaceTrack(r.processor.processedTrack)}catch(k){d={error:k}}finally{try{!C&&!u&&(f=x.return)&&(yield f.call(x))}finally{if(d)throw d.error}}})()})}setDegradationPreference(e){return U(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},N_))}setPublishingCodecs(e){return U(this,void 0,void 0,function*(){var n,i,r,l,u,d,f;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Fi(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const m=[];try{for(n=!0,i=js(e);r=yield i.next(),l=r.done,!l;n=!0){f=r.value,n=!1;const p=f;if(!this.codec||this.codec===p.codec)yield this.setPublishingLayers(Fi(p.codec),p.qualities);else{const v=this.simulcastCodecs.get(p.codec);if(this.log.debug("try setPublishingCodec for ".concat(p.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:v})),!v||!v.sender){for(const C of p.qualities)if(C.enabled){m.push(p.codec);break}}else v.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(p.codec),this.logContext),yield h2(v.sender,v.encodings,p.qualities,this.senderLock,Fi(p.codec),this.log,this.logContext))}}}catch(p){u={error:p}}finally{try{!n&&!l&&(d=i.return)&&(yield d.call(i))}finally{if(u)throw u.error}}return m})}setPublishingLayers(e,n){return U(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield h2(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return U(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var l;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((l=this.mediaStreamTrack.getSettings().height)!==null&&l!==void 0?l:360)/360)),scalabilityMode:r===0&&Fi(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return U(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),J5()&&this.isInBackground&&this.source===pe.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function h2(t,e,n,i,r,l,u){return U(this,void 0,void 0,function*(){const d=yield i.lock();l.debug("setPublishingLayersForSender",Object.assign(Object.assign({},u),{sender:t,qualities:n,senderEncodings:e}));try{const f=t.getParameters(),{encodings:m}=f;if(!m)return;if(m.length!==e.length){l.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},u),{encodings:m,senderEncodings:e}));return}let p=!1;!1&&m[0].scalabilityMode||(r&&n.some(x=>x.enabled)&&n.forEach(x=>x.enabled=!0),m.forEach((C,x)=>{var S;let k=(S=C.rid)!==null&&S!==void 0?S:"";k===""&&(k="q");const E=d4(k),_=n.find(O=>O.quality===E);_&&C.active!==_.enabled&&(p=!0,C.active=_.enabled,l.debug("setting layer ".concat(_.quality," to ").concat(C.active?"enabled":"disabled"),u),$a()&&(_.enabled?(C.scaleResolutionDownBy=e[x].scaleResolutionDownBy,C.maxBitrate=e[x].maxBitrate,C.maxFrameRate=e[x].maxFrameRate):(C.scaleResolutionDownBy=4,C.maxBitrate=10,C.maxFrameRate=2)))})),p&&(f.encodings=m,l.debug("setting encodings",Object.assign(Object.assign({},u),{encodings:f.encodings})),yield t.setParameters(f))}finally{d()}})}function d4(t){switch(t){case"f":return di.HIGH;case"h":return di.MEDIUM;case"q":return di.LOW;default:return di.HIGH}}function f2(t,e,n,i){if(!n)return[new ua({quality:di.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,l=new u4(r),u=[],d=l.suffix=="h"?1.5:2,f=l.suffix=="h"?2:3;for(let m=0;m<l.spatial;m+=1)u.push(new ua({quality:Math.min(di.HIGH,l.spatial-1)-m,width:Math.ceil(t/Math.pow(d,m)),height:Math.ceil(e/Math.pow(d,m)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(f,m)):0,ssrc:0}));return u}return n.map(r=>{var l,u,d;const f=(l=r.scaleResolutionDownBy)!==null&&l!==void 0?l:1;let m=d4((u=r.rid)!==null&&u!==void 0?u:"");return new ua({quality:m,width:Math.ceil(t/f),height:Math.ceil(e/f),bitrate:(d=r.maxBitrate)!==null&&d!==void 0?d:0,ssrc:0})})}const m2="_lossy",p2="_reliable",__=2*1e3,vm="leave-reconnect",A_=3e4;var Ei;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Ei||(Ei={}));class M_ extends ss.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=lg.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Ei.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Xe,this.reliableDataSequence=1,this.reliableMessageBuffer=new t2,this.reliableReceivedState=new e_(A_),this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>U(this,[i],void 0,function(r){var l=this;let{channel:u}=r;return(function*(){if(u){if(u.label===p2)l.reliableDCSub=u;else if(u.label===m2)l.lossyDCSub=u;else return;l.log.debug("on data channel ".concat(u.id,", ").concat(u.label),l.logContext),u.onmessage=l.handleDataMessage}})()}),this.handleDataMessage=i=>U(this,void 0,void 0,function*(){var r,l,u,d,f;const m=yield this.dataProcessLock.lock();try{let p;if(i.data instanceof ArrayBuffer)p=i.data;else if(i.data instanceof Blob)p=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const v=Un.fromBinary(new Uint8Array(p));if(v.sequence>0&&v.participantSid!==""){const C=this.reliableReceivedState.get(v.participantSid);if(C&&v.sequence<=C)return;this.reliableReceivedState.set(v.participantSid,v.sequence)}if(((r=v.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(je.ActiveSpeakersUpdate,v.value.value.speakers);else if(((l=v.value)===null||l===void 0?void 0:l.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const C=yield(u=this.e2eeManager)===null||u===void 0?void 0:u.handleEncryptedData(v.value.value.encryptedValue,v.value.value.iv,v.participantIdentity,v.value.value.keyIndex),x=Y9.fromBinary(C.payload),S=new Un({value:x.value,participantIdentity:v.participantIdentity,participantSid:v.participantSid});((d=S.value)===null||d===void 0?void 0:d.case)==="user"&&g2(S,S.value.value),this.emit(je.DataPacketReceived,S,v.value.value.encryptionType)}else((f=v.value)===null||f===void 0?void 0:f.case)==="user"&&g2(v,v.value.value),this.emit(je.DataPacketReceived,v,vn.NONE)}finally{m()}}),this.handleDataError=i=>{const l=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:u}=i.error;this.log.error("DataChannel error on ".concat(l,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:u}))}else this.log.error("Unknown DataChannel error on ".concat(l),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const l=i.currentTarget.maxRetransmits===0?st.LOSSY:st.RELIABLE;this.updateAndEmitDCBufferStatus(l)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const l=f=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(f,"ms. giving up"),this.logContext),this.emit(je.Disconnected),this.close()},u=Date.now()-this.reconnectStart;let d=this.getNextRetryDelay({elapsedMs:u,retryCount:this.reconnectAttempts});if(d===null){l(u);return}i===vm&&(d=0),this.log.debug("reconnecting in ".concat(d,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Nn.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),d)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Ei.Connected&&i();const l=()=>{this.off(je.Disconnected,u),i()},u=()=>{this.off(je.Restarted,l),r()};this.once(je.Restarted,l),this.once(je.Disconnected,u)}),this.updateAndEmitDCBufferStatus=i=>{if(i===st.RELIABLE){const l=this.dataChannelForKind(i);l&&this.reliableMessageBuffer.alignBufferedAmount(l.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(je.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>U(this,void 0,void 0,function*(){!this.url||!(yield fetch(Sl(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===_t.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===_t.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Pa.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>U(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Sl(this.url),{method:"HEAD"}),_n(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=As((n=e.loggerName)!==null&&n!==void 0?n:qi.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new sg(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Bn,this.dataProcessLock=new Bn,this.dcBufferStatus=new Map([[st.LOSSY,!0],[st.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(je.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(je.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(je.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(je.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(je.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(je.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(je.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(je.SignalRequestResponse,i)}get logContext(){var e,n,i,r,l,u;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(u=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||u===void 0?void 0:u.identity,pID:this.participantSid}}join(e,n,i,r){return U(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const l=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=l,this.subscriberPrimary=l.subscriberPrimary,this.pcManager||(yield this.configure(l)),(!this.subscriberPrimary||l.fastPublish)&&this.negotiate().catch(u=>{Xe.error(u,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=l.clientConfiguration,this.emit(je.SignalConnected,l),l}catch(l){if(l instanceof ut&&l.reason===Ge.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw l}})}close(){return U(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(je.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return U(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new t2,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return U(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Rs("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new ut("publication of local track timed out, no response from server",Ge.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:l=>{clearTimeout(r),n(l)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return U(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return U(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==$t.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new c_(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(je.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(l,u)=>{this.client.sendIceCandidate(l,u)},this.pcManager.onPublisherOffer=(l,u)=>{this.client.sendOffer(l,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(l,u,d)=>U(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),l===$t.CONNECTED){const p=this.pcState===Ei.New;this.pcState=Ei.Connected,p&&this.emit(je.Connected,e)}else l===$t.FAILED&&(this.pcState===Ei.Connected||this.pcState===Ei.Reconnecting)&&(this.pcState=Ei.Disconnected,this.handleDisconnect("peerconnection failed",d==="failed"?Pa.RR_SUBSCRIBER_FAILED:Pa.RR_PUBLISHER_FAILED));const f=this.client.isDisconnected||this.client.currentState===_t.RECONNECTING,m=[$t.FAILED,$t.CLOSING,$t.CLOSED].includes(l);f&&m&&!this._isClosed&&this.emit(je.Offline)}),this.pcManager.onTrack=l=>{l.streams.length!==0&&this.emit(je.MediaTrackAdded,l.track,l.streams[0],l.receiver)},O_((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>U(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>U(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(je.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(je.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(je.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(je.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(je.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let l=0;l<e.numAudios;l++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let l=0;l<e.numVideos;l++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Pa.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:o4,regionSettings:e.regions})),e.action){case Fr.DISCONNECT:this.emit(je.Disconnected,e==null?void 0:e.reason),this.close();break;case Fr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(vm);break;case Fr.RESUME:this.handleDisconnect(vm)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(l=>{const u={urls:l.urls};l.username&&(u.username=l.username),l.credential&&(u.credential=l.credential),r.push(u)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===vl.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(m2,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(p2,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return U(this,void 0,void 0,function*(){if(rp())return yield this.createTransceiverRTCRtpSender(e,n,i);if(op())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new gn("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return U(this,void 0,void 0,function*(){if(rp())return this.createSimulcastTransceiverSender(e,n,i,r);if(op())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new gn("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return U(this,void 0,void 0,function*(){if(!this.pcManager)throw new gn("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),pa(e)&&(e.codec=n.videoCodec);const l={direction:"sendonly",streams:r};return i&&(l.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,l)).sender})}createSimulcastTransceiverSender(e,n,i,r){return U(this,void 0,void 0,function*(){if(!this.pcManager)throw new gn("publisher is closed");const l={direction:"sendonly"};r&&(l.sendEncodings=r);const u=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,l);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,u.sender),u.sender})}createRTCRtpSender(e){return U(this,void 0,void 0,function*(){if(!this.pcManager)throw new gn("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return U(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Xe.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===vl.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:$t.NEW)===$t.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(l){this.reconnectAttempts+=1;let u=!0;l instanceof gn?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:l})),u=!1):l instanceof Dr||(this.fullReconnectOnNext=!0),u?this.handleDisconnect("reconnect",Pa.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(je.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return U(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new gn("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(je.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let l;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Dr;l=yield this.join(e??this.url,this.token,this.signalOpts)}catch(u){throw u instanceof ut&&u.reason===Ge.NotAllowed?new gn("could not reconnect, token might be expired"):new Dr}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(je.SignalRestarted,l),yield this.waitForPCReconnected(),this.client.currentState!==_t.CONNECTED)throw new Dr("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(je.Restarted)}catch(l){const u=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(u){yield this.restartConnection(u);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),l}})}resumeConnection(e){return U(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new gn("could not reconnect, url or token not saved");if(!this.pcManager)throw new gn("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(je.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let l="";throw r instanceof Error&&(l=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof ut&&r.reason===Ge.NotAllowed?new gn("could not reconnect, token might be expired"):r instanceof ut&&r.reason===Ge.LeaveRequest?r:new Dr(l)}if(this.emit(je.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==_t.CONNECTED)throw new Dr("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(je.Resumed)})}waitForPCInitialConnection(e,n){return U(this,void 0,void 0,function*(){if(!this.pcManager)throw new gn("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return U(this,void 0,void 0,function*(){this.pcState=Ei.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield _n(__),!this.pcManager)throw new gn("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ei.Connected}catch(e){throw this.pcState=Ei.Disconnected,new ut("could not establish PC connection, ".concat(e.message),Ge.InternalError)}})}publishRpcResponse(e,n,i,r){return U(this,void 0,void 0,function*(){const l=new Un({destinationIdentities:[e],kind:st.RELIABLE,value:{case:"rpcResponse",value:new Kp({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(l,st.RELIABLE)})}publishRpcAck(e,n){return U(this,void 0,void 0,function*(){const i=new Un({destinationIdentities:[e],kind:st.RELIABLE,value:{case:"rpcAck",value:new Gp({requestId:n})}});yield this.sendDataPacket(i,st.RELIABLE)})}sendDataPacket(e,n){return U(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const l=tN(e);if(l){const u=yield this.e2eeManager.encryptData(l.toBinary());e.value={case:"encryptedPacket",value:new Z9({encryptedValue:u.payload,iv:u.iv,keyIndex:u.keyIndex})}}}n===st.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary();yield this.waitForBufferStatusLow(n);const r=this.dataChannelForKind(n);if(r){if(n===st.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return U(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(st.RELIABLE);const n=this.dataChannelForKind(st.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(st.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>U(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(je.Closing,r);!this.dcBufferStatus.get(e);)yield _n(10);this.off(je.Closing,r),n()}}))}ensureDataTransportConnected(e){return U(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var l;if(!i.pcManager)throw new gn("PC manager is closed");const u=r?i.pcManager.subscriber:i.pcManager.publisher,d=r?"Subscriber":"Publisher";if(!u)throw new ut("".concat(d," connection not set"),Ge.InternalError);let f=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),f=!0),!f&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(f=!0),f&&i.negotiate().catch(v=>{Xe.error(v,i.logContext)});const m=i.dataChannelForKind(n,r);if((m==null?void 0:m.readyState)==="open")return;const p=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<p;){if(u.isICEConnected&&((l=i.dataChannelForKind(n,r))===null||l===void 0?void 0:l.readyState)==="open")return;yield _n(50)}throw new ut("could not establish ".concat(d," connection, state: ").concat(u.getICEConnectionState()),Ge.InternalError)})()})}ensurePublisherConnected(e){return U(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==$t.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return U(this,void 0,void 0,function*(){return new Promise((e,n)=>U(this,void 0,void 0,function*(){if(!this.pcManager){n(new ip("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(je.Closing,r),this.pcManager.publisher.once($r.RTPVideoPayloadTypes,l=>{const u=new Map;l.forEach(d=>{const f=d.codec.toLowerCase();EN(f)&&u.set(d.payload,f)}),this.emit(je.RTPVideoMapUpdate,u)});try{yield this.pcManager.negotiate(i),e()}catch(l){l instanceof ip&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Pa.RR_UNKNOWN),n(l)}finally{this.off(je.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===st.LOSSY)return this.lossyDCSub;if(e===st.RELIABLE)return this.reliableDCSub}else{if(e===st.LOSSY)return this.lossyDC;if(e===st.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,l,u;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const d=this.pcManager.publisher.getLocalDescription(),f=this.pcManager.publisher.getRemoteDescription(),m=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),p=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),v=(u=(l=this.signalOpts)===null||l===void 0?void 0:l.autoSubscribe)!==null&&u!==void 0?u:!0,C=new Array,x=new Array;e.forEach(S=>{S.isDesired!==v&&C.push(S.trackSid),S.isEnabled||x.push(S.trackSid)}),this.client.sendSyncState(new Qp({answer:this.options.singlePeerConnection?f?Ir({sdp:f.sdp,type:f.type}):void 0:p?Ir({sdp:p.sdp,type:p.type}):void 0,offer:this.options.singlePeerConnection?d?Ir({sdp:d.sdp,type:d.type}):void 0:m?Ir({sdp:m.sdp,type:m.type}):void 0,subscription:new vd({trackSids:C,subscribe:!v,participantTracks:[]}),publishTracks:LN(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:x,datachannelReceiveStates:this.reliableReceivedState.map((S,k)=>new p5({publisherSid:k,lastSeq:S}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new g5({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(st.LOSSY),Bi.PUBLISHER),n(this.dataChannelForKind(st.RELIABLE),Bi.PUBLISHER),n(this.dataChannelForKind(st.LOSSY,!0),Bi.SUBSCRIBER),n(this.dataChannelForKind(st.RELIABLE,!0),Bi.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Nn.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Yn()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Yn()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(l=>{let[u]=l;return u===i});if(r)return r[1]}}}class Dr extends Error{}function O_(t){return t!==void 0&&t>13}function g2(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class h4{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new wi("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),In.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new wi("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),In.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class D_ extends h4{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Ri,i=null,r=null;if(this.signal){const u=this.signal;r=()=>{var d;(d=n.reject)===null||d===void 0||d.call(n,u.reason)},u.addEventListener("abort",r),i=u}const l=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>U(this,void 0,void 0,function*(){var u,d;try{const{done:f,value:m}=yield Promise.race([e.read(),n.promise,(d=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&d!==void 0?d:new Promise(()=>{})]);return f?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(m),{done:!1,value:m.content})}catch(f){throw l(),f}}),return(){return U(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return U(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,l,u;let d=new Set;const f=n.signal?e.withAbortSignal(n.signal):e;try{for(var m=!0,p=js(f),v;v=yield p.next(),i=v.done,!i;m=!0){u=v.value,m=!1;const C=u;d.add(C)}}catch(C){r={error:C}}finally{try{!m&&!i&&(l=p.return)&&(yield l.call(p))}finally{if(r)throw r.error}}return Array.from(d)})()})}}class L_ extends h4{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Mu(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const l=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,l)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Ri,r=null,l=null;if(this.signal){const d=this.signal;l=()=>{var f;(f=i.reject)===null||f===void 0||f.call(i,d.reason)},d.addEventListener("abort",l),r=d}const u=()=>{e.releaseLock(),r&&l&&r.removeEventListener("abort",l),this.signal=void 0};return{next:()=>U(this,void 0,void 0,function*(){var d,f;try{const{done:m,value:p}=yield Promise.race([e.read(),i.promise,(f=(d=this.outOfBandFailureRejectingFuture)===null||d===void 0?void 0:d.promise)!==null&&f!==void 0?f:new Promise(()=>{})]);if(m)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(p);let v;try{v=n.decode(p.content)}catch(C){throw new wi("Cannot decode datastream chunk ".concat(p.chunkIndex," as text: ").concat(C),In.DecodeFailed)}return{done:!1,value:v}}}catch(m){throw u(),m}}),return(){return U(this,void 0,void 0,function*(){return u(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return U(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,l,u;let d="";const f=n.signal?e.withAbortSignal(n.signal):e;try{for(var m=!0,p=js(f),v;v=yield p.next(),i=v.done,!i;m=!0)u=v.value,m=!1,d+=u}catch(C){r={error:C}}finally{try{!m&&!i&&(l=p.return)&&(yield l.call(p))}finally{if(r)throw r.error}}return d})()})}}class P_{constructor(){this.log=Xe,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new wi('A text stream handler for topic "'.concat(e,'" has already been set.'),In.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new wi('A byte stream handler for topic "'.concat(e,'" has already been set.'),In.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,l;const u=Array.from(this.textStreamControllers.entries()).filter(f=>f[1].sendingParticipantIdentity===e),d=Array.from(this.byteStreamControllers.entries()).filter(f=>f[1].sendingParticipantIdentity===e);if(u.length>0||d.length>0){const f=new wi("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),In.AbnormalEnd);for(const[m,p]of d)(i=(n=p.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,f),this.byteStreamControllers.delete(m);for(const[m,p]of u)(l=(r=p.outOfBandFailureRejectingFuture).reject)===null||l===void 0||l.call(r,f),this.textStreamControllers.delete(m)}}handleDataStreamPacket(e,n){return U(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return U(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const l=this.byteStreamHandlers.get(e.topic);if(!l){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let u;const d=new Ri;d.promise.catch(p=>{this.log.error(p)});const f={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Mu(e.timestamp),attributes:e.attributes,encryptionType:i},m=new ReadableStream({start:p=>{if(u=p,this.textStreamControllers.has(e.streamId))throw new wi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),In.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:f,controller:u,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:d})}});l(new D_(f,m,Mu(e.totalLength),d),{identity:n})}else if(e.contentHeader.case==="textHeader"){const l=this.textStreamHandlers.get(e.topic);if(!l){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let u;const d=new Ri;d.promise.catch(p=>{this.log.error(p)});const f={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},m=new ReadableStream({start:p=>{if(u=p,this.textStreamControllers.has(e.streamId))throw new wi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),In.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:f,controller:u,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:d})}});l(new L_(f,m,Mu(e.totalLength),d),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new wi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),In.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new wi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),In.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new wi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),In.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new wi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),In.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class f4{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return U(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class I_ extends f4{}class U_ extends f4{}const v2=15e3;class B_{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return U(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),u=new TextEncoder().encode(e).byteLength,d=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),f=new Array(d?d.length+1:1).fill(0),m=(v,C)=>{var x;f[C]=v;const S=f.reduce((k,E)=>k+E,0);(x=n==null?void 0:n.onProgress)===null||x===void 0||x.call(n,S)},p=yield this.streamText({streamId:r,totalSize:u,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:d,attributes:n==null?void 0:n.attributes});return yield p.write(e),m(1,0),yield p.close(),n!=null&&n.attachments&&d&&(yield Promise.all(n.attachments.map((v,C)=>U(this,void 0,void 0,function*(){return this._sendFile(d[C],v,{topic:n.topic,mimeType:v.type,onProgress:x=>{m(x,C+1)}})})))),p.info})}streamText(e){return U(this,void 0,void 0,function*(){var n,i,r;const l=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),u={id:l,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?vn.GCM:vn.NONE},d=new Vu({streamId:l,mimeType:u.mimeType,topic:u.topic,timestamp:Ia(u.timestamp),totalLength:Ia(e==null?void 0:e.totalSize),attributes:u.attributes,contentHeader:{case:"textHeader",value:new o5({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Gm.UPDATE:Gm.CREATE})}}),f=e==null?void 0:e.destinationIdentities,m=new Un({destinationIdentities:f,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(m,st.RELIABLE);let p=0;const v=this.engine,C=new WritableStream({write(k){return U(this,void 0,void 0,function*(){for(const E of AN(k,v2)){const _=new Hu({content:E,streamId:l,chunkIndex:Ia(p)}),O=new Un({destinationIdentities:f,value:{case:"streamChunk",value:_}});yield v.sendDataPacket(O,st.RELIABLE),p+=1}})},close(){return U(this,void 0,void 0,function*(){const k=new $u({streamId:l}),E=new Un({destinationIdentities:f,value:{case:"streamTrailer",value:k}});yield v.sendDataPacket(E,st.RELIABLE)})},abort(k){console.log("Sink error:",k)}});let x=()=>U(this,void 0,void 0,function*(){yield S.close()});v.once(je.Closing,x);const S=new I_(C,u,()=>this.engine.off(je.Closing,x));return S})}sendFile(e,n){return U(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return U(this,void 0,void 0,function*(){var r;const l=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),u=n.stream().getReader();for(;;){const{done:d,value:f}=yield u.read();if(d)break;yield l.write(f)}return yield l.close(),l.info})}streamBytes(e){return U(this,void 0,void 0,function*(){var n,i,r,l,u,d;const f=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),m=e==null?void 0:e.destinationIdentities,p={id:f,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(l=e==null?void 0:e.name)!==null&&l!==void 0?l:"unknown",encryptionType:!((u=this.engine.e2eeManager)===null||u===void 0)&&u.isDataChannelEncryptionEnabled?vn.GCM:vn.NONE},v=new Vu({totalLength:Ia((d=p.size)!==null&&d!==void 0?d:0),mimeType:p.mimeType,streamId:f,topic:p.topic,timestamp:Ia(Date.now()),attributes:p.attributes,contentHeader:{case:"byteHeader",value:new l5({name:p.name})}}),C=new Un({destinationIdentities:m,value:{case:"streamHeader",value:v}});yield this.engine.sendDataPacket(C,st.RELIABLE);let x=0;const S=new Bn,k=this.engine,E=this.log,_=new WritableStream({write(A){return U(this,void 0,void 0,function*(){const w=yield S.lock();let j=0;try{for(;j<A.byteLength;){const R=A.slice(j,j+v2),N=new Un({destinationIdentities:m,value:{case:"streamChunk",value:new Hu({content:R,streamId:f,chunkIndex:Ia(x)})}});yield k.sendDataPacket(N,st.RELIABLE),x+=1,j+=R.byteLength}}finally{w()}})},close(){return U(this,void 0,void 0,function*(){const A=new $u({streamId:f}),w=new Un({destinationIdentities:m,value:{case:"streamTrailer",value:A}});yield k.sendDataPacket(w,st.RELIABLE)})},abort(A){E.error("Sink error:",A)}});return new U_(_,p)})}}class Wu extends pe{constructor(e,n,i,r,l){super(e,i,l),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ce.Muted:Ce.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Ce.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return U(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),ug)),PN()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:l}=i;l&&this.rtpTimestamp!==l&&(this.emit(Ce.TimeSyncUpdate,{timestamp:r,rtpTimestamp:l}),this.rtpTimestamp=l)}};e()}}class F_ extends Wu{constructor(e,n,i,r,l,u){super(e,n,pe.Kind.Audio,i,u),this.monitorReceiver=()=>U(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const d=yield this.getReceiverStats();d&&this.prevStats&&this.receiver&&(this._currentBitrate=Cd(d,this.prevStats)),this.prevStats=d}),this.audioContext=r,this.webAudioPluginNodes=[],l&&(this.sinkId=l.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;ns()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ns())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return U(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(lp(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&lp(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Ce.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(Ce.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return U(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const ym=100;class z_ extends Wu{constructor(e,n,i,r,l){super(e,n,pe.Kind.Video,i,l),this.elementInfos=[],this.monitorReceiver=()=>U(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=Cd(u,this.prevStats)),this.prevStats=u}),this.debouncedHandleResize=rg(()=>{this.updateDimensions()},ym),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===pe.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?qr(this._mediaStreamTrack,n):Pr(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new q_(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return U(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(l=>{l.type==="inbound-rtp"?(i=l.codecId,n={type:"video",streamId:l.id,framesDecoded:l.framesDecoded,framesDropped:l.framesDropped,framesReceived:l.framesReceived,packetsReceived:l.packetsReceived,packetsLost:l.packetsLost,frameWidth:l.frameWidth,frameHeight:l.frameHeight,pliCount:l.pliCount,firCount:l.firCount,nackCount:l.nackCount,jitter:l.jitter,timestamp:l.timestamp,bytesReceived:l.bytesReceived,decoderImplementation:l.decoderImplementation}):l.type==="codec"&&r.set(l.id,l)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return U(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((f,m)=>Math.max(f,m.visibilityChangedAt||0),0),l=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,u=this.elementInfos.some(f=>f.pictureInPicture),d=this.elementInfos.some(f=>f.visible)&&!l||u;if(!(this.lastVisible===d&&!e)){if(!d&&Date.now()-r<ym){Nn.setTimeout(()=>{this.updateVisibility()},ym);return}this.lastVisible=d,this.emit(Ce.VisibilityChanged,d,this)}}updateDimensions(){var e,n;let i=0,r=0;const l=this.getPixelDensity();for(const u of this.elementInfos){const d=u.width()*l,f=u.height()*l;d+f>i+r&&(i=d,r=f)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(Ce.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Kb():n||(Kb()>2?2:1)}}class q_{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:l,isIntersecting:u}=i;l===this.element&&(this.isIntersecting=u,this.isPiP=ol(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,l;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=ol(this.element),(l=this.handleVisibilityChanged)===null||l===void 0||l.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=ol(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??pp(e),this.isPiP=Yn()&&ol(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=pp(this.element),this.isPiP=ol(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Zb().observe(this.element),Wb().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,l;(e=Zb())===null||e===void 0||e.unobserve(this.element),(n=Wb())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(l=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||l===void 0||l.removeEventListener("pagehide",this.onLeavePiP)}}function ol(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?pp(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function pp(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const l=t.offsetWidth,u=t.offsetHeight,{hidden:d}=t,{display:f}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+u>n.pageYOffset&&r+l>n.pageXOffset&&!d&&f!=="none"}class Ts extends ss.EventEmitter{constructor(e,n,i,r){var l;super(),this.metadataMuted=!1,this.encryption=vn.NONE,this.log=Xe,this.handleMuted=()=>{this.emit(Ce.Muted)},this.handleUnmuted=()=>{this.emit(Ce.Unmuted)},this.log=As((l=r==null?void 0:r.loggerName)!==null&&l!==void 0?l:qi.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=pe.Source.Unknown}setTrack(e){this.track&&(this.track.off(Ce.Muted,this.handleMuted),this.track.off(Ce.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Ce.Muted,this.handleMuted),e.on(Ce.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),it(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==vn.NONE}get audioTrack(){if(es(this.track))return this.track}get videoTrack(){if(pa(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=pe.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===pe.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(Ts||(Ts={}));class gp extends Ts{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Ce.Ended)},this.handleCpuConstrained=()=>{this.track&&pa(this.track)&&this.emit(Ce.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(Ce.Ended,this.handleTrackEnded),this.track.off(Ce.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(Ce.Ended,this.handleTrackEnded),e.on(Ce.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return U(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return U(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return U(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return U(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(es(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Sn.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Sn.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Sn.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Sn.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Sn.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Sn.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function xd(t,e){return U(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:l}=i4(t);let u=l.audio,d=l.video;if(i&&typeof l.audio=="object"&&(l.audio.processor=i),r&&typeof l.video=="object"&&(l.video.processor=r),t.audio&&typeof l.audio=="object"&&typeof l.audio.deviceId=="string"){const v=l.audio.deviceId;l.audio.deviceId={exact:v},n=!0,u=Object.assign(Object.assign({},l.audio),{deviceId:{ideal:v}})}if(l.video&&typeof l.video=="object"&&typeof l.video.deviceId=="string"){const v=l.video.deviceId;l.video.deviceId={exact:v},n=!0,d=Object.assign(Object.assign({},l.video),{deviceId:{ideal:v}})}l.audio===!0?l.audio={deviceId:"default"}:typeof l.audio=="object"&&l.audio!==null&&(l.audio=Object.assign(Object.assign({},l.audio),{deviceId:l.audio.deviceId||"default"})),l.video===!0?l.video={deviceId:"default"}:typeof l.video=="object"&&!l.video.deviceId&&(l.video.deviceId="default");const f=e4(l,a4,r4),m=ig(f),p=navigator.mediaDevices.getUserMedia(m);l.audio&&(kn.userMediaPromiseMap.set("audioinput",p),p.catch(()=>kn.userMediaPromiseMap.delete("audioinput"))),l.video&&(kn.userMediaPromiseMap.set("videoinput",p),p.catch(()=>kn.userMediaPromiseMap.delete("videoinput")));try{const v=yield p;return yield Promise.all(v.getTracks().map(C=>U(this,void 0,void 0,function*(){const x=C.kind==="audio";let S=x?f.audio:f.video;(typeof S=="boolean"||!S)&&(S={});let k;const E=x?m.audio:m.video;typeof E!="boolean"&&(k=E);const _=C.getSettings().deviceId;k!=null&&k.deviceId&&ha(k.deviceId)!==_?k.deviceId=_:k||(k={deviceId:_});const O=y_(C,k,e);return O.kind===pe.Kind.Video?O.source=pe.Source.Camera:O.kind===pe.Kind.Audio&&(O.source=pe.Source.Microphone),O.mediaStream=v,es(O)&&i?yield O.setProcessor(i):pa(O)&&r&&(yield O.setProcessor(r)),O})))}catch(v){if(!n)throw v;return xd(Object.assign(Object.assign({},t),{audio:u,video:d}),e)}})}function V_(t){return U(this,void 0,void 0,function*(){return(yield xd({audio:!1,video:!0}))[0]})}function H_(t){return U(this,void 0,void 0,function*(){return(yield xd({audio:!0,video:!1}))[0]})}var oa;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(oa||(oa={}));function $_(t){switch(t){case cl.EXCELLENT:return oa.Excellent;case cl.GOOD:return oa.Good;case cl.POOR:return oa.Poor;case cl.LOST:return oa.Lost;default:return oa.Unknown}}class m4 extends ss.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===yl.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Br.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,l,u){let d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:yl.STANDARD;var f;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=oa.Unknown,this.log=Xe,this.log=As((f=u==null?void 0:u.loggerName)!==null&&f!==void 0?f:qi.Participant),this.loggerOptions=u,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=d,this._attributes=l??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Ri,this.once(Re.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(pe.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(pe.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(pe.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Br.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Br.ACTIVE&&this.emit(Re.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(Re.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(Re.ParticipantNameChanged,e)}_setAttributes(e){const n=IN(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(Re.AttributesChanged,n)}setPermissions(e){var n,i,r,l,u,d;const f=this.permissions,m=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((l=this.permissions)===null||l===void 0?void 0:l.hidden)||e.recorder!==((u=this.permissions)===null||u===void 0?void 0:u.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((p,v)=>{var C;return p!==((C=this.permissions)===null||C===void 0?void 0:C.canPublishSources[v])})||e.canSubscribeMetrics!==((d=this.permissions)===null||d===void 0?void 0:d.canSubscribeMetrics);return this.permissions=e,m&&this.emit(Re.ParticipantPermissionsChanged,f),m}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Re.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=$_(e),n!==this._connectionQuality&&this.emit(Re.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>es(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(Ce.Muted,()=>{this.emit(Re.TrackMuted,e)}),e.on(Ce.Unmuted,()=>{this.emit(Re.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case pe.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case pe.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function G_(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new f5({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class K_ extends m4{constructor(e,n,i,r,l,u){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=vn.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Ri)},this.handleReconnected=()=>{var d,f;(f=(d=this.reconnectFuture)===null||d===void 0?void 0:d.resolve)===null||f===void 0||f.call(d),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var d,f,m,p,v,C;this.reconnectFuture&&(this.reconnectFuture.promise.catch(x=>this.log.warn(x.message,this.logContext)),(f=(d=this.reconnectFuture)===null||d===void 0?void 0:d.reject)===null||f===void 0||f.call(d,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((p=(m=this.signalConnectedFuture).reject)===null||p===void 0||p.call(m,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(C=(v=this.activeAgentFuture)===null||v===void 0?void 0:v.reject)===null||C===void 0||C.call(v,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=d=>{var f,m;d.participant&&this.updateInfo(d.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Ri),(m=(f=this.signalConnectedFuture).resolve)===null||m===void 0||m.call(f)},this.handleSignalRequestResponse=d=>{const{requestId:f,reason:m,message:p}=d,v=this.pendingSignalRequests.get(f);v&&(m!==Xp.OK&&v.reject(new qb(p,m)),this.pendingSignalRequests.delete(f))},this.handleDataPacket=d=>{switch(d.value.case){case"rpcResponse":let f=d.value.value,m=null,p=null;f.value.case==="payload"?m=f.value.value:f.value.case==="error"&&(p=Kt.fromProto(f.value.value)),this.handleIncomingRpcResponse(f.requestId,m,p);break;case"rpcAck":let v=d.value.value;this.handleIncomingRpcAck(v.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(d=>G_(d)))},this.onTrackUnmuted=d=>{this.onTrackMuted(d,d.isUpstreamPaused)},this.onTrackMuted=(d,f)=>{if(f===void 0&&(f=!0),!d.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),it(d)));return}this.engine.updateMuteStatus(d.sid,f)},this.onTrackUpstreamPaused=d=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),it(d))),this.onTrackMuted(d,!0)},this.onTrackUpstreamResumed=d=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),it(d))),this.onTrackMuted(d,d.isMuted)},this.onTrackFeatureUpdate=d=>{const f=this.audioTrackPublications.get(d.sid);if(!f){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(d.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(f.trackSid,f.getTrackFeatures())},this.onTrackCpuConstrained=(d,f)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),it(f))),this.emit(Re.LocalTrackCpuConstrained,d,f)},this.handleSubscribedQualityUpdate=d=>U(this,void 0,void 0,function*(){var f,m,p,v,C;if(!(!((C=this.roomOptions)===null||C===void 0)&&C.dynacast))return;const x=this.videoTrackPublications.get(d.trackSid);if(!x){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}if(!x.videoTrack)return;const S=yield x.videoTrack.setPublishingCodecs(d.subscribedCodecs);try{for(var k=!0,E=js(S),_;_=yield E.next(),f=_.done,!f;k=!0){v=_.value,k=!1;const O=v;fN(O)&&(this.log.debug("publish ".concat(O," for ").concat(x.videoTrack.sid),Object.assign(Object.assign({},this.logContext),it(x))),yield this.publishAdditionalCodecForTrack(x.videoTrack,O,x.options))}}catch(O){m={error:O}}finally{try{!k&&!f&&(p=E.return)&&(yield p.call(E))}finally{if(m)throw m.error}}}),this.handleLocalTrackUnpublished=d=>{const f=this.trackPublications.get(d.trackSid);if(!f){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}this.unpublishTrack(f.track)},this.handleTrackEnded=d=>U(this,void 0,void 0,function*(){if(d.source===pe.Source.ScreenShare||d.source===pe.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),it(d))),this.unpublishTrack(d);else if(d.isUserProvided)yield d.mute();else if(ks(d)||aa(d))try{if(Yn())try{const f=yield navigator==null?void 0:navigator.permissions.query({name:d.source===pe.Source.Camera?"camera":"microphone"});if(f&&f.state==="denied")throw this.log.warn("user has revoked access to ".concat(d.source),Object.assign(Object.assign({},this.logContext),it(d))),f.onchange=()=>{f.state!=="denied"&&(d.isMuted||d.restartTrack(),f.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}d.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),it(d))),ks(d)?yield d.restartTrack({deviceId:"default"}):yield d.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),it(d))),yield d.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=l,this.roomOutgoingDataStreamManager=u}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==vn.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(je.RemoteMute,(i,r)=>{const l=this.trackPublications.get(i);!l||!l.track||(r?l.mute():l.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(je.Connected,this.handleReconnected).on(je.SignalConnected,this.handleSignalConnected).on(je.SignalRestarted,this.handleReconnected).on(je.SignalResumed,this.handleReconnected).on(je.Restarting,this.handleReconnecting).on(je.Resuming,this.handleReconnecting).on(je.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(je.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(je.Closing,this.handleClosing).on(je.SignalRequestResponse,this.handleSignalRequestResponse).on(je.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return U(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return U(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return U(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return U(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:l,attributes:u}=n;return(function*(){return new Promise((d,f)=>U(i,void 0,void 0,function*(){var m,p;try{let v=!1;const C=yield this.engine.client.sendUpdateLocalMetadata((m=r??this.metadata)!==null&&m!==void 0?m:"",(p=l??this.name)!==null&&p!==void 0?p:"",u),x=performance.now();for(this.pendingSignalRequests.set(C,{resolve:d,reject:S=>{f(S),v=!0},values:{name:l,metadata:r,attributes:u}});performance.now()-x<5e3&&!v;){if((!l||this.name===l)&&(!r||this.metadata===r)&&(!u||Object.entries(u).every(S=>{let[k,E]=S;return this.attributes[k]===E||E===""&&!this.attributes[k]}))){this.pendingSignalRequests.delete(C),d();return}yield _n(50)}f(new qb("Request to update local metadata timed out","TimeoutError"))}catch(v){v instanceof Error&&f(v)}}))})()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(pe.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(pe.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(pe.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return U(this,void 0,void 0,function*(){this.encryptionType=e?vn.GCM:vn.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return U(this,void 0,void 0,function*(){var l,u;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let d=this.getTrackPublication(e);if(n)if(d)yield d.unmute();else{let f;if(this.pendingPublishing.has(e)){const m=yield this.waitForPendingPublicationOfSource(e);return m||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield m==null?void 0:m.unmute(),m}this.pendingPublishing.add(e);try{switch(e){case pe.Source.Camera:f=yield this.createTracks({video:(l=i)!==null&&l!==void 0?l:!0});break;case pe.Source.Microphone:f=yield this.createTracks({audio:(u=i)!==null&&u!==void 0?u:!0});break;case pe.Source.ScreenShare:f=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Rs(e)}}catch(m){throw f==null||f.forEach(p=>{p.stop()}),m instanceof Error&&this.emit(Re.MediaDevicesError,m,dp(e)),this.pendingPublishing.delete(e),m}for(const m of f){const p=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===pe.Source.Microphone&&es(m)&&p.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),m.startPreConnectBuffer())}try{const m=[];for(const v of f)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),it(v))),m.push(this.publishTrack(v,r));[d]=yield Promise.all(m)}catch(m){throw f==null||f.forEach(p=>{p.stop()}),m}finally{this.pendingPublishing.delete(e)}}else if(!(d!=null&&d.track)&&this.pendingPublishing.has(e)&&(d=yield this.waitForPendingPublicationOfSource(e),d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),d&&d.track)if(e===pe.Source.ScreenShare){d=yield this.unpublishTrack(d.track);const f=this.getTrackPublication(pe.Source.ScreenShareAudio);f&&f.track&&this.unpublishTrack(f.track)}else yield d.mute();return d})}enableCameraAndMicrophone(){return U(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(pe.Source.Camera)||this.pendingPublishing.has(pe.Source.Microphone))){this.pendingPublishing.add(pe.Source.Camera),this.pendingPublishing.add(pe.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(pe.Source.Camera),this.pendingPublishing.delete(pe.Source.Microphone)}}})}createTracks(e){return U(this,void 0,void 0,function*(){var n,i;e??(e={});const r=e4(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield xd(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(d=>(es(d)&&(this.microphoneError=void 0,d.setAudioContext(this.audioContext),d.source=pe.Source.Microphone,this.emit(Re.AudioStreamAcquired)),pa(d)&&(this.cameraError=void 0,d.source=pe.Source.Camera),d))}catch(l){throw l instanceof Error&&(e.audio&&(this.microphoneError=l),e.video&&(this.cameraError=l)),l}})}createScreenTracks(e){return U(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new tg("getDisplayMedia not supported");e.resolution===void 0&&!bN()&&(e.resolution=ng.h1080fps30.resolution);const n=DN(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Rs("no video track found");const l=new Tl(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=pe.Source.ScreenShare,e.contentHint&&(l.mediaStreamTrack.contentHint=e.contentHint);const u=[l];if(i.getAudioTracks().length>0){this.emit(Re.AudioStreamAcquired);const d=new kl(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});d.source=pe.Source.ScreenShareAudio,u.push(d)}return u})}publishTrack(e,n){return U(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return U(this,arguments,void 0,function(i,r){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var d,f,m,p;ks(i)&&i.setAudioContext(l.audioContext),yield(d=l.reconnectFuture)===null||d===void 0?void 0:d.promise,l.republishPromise&&!u&&(yield l.republishPromise),Vr(i)&&l.pendingPublishPromises.has(i)&&(yield l.pendingPublishPromises.get(i));let v;if(i instanceof MediaStreamTrack)v=i.getConstraints();else{v=i.constraints;let _;switch(i.source){case pe.Source.Microphone:_="audioinput";break;case pe.Source.Camera:_="videoinput"}_&&l.activeDeviceMap.has(_)&&(v=Object.assign(Object.assign({},v),{deviceId:l.activeDeviceMap.get(_)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new kl(i,v,!0,l.audioContext,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;case"video":i=new Tl(i,v,!0,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;default:throw new Rs("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});let C;if(l.trackPublications.forEach(_=>{_.track&&_.track===i&&(C=_)}),C)return l.log.warn("track has already been published, skipping",Object.assign(Object.assign({},l.logContext),it(C))),C;const x=Object.assign(Object.assign({},l.roomOptions.publishDefaults),r),S="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,k=(f=x.forceStereo)!==null&&f!==void 0?f:S;k&&(x.dtx===void 0&&l.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},l.logContext),it(i))),x.red===void 0&&l.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(m=x.dtx)!==null&&m!==void 0||(x.dtx=!1),(p=x.red)!==null&&p!==void 0||(x.red=!1)),!xN()&&l.roomOptions.e2ee&&(l.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},l.logContext)),x.simulcast=!1),x.source&&(i.source=x.source);const E=new Promise((_,O)=>U(l,void 0,void 0,function*(){try{if(this.engine.client.currentState!==_t.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:it(i)}));let A=!1;const w=setTimeout(()=>{A=!0,i.stop(),O(new zb("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(w),A)return;const j=yield this.publish(i,x,k);_(j)}else try{const A=yield this.publish(i,x,k);_(A)}catch(A){O(A)}}catch(A){O(A)}}));l.pendingPublishPromises.set(i,E);try{return yield E}catch(_){throw _}finally{l.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Ri),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),it(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>UN(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),it(e))),!1)}publish(e,n,i){return U(this,void 0,void 0,function*(){var r,l,u,d,f,m,p,v,C,x;if(!this.hasPermissionsToPublish(e))throw new zb("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(F=>Vr(e)&&F.source===e.source)&&e.source!==pe.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),it(e))),n.stopMicTrackOnMute&&es(e)&&(e.stopOnMute=!0),e.source===pe.Source.ScreenShare&&$a()&&(n.simulcast=!1),n.videoCodec==="av1"&&!gN()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!vN()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=hp),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(F=>n.videoCodec===fl(F.mime))||(n.videoCodec=fl(this.enabledPublishVideoCodecs[0].mime)));const k=n.videoCodec;e.on(Ce.Muted,this.onTrackMuted),e.on(Ce.Unmuted,this.onTrackUnmuted),e.on(Ce.Ended,this.handleTrackEnded),e.on(Ce.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Ce.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const E=[],_=!(!((r=n.dtx)!==null&&r!==void 0)||r),O=e.getSourceTrackSettings();O.autoGainControl&&E.push(Sn.TF_AUTO_GAIN_CONTROL),O.echoCancellation&&E.push(Sn.TF_ECHO_CANCELLATION),O.noiseSuppression&&E.push(Sn.TF_NOISE_SUPPRESSION),O.channelCount&&O.channelCount>1&&E.push(Sn.TF_STEREO),_&&E.push(Sn.TF_NO_DTX),ks(e)&&e.hasPreConnectBuffer&&E.push(Sn.TF_PRECONNECT_BUFFER);const A=new bl({cid:e.mediaStreamTrack.id,name:n.name,type:pe.kindToProto(e.kind),muted:e.isMuted,source:pe.sourceToProto(e.source),disableDtx:_,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((l=n.red)!==null&&l!==void 0)||l),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:E});let w;if(e.kind===pe.Kind.Video){let F={width:0,height:0};try{F=yield e.waitForDimensions()}catch{const I=(d=(u=this.roomOptions.videoCaptureDefaults)===null||u===void 0?void 0:u.resolution)!==null&&d!==void 0?d:Cl.h720.resolution;F={width:I.width,height:I.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),it(e)),{dims:F}))}A.width=F.width,A.height=F.height,aa(e)&&(Fi(k)&&(e.source===pe.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),it(e))))),n.scalabilityMode=(f=n.scalabilityMode)!==null&&f!==void 0?f:"L3T3_KEY"),A.simulcastCodecs=[new Wm({codec:k,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:hp}),n.backupCodec&&k!==n.backupCodec.codec&&A.encryption===vn.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),A.simulcastCodecs.push(new Wm({codec:n.backupCodec.codec,cid:""})))),w=mp(e.source===pe.Source.ScreenShare,A.width,A.height,n),A.layers=f2(A.width,A.height,w,Fi(n.videoCodec))}else e.kind===pe.Kind.Audio&&(w=[{maxBitrate:(m=n.audioPreset)===null||m===void 0?void 0:m.maxBitrate,priority:(v=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&v!==void 0?v:"high",networkPriority:(x=(C=n.audioPreset)===null||C===void 0?void 0:C.priority)!==null&&x!==void 0?x:"high"}]);if(!this.engine||this.engine.isClosed)throw new gn("cannot publish track when not connected");const j=()=>U(this,void 0,void 0,function*(){var F,D,I;if(!this.engine.pcManager)throw new gn("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,w),this.emit(Re.LocalSenderCreated,e.sender,e),aa(e)&&((F=n.degradationPreference)!==null&&F!==void 0||(n.degradationPreference=R_(e)),e.setDegradationPreference(n.degradationPreference)),w)if($a()&&e.kind===pe.Kind.Audio){let B;for(const G of this.engine.pcManager.publisher.getTransceivers())if(G.sender===e.sender){B=G;break}B&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:B,codec:"opus",maxbr:!((D=w[0])===null||D===void 0)&&D.maxBitrate?w[0].maxBitrate/1e3:0})}else e.codec&&Fi(e.codec)&&(!((I=w[0])===null||I===void 0)&&I.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:A.cid,codec:e.codec,maxbr:w[0].maxBitrate/1e3});yield this.engine.negotiate()});let R;const N=new Promise((F,D)=>U(this,void 0,void 0,function*(){var I;try{R=yield this.engine.addTrack(A),F(R)}catch(B){e.sender&&(!((I=this.engine.pcManager)===null||I===void 0)&&I.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(G=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),it(e)),{error:G}))})),D(B)}}));if(this.enabledPublishVideoCodecs.length>0)R=(yield Promise.all([N,j()]))[0];else{R=yield N;let F;if(R.codecs.forEach(D=>{F===void 0&&(F=D.mimeType)}),F&&e.kind===pe.Kind.Video){const D=fl(F);D!==k&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),it(e)),{codec:D})),n.videoCodec=D,w=mp(e.source===pe.Source.ScreenShare,A.width,A.height,n))}yield j()}const L=new gp(e.kind,R,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(L.on(Ce.CpuConstrained,F=>this.onTrackCpuConstrained(F,L)),L.options=n,e.sid=R.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:w,trackInfo:R})),aa(e)?e.startMonitor(this.engine.client):ks(e)&&e.startMonitor(),this.addTrackPublication(L),this.emit(Re.LocalTrackPublished,L),ks(e)&&R.audioFeatures.includes(Sn.TF_PRECONNECT_BUFFER)){const F=e.getPreConnectBuffer(),D=e.getPreConnectBufferMimeType();this.on(Re.LocalTrackSubscribed,I=>{if(I.trackSid===R.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),it(e))),e.stopPreConnectBuffer()}}),F&&new Promise((B,G)=>U(this,void 0,void 0,function*(){var Z,ue,q,ee,re,he;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),it(e)));const ae=setTimeout(()=>{G(new Error("agent not active within 10 seconds"))},1e4),le=yield this.waitUntilActiveAgentPresent();clearTimeout(ae),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),it(e)));const Te=yield this.streamBytes({name:"preconnect-buffer",mimeType:D,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[le.identity],attributes:{trackId:L.trackSid,sampleRate:String((re=O.sampleRate)!==null&&re!==void 0?re:"48000"),channels:String((he=O.channelCount)!==null&&he!==void 0?he:"1")}});try{for(var Se=!0,P=js(F),K;K=yield P.next(),Z=K.done,!Z;Se=!0){ee=K.value,Se=!1;const ce=ee;yield Te.write(ce)}}catch(ce){ue={error:ce}}finally{try{!Se&&!Z&&(q=P.return)&&(yield q.call(P))}finally{if(ue)throw ue.error}}yield Te.close(),B()}catch(ae){G(ae)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),it(e)))}).catch(B=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),it(e)),{error:B}))})}return L})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return U(this,void 0,void 0,function*(){var r;if(this.encryptionType!==vn.NONE)return;let l;if(this.trackPublications.forEach(x=>{x.track&&x.track===e&&(l=x)}),!l)throw new Rs("track is not published");if(!aa(e))throw new Rs("track is not a video track");const u=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),d=E_(e,n,u);if(!d){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),it(e)));return}const f=e.addSimulcastTrack(n,d);if(!f)return;const m=new bl({cid:f.mediaStreamTrack.id,type:pe.kindToProto(e.kind),muted:e.isMuted,source:pe.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:u.videoCodec,cid:f.mediaStreamTrack.id}]});if(m.layers=f2(m.width,m.height,d),!this.engine||this.engine.isClosed)throw new gn("cannot publish track when not connected");const p=()=>U(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,f,u,d),yield this.engine.negotiate()}),C=(yield Promise.all([this.engine.addTrack(m),p()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:C}))})}unpublishTrack(e,n){return U(this,void 0,void 0,function*(){var i,r;if(Vr(e)){const m=this.pendingPublishPromises.get(e);m&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),it(e))),yield m)}const l=this.getPublicationForTrack(e),u=l?it(l):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),!l||!l.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u));return}e=l.track,e.off(Ce.Muted,this.onTrackMuted),e.off(Ce.Unmuted,this.onTrackUnmuted),e.off(Ce.Ended,this.handleTrackEnded),e.off(Ce.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Ce.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let d=!1;const f=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<$t.FAILED&&f)try{for(const m of this.engine.pcManager.publisher.getTransceivers())m.sender===f&&(m.direction="inactive",d=!0);if(this.engine.removeTrack(f)&&(d=!0),aa(e)){for(const[,m]of e.simulcastCodecs)m.sender&&(this.engine.removeTrack(m.sender)&&(d=!0),m.sender=void 0);e.simulcastCodecs.clear()}}catch(m){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:m}))}switch(this.trackPublications.delete(l.trackSid),l.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(l.trackSid);break;case pe.Kind.Video:this.videoTrackPublications.delete(l.trackSid);break}return this.emit(Re.LocalTrackUnpublished,l),l.setTrack(void 0),d&&(yield this.engine.negotiate()),l})}unpublishTracks(e){return U(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return U(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((l,u)=>U(i,void 0,void 0,function*(){try{const d=[];this.trackPublications.forEach(f=>{f.track&&(n&&(f.options=Object.assign(Object.assign({},f.options),n)),d.push(f))}),yield Promise.all(d.map(f=>U(this,void 0,void 0,function*(){const m=f.track;yield this.unpublishTrack(m,!1),r&&!m.isMuted&&m.source!==pe.Source.ScreenShare&&m.source!==pe.Source.ScreenShareAudio&&(ks(m)||aa(m))&&!m.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:f.trackSid})),yield m.restartTrack()),yield this.publishOrRepublishTrack(m,f.options,!0)}))),l()}catch(d){u(d)}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return U(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const l=r.reliable?st.RELIABLE:st.LOSSY,u=r.destinationIdentities,d=r.topic;let f=new Hp({participantIdentity:i.identity,payload:n,destinationIdentities:u,topic:d});const m=new Un({kind:l,value:{case:"user",value:f}});yield i.engine.sendDataPacket(m,l)})()})}publishDtmf(e,n){return U(this,void 0,void 0,function*(){const i=new Un({kind:st.RELIABLE,value:{case:"sipDtmf",value:new Q9({code:e,digit:n})}});yield this.engine.sendDataPacket(i,st.RELIABLE)})}sendChatMessage(e,n){return U(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Un({value:{case:"chatMessage",value:new qu(Object.assign(Object.assign({},i),{timestamp:It.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,st.RELIABLE),this.emit(Re.ChatMessage,i),i})}editChatMessage(e,n){return U(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Un({value:{case:"chatMessage",value:new qu(Object.assign(Object.assign({},i),{timestamp:It.parse(i.timestamp),editTimestamp:It.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,st.RELIABLE),this.emit(Re.ChatMessage,i),i})}sendText(e,n){return U(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return U(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return U(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return U(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return U(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:l,payload:u,responseTimeout:d=15e3}=n;return(function*(){return new Promise((p,v)=>U(i,void 0,void 0,function*(){var C,x,S,k;if(cg(u)>l4){v(Kt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((x=(C=this.engine.latestJoinResponse)===null||C===void 0?void 0:C.serverInfo)===null||x===void 0)&&x.version&&is((k=(S=this.engine.latestJoinResponse)===null||S===void 0?void 0:S.serverInfo)===null||k===void 0?void 0:k.version,"1.8.0")<0){v(Kt.builtIn("UNSUPPORTED_SERVER"));return}const E=Math.max(d,8e3),_=crypto.randomUUID();yield this.publishRpcRequest(r,_,l,u,E);const O=setTimeout(()=>{this.pendingAcks.delete(_),v(Kt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(_),clearTimeout(A)},7e3);this.pendingAcks.set(_,{resolve:()=>{clearTimeout(O)},participantIdentity:r});const A=setTimeout(()=>{this.pendingResponses.delete(_),v(Kt.builtIn("RESPONSE_TIMEOUT"))},d);this.pendingResponses.set(_,{resolve:(w,j)=>{clearTimeout(A),this.pendingAcks.has(_)&&(console.warn("RPC response received before ack",_),this.pendingAcks.delete(_),clearTimeout(O)),j?v(j):p(w??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,l){return U(this,void 0,void 0,function*(){const u=new Un({destinationIdentities:[e],kind:st.RELIABLE,value:{case:"rpcRequest",value:new $p({id:n,method:i,payload:r,responseTimeoutMs:l,version:1})}});yield this.engine.sendDataPacket(u,st.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Kt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const l=this.trackPublications.get(n.sid);if(l){const u=l.isMuted||((r=(i=l.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);u!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),it(l)),{mutedOnServer:u})),this.engine.client.sendMuteTrack(n.sid,u))}}),!0):!1}setActiveAgent(e){var n,i,r,l;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(l=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||l===void 0||l.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Ri),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(ks(r)||aa(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return U(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(l=>{let[u]=l;return u.source===e});if(r)return r[1];yield _n(20)}})}}class W_ extends Ts{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=l=>{this.setTrack(void 0),this.emit(Ce.Ended,l)},this.handleVisibilityChange=l=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(l),this.logContext),this.visible=l,this.emitTrackUpdate()},this.handleVideoDimensionsChange=l=>{this.log.debug("adaptivestream video dimensions ".concat(l.width,"x").concat(l.height),this.logContext),this.videoDimensionsAdaptiveStream=l,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new vd({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new e5({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Ce.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Ts.SubscriptionStatus.Unsubscribed:super.isSubscribed?Ts.SubscriptionStatus.Subscribed:Ts.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Ts.PermissionStatus.Allowed:Ts.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(dm(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&dm(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:di.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(Ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(Ce.VisibilityChanged,this.handleVisibilityChange),r.off(Ce.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(Ce.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Ce.VisibilityChanged,this.handleVisibilityChange),e.on(Ce.Ended,this.handleEnded),this.emit(Ce.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(Ce.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?Ce.Muted:Ce.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(Ce.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Ce.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return dm(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new c5({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===pe.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Qb(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=BN(this.trackInfo,this.requestedMaxQuality);i&&Qb(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:di.HIGH})),e.quality=di.HIGH)}this.emit(Ce.UpdateSettings,e)}}class Zu extends m4{static fromParticipantInfo(e,n,i){return new Zu(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,l,u,d){let f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:yl.STANDARD;super(n,i||"",r,l,u,d,f),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Ce.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),it(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(Ce.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(Ce.SubscriptionPermissionChanged,n=>{this.emit(Re.TrackSubscriptionPermissionChanged,e,n)}),e.on(Ce.SubscriptionStatusChanged,n=>{this.emit(Re.TrackSubscriptionStatusChanged,e,n)}),e.on(Ce.Subscribed,n=>{this.emit(Re.TrackSubscribed,n,e)}),e.on(Ce.Unsubscribed,n=>{this.emit(Re.TrackUnsubscribed,n,e)}),e.on(Ce.SubscriptionFailed,n=>{this.emit(Re.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,l,u){let d=this.getTrackPublicationBySid(n);if(d||n.startsWith("TR")||this.trackPublications.forEach(p=>{!d&&e.kind===p.kind.toString()&&(d=p)}),!d){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(Re.TrackSubscriptionFailed,n);return}u===void 0&&(u=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,l,u-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),it(d))),this.emit(Re.TrackSubscriptionFailed,n);return}const f=e.kind==="video";let m;return f?m=new z_(e,n,r,l):m=new F_(e,n,r,this.audioContext,this.audioOutput),m.source=d.source,m.isMuted=d.isMuted,m.setMediaStream(i),m.start(),d.setTrack(m),this.volumeMap.has(d.source)&&cp(m)&&es(m)&&m.setVolume(this.volumeMap.get(d.source)),d}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var l,u;let d=this.getTrackPublicationBySid(r.sid);if(d)d.updateInfo(r);else{const f=pe.kindFromProto(r.type);if(!f)return;d=new W_(f,r,(l=this.signalClient.connectOptions)===null||l===void 0?void 0:l.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(u=this.loggerOptions)===null||u===void 0?void 0:u.loggerName}),d.updateInfo(r),i.set(r.sid,d);const m=Array.from(this.trackPublications.values()).find(p=>p.source===(d==null?void 0:d.source));m&&d.source!==pe.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(d.source),Object.assign(Object.assign({},this.logContext),{oldTrack:it(m),newTrack:it(d)})),this.addTrackPublication(d)}n.set(r.sid,d)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),it(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(Re.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(e);break;case pe.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(Re.TrackUnpublished,i)}setAudioOutput(e){return U(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;es(i.track)&&cp(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Ct;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Ct||(Ct={}));const Z_=4*1e3;class Zr extends ss.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,l;if(super(),n=this,this.state=Ct.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Xe,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,d,f)=>U(this,void 0,void 0,function*(){var m;if(!yN())throw ns()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const p=yield this.disconnectLock.lock();if(this.state===Ct.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),p(),Promise.resolve();if(this.connectFuture)return p(),this.connectFuture.promise;this.setAndEmitConnectionState(Ct.Connecting),((m=this.regionUrlProvider)===null||m===void 0?void 0:m.getServerUrl().toString())!==u&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ku(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new xt(u,d):this.regionUrlProvider.updateToken(d),this.regionUrlProvider.fetchRegionSettings().then(x=>{var S;(S=this.regionUrlProvider)===null||S===void 0||S.setServerReportedRegions(x)}).catch(x=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:x}))}));const v=(x,S,k)=>U(this,void 0,void 0,function*(){var E,_;this.abortController&&this.abortController.abort();const O=new AbortController;this.abortController=O,p==null||p();try{if(yield Hr.getInstance().getBackOffPromise(u),O.signal.aborted)throw new ut("Connection attempt aborted",Ge.Cancelled);yield this.attemptConnection(k??u,d,f,O),this.abortController=void 0,x()}catch(A){if(this.regionUrlProvider&&A instanceof ut&&A.reason!==Ge.Cancelled&&A.reason!==Ge.NotAllowed){let w=null;try{this.log.debug("Fetching next region"),w=yield this.regionUrlProvider.getNextBestRegionUrl((E=this.abortController)===null||E===void 0?void 0:E.signal)}catch(j){if(j instanceof ut&&(j.status===401||j.reason===Ge.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),S(j);return}}[Ge.InternalError,Ge.ServerUnreachable,Ge.Timeout].includes(A.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Hr.getInstance().addFailedConnectionAttempt(u)),w&&!(!((_=this.abortController)===null||_===void 0)&&_.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(A.message,". Retrying with another region: ").concat(w),this.logContext),this.recreateEngine(),yield v(x,S,w)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Jb(A)),S(A))}else{let w=zi.UNKNOWN_REASON;A instanceof ut&&(w=Jb(A)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,w),S(A)}}}),C=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Ri((x,S)=>{v(x,S,C)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,d,f,m,p,v)=>U(this,void 0,void 0,function*(){var C,x,S;const k=yield f.join(u,d,{autoSubscribe:m.autoSubscribe,adaptiveStream:typeof p.adaptiveStream=="object"?!0:p.adaptiveStream,maxRetries:m.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:m.websocketTimeout,singlePeerConnection:p.singlePeerConnection},v.signal);let E=k.serverInfo;if(E||(E={version:k.serverVersion,region:k.serverRegion}),this.serverInfo=E,this.log.debug("connected to Livekit Server ".concat(Object.entries(E).map(_=>{let[O,A]=_;return"".concat(O,": ").concat(A)}).join(", ")),{room:(C=k.room)===null||C===void 0?void 0:C.name,roomSid:(x=k.room)===null||x===void 0?void 0:x.sid,identity:(S=k.participant)===null||S===void 0?void 0:S.identity}),!E.version)throw new nN("unknown server version");return E.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),p.dynacast=!1),k}),this.applyJoinResponse=u=>{const d=u.participant;if(this.localParticipant.sid=d.sid,this.localParticipant.identity=d.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(f){this.log.error(f instanceof Error?f.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:f}))}this.handleParticipantUpdates([d,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,d,f,m)=>U(this,void 0,void 0,function*(){var p,v;this.state===Ct.Reconnecting||this.isResuming||!((p=this.engine)===null||p===void 0)&&p.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((v=this.regionUrlProvider)===null||v===void 0)&&v.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},lg),f),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const C=yield this.connectSignal(u,d,this.engine,this.connOptions,this.options,m);this.applyJoinResponse(C),this.setupLocalParticipantEvents(),this.emit(ye.SignalConnected)}catch(C){yield this.engine.close(),this.recreateEngine();const x=new ut("could not establish signal connection",m.signal.aborted?Ge.Cancelled:Ge.ServerUnreachable);throw C instanceof Error&&(x.message="".concat(x.message,": ").concat(C.message)),C instanceof ut&&(x.reason=C.reason,x.status=C.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:C})),x}if(m.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ut("Connection attempt aborted",Ge.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,m)}catch(C){throw yield this.engine.close(),this.recreateEngine(),C}Yn()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Yn()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ct.Connected),this.emit(ye.Connected),Hr.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,d=new Array(u),f=0;f<u;f++)d[f]=arguments[f];return U(n,[...d],void 0,function(){var m=this;let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var v,C,x;const S=yield m.disconnectLock.lock();try{if(m.state===Ct.Disconnected){m.log.debug("already disconnected",m.logContext);return}if(m.log.info("disconnect from room",Object.assign({},m.logContext)),m.state===Ct.Connecting||m.state===Ct.Reconnecting||m.isResuming){const k="Abort connection attempt due to user initiated disconnect";m.log.warn(k,m.logContext),(v=m.abortController)===null||v===void 0||v.abort(k),(x=(C=m.connectFuture)===null||C===void 0?void 0:C.reject)===null||x===void 0||x.call(C,new ut("Client initiated disconnect",Ge.Cancelled)),m.connectFuture=void 0}m.engine&&(m.engine.client.isDisconnected||(yield m.engine.client.sendLeave()),yield m.engine.close()),m.handleDisconnect(p,zi.CLIENT_INITIATED),m.engine=void 0}finally{S()}})()})},this.onPageLeave=()=>U(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>U(this,void 0,void 0,function*(){const u=[],d=ti();if(d&&d.os==="iOS"){const f="livekit-dummy-audio-el";let m=document.getElementById(f);if(!m){m=document.createElement("audio"),m.id=f,m.autoplay=!0,m.hidden=!0;const p=um();p.enabled=!0;const v=new MediaStream([p]);m.srcObject=v,document.addEventListener("visibilitychange",()=>{m&&(m.srcObject=document.hidden?null:v,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(m),this.once(ye.Disconnected,()=>{m==null||m.remove(),m=null})}u.push(m)}this.remoteParticipants.forEach(f=>{f.audioTrackPublications.forEach(m=>{m.track&&m.track.attachedElements.forEach(p=>{u.push(p)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(f=>(f.muted=!1,f.play()))]),this.handleAudioPlaybackStarted()}catch(f){throw this.handleAudioPlaybackFailed(f),f}}),this.startVideo=()=>U(this,void 0,void 0,function*(){const u=[];for(const d of this.remoteParticipants.values())d.videoTrackPublications.forEach(f=>{var m;(m=f.track)===null||m===void 0||m.attachedElements.forEach(p=>{u.includes(p)||u.push(p)})});yield Promise.all(u.map(d=>d.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(d=>{d.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Ct.Reconnecting)&&this.emit(ye.Reconnecting)},this.handleSignalRestarted=u=>U(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(d){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:d}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ct.Connected),this.emit(ye.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(d=>{var f;if(d.identity===this.localParticipant.identity){this.localParticipant.updateInfo(d);return}d.identity===""&&(d.identity=(f=this.sidToIdentity.get(d.sid))!==null&&f!==void 0?f:"");let m=this.remoteParticipants.get(d.identity);d.state===Br.DISCONNECTED?this.handleParticipantDisconnected(d.identity,m):m=this.getOrCreateParticipant(d.identity,d)})},this.handleActiveSpeakersUpdate=u=>{const d=[],f={};u.forEach(m=>{if(f[m.sid]=!0,m.sid===this.localParticipant.sid)this.localParticipant.audioLevel=m.level,this.localParticipant.setIsSpeaking(!0),d.push(this.localParticipant);else{const p=this.getRemoteParticipantBySid(m.sid);p&&(p.audioLevel=m.level,p.setIsSpeaking(!0),d.push(p))}}),f[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(m=>{f[m.sid]||(m.audioLevel=0,m.setIsSpeaking(!1))}),this.activeSpeakers=d,this.emitWhenConnected(ye.ActiveSpeakersChanged,d)},this.handleSpeakersChanged=u=>{const d=new Map;this.activeSpeakers.forEach(m=>{const p=this.remoteParticipants.get(m.identity);p&&p.sid!==m.sid||d.set(m.sid,m)}),u.forEach(m=>{let p=this.getRemoteParticipantBySid(m.sid);m.sid===this.localParticipant.sid&&(p=this.localParticipant),p&&(p.audioLevel=m.level,p.setIsSpeaking(m.active),m.active?d.set(m.sid,p):d.delete(m.sid))});const f=Array.from(d.values());f.sort((m,p)=>p.audioLevel-m.audioLevel),this.activeSpeakers=f,this.emitWhenConnected(ye.ActiveSpeakersChanged,f)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(d=>{const f=this.getRemoteParticipantBySid(d.participantSid);if(!f)return;const m=f.getTrackPublicationBySid(d.trackSid);if(!m||!m.track)return;const p=pe.streamStateFromProto(d.state);m.track.setStreamState(p),p!==m.track.streamState&&(f.emit(Re.TrackStreamStateChanged,m,m.track.streamState),this.emitWhenConnected(ye.TrackStreamStateChanged,m,m.track.streamState,f))})},this.handleSubscriptionPermissionUpdate=u=>{const d=this.getRemoteParticipantBySid(u.participantSid);if(!d)return;const f=d.getTrackPublicationBySid(u.trackSid);f&&f.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const d=Array.from(this.remoteParticipants.values()).find(m=>m.trackPublications.has(u.trackSid));if(!d)return;const f=d.getTrackPublicationBySid(u.trackSid);f&&f.setSubscriptionError(u.err)},this.handleDataPacket=(u,d)=>{const f=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(f,u.value.value,u.kind,d);else if(u.value.case==="transcription")this.handleTranscription(f,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(f,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(f,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,f);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,d);else if(u.value.case==="rpcRequest"){const m=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,m.id,m.method,m.payload,m.responseTimeoutMs,m.version)}},this.handleUserPacket=(u,d,f,m)=>{this.emit(ye.DataReceived,d.payload,u,f,d.topic,m),u==null||u.emit(Re.DataReceived,d.payload,f,m)},this.handleSipDtmf=(u,d)=>{this.emit(ye.SipDTMFReceived,d,u),u==null||u.emit(Re.SipDTMFReceived,d)},this.handleTranscription=(u,d)=>{const f=d.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(d.transcribedParticipantIdentity),m=f==null?void 0:f.trackPublications.get(d.trackId),p=jN(d,this.transcriptionReceivedTimes);m==null||m.emit(Ce.TranscriptionReceived,p),f==null||f.emit(Re.TranscriptionReceived,p,m),this.emit(ye.TranscriptionReceived,p,f,m)},this.handleChatMessage=(u,d)=>{const f=RN(d);this.emit(ye.ChatMessage,f,u)},this.handleMetrics=(u,d)=>{this.emit(ye.MetricsReceived,u,d)},this.handleDataStream=(u,d)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,d)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(ye.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(ye.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(ye.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(ye.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>U(this,void 0,void 0,function*(){var u;((u=ti())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(ye.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const d=this.roomInfo;this.roomInfo=u,d&&d.metadata!==u.metadata&&this.emitWhenConnected(ye.RoomMetadataChanged,u.metadata),(d==null?void 0:d.activeRecording)!==u.activeRecording&&this.emitWhenConnected(ye.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(d=>{if(d.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(d.quality);return}const f=this.getRemoteParticipantBySid(d.participantSid);f&&f.setConnectionQuality(d.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(ye.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(ye.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(ye.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(ye.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(ye.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var d;(d=u==null?void 0:u.onPublish)===null||d===void 0||d.call(u,this)},this.onLocalTrackPublished=u=>U(this,void 0,void 0,function*(){var d,f,m,p,v,C;(d=u.track)===null||d===void 0||d.on(Ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.on(Ce.Restarted,this.onLocalTrackRestarted),(v=(p=(m=u.track)===null||m===void 0?void 0:m.getProcessor())===null||p===void 0?void 0:p.onPublish)===null||v===void 0||v.call(p,this),this.emit(ye.LocalTrackPublished,u,this.localParticipant),ks(u.track)&&(yield u.track.checkForSilence())&&this.emit(ye.LocalAudioSilenceDetected,u);const x=yield(C=u.track)===null||C===void 0?void 0:C.getDeviceId(!1),S=dp(u.source);S&&x&&x!==this.localParticipant.activeDeviceMap.get(S)&&(this.localParticipant.activeDeviceMap.set(S,x),this.emit(ye.ActiveDeviceChanged,S,x))}),this.onLocalTrackUnpublished=u=>{var d,f;(d=u.track)===null||d===void 0||d.off(Ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.off(Ce.Restarted,this.onLocalTrackRestarted),this.emit(ye.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>U(this,void 0,void 0,function*(){const d=yield u.getDeviceId(!1),f=dp(u.source);f&&d&&d!==this.localParticipant.activeDeviceMap.get(f)&&(this.log.debug("local track restarted, setting ".concat(f," ").concat(d," active"),this.logContext),this.localParticipant.activeDeviceMap.set(f,d),this.emit(ye.ActiveDeviceChanged,f,d))}),this.onLocalConnectionQualityChanged=u=>{this.emit(ye.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,d)=>{this.emit(ye.MediaDevicesError,u,d)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(ye.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(ye.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},l_),e),this.log=As((i=this.options.loggerName)!==null&&i!==void 0?i:qi.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},a4),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},r4),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},o_),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new P_,this.outgoingDataStreamManager=new B_(this.engine,this.log),this.disconnectLock=new Bn,this.localParticipant=new K_("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ha(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ha(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",ha(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),Yn()){const u=new AbortController;(l=navigator.mediaDevices)===null||l===void 0||l.addEventListener("devicechange",this.handleDeviceChange,{signal:u.signal}),Zr.cleanupRegistry&&Zr.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return U(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new FN(i,n),this.e2eeManager.on(la.ParticipantEncryptionStatusChanged,(r,l)=>{_N(l)&&(this.isE2EEEnabled=r),this.emit(ye.ParticipantEncryptionStatusChanged,r,l)}),this.e2eeManager.on(la.EncryptionError,(r,l)=>{const u=l?this.getParticipantByIdentity(l):void 0;this.emit(ye.EncryptionError,r,u)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return U(this,void 0,void 0,function*(){return this.state===Ct.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(je.RoomUpdate,i),e(r.sid))};this.engine.on(je.RoomUpdate,i),this.once(ye.Disconnected,()=>{this.engine.off(je.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new M_(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(je.ParticipantUpdate,this.handleParticipantUpdates).on(je.RoomUpdate,this.handleRoomUpdate).on(je.SpeakersChanged,this.handleSpeakersChanged).on(je.StreamStateChanged,this.handleStreamStateUpdate).on(je.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(je.SubscriptionError,this.handleSubscriptionError).on(je.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(je.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(je.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(je.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(je.DataPacketReceived,this.handleDataPacket).on(je.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ct.SignalReconnecting)&&this.emit(ye.SignalReconnecting)}).on(je.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ct.Connected)&&this.emit(ye.Reconnected)}).on(je.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ct.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(je.Restarting,this.handleRestarting).on(je.SignalRestarted,this.handleSignalRestarted).on(je.Offline,()=>{this.setAndEmitConnectionState(Ct.Reconnecting)&&this.emit(ye.Reconnecting)}).on(je.DCBufferStatusChanged,(e,n)=>{this.emit(ye.DCBufferStatusChanged,e,n)}).on(je.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(Re.LocalTrackSubscribed,n),this.emitWhenConnected(ye.LocalTrackSubscribed,n,this.localParticipant)}).on(je.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(ye.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return kn.getInstance().getDevices(e,n)}prepareConnection(e,n){return U(this,void 0,void 0,function*(){if(this.state===Ct.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Ku(new URL(e))&&n){this.regionUrlProvider=new xt(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Ct.Disconnected&&(this.regionUrl=i,yield fetch(Sl(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Sl(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return U(this,void 0,void 0,function*(){let i=()=>U(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Qi({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Qi({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Qi({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Qi({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>U(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Qi({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>U(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Qi({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Qi({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>U(this,void 0,void 0,function*(){const l=this.engine.client.onLeave;l&&l(new yd({reason:zi.CLIENT_INITIATED,action:Fr.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Qi({scenario:{case:"subscriberBandwidth",value:Ia(n)}});break;case"leave-full-reconnect":r=new Qi({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return U(this,arguments,void 0,function(i,r){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var d,f,m,p,v,C,x;let S=!0,k=!1;const E=u?{exact:r}:r;if(i==="audioinput"){k=l.localParticipant.audioTrackPublications.size===0;const _=(d=l.getActiveDevice(i))!==null&&d!==void 0?d:l.options.audioCaptureDefaults.deviceId;l.options.audioCaptureDefaults.deviceId=E;const O=Array.from(l.localParticipant.audioTrackPublications.values()).filter(w=>w.source===pe.Source.Microphone);try{S=(yield Promise.all(O.map(w=>{var j;return(j=w.audioTrack)===null||j===void 0?void 0:j.setDeviceId(E)}))).every(w=>w===!0)}catch(w){throw l.options.audioCaptureDefaults.deviceId=_,w}const A=O.some(w=>{var j,R;return(R=(j=w.track)===null||j===void 0?void 0:j.isMuted)!==null&&R!==void 0?R:!1});S&&A&&(k=!0)}else if(i==="videoinput"){k=l.localParticipant.videoTrackPublications.size===0;const _=(f=l.getActiveDevice(i))!==null&&f!==void 0?f:l.options.videoCaptureDefaults.deviceId;l.options.videoCaptureDefaults.deviceId=E;const O=Array.from(l.localParticipant.videoTrackPublications.values()).filter(w=>w.source===pe.Source.Camera);try{S=(yield Promise.all(O.map(w=>{var j;return(j=w.videoTrack)===null||j===void 0?void 0:j.setDeviceId(E)}))).every(w=>w===!0)}catch(w){throw l.options.videoCaptureDefaults.deviceId=_,w}const A=O.some(w=>{var j,R;return(R=(j=w.track)===null||j===void 0?void 0:j.isMuted)!==null&&R!==void 0?R:!1});S&&A&&(k=!0)}else if(i==="audiooutput"){if(k=!0,!lp()&&!l.options.webAudioMix||l.options.webAudioMix&&l.audioContext&&!("setSinkId"in l.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");l.options.webAudioMix&&(r=(m=yield kn.getInstance().normalizeDeviceId("audiooutput",r))!==null&&m!==void 0?m:""),(p=(x=l.options).audioOutput)!==null&&p!==void 0||(x.audioOutput={});const _=(v=l.getActiveDevice(i))!==null&&v!==void 0?v:l.options.audioOutput.deviceId;l.options.audioOutput.deviceId=r;try{l.options.webAudioMix&&((C=l.audioContext)===null||C===void 0||C.setSinkId(r)),yield Promise.all(Array.from(l.remoteParticipants.values()).map(O=>O.setAudioOutput({deviceId:r})))}catch(O){throw l.options.audioOutput.deviceId=_,O}}return k&&(l.localParticipant.activeDeviceMap.set(i,r),l.emit(ye.ActiveDeviceChanged,i,r)),S})()})}setupLocalParticipantEvents(){this.localParticipant.on(Re.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Re.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Re.AttributesChanged,this.onLocalAttributesChanged).on(Re.TrackMuted,this.onLocalTrackMuted).on(Re.TrackUnmuted,this.onLocalTrackUnmuted).on(Re.LocalTrackPublished,this.onLocalTrackPublished).on(Re.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Re.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Re.MediaDevicesError,this.onMediaDevicesError).on(Re.AudioStreamAcquired,this.startAudio).on(Re.ChatMessage,this.onLocalChatMessageSent).on(Re.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Ct.Connecting||this.state===Ct.Reconnecting){const v=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(x=>x.id)}),this.onTrackAdded(e,n,i),C()},C=()=>{this.off(ye.Reconnected,v),this.off(ye.Connected,v),this.off(ye.Disconnected,C)};this.once(ye.Reconnected,v),this.once(ye.Connected,v),this.once(ye.Disconnected,C);return}if(this.state===Ct.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=pN(n.id),l=r[0];let u=r[1],d=e.id;if(u&&u.startsWith("TR")&&(d=u),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const f=Array.from(this.remoteParticipants.values()).find(v=>v.sid===l);if(!f){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}if(!d.startsWith("TR")){const v=this.engine.getTrackIdForReceiver(i);if(!v){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(l),this.logContext);return}d=v}d.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(l,", streamId: ").concat(u,", trackId: ").concat(d),Object.assign(Object.assign({},this.logContext),{rpID:l,streamId:u,trackId:d}));let m;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?m=this.options.adaptiveStream:m={});const p=f.addSubscribedMediaTrack(e,d,n,i,m);p!=null&&p.isEncrypted&&!this.e2eeManager&&this.emit(ye.EncryptionError,new Error("Encrypted ".concat(p.source," track received from participant ").concat(f.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ct.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(l=>{r.unpublishTrack(l.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var l,u,d;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((l=r.track)===null||l===void 0||l.detach(),(u=r.track)===null||u===void 0||u.stop()):(d=r.track)===null||d===void 0||d.stopMonitor()}),this.localParticipant.off(Re.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Re.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Re.AttributesChanged,this.onLocalAttributesChanged).off(Re.TrackMuted,this.onLocalTrackMuted).off(Re.TrackUnmuted,this.onLocalTrackUnmuted).off(Re.LocalTrackPublished,this.onLocalTrackPublished).off(Re.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Re.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Re.MediaDevicesError,this.onMediaDevicesError).off(Re.AudioStreamAcquired,this.startAudio).off(Re.ChatMessage,this.onLocalChatMessageSent).off(Re.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Yn()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ct.Disconnected),this.emit(ye.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(ye.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,l,u){return U(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),u!==1){yield this.engine.publishRpcResponse(e,n,null,Kt.builtIn("UNSUPPORTED_VERSION"));return}const d=this.rpcHandlers.get(i);if(!d){yield this.engine.publishRpcResponse(e,n,null,Kt.builtIn("UNSUPPORTED_METHOD"));return}let f=null,m=null;try{const p=yield d({requestId:n,callerIdentity:e,payload:r,responseTimeout:l});cg(p)>l4?(f=Kt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):m=p}catch(p){p instanceof Kt?f=p:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),p),f=Kt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,m,f)})}selectDefaultDevices(){return U(this,void 0,void 0,function*(){var e,n,i;const r=kn.getInstance().previousDevices,l=yield kn.getInstance().getDevices(void 0,!1),u=ti();if((u==null?void 0:u.name)==="Chrome"&&u.os!=="iOS")for(let f of l){const m=r.find(p=>p.deviceId===f.deviceId);m&&m.label!==""&&m.kind===f.kind&&m.label!==f.label&&this.getActiveDevice(f.kind)==="default"&&this.emit(ye.ActiveDeviceChanged,f.kind,f.deviceId)}const d=["audiooutput","audioinput","videoinput"];for(let f of d){const m=ON(f),p=this.localParticipant.getTrackPublication(m);if(p&&(!((e=p.track)===null||e===void 0)&&e.isUserProvided))continue;const v=l.filter(x=>x.kind===f),C=this.getActiveDevice(f);if(C===((n=r.filter(x=>x.kind===f)[0])===null||n===void 0?void 0:n.deviceId)&&v.length>0&&((i=v[0])===null||i===void 0?void 0:i.deviceId)!==C){yield this.switchActiveDevice(f,v[0].deviceId);continue}f==="audioinput"&&!xl()||f==="videoinput"||v.length>0&&!v.find(x=>x.deviceId===this.getActiveDevice(f))&&(f!=="audiooutput"||!xl())&&(yield this.switchActiveDevice(f,v[0].deviceId))}})}acquireAudioContext(){return U(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=n4())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),_n(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(ye.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Zu.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Zu(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(ye.ParticipantConnected,i),i.on(Re.TrackPublished,r=>{this.emitWhenConnected(ye.TrackPublished,r,i)}).on(Re.TrackSubscribed,(r,l)=>{r.kind===pe.Kind.Audio?(r.on(Ce.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(Ce.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===pe.Kind.Video&&(r.on(Ce.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(Ce.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(ye.TrackSubscribed,r,l,i)}).on(Re.TrackUnpublished,r=>{this.emit(ye.TrackUnpublished,r,i)}).on(Re.TrackUnsubscribed,(r,l)=>{this.emit(ye.TrackUnsubscribed,r,l,i)}).on(Re.TrackMuted,r=>{this.emitWhenConnected(ye.TrackMuted,r,i)}).on(Re.TrackUnmuted,r=>{this.emitWhenConnected(ye.TrackUnmuted,r,i)}).on(Re.ParticipantMetadataChanged,r=>{this.emitWhenConnected(ye.ParticipantMetadataChanged,r,i)}).on(Re.ParticipantNameChanged,r=>{this.emitWhenConnected(ye.ParticipantNameChanged,r,i)}).on(Re.AttributesChanged,r=>{this.emitWhenConnected(ye.ParticipantAttributesChanged,r,i)}).on(Re.ConnectionQualityChanged,r=>{this.emitWhenConnected(ye.ConnectionQualityChanged,r,i)}).on(Re.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(ye.ParticipantPermissionsChanged,r,i)}).on(Re.TrackSubscriptionStatusChanged,(r,l)=>{this.emitWhenConnected(ye.TrackSubscriptionStatusChanged,r,l,i)}).on(Re.TrackSubscriptionFailed,(r,l)=>{this.emit(ye.TrackSubscriptionFailed,r,i,l)}).on(Re.TrackSubscriptionPermissionChanged,(r,l)=>{this.emitWhenConnected(ye.TrackSubscriptionPermissionChanged,r,l,i)}).on(Re.Active,()=>{this.emitWhenConnected(ye.ParticipantActive,i),i.kind===yl.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&NN(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Nn.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,zi.STATE_MISMATCH))):e=0},Z_)}clearConnectionReconcile(){this.connectionReconcileInterval&&Nn.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(ye.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Ct.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Ct.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return U(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),l=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new md({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:It.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ha({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(ye.SignalConnected),this.emit(ye.Connected),this.setAndEmitConnectionState(Ct.Connected),r.video){const u=new gp(pe.Kind.Video,new Lr({source:cn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ui.AUDIO,name:"video-dummy"}),new Tl(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Yb(160*((n=l.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(Re.LocalTrackPublished,u)}if(r.audio){const u=new gp(pe.Kind.Audio,new Lr({source:cn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ui.AUDIO}),new kl(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:um(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(Re.LocalTrackPublished,u)}for(let u=0;u<l.count-1;u+=1){let d=new Ha({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(u),state:Br.ACTIVE,tracks:[],joinedAt:It.parse(Date.now())});const f=this.getOrCreateParticipant(d.identity,d);if(l.video){const m=Yb(160*((i=l.aspectRatios[u%l.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),p=new Lr({source:cn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ui.AUDIO});f.addSubscribedMediaTrack(m,p.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,p]}if(l.audio){const m=um(),p=new Lr({source:cn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ui.AUDIO});f.addSubscribedMediaTrack(m,p.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,p]}f.updateInfo(d)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==ye.ActiveSpeakersChanged&&e!==ye.TranscriptionReceived){const l=p4(i).filter(u=>u!==void 0);(e===ye.TrackSubscribed||e===ye.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:l})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:l}))}return super.emit(e,...i)}}Zr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function p4(t){return t.map(e=>{if(e)return Array.isArray(e)?p4(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ii;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ii||(Ii={}));class ga extends ss.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ii.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Zr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return U(this,void 0,void 0,function*(){if(this.status!==Ii.IDLE)throw Error("check is running already");this.setStatus(Ii.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ii.SKIPPED&&this.setStatus(this.isSuccess()?Ii.SUCCESS:Ii.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return U(this,void 0,void 0,function*(){return this.room.state===Ct.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return U(this,void 0,void 0,function*(){this.room&&this.room.state!==Ct.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ii.SKIPPED)}switchProtocol(e){return U(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(ye.Reconnecting,()=>{n=!0}),this.room.once(ye.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(l=>setTimeout(l,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield _n(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class Y_ extends ga{get description(){return"Cloud regions"}perform(){return U(this,void 0,void 0,function*(){const e=new xt(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let l=0;l<3;l++){const u=yield e.getNextBestRegionUrl();if(!u)break;if(i.has(u))continue;i.add(u);const d=yield this.checkCloudRegion(u);this.appendMessage("".concat(d.region," RTT: ").concat(d.rtt,"ms, duration: ").concat(d.duration,"ms")),n.push(d)}n.sort((l,u)=>(l.duration-u.duration)*.5+(l.rtt-u.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return U(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const l=yield this.room.localParticipant.streamText({topic:"test"}),u=1e3,f=1e6/u,m="A".repeat(u),p=Date.now();for(let S=0;S<f;S++)yield l.write(m);yield l.close();const v=Date.now(),C=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),x={region:r,rtt:1e4,duration:v-p};return C==null||C.forEach(S=>{S.type==="candidate-pair"&&S.nominated&&(x.rtt=S.currentRoundTripTime*1e3)}),yield this.disconnect(),x})}}const bm=1e4;class J_ extends ga{get description(){return"Connection via UDP vs TCP"}perform(){return U(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(bm/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(bm/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return U(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const l=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(l)};l();const d=n.captureStream(30).getVideoTracks()[0],m=(yield this.room.localParticipant.publishTrack(d,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,p={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},v=setInterval(()=>U(this,void 0,void 0,function*(){const C=yield m.getRTCStatsReport();C==null||C.forEach(x=>{x.type==="outbound-rtp"?(p.packetsSent=x.packetsSent,p.qualityLimitationDurations=x.qualityLimitationDurations,p.bitrateTotal+=x.targetBitrate,p.count++):x.type==="remote-inbound-rtp"&&(p.packetsLost=x.packetsLost,p.rttTotal+=x.roundTripTime,p.jitterTotal+=x.jitter)})}),1e3);return yield new Promise(C=>setTimeout(C,bm)),clearInterval(v),d.stop(),n.remove(),yield this.disconnect(),p})}}class Q_ extends ga{get description(){return"Can publish audio"}perform(){return U(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield H_();if(yield t4(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(d=>setTimeout(d,3e3));const l=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!l)throw new Error("Could not get RTCStats");let u=0;if(l.forEach(d=>{d.type==="outbound-rtp"&&(d.kind==="audio"||!d.kind&&d.mediaType==="audio")&&(u=d.packetsSent)}),u===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(u," audio packets"))})}}class X_ extends ga{get description(){return"Can publish video"}perform(){return U(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield V_();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(u=>setTimeout(u,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let l=0;if(r.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="video"||!u.kind&&u.mediaType==="video")&&(l+=u.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," video packets"))})}checkForVideo(e){return U(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var l,u,d,f;const m=document.createElement("canvas"),p=e.getSettings(),v=(u=(l=p.width)!==null&&l!==void 0?l:i.videoWidth)!==null&&u!==void 0?u:1280,C=(f=(d=p.height)!==null&&d!==void 0?d:i.videoHeight)!==null&&f!==void 0?f:720;m.width=v,m.height=C;const x=m.getContext("2d");x.drawImage(i,0,0);const k=x.getImageData(0,0,m.width,m.height).data;let E=!0;for(let _=0;_<k.length;_+=4)if(k[_]!==0||k[_+1]!==0||k[_+2]!==0){E=!1;break}E?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class eA extends ga{get description(){return"Resuming connection after interruption"}perform(){return U(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,l;const u=new Promise(m=>{setTimeout(m,5e3),l=m}),d=()=>{i=!0};n.on(ye.SignalReconnecting,d).on(ye.Reconnecting,d).on(ye.Reconnected,()=>{r=!0,l(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const f=n.engine.client.onClose;if(f&&f(""),yield u,i){if(!r||n.state!==Ct.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class tA extends ga{get description(){return"Can connect via TURN"}perform(){return U(this,void 0,void 0,function*(){var e,n;const i=new sg,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let l=!1,u=!1,d=!1;for(let f of r.iceServers)for(let m of f.urls)m.startsWith("turn:")?(u=!0,d=!0):m.startsWith("turns:")&&(u=!0,d=!0,l=!0),m.startsWith("stun:")&&(d=!0);d?u&&!l&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(f=>setTimeout(f,0)))})}}class nA extends ga{get description(){return"Establishing WebRTC connection"}perform(){return U(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(ye.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(l,u)=>{if(l.candidate){const d=new RTCIceCandidate(l);let f="".concat(d.protocol," ").concat(d.address,":").concat(d.port," ").concat(d.type);d.address&&(iA(d.address)?f+=" (private)":d.protocol==="tcp"&&d.tcpType==="passive"?(e=!0,f+=" (passive)"):d.protocol==="udp"&&(n=!0)),this.appendMessage(f)}r&&r(l,u)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=l=>{l instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(l.errorCode," ").concat(l.errorText," ").concat(l.url))})});try{yield this.connect(),Xe.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function iA(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class sA extends ga{get description(){return"Connecting to signal connection via WebSocket"}perform(){return U(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new sg;const l=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});this.appendMessage("Connected to server, version ".concat(l.serverVersion,".")),((e=l.serverInfo)===null||e===void 0?void 0:e.edition)===n5.Cloud&&(!((n=l.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=l.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class NM extends ss.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ii.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ii.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return U(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=u=>{this.updateCheck(n,u)};i.on("update",r);const l=yield i.run();return i.off("update",r),l})}checkWebsocket(){return U(this,void 0,void 0,function*(){return this.createAndRunCheck(sA)})}checkWebRTC(){return U(this,void 0,void 0,function*(){return this.createAndRunCheck(nA)})}checkTURN(){return U(this,void 0,void 0,function*(){return this.createAndRunCheck(tA)})}checkReconnect(){return U(this,void 0,void 0,function*(){return this.createAndRunCheck(eA)})}checkPublishAudio(){return U(this,void 0,void 0,function*(){return this.createAndRunCheck(Q_)})}checkPublishVideo(){return U(this,void 0,void 0,function*(){return this.createAndRunCheck(X_)})}checkConnectionProtocol(){return U(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(J_);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return U(this,void 0,void 0,function*(){return this.createAndRunCheck(Y_)})}}function at(t,e,n){return(e=rA(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function aA(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function rA(t){var e=aA(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class zn extends Error{constructor(e,n){var i;super(e,n),at(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}at(zn,"code","ERR_JOSE_GENERIC");class oA extends zn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),at(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),at(this,"claim",void 0),at(this,"reason",void 0),at(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}at(oA,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class lA extends zn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),at(this,"code","ERR_JWT_EXPIRED"),at(this,"claim",void 0),at(this,"reason",void 0),at(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}at(lA,"code","ERR_JWT_EXPIRED");class cA extends zn{constructor(){super(...arguments),at(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}at(cA,"code","ERR_JOSE_ALG_NOT_ALLOWED");class uA extends zn{constructor(){super(...arguments),at(this,"code","ERR_JOSE_NOT_SUPPORTED")}}at(uA,"code","ERR_JOSE_NOT_SUPPORTED");class dA extends zn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),at(this,"code","ERR_JWE_DECRYPTION_FAILED")}}at(dA,"code","ERR_JWE_DECRYPTION_FAILED");class hA extends zn{constructor(){super(...arguments),at(this,"code","ERR_JWE_INVALID")}}at(hA,"code","ERR_JWE_INVALID");class fA extends zn{constructor(){super(...arguments),at(this,"code","ERR_JWS_INVALID")}}at(fA,"code","ERR_JWS_INVALID");class mA extends zn{constructor(){super(...arguments),at(this,"code","ERR_JWT_INVALID")}}at(mA,"code","ERR_JWT_INVALID");class pA extends zn{constructor(){super(...arguments),at(this,"code","ERR_JWK_INVALID")}}at(pA,"code","ERR_JWK_INVALID");class gA extends zn{constructor(){super(...arguments),at(this,"code","ERR_JWKS_INVALID")}}at(gA,"code","ERR_JWKS_INVALID");class vA extends zn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),at(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}at(vA,"code","ERR_JWKS_NO_MATCHING_KEY");class yA extends zn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),at(this,Symbol.asyncIterator,void 0),at(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}at(yA,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class bA extends zn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),at(this,"code","ERR_JWKS_TIMEOUT")}}at(bA,"code","ERR_JWKS_TIMEOUT");class CA extends zn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),at(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}at(CA,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function xA({roomName:t,token:e,url:n}){const[i,r]=b.useState(null),[l,u]=b.useState(null),[d,f]=b.useState(new Map),[m,p]=b.useState(!1),[v,C]=b.useState(null),[x,S]=b.useState(!0),[k,E]=b.useState(!0),_=b.useRef(null),O=b.useCallback(async()=>{try{C(null),console.log("[LiveKit] Connecting to room:",t);const R=new Zr;if(_.current=R,r(R),R.on(ye.Connected,()=>{console.log("[LiveKit] Connected to room"),p(!0)}),R.on(ye.Disconnected,N=>{console.log("[LiveKit] Disconnected from room:",N),p(!1),u(null),f(new Map)}),R.on(ye.LocalTrackPublished,N=>{console.log("[LiveKit] Local track published:",N.kind),N.track&&u(L=>{const F=L?new MediaStream(L.getTracks()):new MediaStream;if(N.track instanceof Tl||N.track instanceof kl){const D=N.track.mediaStreamTrack;D&&(F.getTracks().find(B=>B.id===D.id)||F.addTrack(D))}return F})}),R.on(ye.TrackSubscribed,(N,L,F)=>{console.log("[LiveKit] Track subscribed:",N.kind,"from",F.identity),N instanceof Wu&&f(D=>{const I=new Map(D),B=F.identity;let G=I.get(B);G||(G=new MediaStream,I.set(B,G));const Z=N.mediaStreamTrack;return Z&&!G.getTracks().find(ue=>ue.id===Z.id)&&G.addTrack(Z),new Map(I)})}),R.on(ye.TrackUnsubscribed,(N,L,F)=>{console.log("[LiveKit] Track unsubscribed:",N.kind,"from",F.identity),N instanceof Wu&&f(D=>{const I=new Map(D),B=F.identity,G=I.get(B);if(G){const Z=N.mediaStreamTrack;Z&&G.removeTrack(Z),G.getTracks().length===0&&I.delete(B)}return new Map(I)})}),R.on(ye.ParticipantConnected,N=>{console.log("[LiveKit] Participant connected:",N.identity)}),R.on(ye.ParticipantDisconnected,N=>{console.log("[LiveKit] Participant disconnected:",N.identity),f(L=>{const F=new Map(L);return F.delete(N.identity),F})}),await R.connect(n,e),console.log("[LiveKit] Room connection initiated"),R.state==="connected"){await R.localParticipant.enableCameraAndMicrophone(),console.log("[LiveKit] Camera and microphone enabled");const N=R.localParticipant.trackPublications.values(),L=[];for(const F of N)if(F.track){const D=F.track.mediaStreamTrack;D&&L.push(D)}L.length>0&&u(new MediaStream(L))}}catch(R){console.error("[LiveKit] Error connecting:",R),C(R.message||"Failed to connect to LiveKit room"),p(!1)}},[t,e,n]),A=b.useCallback(()=>{_.current&&(console.log("[LiveKit] Disconnecting from room"),_.current.disconnect(),_.current=null,r(null),p(!1),u(null),f(new Map))},[]),w=b.useCallback(()=>{if(_.current){const R=!x;_.current.localParticipant.setCameraEnabled(R),S(R),console.log("[LiveKit] Video toggled:",R)}},[x]),j=b.useCallback(()=>{if(_.current){const R=!k;_.current.localParticipant.setMicrophoneEnabled(R),E(R),console.log("[LiveKit] Audio toggled:",R)}},[k]);return b.useEffect(()=>()=>{A()},[A]),{room:i,localStream:l,remoteStreams:d,isConnected:m,error:v,connect:O,disconnect:A,toggleVideo:w,toggleAudio:j,isVideoEnabled:x,isAudioEnabled:k}}function SA({participant:t}){const e=b.useRef(null);return b.useEffect(()=>{e.current&&t.stream&&(e.current.srcObject=t.stream)},[t.stream]),o.jsxs("div",{className:"participant-video-tile",children:[o.jsx("video",{ref:e,autoPlay:!0,playsInline:!0,muted:t.isLocal,className:"participant-video"}),o.jsxs("div",{className:"participant-info",children:[t.avatar?o.jsx("img",{src:t.avatar,alt:t.name||t.participantId,className:"participant-avatar"}):o.jsx("div",{className:"participant-avatar-placeholder",children:(t.name||t.participantId).charAt(0).toUpperCase()}),o.jsx("span",{className:"participant-name",children:t.isLocal?"Bn":t.name||t.participantId})]})]})}function kA({participants:t,localStream:e,localParticipantId:n}){const i=Ou.useMemo(()=>{const l=[];return e&&l.push({participantId:n,stream:e,isLocal:!0}),t.forEach(u=>{u.participantId!==n&&l.push({...u,isLocal:!1})}),l},[t,e,n]),r=Ou.useMemo(()=>{const l=i.length;return l===1?"grid-1":l===2?"grid-2":l===3?"grid-3":l===4?"grid-4":l===5?"grid-5":"grid-6"},[i.length]);return o.jsx("div",{className:`group-call-grid ${r}`,children:i.map(l=>o.jsx(SA,{participant:l},l.participantId))})}function TA(){const{callId:t}=wl(),e=yn(),n=Fn(),[i,r]=b.useState(null),[l,u]=b.useState(!1),[d]=b.useState(()=>localStorage.getItem("user_id")),[f,m]=b.useState(!1);b.useEffect(()=>(console.log("[CallScreen] Component mounted, callId:",t),()=>{console.log("[CallScreen] Component unmounting, callId:",t)}),[t]);const p=n.state,[v,C]=b.useState(0),[x,S]=b.useState(null),k=b.useRef(null),{info:E}=x9((i==null?void 0:i.conversationId)||""),_=[{id:"none",label:"Gc",emoji:""},{id:"beauty",label:"Mn",emoji:""},{id:"warm",label:"m",emoji:""},{id:"cool",label:"Mt",emoji:""},{id:"party",label:"Party",emoji:""},{id:"birthday",label:"Sinh nht",emoji:""}],[O,A]=b.useState(!1),[w,j]=b.useState(null),[R,N]=b.useState(""),L=!(i!=null&&i.callType)||i.callType==="p2p",{localStream:F,remoteStream:D,isConnected:I,error:B,startCall:G,endCall:Z,toggleVideo:ue,toggleAudio:q,isVideoEnabled:ee,isAudioEnabled:re,applyFilter:he,currentFilter:Se,startScreenShare:P,stopScreenShare:K,isScreenSharing:ae,localVideoRef:le,remoteVideoRef:Te}=tj({callId:t||"",conversationId:(i==null?void 0:i.conversationId)||"",isInitiator:l,localUserId:d||"",remoteUserId:(i==null?void 0:i.remoteUserId)||""}),{localStream:ce,remoteStreams:_e,isConnected:V,error:ve,connect:be,disconnect:Ue,toggleVideo:et,toggleAudio:At,isVideoEnabled:mt,isAudioEnabled:Dt}=xA({roomName:(i==null?void 0:i.livekitRoomName)||"",token:w||"",url:R}),Q=L?F:ce,Ee=L?D:null,se=L?I:V,fe=L?B:ve,Ae=L?ue:et,He=L?q:At,Me=L?ee:mt,Be=L?re:Dt,Je=L&&(i==null?void 0:i.type)==="video";b.useEffect(()=>{Je||A(!1)},[Je]);const xe=()=>{Je&&A(Ve=>!Ve)},Ne=b.useRef(!1),Ke=b.useRef(G);b.useEffect(()=>{Ke.current=G},[G]),b.useEffect(()=>(se&&x?k.current=setInterval(()=>{const pt=Math.floor((new Date().getTime()-x.getTime())/1e3);C(pt)},1e3):k.current&&(clearInterval(k.current),k.current=null),()=>{k.current&&clearInterval(k.current)}),[se,x]),b.useEffect(()=>{se&&!x&&S(new Date)},[se,x]);const ft=Ve=>{const pt=Math.floor(Ve/3600),Tt=Math.floor(Ve%3600/60),Bt=Ve%60;return pt>0?`${pt.toString().padStart(2,"0")}:${Tt.toString().padStart(2,"0")}:${Bt.toString().padStart(2,"0")}`:`${Tt.toString().padStart(2,"0")}:${Bt.toString().padStart(2,"0")}`};b.useEffect(()=>{if(!t||!d)return;if(p!=null&&p.conversationId){console.log("[CallScreen] Using call info from location state:",p),r({conversationId:p.conversationId,initiatorId:p.initiatorId||d,remoteUserId:p.remoteUserId||"",type:p.type||"video",callType:p.callType||"p2p",livekitRoomName:p.livekitRoomName}),u(p.isInitiator||!1),p.callType==="sfu"&&p.livekitRoomName&&t&&Hf(t).then(Tt=>{j(Tt.token),N(Tt.url),console.log("[CallScreen] LiveKit token obtained from location state")}).catch(Tt=>{console.error("[CallScreen] Error getting LiveKit token:",Tt)}),(p.acceptedFromModal||!p.isInitiator&&p.conversationId)&&(m(!0),console.log("[CallScreen] User accepted from modal, will auto-start call"));return}(async()=>{var Tt,Bt,ii;try{console.log("[CallScreen] Loading call info for callId:",t);const Lt=await pC(t);console.log("[CallScreen] Call info loaded:",Lt);const Fe=Lt.participants.find(qn=>String(qn)!==d)||"",rt=String(Lt.initiatorId)===d,fn=Lt.callType||"p2p";if(r({conversationId:String(Lt.conversationId),initiatorId:String(Lt.initiatorId),remoteUserId:String(Fe),type:Lt.type,callType:fn,livekitRoomName:(Tt=Lt.metadata)==null?void 0:Tt.livekitRoomName,participants:Lt.participants.map(qn=>String(qn))}),u(rt),fn==="sfu"&&((Bt=Lt.metadata)!=null&&Bt.livekitRoomName))try{const qn=await Hf(t);j(qn.token),N(qn.url),console.log("[CallScreen] LiveKit token obtained")}catch(qn){console.error("[CallScreen] Error getting LiveKit token:",qn)}}catch(Lt){if(console.error("[CallScreen] Error loading call info:",Lt),((ii=Lt.response)==null?void 0:ii.status)===404){console.warn("[CallScreen] Call not found (404), trying socket events...");const Fe=hi();Fe&&(Fe.once("call:info",rt=>{rt.callId===t&&(console.log("[CallScreen] Got call info from socket:",rt),r({conversationId:rt.conversationId,initiatorId:rt.initiatorId,remoteUserId:rt.remoteUserId||rt.initiatorId,type:rt.type||"video"}),u(String(rt.initiatorId)===d))}),Fe.once("call:incoming",rt=>{rt.callId===t&&(console.log("[CallScreen] Got call info from call:incoming:",rt),r({conversationId:rt.conversationId,initiatorId:rt.initiatorId,remoteUserId:rt.initiatorId,type:rt.type||"video"}),u(!1))}))}}})();const pt=hi();if(pt){const Tt=async Fe=>{if(Fe.callId===t&&(console.log("[CallScreen] Received call:incoming event:",Fe),r({conversationId:Fe.conversationId,initiatorId:Fe.initiatorId,remoteUserId:Fe.remoteUserId||Fe.initiatorId,type:Fe.type,callType:Fe.callType||"p2p",livekitRoomName:Fe.livekitRoomName,participants:Fe.participants}),u(!1),Fe.callType==="sfu"&&Fe.livekitRoomName))try{const rt=await Hf(t);j(rt.token),N(rt.url),console.log("[CallScreen] LiveKit token obtained from incoming call")}catch(rt){console.error("[CallScreen] Error getting LiveKit token:",rt)}},Bt=Fe=>{if(Fe.callId!==t)return;console.log("[CallScreen] Received call:info event:",Fe);const rt=Fe.participants.find(qn=>String(qn)!==d)||"",fn=String(Fe.initiatorId)===d;r({conversationId:Fe.conversationId,initiatorId:String(Fe.initiatorId),remoteUserId:String(rt),type:Fe.type}),u(fn)},ii=Fe=>{if(Fe.callId===t){if(console.log("[CallScreen] Received call:accepted event:",Fe),Fe.conversationId){const rt=Fe.participants?Fe.participants.find(fn=>String(fn)!==d)||"":Fe.remoteUserId||"";r(fn=>fn?{...fn,conversationId:Fe.conversationId,remoteUserId:rt||fn.remoteUserId,type:Fe.type||fn.type}:{conversationId:Fe.conversationId,initiatorId:Fe.initiatorId||d,remoteUserId:rt,type:Fe.type||"video"})}l&&!se&&!Ne.current&&i&&(console.log("[CallScreen] Call accepted, auto-starting call..."),console.log("[CallScreen] CallInfo available:",i),Ne.current=!0,setTimeout(async()=>{console.log("[CallScreen] Attempting to start call as initiator..."),i.callType==="sfu"&&w?await be():Ke.current().then(()=>{console.log("[CallScreen] Call started successfully as initiator")}).catch(rt=>{console.error("[CallScreen] Error auto-starting call:",rt),Ne.current=!1})},1e3))}},Lt=Fe=>{Fe.callId===t&&console.log("[CallScreen] Received call:active event:",Fe)};return pt.on("call:incoming",Tt),pt.on("call:info",Bt),pt.on("call:accepted",ii),pt.on("call:active",Lt),()=>{pt.off("call:incoming",Tt),pt.off("call:info",Bt),pt.off("call:accepted",ii),pt.off("call:active",Lt)}}},[t,d]),b.useEffect(()=>{se&&(Ne.current=!1)},[se]),b.useEffect(()=>{if(se||Ne.current)return;const Ve=(i==null?void 0:i.callType)==="sfu",pt=!Ve&&(i==null?void 0:i.remoteUserId),Tt=Ve&&(i==null?void 0:i.livekitRoomName);l&&i&&i.conversationId&&(pt||Tt)?(console.log("[CallScreen] Auto-start effect triggered for initiator:",{isInitiator:l,isConnected:se,callInfo:i,isP2PReady:pt,isSFUReady:Tt}),Ne.current=!0,console.log("[CallScreen] Starting call as initiator from auto-start effect..."),setTimeout(async()=>{if(Ve)if(w||i.livekitRoomName){console.log("[CallScreen] Connecting to LiveKit...",{hasToken:!!w});try{await be()}catch(Bt){console.error("[CallScreen] Error connecting to LiveKit:",Bt),Ne.current=!1}}else console.error("[CallScreen] LiveKit token and room name not available"),Ne.current=!1;else console.log("[CallScreen] Starting P2P call with remoteUserId:",i.remoteUserId),Ke.current().then(()=>{console.log("[CallScreen]  Call started as initiator from auto-start effect")}).catch(Bt=>{console.error("[CallScreen]  Error starting call as initiator:",Bt),Ne.current=!1})},500)):f&&!l&&i&&i.conversationId&&(pt||Tt)&&(console.log("[CallScreen] Auto-start effect triggered for non-initiator:",{acceptedFromModal:f,isInitiator:l,isConnected:se,callInfo:i,isP2PReady:pt,isSFUReady:Tt}),Ne.current=!0,console.log("[CallScreen] Starting call from auto-start effect..."),setTimeout(async()=>{if(Ve)if(w||i.livekitRoomName){console.log("[CallScreen] Connecting to LiveKit...",{hasToken:!!w});try{await be()}catch(Bt){console.error("[CallScreen] Error connecting to LiveKit:",Bt),Ne.current=!1}}else console.error("[CallScreen] LiveKit token and room name not available"),Ne.current=!1;else console.log("[CallScreen] Starting P2P call with remoteUserId:",i.remoteUserId),Ke.current().then(()=>{console.log("[CallScreen]  Call started from auto-start effect")}).catch(Bt=>{console.error("[CallScreen]  Error starting call from auto-start effect:",Bt),Ne.current=!1})},500))},[f,l,se,i,w,be]);const zt=async()=>{if(t)try{console.log("[CallScreen] Accepting call:",t),await gC(t),console.log("[CallScreen] Call accepted, starting call..."),(i==null?void 0:i.callType)==="sfu"&&w?await be():await G(),console.log("[CallScreen] Call started successfully")}catch(Ve){console.error("[CallScreen] Error accepting call:",Ve);try{(i==null?void 0:i.callType)==="sfu"&&w?await be():await G()}catch(pt){console.error("[CallScreen] Error starting call after accept:",pt)}}},dn=async()=>{if(t)try{await vC(t),e(-1)}catch(Ve){console.error("Error rejecting call:",Ve)}},hn=async()=>{if(t)try{L?Z():Ue(),await OE(t),e(-1)}catch(Ve){console.error("Error ending call:",Ve),e(-1)}},Os=async Ve=>{try{await he(Ve),A(!1)}catch(pt){console.error("[CallScreen] Error applying filter:",pt)}},fi=async()=>{try{ae?await K():await P()}catch(Ve){console.error("[CallScreen] Screen share error:",Ve)}},nn=Ou.useMemo(()=>{if(L)return[];const Ve=[];return _e.forEach((pt,Tt)=>{Ve.push({participantId:Tt,stream:pt})}),Ve},[_e,L]),Ln=(E==null?void 0:E.name)||"Unknown",qt=E==null?void 0:E.avatar;return t?i?o.jsxs("div",{className:"call-screen",children:[!L&&i.callType==="sfu"?o.jsx("div",{className:"call-main-video",style:{width:"100%",height:"100%",background:"#000"},children:se&&(Q||nn.length>0)?o.jsx(kA,{participants:nn,localStream:Q,localParticipantId:d||""}):o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#fff"},children:[w?se?o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{fontSize:"18px",marginBottom:"10px"},children:"ang ti video..."}),o.jsx("div",{style:{fontSize:"14px",color:"rgba(255,255,255,0.6)"},children:"Vui lng i"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{fontSize:"18px",marginBottom:"10px"},children:"ang kt ni..."}),o.jsx("div",{style:{fontSize:"14px",color:"rgba(255,255,255,0.6)"},children:"ang tham gia cuc gi nhm"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{fontSize:"18px",marginBottom:"10px"},children:"ang ly token..."}),o.jsx("div",{style:{fontSize:"14px",color:"rgba(255,255,255,0.6)"},children:"Vui lng i"})]}),fe&&o.jsx("div",{style:{marginTop:"20px",padding:"10px 20px",background:"rgba(255,0,0,0.2)",borderRadius:"8px",color:"#ff6b6b"},children:fe})]})}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"call-main-video",children:Ee?o.jsx("video",{ref:Te,autoPlay:!0,playsInline:!0,className:"call-video-remote"}):o.jsxs("div",{className:"call-avatar-container",children:[qt?o.jsx("img",{src:qt,alt:Ln,className:"call-avatar"}):o.jsx("div",{className:"call-avatar-placeholder",children:Ln.charAt(0).toUpperCase()}),o.jsx("div",{className:"call-name",children:Ln}),!se&&o.jsx("div",{className:"call-status",children:l?"ang gi...":f?"ang kt ni...":"Cuc gi n..."})]})}),i.type==="video"&&Q&&o.jsx("div",{className:"call-self-view",children:o.jsx("video",{ref:le,autoPlay:!0,playsInline:!0,muted:!0,className:"call-video-local"})})]}),se&&v>0&&o.jsx("div",{className:"call-duration",children:ft(v)}),fe&&o.jsx("div",{className:"call-error-banner",children:fe}),o.jsxs("div",{className:"call-controls",children:[!l&&!se&&!f&&o.jsxs("div",{className:"call-incoming-controls",children:[o.jsx("button",{className:"call-control-btn call-control-accept",onClick:zt,title:"Chp nhn",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),o.jsx("button",{className:"call-control-btn call-control-reject",onClick:dn,title:"T chi",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),se&&o.jsxs("div",{className:"call-active-controls",children:[o.jsx("button",{className:"call-control-btn call-control-secondary",onClick:()=>e(`/chat/${i.conversationId}`),title:"Tin nhn",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),Je&&o.jsx("button",{className:`call-control-btn call-control-secondary ${O||Se!=="none"?"call-control-active":""}`,title:"B lc lm p",onClick:xe,children:o.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M12 3L13.5 7.5L18 9L13.5 10.5L12 15L10.5 10.5L6 9L10.5 7.5L12 3Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M5 16H9",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),o.jsx("path",{d:"M15 16H19",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})]})}),Je&&o.jsx("button",{className:`call-control-btn call-control-secondary ${ae?"call-control-active":""}`,title:ae?"Dng chia s mn hnh":"Chia s mn hnh",onClick:fi,children:ae?o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M4 5H20C21.1046 5 22 5.89543 22 7V15C22 16.1046 21.1046 17 20 17H4C2.89543 17 2 16.1046 2 15V7C2 5.89543 2.89543 5 4 5Z",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M12 21V17",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),o.jsx("path",{d:"M8 21H16",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),o.jsx("path",{d:"M8 9L12 13L16 9",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"})]}):o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M4 5H20C21.1046 5 22 5.89543 22 7V14C22 15.1046 21.1046 16 20 16H4C2.89543 16 2 15.1046 2 14V7C2 5.89543 2.89543 5 4 5Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M12 20V16",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),o.jsx("path",{d:"M8 20H16",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})]})}),o.jsx("button",{className:`call-control-btn ${Be?"":"call-control-muted"}`,onClick:He,title:Be?"Tt mic":"Bt mic",children:Be?o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M12 1C10.34 1 9 2.34 9 4V12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12V4C15 2.34 13.66 1 12 1Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M19 10V12C19 15.87 15.87 19 12 19C8.13 19 5 15.87 5 12V10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M12 19V23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M8 23H16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}):o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M1 1L23 23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M9 9V12C9 13.66 10.34 15 12 15C12.41 15 12.81 14.92 13.17 14.77",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M5 10V12C5 15.87 8.13 19 12 19C12.69 19 13.35 18.89 13.97 18.7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M9 1V4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M15 1V4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M12 19V23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M8 23H16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),i.type==="video"&&o.jsx("button",{className:`call-control-btn ${Me?"":"call-control-muted"}`,onClick:Ae,title:Me?"Tt camera":"Bt camera",children:Me?o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M23 7L16 12L23 17V7Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M14 5H3C1.89543 5 1 5.89543 1 7V17C1 18.1046 1.89543 19 3 19H14C15.1046 19 16 18.1046 16 17V7C16 5.89543 15.1046 5 14 5Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}):o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M1 1L23 23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M16 12L23 7V17L16 12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M14 5H3C1.89543 5 1 5.89543 1 7V17C1 18.1046 1.89543 19 3 19H14C15.1046 19 16 18.1046 16 17V7C16 5.89543 15.1046 5 14 5Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),o.jsx("button",{className:"call-control-btn call-control-end",onClick:hn,title:"Kt thc cuc gi",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M3 5C3 3.89543 3.89543 3 5 3H8.27924C8.70967 3 9.09181 3.27543 9.22792 3.68377L10.7257 8.17721C10.8831 8.64932 10.6694 9.16531 10.2243 9.38787L7.96701 10.5165C9.06925 12.9612 11.0388 14.9308 13.4835 16.033L14.6121 13.7757C14.8347 13.3306 15.3507 13.1169 15.8228 13.2743L20.3162 14.7721C20.7246 14.9082 21 15.2903 21 15.7208V19C21 20.1046 20.1046 21 19 21H18C9.71573 21 3 14.2843 3 6V5Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),Je&&ae&&o.jsxs("div",{className:"call-screen-share-indicator",children:[o.jsx("span",{children:"ang chia s mn hnh"}),o.jsx("button",{type:"button",onClick:fi,children:"Dng chia s"})]}),Je&&O&&o.jsxs("div",{className:"call-filter-panel",children:[o.jsxs("div",{className:"call-filter-panel__header",children:[o.jsx("span",{children:"B lc & hiu ng"}),o.jsx("button",{type:"button",onClick:()=>A(!1),"aria-label":"ng",children:""})]}),o.jsx("div",{className:"call-filter-panel__list",children:_.map(Ve=>{const pt=Se===Ve.id,Tt=ae;return o.jsxs("button",{type:"button",className:`filter-option ${pt?"active":""} ${Tt?"disabled":""}`,onClick:()=>!Tt&&Os(Ve.id),disabled:Tt,children:[o.jsx("span",{className:"filter-option__emoji",children:Ve.emoji}),o.jsx("span",{className:"filter-option__label",children:Ve.label})]},Ve.id)})}),ae&&o.jsx("div",{className:"call-filter-panel__notice",children:"Tt chia s mn hnh  s dng b lc."})]})]}):o.jsxs("div",{className:"call-screen",children:[o.jsx("div",{className:"call-loading",children:"Loading call..."}),o.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",color:"rgba(255, 255, 255, 0.5)",fontSize:"14px"},children:["Call ID: ",t]}),o.jsx("div",{style:{position:"absolute",bottom:"60px",left:"50%",transform:"translateX(-50%)",color:"rgba(255, 255, 255, 0.3)",fontSize:"12px",textAlign:"center",maxWidth:"400px"},children:"Nu call khng tm thy, c th  b kt thc hoc backend cha c endpoint GET /calls/:callId"})]}):o.jsx("div",{className:"call-screen",children:o.jsx("div",{className:"call-loading",children:"Invalid call ID"})})}const EA=({imageFile:t,onClose:e,onSave:n})=>{const[i,r]=b.useState(""),[l,u]=b.useState(1),[d,f]=b.useState({x:0,y:0}),[m,p]=b.useState(!1),[v,C]=b.useState({x:0,y:0}),x=b.useRef(null),S=b.useRef(null),k=b.useRef(null),E=400,[_,O]=b.useState(.5),A=3;b.useEffect(()=>{if(!t)return;const D=new FileReader;D.onload=I=>{var Z;const B=(Z=I.target)==null?void 0:Z.result;r(B);const G=new Image;G.onload=()=>{S.current=G;const ue=Math.max(E/G.width,E/G.height);O(Math.max(ue,.5)),u(1),f({x:0,y:0})},G.src=B},D.readAsDataURL(t)},[t]);const w=D=>{k.current&&(p(!0),k.current.getBoundingClientRect(),C({x:D.clientX-d.x,y:D.clientY-d.y}))},j=D=>{if(!m||!k.current)return;const I=D.clientX-v.x,B=D.clientY-v.y;f({x:I,y:B})},R=()=>{p(!1)},N=D=>{u(parseFloat(D.target.value))},L=()=>new Promise((D,I)=>{if(!S.current||!x.current||!k.current){I(new Error("Image or container not loaded"));return}const B=x.current,G=B.getContext("2d");if(!G){I(new Error("Could not get canvas context"));return}const Z=S.current;k.current.getBoundingClientRect(),B.width=E,B.height=E,G.clearRect(0,0,E,E),G.beginPath(),G.arc(E/2,E/2,E/2,0,Math.PI*2),G.clip();const ue=E,q=Z.width*l,ee=Z.height*l,re=(ue-q)/2+d.x,he=(ue-ee)/2+d.y,Se=0-re,P=0-he,K=Se/l,ae=P/l,le=ue/l,Te=ue/l,ce=Math.max(0,Math.min(K,Z.width-le)),_e=Math.max(0,Math.min(ae,Z.height-Te)),V=Math.min(le,Z.width-ce),ve=Math.min(Te,Z.height-_e);G.drawImage(Z,ce,_e,V,ve,0,0,E,E),B.toBlob(be=>{be?D(be):I(new Error("Failed to create blob"))},"image/png",.95)}),F=async()=>{try{const D=await L();n(D),e()}catch(D){console.error("Failed to crop image:",D),alert("Khng th ct nh. Vui lng th li.")}};return!t||!i?null:o.jsx("div",{className:"avatar-crop-modal-overlay",onClick:e,children:o.jsxs("div",{className:"avatar-crop-modal",onClick:D=>D.stopPropagation(),children:[o.jsxs("div",{className:"avatar-crop-modal-header",children:[o.jsx("h2",{children:"Chn nh i din"}),o.jsx("button",{className:"avatar-crop-modal-close",onClick:e,children:""})]}),o.jsx("div",{className:"avatar-crop-container-wrapper",children:o.jsxs("div",{ref:k,className:"avatar-crop-container",onMouseDown:w,onMouseMove:j,onMouseUp:R,onMouseLeave:R,style:{cursor:m?"grabbing":"grab"},children:[o.jsx("div",{className:"avatar-crop-image-wrapper",style:{transform:`translate(calc(-50% + ${d.x}px), calc(-50% + ${d.y}px)) scale(${l})`,transition:m?"none":"transform 0.1s ease-out"},children:o.jsx("img",{src:i,alt:"Preview",className:"avatar-crop-preview-image",style:{width:S.current?`${S.current.width}px`:"auto",height:S.current?`${S.current.height}px`:"auto",display:"block"}})}),o.jsx("div",{className:"avatar-crop-mask"})]})}),o.jsx("div",{className:"avatar-crop-controls",children:o.jsxs("div",{className:"avatar-crop-zoom-control",children:[o.jsx("span",{style:{fontSize:12,color:"#b0b3b8"},children:""}),o.jsx("input",{type:"range",min:_,max:A,step:.1,value:l,onChange:N,className:"avatar-crop-zoom-slider"}),o.jsx("span",{style:{fontSize:16,color:"#b0b3b8"},children:"+"})]})}),o.jsxs("div",{className:"avatar-crop-info",children:[o.jsx("span",{style:{fontSize:12,color:"#b0b3b8"},children:""}),o.jsx("span",{style:{fontSize:13,color:"#b0b3b8",marginLeft:6},children:"nh i din ca bn hin th cng khai."})]}),o.jsxs("div",{className:"avatar-crop-actions",children:[o.jsx("button",{className:"avatar-crop-btn-cancel",onClick:e,children:"Hy"}),o.jsx("button",{className:"avatar-crop-btn-save",onClick:F,children:"Lu"})]}),o.jsx("canvas",{ref:x,style:{display:"none"}})]})})},wA=({user:t,isSelf:e,isBlocked:n,hasBlockedYou:i,isFriend:r,friendRequestSent:l,isSendingRequest:u,isUploadingCover:d,isUploadingAvatar:f,avatarCropFile:m,coverInputRef:p,avatarInputRef:v,handleCoverUpload:C,handleAvatarFileSelect:x,handleAvatarCropSave:S,setAvatarCropFile:k,handleSendFriendRequest:E,handleBlock:_,handleUnblock:O,handleUnfriend:A,targetUserId:w,navigate:j,onNavigate:R})=>{var L,F;const N=b.useRef(null);return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"profile-cover-wrapper",style:{position:"relative",width:"100%",zIndex:1,marginBottom:0},children:[t.coverImage&&t.coverImage.trim()!==""?o.jsx("img",{src:t.coverImage,alt:"Cover",className:"profile-cover",style:{width:"100%",height:"350px",display:"block",objectFit:"cover"}}):o.jsx("div",{className:"profile-cover-gradient",style:{width:"100%",height:"350px",position:"relative"}}),e&&o.jsxs("div",{className:"profile-cover-edit-btn-wrapper",style:{position:"absolute",bottom:16,right:16,zIndex:1e4,pointerEvents:"auto",isolation:"isolate"},children:[o.jsx("input",{id:"cover-image-input",type:"file",accept:"image/*",ref:p,style:{display:"none"},onChange:C,disabled:d}),o.jsxs("label",{htmlFor:"cover-image-input",style:{display:"flex",alignItems:"center",gap:8,padding:"10px 16px",background:d?"rgba(200,200,200,0.9)":"rgba(255,255,255,0.9)",border:"none",borderRadius:8,color:"#050505",fontSize:14,fontWeight:600,cursor:d?"wait":"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",pointerEvents:d?"none":"auto"},children:[o.jsx("span",{children:""}),o.jsx("span",{children:d?"ang ti...":"Chnh sa nh ba"})]})]})]}),o.jsxs("div",{className:"profile-header",children:[o.jsxs("div",{className:"profile-avatar-wrapper",children:[o.jsxs("div",{className:"profile-avatar",style:{position:"relative"},children:[t.avatar?o.jsx("img",{src:t.avatar,alt:t.name}):o.jsx("span",{className:"profile-avatar-initials",children:((F=(L=t.name)==null?void 0:L.charAt(0))==null?void 0:F.toUpperCase())||"U"}),e&&o.jsxs(o.Fragment,{children:[o.jsx("input",{id:"avatar-image-input",type:"file",accept:"image/*",ref:v,style:{display:"none"},onChange:x,disabled:f}),o.jsx("label",{htmlFor:"avatar-image-input",style:{position:"absolute",bottom:8,right:8,width:36,height:36,borderRadius:"50%",background:f?"rgba(200,200,200,0.9)":"#3a3b3c",border:"2px solid #242526",display:"flex",alignItems:"center",justifyContent:"center",cursor:f?"wait":"pointer",fontSize:18,zIndex:1e3,pointerEvents:f?"none":"auto"},children:f?"":""})]})]}),o.jsx("div",{className:"profile-actions",children:e?o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"profile-action-btn profile-action-btn--primary",children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Thm vo tin"})]}),o.jsxs("button",{className:"profile-action-btn profile-action-btn--secondary",children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Chnh sa trang c nhn"})]})]}):o.jsx(o.Fragment,{children:i?o.jsx("div",{style:{padding:"8px 16px",background:"#3A3B3C",borderRadius:"8px",color:"#B0B3B8",fontSize:"14px"},children:"Ngi ny  chn bn"}):o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"profile-action-btn profile-action-btn--primary",onClick:E,disabled:u||l||r,style:{opacity:u||l||r?.6:1,cursor:u||l||r?"not-allowed":"pointer"},children:[o.jsx("span",{children:""}),o.jsx("span",{children:u?"ang gi...":l?" gi li mi":r?"Bn b":"Thm bn b"})]}),o.jsxs("button",{className:"profile-action-btn profile-action-btn--secondary",onClick:()=>R(`/chat/${w}`),children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Nhn tin"})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{className:"profile-action-btn profile-action-btn--secondary",onClick:D=>{D.stopPropagation();const I=document.getElementById(`profile-menu-${w}`);I&&(I.style.display=I.style.display==="block"?"none":"block")},children:o.jsx("span",{children:""})}),o.jsx("div",{id:`profile-menu-${w}`,ref:N,style:{display:"none",position:"absolute",top:"100%",right:0,marginTop:"8px",background:"#242526",border:"1px solid #3A3B3C",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,minWidth:"200px"},children:n?o.jsx("button",{onClick:O,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#E4E6EB",textAlign:"left",cursor:"pointer",fontSize:"14px"},onMouseEnter:D=>D.currentTarget.style.background="#3A3B3C",onMouseLeave:D=>D.currentTarget.style.background="transparent",children:"B chn"}):o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:_,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#E4E6EB",textAlign:"left",cursor:"pointer",fontSize:"14px"},onMouseEnter:D=>D.currentTarget.style.background="#3A3B3C",onMouseLeave:D=>D.currentTarget.style.background="transparent",children:"Chn"}),r&&o.jsx("button",{onClick:A,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#E4E6EB",textAlign:"left",cursor:"pointer",fontSize:"14px",borderTop:"1px solid #3A3B3C"},onMouseEnter:D=>D.currentTarget.style.background="#3A3B3C",onMouseLeave:D=>D.currentTarget.style.background="transparent",children:"Hy kt bn"})]})})]})]})})})]}),o.jsxs("div",{className:"profile-info",children:[o.jsxs("h1",{className:"profile-name",style:{display:"flex",alignItems:"center",gap:8},children:[t.name||"Ngi dng",t.isVerified&&o.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:"50%",background:"#1877f2",color:"white",fontSize:12,fontWeight:700,lineHeight:1},title:"Verified",children:""})]}),t.email&&o.jsx("p",{className:"profile-email",children:t.email})]})]}),m&&o.jsx(EA,{imageFile:m,onClose:()=>k(null),onSave:S})]})},jA=({user:t,isSelf:e,userPhotos:n,displayFriends:i,friends:r,setShowEditProfile:l})=>{const u=yn();return o.jsxs("div",{className:"profile-left-column",style:{width:"360px",flexShrink:0,position:"sticky",top:"80px",height:"fit-content"},children:[o.jsxs("div",{className:"profile-intro-card",children:[o.jsx("h3",{children:"Gii thiu"}),t.bio&&o.jsxs("div",{className:"profile-intro-item",children:['"',t.bio,'"']}),o.jsx("div",{className:"profile-intro-item",children:t.currentCity?`Sng ti ${t.currentCity}`:"Cha cp nht ni "}),o.jsx("div",{className:"profile-intro-item",children:t.hometown?`n t ${t.hometown}`:"Cha cp nht qu qun"}),o.jsx("div",{className:"profile-intro-item",children:t.relationshipStatus?t.relationshipStatus:"Cha cp nht tnh trng"}),t.works&&t.works.length>0&&o.jsxs("div",{className:"profile-intro-item",children:[" Lm vic ti:",o.jsx("ul",{style:{margin:"6px 0 0 14px",padding:0},children:t.works.map((d,f)=>o.jsx("li",{children:d},f))})]}),t.colleges&&t.colleges.length>0&&o.jsxs("div",{className:"profile-intro-item",children:[" i hc / Cao ng:",o.jsx("ul",{style:{margin:"6px 0 0 14px",padding:0},children:t.colleges.map((d,f)=>o.jsx("li",{children:d},f))})]}),t.highSchools&&t.highSchools.length>0&&o.jsxs("div",{className:"profile-intro-item",children:[" Trung hc:",o.jsx("ul",{style:{margin:"6px 0 0 14px",padding:0},children:t.highSchools.map((d,f)=>o.jsx("li",{children:d},f))})]}),t.phone&&o.jsxs("div",{className:"profile-intro-item",children:[" ",t.phone]}),t.instagram&&o.jsxs("div",{className:"profile-intro-item",children:[" Instagram: ",t.instagram]}),t.facebook&&o.jsxs("div",{className:"profile-intro-item",children:[" Facebook: ",t.facebook]}),t.website&&o.jsxs("div",{className:"profile-intro-item",children:[" Website: ",t.website]}),e&&o.jsx("button",{style:{width:"100%",padding:"8px",background:"#3A3B3C",color:"#E4E6EB",borderRadius:"6px",border:"none",fontWeight:600,marginTop:"16px",cursor:"pointer"},onClick:()=>l(!0),children:"Chnh sa chi tit"})]}),o.jsxs("div",{className:"profile-photos-card",children:[o.jsxs("div",{className:"profile-card-header",children:[o.jsx("h3",{children:"nh"}),n.length>0&&o.jsx("button",{className:"profile-card-link",children:"Xem tt c nh"})]}),n.length>0?o.jsx("div",{className:"profile-photos-grid",children:n.map((d,f)=>o.jsx("div",{className:"profile-photo-item",children:o.jsx("img",{src:d.url,alt:`Photo ${f+1}`,className:"profile-photo-img"})},`${d.postId}-${f}`))}):o.jsx("div",{className:"profile-widget-empty",children:e?"Bn cha c nh no":"Cha c nh"})]}),o.jsxs("div",{className:"profile-friends-card",children:[o.jsxs("div",{className:"profile-card-header",children:[o.jsxs("div",{children:[o.jsx("h3",{children:"Bn b"}),o.jsxs("p",{className:"profile-friends-count",children:[r.length," ngi bn"]})]}),i.length>0&&o.jsx("button",{className:"profile-card-link",onClick:()=>u("/friends"),children:"Xem tt c bn b"})]}),i.length>0?o.jsx("div",{className:"profile-friends-grid",children:i.map(d=>{var f,m;return o.jsxs("div",{className:"profile-friend-item",onClick:()=>u(`/profile/${d._id}`),style:{cursor:"pointer"},children:[o.jsx("div",{className:"profile-friend-avatar",children:d.avatar?o.jsx("img",{src:d.avatar,alt:d.name,className:"profile-friend-img"}):o.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",fontWeight:700,fontSize:"24px"},children:((m=(f=d.name)==null?void 0:f.charAt(0))==null?void 0:m.toUpperCase())||"U"})}),o.jsx("div",{className:"profile-friend-name",children:d.name||d.email||"User"})]},d._id)})}):o.jsx("div",{className:"profile-widget-empty",children:e?"Bn cha c bn b no":"Cha c bn b"})]})]})},RA=({user:t,isSelf:e,posts:n,isLoading:i,postReactions:r,handleSelectReaction:l,handleClearReaction:u})=>{var d,f;return o.jsxs(o.Fragment,{children:[e&&o.jsx("div",{className:"profile-create-post-card",children:o.jsxs("div",{className:"profile-create-post-header",children:[o.jsx("div",{className:"profile-create-post-avatar",children:t.avatar?o.jsx("img",{src:t.avatar,alt:t.name}):o.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",color:"white",fontWeight:700},children:((f=(d=t.name)==null?void 0:d.charAt(0))==null?void 0:f.toUpperCase())||"U"})}),o.jsx("div",{className:"profile-create-post-input",children:t.name?`Bn ang ngh g, ${t.name}?`:"Bn ang ngh g?"})]})}),o.jsxs("div",{className:"profile-posts-container",children:[n.map(m=>o.jsx(hd,{post:m,reaction:r[m._id]||null,onSelectReaction:l,onClearReaction:u},m._id)),i&&o.jsx("div",{style:{textAlign:"center",padding:"16px",color:"#B0B3B8"},children:"ang ti..."}),!i&&n.length===0&&o.jsx("div",{style:{textAlign:"center",padding:"32px",color:"#B0B3B8"},children:e?"Bn cha c bi vit no.":"Ngi dng ny cha c bi vit no."})]})]})},xn=({icon:t,label:e,subLabel:n,isSelf:i,onEdit:r})=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 0",borderBottom:"1px solid #3a3b3c"},children:[o.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:"#3a3b3c",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:t}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontSize:15,color:"#e4e6eb"},children:e}),n&&o.jsx("div",{style:{fontSize:13,color:"#b0b3b8"},children:n})]}),i&&r&&o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:r,style:{width:36,height:36,borderRadius:"50%",background:"#3a3b3c",border:"none",color:"#e4e6eb",cursor:"pointer",fontSize:16,display:"flex",alignItems:"center",justifyContent:"center"},title:"Chnh sa",children:""}),o.jsx("button",{style:{width:36,height:36,borderRadius:"50%",background:"#3a3b3c",border:"none",color:"#e4e6eb",cursor:"pointer",fontSize:16,display:"flex",alignItems:"center",justifyContent:"center"},title:"Thm ty chn",children:""})]})]}),Mn=({label:t,onClick:e})=>o.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:12,padding:"12px 0",background:"transparent",border:"none",cursor:"pointer",width:"100%",textAlign:"left"},children:[o.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:"#3a3b3c",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,color:"#2374e1"},children:""}),o.jsx("span",{style:{fontSize:15,color:"#2374e1"},children:t})]}),Li=({title:t,fields:e,onSave:n,onCancel:i})=>o.jsxs("div",{style:{background:"#242526",border:"1px solid #3a3b3c",borderRadius:8,padding:16,marginBottom:8},children:[o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"0 0 16px"},children:t}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:e.map(r=>o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[o.jsx("label",{style:{fontSize:12,color:"#b0b3b8"},children:r.label}),r.multiline?o.jsx("textarea",{value:r.value,onChange:l=>r.onChange(l.target.value),placeholder:r.placeholder,style:{background:"#3a3b3c",border:"1px solid #4e4f50",borderRadius:6,padding:"10px 12px",color:"#e4e6eb",fontSize:15,resize:"vertical",minHeight:80,outline:"none"}}):o.jsx("input",{type:"text",value:r.value,onChange:l=>r.onChange(l.target.value),placeholder:r.placeholder,style:{background:"#3a3b3c",border:"1px solid #4e4f50",borderRadius:6,padding:"10px 12px",color:"#e4e6eb",fontSize:15,outline:"none"}})]},r.key))}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[o.jsx("button",{onClick:i,style:{padding:"8px 16px",background:"#3a3b3c",border:"none",borderRadius:6,color:"#e4e6eb",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Hy"}),o.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#2374e1",border:"none",borderRadius:6,color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Lu"})]})]}),NA=({user:t,isSelf:e,inlineForm:n,setInlineForm:i,editingField:r,setEditingField:l,saveInlineField:u,cancelInlineEdit:d})=>{var p,v,C,x;const[f,m]=b.useState("overview");return o.jsxs("div",{className:"profile-about-fb",style:{display:"flex",gap:0,background:"#242526",borderRadius:8,overflow:"hidden"},children:[o.jsxs("div",{className:"profile-about-sidebar",style:{width:280,flexShrink:0,borderRight:"1px solid #3a3b3c",padding:"16px 0"},children:[o.jsx("h3",{style:{padding:"0 16px 12px",margin:0,fontSize:20,fontWeight:700},children:"Gii thiu"}),o.jsx("nav",{style:{display:"flex",flexDirection:"column",gap:2},children:[{key:"overview",label:"Tng quan"},{key:"work",label:"Cng vic v hc vn"},{key:"places",label:"Ni tng sng"},{key:"contact",label:"Thng tin lin h v c bn"},{key:"relationship",label:"Gia nh v cc mi quan h"},{key:"details",label:"Chi tit v bn"}].map(S=>o.jsx("button",{onClick:()=>m(S.key),style:{textAlign:"left",padding:"10px 16px",background:f===S.key?"#3a3b3c":"transparent",borderLeft:f===S.key?"3px solid #2374e1":"3px solid transparent",border:"none",color:f===S.key?"#2374e1":"#e4e6eb",fontSize:15,fontWeight:f===S.key?600:400,cursor:"pointer",transition:"all 0.15s"},onMouseEnter:k=>{f!==S.key&&(k.currentTarget.style.background="#3a3b3c")},onMouseLeave:k=>{f!==S.key&&(k.currentTarget.style.background="transparent")},children:S.label},S.key))})]}),o.jsxs("div",{className:"profile-about-content",style:{flex:1,padding:16},children:[f==="overview"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e&&!((p=t.works)!=null&&p.length)&&o.jsx(Mn,{label:"Thm ni lm vic",onClick:()=>{m("work"),l("work")}}),t.works&&t.works.length>0&&t.works.map((S,k)=>o.jsx(xn,{icon:"",label:S,isSelf:e,onEdit:()=>{m("work"),l("work")}},k)),t.colleges&&t.colleges.length>0?t.colleges.map((S,k)=>o.jsx(xn,{icon:"",label:`Hc ti ${S}`,subLabel:" bt u",isSelf:e,onEdit:()=>{m("work"),l("college")}},k)):e?o.jsx(Mn,{label:"Thm trng hc",onClick:()=>{m("work"),l("college")}}):null,t.currentCity?o.jsx(xn,{icon:"",label:`Sng ti ${t.currentCity}`,isSelf:e,onEdit:()=>{m("places"),i({...n,currentCity:t.currentCity}),l("currentCity")}}):e?o.jsx(Mn,{label:"Thm thnh ph hin ti",onClick:()=>{m("places"),l("currentCity")}}):null,t.hometown?o.jsx(xn,{icon:"",label:`n t ${t.hometown}`,isSelf:e,onEdit:()=>{m("places"),i({...n,hometown:t.hometown}),l("hometown")}}):e?o.jsx(Mn,{label:"Thm qu qun",onClick:()=>{m("places"),l("hometown")}}):null,t.relationshipStatus?o.jsx(xn,{icon:"",label:t.relationshipStatus,isSelf:e,onEdit:()=>{m("relationship"),i({...n,relationshipStatus:t.relationshipStatus}),l("relationship")}}):e?o.jsx(Mn,{label:"Thm tnh trng mi quan h",onClick:()=>{m("relationship"),l("relationship")}}):null,t.phone&&o.jsx(xn,{icon:"",label:t.phone,subLabel:"Di ng",isSelf:e,onEdit:()=>{m("contact"),i({...n,phone:t.phone}),l("phone")}})]}),f==="work"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"0 0 8px"},children:"Cng vic"}),t.works&&t.works.length>0&&t.works.map((S,k)=>o.jsx(xn,{icon:"",label:S,isSelf:e,onEdit:()=>l("work")},k)),e&&r==="work"?o.jsx(Li,{title:"Cng vic",fields:[{key:"work",label:"Cng ty",placeholder:"Tn cng ty",value:n.work,onChange:S=>i({...n,work:S})},{key:"workPosition",label:"Chc v",placeholder:"V tr cng vic",value:n.workPosition,onChange:S=>i({...n,workPosition:S})},{key:"workCity",label:"Thnh ph/Th x",placeholder:"Ni lm vic",value:n.workCity,onChange:S=>i({...n,workCity:S})},{key:"workDescription",label:"M t",placeholder:"M t cng vic",value:n.workDescription,onChange:S=>i({...n,workDescription:S}),multiline:!0}],onSave:()=>u("work"),onCancel:d}):e?o.jsx(Mn,{label:"Thm ni lm vic",onClick:()=>l("work")}):!((v=t.works)!=null&&v.length)&&o.jsx("div",{style:{color:"#b0b3b8",fontSize:14},children:"Cha c thng tin"}),o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"16px 0 8px"},children:"i hc"}),t.colleges&&t.colleges.length>0&&t.colleges.map((S,k)=>o.jsx(xn,{icon:"",label:S,isSelf:e,onEdit:()=>l("college")},k)),e&&r==="college"?o.jsx(Li,{title:"i hc",fields:[{key:"college",label:"Trng",placeholder:"Tn trng i hc / cao ng",value:n.college,onChange:S=>i({...n,college:S})},{key:"collegeYear",label:"Nm bt u",placeholder:"VD: 2020",value:n.collegeYear,onChange:S=>i({...n,collegeYear:S})}],onSave:()=>u("college"),onCancel:d}):e?o.jsx(Mn,{label:"Thm trng cao ng/i hc",onClick:()=>l("college")}):!((C=t.colleges)!=null&&C.length)&&o.jsx("div",{style:{color:"#b0b3b8",fontSize:14},children:"Cha c thng tin"}),o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"16px 0 8px"},children:"Trung hc"}),t.highSchools&&t.highSchools.length>0&&t.highSchools.map((S,k)=>o.jsx(xn,{icon:"",label:S,isSelf:e,onEdit:()=>l("highSchool")},k)),e&&r==="highSchool"?o.jsx(Li,{title:"Trung hc",fields:[{key:"highSchool",label:"Trng",placeholder:"Tn trng THPT",value:n.highSchool,onChange:S=>i({...n,highSchool:S})},{key:"highSchoolYear",label:"Nm bt u",placeholder:"VD: 2017",value:n.highSchoolYear,onChange:S=>i({...n,highSchoolYear:S})}],onSave:()=>u("highSchool"),onCancel:d}):e?o.jsx(Mn,{label:"Thm trng trung hc",onClick:()=>l("highSchool")}):!((x=t.highSchools)!=null&&x.length)&&o.jsx("div",{style:{color:"#b0b3b8",fontSize:14},children:"Cha c thng tin"})]}),f==="places"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"0 0 8px"},children:"Ni tng sng"}),t.currentCity&&o.jsx(xn,{icon:"",label:t.currentCity,subLabel:"Thnh ph hin ti",isSelf:e,onEdit:()=>{i({...n,currentCity:t.currentCity}),l("currentCity")}}),e&&r==="currentCity"?o.jsx(Li,{title:"Thnh ph hin ti",fields:[{key:"currentCity",label:"Thnh ph",placeholder:"VD:  Nng",value:n.currentCity,onChange:S=>i({...n,currentCity:S})}],onSave:()=>u("currentCity"),onCancel:d}):e&&!t.currentCity?o.jsx(Mn,{label:"Thm thnh ph hin ti",onClick:()=>l("currentCity")}):!t.currentCity&&o.jsx("div",{style:{color:"#b0b3b8",fontSize:14},children:"Cha c thng tin"}),t.hometown&&o.jsx(xn,{icon:"",label:t.hometown,subLabel:"Qu qun",isSelf:e,onEdit:()=>{i({...n,hometown:t.hometown}),l("hometown")}}),e&&r==="hometown"?o.jsx(Li,{title:"Qu qun",fields:[{key:"hometown",label:"Qu qun",placeholder:"VD: Qung Ninh, Vietnam",value:n.hometown,onChange:S=>i({...n,hometown:S})}],onSave:()=>u("hometown"),onCancel:d}):e&&!t.hometown?o.jsx(Mn,{label:"Thm qu qun",onClick:()=>l("hometown")}):null]}),f==="contact"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"0 0 8px"},children:"Thng tin lin h"}),t.phone&&o.jsx(xn,{icon:"",label:t.phone,subLabel:"Di ng",isSelf:e,onEdit:()=>{i({...n,phone:t.phone}),l("phone")}}),e&&r==="phone"?o.jsx(Li,{title:"S in thoi",fields:[{key:"phone",label:"S in thoi",placeholder:"VD: 0901234567",value:n.phone,onChange:S=>i({...n,phone:S})}],onSave:()=>u("phone"),onCancel:d}):e&&!t.phone?o.jsx(Mn,{label:"Thm s in thoi",onClick:()=>l("phone")}):!t.phone&&o.jsx("div",{style:{color:"#b0b3b8",fontSize:14},children:"Cha c thng tin"}),t.email&&o.jsx(xn,{icon:"",label:t.email,subLabel:"Email",isSelf:!1}),o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"16px 0 8px"},children:"Trang web v lin kt x hi"}),t.website&&o.jsx(xn,{icon:"",label:t.website,subLabel:"Website",isSelf:e,onEdit:()=>{i({...n,website:t.website}),l("website")}}),e&&r==="website"?o.jsx(Li,{title:"Website",fields:[{key:"website",label:"URL",placeholder:"https://yoursite.com",value:n.website,onChange:S=>i({...n,website:S})}],onSave:()=>u("website"),onCancel:d}):e&&!t.website?o.jsx(Mn,{label:"Thm website",onClick:()=>l("website")}):null,t.instagram&&o.jsx(xn,{icon:"",label:t.instagram,subLabel:"Instagram",isSelf:e,onEdit:()=>{i({...n,instagram:t.instagram}),l("instagram")}}),e&&r==="instagram"?o.jsx(Li,{title:"Instagram",fields:[{key:"instagram",label:"Username",placeholder:"@username",value:n.instagram,onChange:S=>i({...n,instagram:S})}],onSave:()=>u("instagram"),onCancel:d}):e&&!t.instagram?o.jsx(Mn,{label:"Thm Instagram",onClick:()=>l("instagram")}):null,t.facebook&&o.jsx(xn,{icon:"",label:t.facebook,subLabel:"Facebook",isSelf:e,onEdit:()=>{i({...n,facebook:t.facebook}),l("facebook")}}),e&&r==="facebook"?o.jsx(Li,{title:"Facebook",fields:[{key:"facebook",label:"Link Facebook",placeholder:"https://facebook.com/...",value:n.facebook,onChange:S=>i({...n,facebook:S})}],onSave:()=>u("facebook"),onCancel:d}):e&&!t.facebook?o.jsx(Mn,{label:"Thm Facebook",onClick:()=>l("facebook")}):null]}),f==="relationship"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"0 0 8px"},children:"Mi quan h"}),t.relationshipStatus&&o.jsx(xn,{icon:"",label:t.relationshipStatus,isSelf:e,onEdit:()=>{i({...n,relationshipStatus:t.relationshipStatus}),l("relationship")}}),e&&r==="relationship"?o.jsx(Li,{title:"Tnh trng mi quan h",fields:[{key:"relationshipStatus",label:"Tnh trng",placeholder:"c thn / Hn h /  kt hn...",value:n.relationshipStatus,onChange:S=>i({...n,relationshipStatus:S})}],onSave:()=>u("relationship"),onCancel:d}):e&&!t.relationshipStatus?o.jsx(Mn,{label:"Thm tnh trng mi quan h",onClick:()=>l("relationship")}):!t.relationshipStatus&&o.jsx("div",{style:{color:"#b0b3b8",fontSize:14},children:"Cha c thng tin"})]}),f==="details"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx("h4",{style:{fontSize:17,fontWeight:700,margin:"0 0 8px"},children:"Gii thiu bn thn"}),t.bio&&o.jsx(xn,{icon:"",label:t.bio,isSelf:e,onEdit:()=>{i({...n,bio:t.bio}),l("bio")}}),e&&r==="bio"?o.jsx(Li,{title:"Tiu s",fields:[{key:"bio",label:"Gii thiu v bn",placeholder:"M t ngn v bn thn...",value:n.bio,onChange:S=>i({...n,bio:S}),multiline:!0}],onSave:()=>u("bio"),onCancel:d}):e&&!t.bio?o.jsx(Mn,{label:"Thm tiu s",onClick:()=>l("bio")}):!t.bio&&o.jsx("div",{style:{color:"#b0b3b8",fontSize:14},children:"Cha c thng tin"})]})]})]})},_A=({user:t,isSelf:e,photosAuthored:n,photosTagged:i,activePhotoTab:r,setActivePhotoTab:l})=>o.jsxs("div",{className:"profile-photos-tab",children:[o.jsxs("div",{style:{marginBottom:"12px",display:"flex",gap:12,alignItems:"center"},children:[o.jsx("span",{style:{fontWeight:700},children:"nh"}),o.jsxs("div",{style:{display:"flex",gap:8,background:"#242526",padding:"4px",borderRadius:999},children:[o.jsxs("button",{className:`profile-tab-mini ${r==="authored"?"profile-tab-mini--active":""}`,onClick:()=>l("authored"),children:["nh ca ",e?"bn":"h"]}),o.jsxs("button",{className:`profile-tab-mini ${r==="tagged"?"profile-tab-mini--active":""}`,onClick:()=>l("tagged"),children:["nh c mt ",e?"bn":"h"]})]})]}),r==="authored"&&o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontWeight:600,marginBottom:8},children:["nh ca ",e?"bn":t.name||"ngi ny"]}),n.length>0?o.jsx("div",{className:"profile-photos-grid",children:n.map(u=>o.jsx("div",{className:"profile-photo-item",children:o.jsx("img",{src:u.url,alt:"photo",className:"profile-photo-img"})},`${u.postId}-${u.url}`))}):o.jsx("div",{className:"profile-widget-empty",children:"Cha c nh"})]}),r==="tagged"&&o.jsxs("div",{children:[o.jsxs("div",{style:{fontWeight:600,marginBottom:8},children:["nh c mt ",e?"bn":t.name||"ngi ny"]}),i.length>0?o.jsx("div",{className:"profile-photos-grid",children:i.map(u=>o.jsx("div",{className:"profile-photo-item",children:o.jsx("img",{src:u.url,alt:"photo",className:"profile-photo-img"})},`${u.postId}-${u.url}`))}):o.jsx("div",{className:"profile-widget-empty",children:"Cha c nh c tag"})]})]}),AA=({user:t,isSelf:e,friends:n,activeFriendsTab:i,setActiveFriendsTab:r,friendsSearchQuery:l,setFriendsSearchQuery:u})=>{const d=yn();let f=n;if(l.trim()){const m=l.toLowerCase();f=n.filter(p=>{var v,C,x;return((v=p.name)==null?void 0:v.toLowerCase().includes(m))||((C=p.email)==null?void 0:C.toLowerCase().includes(m))||((x=p.username)==null?void 0:x.toLowerCase().includes(m))})}return i==="recent"?f=[...f].reverse():(i==="college"&&t.colleges&&t.colleges.length>0||i==="city"&&t.currentCity||i==="hometown"&&t.hometown)&&(f=f),o.jsxs("div",{className:"profile-friends-tab",children:[o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("h2",{style:{fontSize:24,fontWeight:700,marginBottom:"16px"},children:"Bn b"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:"16px",flexWrap:"wrap"},children:[o.jsx("div",{style:{display:"flex",gap:4,background:"#242526",padding:"4px",borderRadius:999,flexWrap:"wrap"},children:[{key:"all",label:"Tt c bn b"},{key:"recent",label:" thm gn y"},{key:"birthdays",label:"Sinh nht"},{key:"college",label:"i hc"},{key:"city",label:"Tnh/Thnh ph hin ti"},{key:"hometown",label:"Qu qun"},{key:"following",label:"ang theo di"}].map(m=>o.jsx("button",{className:`profile-tab-mini ${i===m.key?"profile-tab-mini--active":""}`,onClick:()=>r(m.key),children:m.label},m.key))}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginLeft:"auto"},children:[o.jsx("input",{type:"text",placeholder:"Tm kim",value:l,onChange:m=>u(m.target.value),style:{padding:"8px 12px",background:"#3a3b3c",border:"none",borderRadius:20,color:"#e4e6eb",fontSize:14,width:200}}),e&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"profile-action-btn profile-action-btn--secondary",style:{fontSize:14,padding:"8px 16px"},onClick:()=>d("/friends/requests"),children:"Li mi kt bn"}),o.jsx("button",{className:"profile-action-btn profile-action-btn--secondary",style:{fontSize:14,padding:"8px 16px"},onClick:()=>d("/friends/find"),children:"Tm bn b"})]})]})]})]}),f.length>0?o.jsx("div",{className:"profile-friends-list",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:16},children:f.map(m=>{var p,v;return o.jsxs("div",{className:"profile-friend-card",onClick:()=>d(`/profile/${m._id}`),style:{cursor:"pointer",background:"#242526",borderRadius:8,overflow:"hidden",transition:"transform 0.2s, box-shadow 0.2s"},onMouseEnter:C=>{C.currentTarget.style.transform="translateY(-2px)",C.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"},onMouseLeave:C=>{C.currentTarget.style.transform="translateY(0)",C.currentTarget.style.boxShadow="none"},children:[o.jsx("div",{className:"profile-friend-avatar",style:{width:"100%",aspectRatio:"1",overflow:"hidden"},children:m.avatar?o.jsx("img",{src:m.avatar,alt:m.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):o.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",fontWeight:700,fontSize:"48px"},children:((v=(p=m.name)==null?void 0:p.charAt(0))==null?void 0:v.toUpperCase())||"U"})}),o.jsx("div",{style:{padding:"12px"},children:o.jsx("div",{className:"profile-friend-name",style:{fontWeight:600,fontSize:15,marginBottom:4},children:m.name||m.email||"User"})})]},m._id)})}):o.jsx("div",{className:"profile-widget-empty",style:{padding:"40px",textAlign:"center"},children:l.trim()?"Khng tm thy bn b no":e?"Bn cha c bn b no":"Cha c bn b"})]})},MA=({user:t,isSelf:e,reels:n,reelsLoading:i,reelsHasNext:r,reelsNextCursor:l,loadReels:u})=>{const d=yn();return o.jsxs("div",{className:"profile-reels-tab",children:[o.jsx("h2",{style:{fontSize:24,fontWeight:700,marginBottom:"16px",padding:"0 16px"},children:"Reels"}),i&&n.length===0?o.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#B0B3B8"},children:"ang ti..."}):n.length>0?o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px",padding:"0 16px"},children:n.map(f=>o.jsxs("div",{onClick:()=>d(`/reels?reel=${f._id}`),style:{cursor:"pointer",borderRadius:"8px",overflow:"hidden",background:"#242526",position:"relative",aspectRatio:"9/16"},children:[f.thumbnailUrl?o.jsx("img",{src:f.thumbnailUrl,alt:f.caption||"Reel",style:{width:"100%",height:"100%",objectFit:"cover"}}):o.jsx("video",{src:f.videoUrl,style:{width:"100%",height:"100%",objectFit:"cover"},muted:!0,playsInline:!0}),o.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(to top, rgba(0,0,0,0.7), transparent)",padding:"12px",color:"white",fontSize:"13px",fontWeight:600},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[o.jsx("span",{children:""}),o.jsxs("span",{children:[f.viewCount||0," lt xem"]})]}),f.caption&&o.jsx("div",{style:{fontSize:"12px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:f.caption})]})]},f._id))}):o.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#B0B3B8"},children:e?"Bn cha c reel no.":"Ngi dng ny cha c reel no."}),r&&o.jsx("div",{style:{textAlign:"center",padding:"16px"},children:o.jsx("button",{onClick:()=>u(l||void 0),disabled:i,style:{padding:"8px 16px",background:"#1877F2",color:"white",border:"none",borderRadius:"6px",cursor:i?"not-allowed":"pointer",opacity:i?.6:1},children:i?"ang ti...":"Ti thm"})})]})},OA=({show:t,onClose:e,profileForm:n,setProfileForm:i,onSave:r})=>t?o.jsx("div",{className:"modal-backdrop",children:o.jsxs("div",{className:"modal-panel",style:{maxWidth:720},children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("div",{className:"modal-title",children:"Chnh sa chi tit"}),o.jsx("button",{className:"modal-close",onClick:e,children:""})]}),o.jsxs("div",{className:"modal-body",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Tiu s"}),o.jsx("textarea",{value:n.bio,onChange:l=>i({...n,bio:l.target.value}),placeholder:"Gii thiu ngn"})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Ni lm vic (mi dng mt mc)"}),o.jsx("textarea",{value:n.works,onChange:l=>i({...n,works:l.target.value}),placeholder:"Cng ty A\\nCng ty B"})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"i hc / Cao ng (mi dng mt mc)"}),o.jsx("textarea",{value:n.colleges,onChange:l=>i({...n,colleges:l.target.value}),placeholder:"Trng i hc ..."})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Trung hc (mi dng mt mc)"}),o.jsx("textarea",{value:n.highSchools,onChange:l=>i({...n,highSchools:l.target.value}),placeholder:"Trng THPT ..."})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Ni  hin ti"}),o.jsx("input",{value:n.currentCity,onChange:l=>i({...n,currentCity:l.target.value}),placeholder:" Nng"})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Qu qun"}),o.jsx("input",{value:n.hometown,onChange:l=>i({...n,hometown:l.target.value}),placeholder:"Qu qun"})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Tnh trng mi quan h"}),o.jsx("input",{value:n.relationshipStatus,onChange:l=>i({...n,relationshipStatus:l.target.value}),placeholder:"c thn / Hn h / ..."})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"in thoi"}),o.jsx("input",{value:n.phone,onChange:l=>i({...n,phone:l.target.value}),placeholder:"S in thoi"})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Instagram"}),o.jsx("input",{value:n.instagram,onChange:l=>i({...n,instagram:l.target.value}),placeholder:"@username"})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Facebook"}),o.jsx("input",{value:n.facebook,onChange:l=>i({...n,facebook:l.target.value}),placeholder:"Link Facebook"})]}),o.jsxs("div",{className:"modal-field",children:[o.jsx("label",{children:"Website"}),o.jsx("input",{value:n.website,onChange:l=>i({...n,website:l.target.value}),placeholder:"https://..."})]})]}),o.jsxs("div",{className:"modal-actions",children:[o.jsx("button",{className:"modal-btn",onClick:e,children:"Hy"}),o.jsx("button",{className:"modal-btn modal-btn--primary",onClick:r,children:"Lu"})]})]})}):null,y2=()=>{const t=yn(),{userId:e}=wl(),[n,i]=b.useState(null);b.useEffect(()=>{typeof window<"u"&&i(localStorage.getItem("user_id"))},[]);const r=e===n||!e,l=e||n||"",[u,d]=b.useState(null),[f,m]=b.useState([]),[p,v]=b.useState([]),[C,x]=b.useState({}),[S,k]=b.useState(!1),[E,_]=b.useState(!0),[O,A]=b.useState(null),[w,j]=b.useState(!1),[R,N]=b.useState(!1),[L,F]=b.useState(!1),[D,I]=b.useState(!1),[B,G]=b.useState(!1),[Z,ue]=b.useState("posts"),[q,ee]=b.useState("authored"),[re,he]=b.useState("all"),[Se,P]=b.useState(""),[K,ae]=b.useState([]),[le,Te]=b.useState([]),[ce,_e]=b.useState([]),[V,ve]=b.useState(!1),[be,Ue]=b.useState(null),[et,At]=b.useState(!0),[mt,Dt]=b.useState(!1),[Q,Ee]=b.useState({bio:"",works:"",colleges:"",highSchools:"",currentCity:"",hometown:"",relationshipStatus:"",phone:"",instagram:"",facebook:"",website:""}),[se,fe]=b.useState(null),[Ae,He]=b.useState({work:"",workPosition:"",workCity:"",workDescription:"",workCurrent:!0,college:"",collegeYear:"",highSchool:"",highSchoolYear:"",currentCity:"",hometown:"",relationshipStatus:"",phone:"",bio:"",instagram:"",facebook:"",website:""}),Me=b.useRef(null),Be=b.useRef(null),Je=b.useRef(null),[xe,Ne]=b.useState(!1),[Ke,ft]=b.useState(!1),[zt,dn]=b.useState(null);b.useEffect(()=>{l&&(Ve(),pt(),Lt(),r||hn(),Z==="photos"&&qt(),Z==="friends"&&p.length===0&&Lt())},[l,r,Z]),b.useEffect(()=>{const ke=we=>{const Le=document.getElementById(`profile-menu-${l}`);Le&&!Le.contains(we.target)&&(Le.style.display="none")};return document.addEventListener("mousedown",ke),()=>document.removeEventListener("mousedown",ke)},[l]);const hn=async()=>{try{const ke=await m8(l);j(ke.isBlocked),N(ke.hasBlockedYou)}catch(ke){console.error("Failed to load block status:",ke)}},Os=async()=>{var ke,we;try{await h8(l),j(!0),alert(" chn ngi dng ny")}catch(Le){console.error("Failed to block user:",Le),alert(((we=(ke=Le.response)==null?void 0:ke.data)==null?void 0:we.error)||"Khng th chn ngi dng")}},fi=async()=>{var ke,we;try{await f8(l),j(!1),alert(" b chn ngi dng ny")}catch(Le){console.error("Failed to unblock user:",Le),alert(((we=(ke=Le.response)==null?void 0:ke.data)==null?void 0:we.error)||"Khng th b chn ngi dng")}},nn=async()=>{var ke,we;if(confirm("Bn c chc mun hy kt bn vi ngi ny?"))try{await p8(l),F(!1),alert(" hy kt bn")}catch(Le){console.error("Failed to unfriend user:",Le),alert(((we=(ke=Le.response)==null?void 0:ke.data)==null?void 0:we.error)||"Khng th hy kt bn")}},Ln=async()=>{var ke,we;if(!(B||D||L))try{G(!0),await f9(l),I(!0),alert(" gi li mi kt bn!")}catch(Le){console.error("Failed to send friend request:",Le),alert(((we=(ke=Le.response)==null?void 0:ke.data)==null?void 0:we.error)||Le.message||"Khng th gi li mi kt bn")}finally{G(!1)}},qt=async()=>{var ke,we;try{const[Le,yt]=await Promise.allSettled([sb(l,"authored"),sb(l,"tagged")]),Wt=Tn=>Tn.flatMap(Zt=>(Zt.media||[]).map(kd=>({postId:Zt.postId,url:kd.url}))),mi=Le.status==="fulfilled"&&((ke=Le.value)!=null&&ke.items)?Le.value.items:[],mn=yt.status==="fulfilled"&&((we=yt.value)!=null&&we.items)?yt.value.items:[];let Ft=Wt(mi),sn=Wt(mn);Ft.length===0&&f.length>0&&(Ft=f.flatMap(Tn=>(Tn.media||[]).filter(Zt=>Zt&&Zt.url).map(Zt=>({postId:Tn._id,url:Zt.url})))),sn.length===0&&f.length>0&&(sn=f.filter(Tn=>Array.isArray(Tn.taggedUsers)&&Tn.taggedUsers.some(Zt=>String((Zt==null?void 0:Zt._id)||Zt)===l)).flatMap(Tn=>(Tn.media||[]).filter(Zt=>Zt&&Zt.url).map(Zt=>({postId:Tn._id,url:Zt.url})))),ae(Ft),Te(sn)}catch(Le){console.error("Failed to load photos:",Le),ae([]),Te([])}},Ve=async()=>{try{const ke=await so(l);d(ke),Ee({bio:ke.bio||"",works:(ke.works||[]).join(`
`),colleges:(ke.colleges||[]).join(`
`),highSchools:(ke.highSchools||[]).join(`
`),currentCity:ke.currentCity||"",hometown:ke.hometown||"",relationshipStatus:ke.relationshipStatus||"",phone:ke.phone||"",instagram:ke.instagram||"",facebook:ke.facebook||"",website:ke.website||""})}catch(ke){console.error("Failed to load user:",ke)}},pt=async ke=>{try{_(!0);const we=await c9(l,ke);m(ke?Le=>[...Le,...we.items]:we.items),k(we.hasNext),A(we.nextCursor??null)}catch(we){console.error("Failed to load posts:",we)}finally{_(!1)}},Tt=async(ke,we)=>{try{await Up(ke,we),x(Le=>({...Le,[ke]:we})),m(Le=>Le.map(yt=>{if(yt._id===ke){const Wt=C[ke],mi=we,mn={...yt.reactionCounts||{}};return Wt&&(mn[Wt]=Math.max(0,(mn[Wt]||0)-1)),mn[mi]=(mn[mi]||0)+1,{...yt,reactionCounts:mn,likeCount:Object.values(mn).reduce((Ft,sn)=>Ft+sn,0)}}return yt}))}catch(Le){console.error("Failed to react to post:",Le)}},Bt=async ke=>{try{await Bp(ke);const we=C[ke];x(Le=>{const yt={...Le};return delete yt[ke],yt}),m(Le=>Le.map(yt=>{if(yt._id===ke&&we){const Wt={...yt.reactionCounts||{}};return Wt[we]=Math.max(0,(Wt[we]||0)-1),{...yt,reactionCounts:Wt,likeCount:Object.values(Wt).reduce((mi,mn)=>mi+mn,0)}}return yt}))}catch(we){console.error("Failed to remove reaction:",we)}};b.useEffect(()=>{Z==="photos"&&f.length>0&&K.length===0&&le.length===0&&qt(),Z==="reels"&&ce.length===0&&!V&&ii()},[f,Z]);const ii=async ke=>{if(!V){ve(!0);try{const we=await _8(l,ke);_e(ke?Le=>[...Le,...we.items]:we.items),Ue(we.nextCursor),At(we.hasNext)}catch(we){console.error("Failed to load reels:",we),_e([])}finally{ve(!1)}}},Lt=async()=>{try{if(!r){const we=await qm();Array.isArray(we.friendIds)&&we.friendIds.includes(l)&&F(!0);return}const ke=await qm();if(Array.isArray(ke.friendIds)&&ke.friendIds.length>0){const we=await u9(ke.friendIds);v(we.users||[])}else v([])}catch(ke){console.error("Failed to load friends:",ke)}},Fe=async ke=>{try{let we={};switch(ke){case"work":if(Ae.work.trim()){const Le=Ae.work+(Ae.workPosition?` - ${Ae.workPosition}`:"");we.works=[...u.works||[],Le]}break;case"college":Ae.college.trim()&&(we.colleges=[...u.colleges||[],Ae.college]);break;case"highSchool":Ae.highSchool.trim()&&(we.highSchools=[...u.highSchools||[],Ae.highSchool]);break;case"currentCity":we.currentCity=Ae.currentCity;break;case"hometown":we.hometown=Ae.hometown;break;case"relationship":we.relationshipStatus=Ae.relationshipStatus;break;case"phone":we.phone=Ae.phone;break;case"bio":we.bio=Ae.bio;break;case"instagram":we.instagram=Ae.instagram;break;case"facebook":we.facebook=Ae.facebook;break;case"website":we.website=Ae.website;break}await nu(we),await Ve(),fe(null),He({work:"",workPosition:"",workCity:"",workDescription:"",workCurrent:!0,college:"",collegeYear:"",highSchool:"",highSchoolYear:"",currentCity:"",hometown:"",relationshipStatus:"",phone:"",bio:"",instagram:"",facebook:"",website:""})}catch(we){console.error("Failed to save field:",we),alert("Lu tht bi")}},rt=()=>{fe(null),He({work:"",workPosition:"",workCity:"",workDescription:"",workCurrent:!0,college:"",collegeYear:"",highSchool:"",highSchoolYear:"",currentCity:"",hometown:"",relationshipStatus:"",phone:"",bio:"",instagram:"",facebook:"",website:""})},fn=async ke=>{var Le;const we=(Le=ke.target.files)==null?void 0:Le[0];if(we){Ne(!0);try{const yt=await ib(we);if(yt.url){const Wt=await nu({coverImage:yt.url});Wt&&d(mi=>mi?{...mi,coverImage:Wt.coverImage||yt.url}:{...Wt,coverImage:yt.url}),await Ve()}}catch(yt){console.error("Failed to upload cover:",yt),alert("Khng th ti nh ba. Vui lng th li.")}finally{Ne(!1),Be.current&&(Be.current.value="")}}},qn=ke=>{var Le;const we=(Le=ke.target.files)==null?void 0:Le[0];if(!we||!we.type.startsWith("image/")){alert("Vui lng chn file nh");return}dn(we),Je.current&&(Je.current.value="")},Il=async ke=>{ft(!0);try{const we=new File([ke],"avatar.png",{type:"image/png"}),Le=await ib(we);if(Le.url){const yt=await nu({avatar:Le.url});yt&&d(Wt=>Wt?{...Wt,avatar:yt.avatar||Le.url}:{...yt,avatar:Le.url}),await Ve()}}catch(we){console.error("Failed to upload avatar:",we),alert("Khng th ti nh i din. Vui lng th li.")}finally{ft(!1),dn(null)}},ao=b.useMemo(()=>{const ke=[];return f.forEach(we=>{we.media&&Array.isArray(we.media)&&we.media.forEach(Le=>{(Le.type==="image"||Le.url)&&ke.push({url:Le.url,postId:we._id})})}),ke.slice(0,9)},[f]),va=b.useMemo(()=>p.slice(0,9),[p]);b.useEffect(()=>{const ke=()=>{if(!S||E)return;const we=window.innerHeight+window.scrollY,Le=document.documentElement.scrollHeight-200;we>=Le&&O&&pt(O)};return window.addEventListener("scroll",ke),()=>window.removeEventListener("scroll",ke)},[S,E,O]);const Sd=async()=>{try{await nu({bio:Q.bio,works:Q.works.split(`
`).map(ke=>ke.trim()).filter(Boolean),colleges:Q.colleges.split(`
`).map(ke=>ke.trim()).filter(Boolean),highSchools:Q.highSchools.split(`
`).map(ke=>ke.trim()).filter(Boolean),currentCity:Q.currentCity,hometown:Q.hometown,relationshipStatus:Q.relationshipStatus,phone:Q.phone,instagram:Q.instagram,facebook:Q.facebook,website:Q.website}),await Ve(),Dt(!1)}catch(ke){console.error("Failed to update profile details:",ke),alert("Cp nht tht bi")}};if(!u)return o.jsx("div",{className:"feed-root",children:o.jsx("div",{style:{padding:40,textAlign:"center"},children:"ang ti..."})});const Ul=o.jsx(Wa,{currentUser:u?{_id:u._id,name:u.name,avatar:u.avatar}:null,onLogout:()=>{typeof window<"u"&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),t("/login"))}});return o.jsxs(o.Fragment,{children:[o.jsx(Kr,{header:Ul,hideSidebars:!0,children:o.jsxs("div",{className:"profile-container",children:[o.jsx(wA,{user:u,isSelf:r,isBlocked:w,hasBlockedYou:R,isFriend:L,friendRequestSent:D,isSendingRequest:B,isUploadingCover:xe,isUploadingAvatar:Ke,avatarCropFile:zt,coverInputRef:Be,avatarInputRef:Je,handleCoverUpload:fn,handleAvatarFileSelect:qn,handleAvatarCropSave:Il,setAvatarCropFile:dn,handleSendFriendRequest:Ln,handleBlock:Os,handleUnblock:fi,handleUnfriend:nn,targetUserId:l,navigate:t,onNavigate:t}),o.jsx("div",{className:"profile-tabs-wrapper",children:o.jsxs("div",{className:"profile-tabs",children:[o.jsx("button",{className:`profile-tab ${Z==="posts"?"profile-tab--active":""}`,onClick:()=>ue("posts"),children:"Bi vit"}),o.jsx("button",{className:`profile-tab ${Z==="about"?"profile-tab--active":""}`,onClick:()=>ue("about"),children:"Gii thiu"}),o.jsx("button",{className:`profile-tab ${Z==="friends"?"profile-tab--active":""}`,onClick:()=>ue("friends"),children:"Bn b"}),o.jsx("button",{className:`profile-tab ${Z==="photos"?"profile-tab--active":""}`,onClick:()=>ue("photos"),children:"nh / Albums"}),o.jsx("button",{className:`profile-tab ${Z==="reels"?"profile-tab--active":""}`,onClick:()=>ue("reels"),children:"Reels"})]})}),o.jsxs("div",{className:"profile-content",style:{display:"flex",flexDirection:"row",alignItems:"flex-start",gap:"16px"},children:[o.jsx(jA,{user:u,isSelf:r,userPhotos:ao,displayFriends:va,friends:p,setShowEditProfile:Dt}),o.jsxs("div",{className:"profile-right-column",style:{flex:1,minWidth:0},ref:Me,children:[Z==="posts"&&o.jsx(RA,{user:u,isSelf:r,posts:f,isLoading:E,postReactions:C,handleSelectReaction:Tt,handleClearReaction:Bt}),Z==="about"&&o.jsx(NA,{user:u,isSelf:r,inlineForm:Ae,setInlineForm:He,editingField:se,setEditingField:fe,saveInlineField:Fe,cancelInlineEdit:rt}),Z==="photos"&&o.jsx(_A,{user:u,isSelf:r,photosAuthored:K,photosTagged:le,activePhotoTab:q,setActivePhotoTab:ee}),Z==="friends"&&o.jsx(AA,{user:u,isSelf:r,friends:p,activeFriendsTab:re,setActiveFriendsTab:he,friendsSearchQuery:Se,setFriendsSearchQuery:P}),Z==="reels"&&o.jsx(MA,{user:u,isSelf:r,reels:ce,reelsLoading:V,reelsHasNext:et,reelsNextCursor:be,loadReels:ii})]})]})]})}),o.jsx(OA,{show:mt,onClose:()=>Dt(!1),profileForm:Q,setProfileForm:Ee,onSave:Sd})]})},Cm=["Spam hoc qung co","Ni dung phn cm","Tin gi/misleading","Quy ri hoc th ch","Vi phm bn quyn","Khc"],DA=({isOpen:t,post:e,onClose:n,onSubmit:i,isSubmitting:r})=>{var C;const[l,u]=b.useState(Cm[0]),[d,f]=b.useState(""),[m,p]=b.useState(null);if(b.useEffect(()=>{t||(u(Cm[0]),f(""),p(null))},[t]),!t||!e)return null;const v=async x=>{if(x.preventDefault(),!l||l.trim().length<3){p("Vui lng chn l do");return}try{await i({reason:l,details:d.trim()?d.trim():void 0})}catch(S){p((S==null?void 0:S.message)||"Khng th gi bo co lc ny")}};return o.jsx("div",{className:"report-modal-overlay",children:o.jsxs("div",{className:"report-modal-card",children:[o.jsxs("div",{className:"report-modal-header",children:[o.jsxs("div",{children:[o.jsx("h3",{children:"Bo co bi vit"}),o.jsxs("p",{children:["Bi vit ca ",((C=e.author)==null?void 0:C.name)||"ngi dng"]})]}),o.jsx("button",{className:"report-modal-close",onClick:n,children:""})]}),o.jsxs("form",{onSubmit:v,children:[o.jsxs("div",{className:"report-modal-section",children:[o.jsx("label",{className:"report-modal-label",children:"L do"}),o.jsx("div",{className:"report-modal-reasons",children:Cm.map(x=>o.jsxs("label",{className:"report-reason-option",children:[o.jsx("input",{type:"radio",name:"report-reason",value:x,checked:l===x,onChange:()=>u(x),disabled:r}),o.jsx("span",{children:x})]},x))})]}),o.jsxs("div",{className:"report-modal-section",children:[o.jsxs("label",{className:"report-modal-label",children:["M t thm ",o.jsx("span",{style:{opacity:.6},children:"(tu chn)"})]}),o.jsx("textarea",{className:"report-modal-textarea",placeholder:"Nhp m t chi tit nu cn...",value:d,onChange:x=>f(x.target.value),disabled:r,rows:4})]}),m&&o.jsx("div",{className:"report-modal-error",children:m}),o.jsxs("div",{className:"report-modal-actions",children:[o.jsx("button",{type:"button",className:"report-modal-secondary",onClick:n,disabled:r,children:"Hu"}),o.jsx("button",{type:"submit",className:"report-modal-primary",disabled:r,children:r?"ang gi...":"Gi bo co"})]})]})]})})},LA=()=>{const t=yn(),{items:e,hasNext:n,isLoading:i,loadMore:r,unsave:l,reactionMap:u,selectReaction:d,clearReaction:f}=A6(),[m,p]=b.useState(null),v=b.useRef(null),[C,x]=b.useState(null),[S,k]=b.useState(!1);b.useEffect(()=>{(async()=>{try{const w=await Pl();if(w){const j=await so(w),R={_id:j._id,name:j.name||j.email||"User",avatar:j.avatar};p(R),window.__currentUserId=R._id}}catch(w){console.error("Failed to load current user:",w)}})()},[]),b.useEffect(()=>{const A=v.current;if(!A)return;const w=()=>{!n||i||A.scrollTop+A.clientHeight>=A.scrollHeight-200&&r()};return A.addEventListener("scroll",w),()=>A.removeEventListener("scroll",w)},[n,i,r]);const E=async A=>{var w,j;try{await l(A)}catch(R){window.alert(((j=(w=R==null?void 0:R.response)==null?void 0:w.data)==null?void 0:j.error)||"Khng th b lu bi vit.")}},_=async A=>{var w,j;if(C){k(!0);try{await h9(C._id,A),window.alert(" gi bo co."),x(null)}catch(R){window.alert(((j=(w=R==null?void 0:R.response)==null?void 0:w.data)==null?void 0:j.error)||"Khng th gi bo co.")}finally{k(!1)}}},O=o.jsx(Wa,{currentUser:m,onLogout:()=>{typeof window<"u"&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),t("/login"))}});return o.jsxs(o.Fragment,{children:[o.jsx(Kr,{header:O,hideSidebars:!0,children:o.jsxs("div",{className:"feed-root",children:[o.jsxs("section",{className:"saved-header",style:{padding:"20px",borderBottom:"1px solid #3a3b3c"},children:[o.jsx("h2",{style:{fontSize:24,fontWeight:700,marginBottom:8},children:"Bi vit  lu"}),o.jsx("p",{style:{color:"#b0b3b8"},children:"Nhng bi vit bn  lu s xut hin ti y."})]}),o.jsxs("section",{ref:v,style:{padding:"20px",flex:1,minHeight:0},children:[e.map(A=>{const w=A.post;return o.jsx(hd,{post:w,reaction:u[w._id]||null,onSelectReaction:(j,R)=>d(j,R),onClearReaction:j=>f(j),onUnsavePost:E,onReportPost:j=>x(j),isSaved:!0},w._id)}),i&&o.jsx("div",{style:{padding:16,textAlign:"center"},children:"ang ti..."}),!i&&e.length===0&&o.jsx("div",{style:{padding:16,textAlign:"center",opacity:.7},children:"Bn cha lu bi vit no."})]})]})}),o.jsx(DA,{isOpen:!!C,post:C,onClose:()=>x(null),onSubmit:_,isSubmitting:S})]})},PA=[{type:"LIKE",emoji:"",label:"Thch"},{type:"LOVE",emoji:"",label:"Yu thch"},{type:"HAHA",emoji:"",label:"Haha"},{type:"WOW",emoji:"",label:"Wow"},{type:"SAD",emoji:"",label:"Bun"},{type:"ANGRY",emoji:"",label:"Phn n"}],IA=({reel:t,isActive:e=!1,onLike:n,onComment:i,onShare:r})=>{var ee,re;const l=_i(),u=b.useRef(null),[d,f]=b.useState(!1),[m,p]=b.useState(!1),[v,C]=b.useState(null),[x,S]=b.useState(!1),[k,E]=b.useState(!1),{items:_,loadMore:O,createComment:A,isLoading:w,hasNext:j}=k9(t._id),[R,N]=b.useState(""),[L,F]=b.useState(!1),D=b.useRef(null),I=b.useRef(null),B=t.author||{name:`User ${t.authorId}`,_id:t.authorId};b.useEffect(()=>{e&&u.current?(u.current.play().catch(console.error),f(!0)):u.current&&(u.current.pause(),f(!1))},[e]),b.useEffect(()=>{(async()=>{try{const Se=await A8(t._id);p(Se.liked),C(Se.type||null)}catch(Se){console.error("Failed to check reel liked:",Se)}})()},[t._id]);const G=async()=>{if(!x){S(!0);try{m?(await rb(t._id),p(!1),C(null),n==null||n(t._id,!1)):(await ab(t._id,"LIKE"),p(!0),C("LIKE"),n==null||n(t._id,!0))}catch(he){console.error("Failed to like/unlike reel:",he)}finally{S(!1)}}},Z=async he=>{if(!x){S(!0);try{m&&v===he?(await rb(t._id),p(!1),C(null),n==null||n(t._id,!1)):(await ab(t._id,he),p(!0),C(he),n==null||n(t._id,!0)),F(!1)}catch(Se){console.error("Failed to react to reel:",Se)}finally{S(!1)}}},ue=async()=>{const he=R.trim();he&&(await A(he),N(""))},q=()=>{u.current&&(d?(u.current.pause(),f(!1)):(u.current.play(),f(!0)))};return b.useEffect(()=>{const he=Se=>{D.current&&!D.current.contains(Se.target)&&F(!1)};if(L)return document.addEventListener("mousedown",he),()=>document.removeEventListener("mousedown",he)},[L]),o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",background:"#000",display:"flex",alignItems:"center",justifyContent:"center"},children:[o.jsx("video",{ref:u,src:t.videoUrl,poster:t.thumbnailUrl,loop:!0,muted:!1,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain",cursor:"pointer"},onClick:q,onPlay:()=>f(!0),onPause:()=>f(!1)}),o.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"16px",background:"linear-gradient(to top, rgba(0,0,0,0.7), transparent)",display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[o.jsxs("div",{style:{flex:1,color:"#fff",marginRight:"16px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px",cursor:"pointer"},onClick:()=>l.push(`/profile/${B._id}`),children:[B.avatar?o.jsx("img",{src:B.avatar,alt:B.name,style:{width:"40px",height:"40px",borderRadius:"50%",border:"2px solid #fff"}}):o.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:"18px"},children:((re=(ee=B.name)==null?void 0:ee.charAt(0))==null?void 0:re.toUpperCase())||"U"}),o.jsx("div",{children:o.jsxs("div",{style:{fontWeight:600,fontSize:"14px",display:"flex",alignItems:"center",gap:4},children:[B.name,B.isVerified&&o.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:16,height:16,borderRadius:"50%",background:"#1877f2",color:"white",fontSize:10,fontWeight:700,lineHeight:1},title:"Verified",children:""})]})})]}),t.caption&&o.jsx("div",{style:{fontSize:"14px",marginTop:"8px",lineHeight:"1.4"},children:t.caption})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",alignItems:"center"},children:[o.jsxs("div",{style:{position:"relative"},children:[o.jsxs("button",{onClick:G,disabled:x,style:{background:"transparent",border:"none",cursor:x?"wait":"pointer",padding:"8px",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},onMouseEnter:()=>{I.current&&clearTimeout(I.current),I.current=setTimeout(()=>F(!0),500)},onMouseLeave:()=>{I.current&&clearTimeout(I.current)},children:[o.jsx("div",{style:{fontSize:"28px"},children:m&&v==="LIKE"?"":""}),o.jsx("div",{style:{color:"#fff",fontSize:"12px",fontWeight:600},children:t.likeCount||0})]}),L&&o.jsx("div",{ref:D,style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:"8px",background:"#242526",borderRadius:"24px",padding:"8px",display:"flex",gap:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},onMouseEnter:()=>{I.current&&clearTimeout(I.current)},onMouseLeave:()=>F(!1),children:PA.map(he=>o.jsx("button",{onClick:()=>Z(he.type),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"32px",padding:"4px",borderRadius:"50%",transition:"transform 0.2s"},onMouseEnter:Se=>{Se.currentTarget.style.transform="scale(1.2)"},onMouseLeave:Se=>{Se.currentTarget.style.transform="scale(1)"},title:he.label,children:he.emoji},he.type))})]}),o.jsxs("button",{onClick:()=>{E(!k),i==null||i(t._id)},style:{background:"transparent",border:"none",cursor:"pointer",padding:"8px",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[o.jsx(E9,{}),o.jsx("div",{style:{color:"#fff",fontSize:"12px",fontWeight:600},children:t.commentCount||0})]}),o.jsxs("button",{onClick:()=>r==null?void 0:r(t),style:{background:"transparent",border:"none",cursor:"pointer",padding:"8px",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[o.jsx(w9,{}),o.jsx("div",{style:{color:"#fff",fontSize:"12px",fontWeight:600},children:"Chia s"})]})]})]}),k&&o.jsxs("div",{style:{position:"absolute",right:0,top:0,bottom:0,width:"400px",background:"#242526",borderLeft:"1px solid #3a3b3c",display:"flex",flexDirection:"column",zIndex:10},children:[o.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #3a3b3c",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("h3",{style:{margin:0,color:"#e4e6eb",fontSize:"20px",fontWeight:700},children:"Bnh lun"}),o.jsx("button",{onClick:()=>E(!1),style:{background:"transparent",border:"none",color:"#e4e6eb",fontSize:"24px",cursor:"pointer"},children:""})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px"},children:[_.map(he=>{var Se,P,K,ae,le;return o.jsxs("div",{style:{marginBottom:"16px",display:"flex",gap:"12px"},children:[(Se=he.author)!=null&&Se.avatar?o.jsx("img",{src:he.author.avatar,alt:he.author.name,style:{width:"32px",height:"32px",borderRadius:"50%"}}):o.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:"14px"},children:((ae=(K=(P=he.author)==null?void 0:P.name)==null?void 0:K.charAt(0))==null?void 0:ae.toUpperCase())||"U"}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{color:"#e4e6eb",fontSize:"14px",fontWeight:600},children:((le=he.author)==null?void 0:le.name)||"User"}),o.jsx("div",{style:{color:"#b0b3b8",fontSize:"14px",marginTop:"4px"},children:he.content})]})]},he._id)}),j&&o.jsx("button",{onClick:O,disabled:w,style:{width:"100%",padding:"8px",background:"#3a3b3c",color:"#e4e6eb",border:"none",borderRadius:"6px",cursor:w?"wait":"pointer",marginTop:"16px"},children:w?"ang ti...":"Ti thm"})]}),o.jsx("div",{style:{padding:"16px",borderTop:"1px solid #3a3b3c"},children:o.jsxs("div",{style:{display:"flex",gap:"8px"},children:[o.jsx("input",{type:"text",value:R,onChange:he=>N(he.target.value),onKeyPress:he=>{he.key==="Enter"&&ue()},placeholder:"Vit bnh lun...",style:{flex:1,padding:"8px 12px",background:"#3a3b3c",border:"none",borderRadius:"20px",color:"#e4e6eb",fontSize:"14px"}}),o.jsx("button",{onClick:ue,disabled:!R.trim(),style:{padding:"8px 16px",background:R.trim()?"#2374e1":"#3a3b3c",color:"#fff",border:"none",borderRadius:"20px",cursor:R.trim()?"pointer":"not-allowed",fontSize:"14px",fontWeight:600},children:"ng"})]})})]})]})},UA=({initialReels:t=[]})=>{const[e,n]=b.useState(t),[i,r]=b.useState(0),[l,u]=b.useState(null),[d,f]=b.useState(!0),[m,p]=b.useState(!1),[v,C]=b.useState(!1),x=b.useRef(null),[S,k]=b.useState(!1),[E,_]=b.useState(null),O=b.useCallback(async()=>{if(!(m||!d)){p(!0);try{const j=await Vm(l||void 0);return n(R=>[...R,...j.items]),u(j.nextCursor),f(j.hasNext),j.items.length}catch(j){return console.error("Failed to load reels:",j),0}finally{p(!1)}}},[l,d,m]);b.useEffect(()=>{(async()=>{if(t.length>0){n(t);return}if(await O()===0&&!v){C(!0);try{console.log("No reels found, syncing from video posts...");const N=await M8();if(console.log("Sync result:",N),N.createdCount>0){f(!0),u(null);const L=await Vm();n(L.items),u(L.nextCursor),f(L.hasNext)}}catch(N){console.error("Failed to sync reels:",N)}}})()},[]),b.useEffect(()=>{const j=x.current;if(!j)return;let R=!1,N;const L=()=>{R||(R=!0,clearTimeout(N),N=setTimeout(()=>{const F=j.clientHeight,D=j.scrollTop,I=Math.round(D/F);I!==i&&I>=0&&I<e.length&&r(I),D+F>=j.scrollHeight-F*.5&&d&&!m&&O(),R=!1},100))};return j.addEventListener("scroll",L),()=>{j.removeEventListener("scroll",L),clearTimeout(N)}},[i,e.length,d,m,O]);const A=async(j,R)=>{n(N=>N.map(L=>L._id===j?{...L,likeCount:R?L.likeCount+1:Math.max(0,L.likeCount-1)}:L))},w=j=>{_(j),k(!0)};return e.length===0&&!m?o.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",color:"#e4e6eb"},children:"Cha c reels no"}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{ref:x,style:{height:"100vh",overflowY:"scroll",scrollSnapType:"y mandatory",scrollBehavior:"smooth"},children:[e.map((j,R)=>o.jsx("div",{style:{height:"100vh",scrollSnapAlign:"start",scrollSnapStop:"always"},children:o.jsx(IA,{reel:j,isActive:R===i,onLike:A,onShare:w})},j._id)),m&&o.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",color:"#e4e6eb"},children:"ang ti..."})]}),S&&E&&o.jsx(j9,{isOpen:S,post:E,onClose:()=>{k(!1),_(null)},onSubmit:async()=>{k(!1),_(null)},isSubmitting:!1})]})};function BA(){const[t,e]=b.useState([]),[n,i]=b.useState(!0);b.useEffect(()=>{(async()=>{try{const u=await Vm(void 0,10);e(u.items)}catch(u){console.error("Failed to load reels:",u)}finally{i(!1)}})()},[]);const r=o.jsx(Wa,{currentUser:null,onLogout:()=>{typeof window<"u"&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),window.location.href="#/login")}});return n?o.jsx(Kr,{header:r,hideSidebars:!0,children:o.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",color:"#e4e6eb"},children:"ang ti..."})}):o.jsx(Kr,{header:r,hideSidebars:!0,children:o.jsx(UA,{initialReels:t})})}function FA(){const{postId:t}=wl(),e=yn(),[n,i]=b.useState(null),[r,l]=b.useState(!0),[u,d]=b.useState(null),[f,m]=b.useState({});b.useEffect(()=>{if(!t)return;let k=!0,E=!1;try{const O=sessionStorage.getItem("post_detail_cache"),A=O?JSON.parse(O):{},w=A==null?void 0:A[t];w&&k&&(i(w),m(j=>({...j,[w._id]:w.currentUserReaction||null})),l(!1),E=!0)}catch(O){console.warn("Failed to load post_detail_cache",O)}return(async()=>{var O,A;try{l(!0);const w=await x8(t);k&&(i(w),m(j=>({...j,[w._id]:w.currentUserReaction||null})))}catch(w){k&&!E&&d(((A=(O=w==null?void 0:w.response)==null?void 0:O.data)==null?void 0:A.error)||(w==null?void 0:w.message)||"Khng ti c bi vit")}finally{k&&l(!1)}})(),()=>{k=!1}},[t]);const p=async(k,E)=>{await Up(k,E),m(_=>({..._,[k]:E}))},v=async k=>{await Bp(k),m(E=>{const _={...E};return delete _[k],_})},C=async k=>{await k8(k),alert(" lu bi vit")},x=async k=>{await d9(k),alert(" b lu bi vit")},S=async k=>{const E=prompt("Nhp l do bo co:");E&&(await h9(k._id,{reason:E}),alert(" gi bo co"))};return r?o.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:"ang ti..."}):!n&&u?o.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:12},children:[o.jsx("div",{children:u||"Khng tm thy bi vit"}),o.jsx("button",{onClick:()=>e("/feed"),style:{padding:"8px 16px",borderRadius:6,border:"1px solid #3a3b3c",background:"#0f172a",color:"#e5e7eb",cursor:"pointer"},children:"V bng tin"})]}):n?o.jsx("div",{style:{maxWidth:720,margin:"0 auto",padding:"24px 16px"},children:o.jsx(hd,{post:n,reaction:f[n._id]||null,onSelectReaction:p,onClearReaction:v,onSavePost:C,onUnsavePost:x,onReportPost:S})}):null}function zA(){const[t,e]=b.useState(null),[n,i]=b.useState("Ai "),[r,l]=b.useState(null),[u,d]=b.useState(!1),[f,m]=b.useState(!1),[p,v]=b.useState(null),C=yn();b.useEffect(()=>{const O=hi();if(!O){console.warn("[IncomingCallModal] Socket not available, retrying...");const w=setTimeout(()=>{hi()&&console.log("[IncomingCallModal] Socket now available")},1e3);return()=>clearTimeout(w)}const A=w=>{console.log("[IncomingCallModal] Received call:incoming:",w);const j=localStorage.getItem("user_id");if(w.initiatorId===j){console.log("[IncomingCallModal] Ignoring call:incoming - we are the initiator");return}!t&&!u?(e(w),Hm({title:"Cuc gi n",body:`Ai  ang gi ${w.type==="video"?"video":"audio"}...`,conversationId:w.conversationId}).catch(R=>{console.error("[IncomingCallModal] Error showing notification:",R)})):console.log("[IncomingCallModal] Already have an incoming call or processing, ignoring new one")};return console.log("[IncomingCallModal] Setting up call:incoming listener"),O.on("call:incoming",A),O.on("connect",()=>{console.log("[IncomingCallModal] Socket connected, ready to receive calls")}),()=>{console.log("[IncomingCallModal] Cleaning up call:incoming listener"),O.off("call:incoming",A),O.off("connect")}},[t,u]),b.useEffect(()=>{if(!t)return;let O=!1;return(async()=>{var w,j,R,N,L,F;try{if(!t.callType||!t.livekitRoomName)try{const B=await pC(t.callId);!O&&B&&(e(G=>{var Z;return G&&{...G,callType:B.callType||G.callType,livekitRoomName:((Z=B.metadata)==null?void 0:Z.livekitRoomName)||G.livekitRoomName}}),console.log("[IncomingCallModal] Call info loaded:",{callType:B.callType,livekitRoomName:(w=B.metadata)==null?void 0:w.livekitRoomName}))}catch(B){console.warn("[IncomingCallModal] Could not fetch call info:",B)}const I=(await Np()).find(B=>B._id===t.conversationId);if(O)return;if(I!=null&&I.isGroup){m(!0),v(I.title||`Nhm (${((j=I.members)==null?void 0:j.length)||0} thnh vin)`),l(I.avatar||null);try{const B=await Rm(t.conversationId);!O&&((R=B==null?void 0:B.user)!=null&&R.name)&&i(B.user.name)}catch{}}else{m(!1),v(null);const B=await Rm(t.conversationId);if(O)return;i(((N=B==null?void 0:B.user)==null?void 0:N.name)||((L=B==null?void 0:B.user)==null?void 0:L.email)||"Ai "),l(((F=B==null?void 0:B.user)==null?void 0:F.avatar)||null)}}catch(D){console.error("[IncomingCallModal] Failed to load caller info",D),O||(i("Ai "),l(null),m(!1))}})(),()=>{O=!0}},[t==null?void 0:t.callId,t==null?void 0:t.conversationId]);const x=()=>{e(null),d(!1),m(!1),v(null),i("Ai "),l(null)},S=async()=>{if(!t||u){console.log("[IncomingCallModal] Cannot accept: no call or already processing");return}d(!0);const O={...t};try{console.log("[IncomingCallModal] Accepting call:",O.callId),await gC(O.callId),console.log("[IncomingCallModal] Call accepted via API")}catch(A){console.error("[IncomingCallModal] Error accepting call (will still navigate):",A)}console.log("[IncomingCallModal] Navigating to call screen:",O.callId),C(`/call/${O.callId}`,{state:{conversationId:O.conversationId,initiatorId:O.initiatorId,remoteUserId:O.initiatorId,type:O.type,callType:O.callType||(f?"sfu":"p2p"),livekitRoomName:O.livekitRoomName,isInitiator:!1,acceptedFromModal:!0},replace:!1}),console.log("[IncomingCallModal] Navigated to call screen"),setTimeout(()=>{x()},100)},k=async()=>{if(!t||u){console.log("[IncomingCallModal] Cannot reject: no call or already processing");return}d(!0);try{console.log("[IncomingCallModal] Rejecting call:",t.callId),await vC(t.callId)}catch(O){console.error("[IncomingCallModal] Error rejecting call:",O)}x()};if(b.useEffect(()=>{if(!t)return;const O=setTimeout(()=>{console.log("[IncomingCallModal] Auto-dismissing call after timeout"),k()},3e4);return()=>clearTimeout(O)},[t]),!t)return null;const E=f?p||"Nhm":n,_=f?`${n} ang gi ${t.type==="video"?"video":"thoi"} nhm`:t.type==="video"?"Gi video":"Gi thoi";return o.jsx("div",{className:"incoming-call-overlay",onClick:O=>O.stopPropagation(),children:o.jsxs("div",{className:`incoming-call-card ${f?"incoming-call-card--group":""}`,onClick:O=>O.stopPropagation(),children:[o.jsx("div",{className:"incoming-call-header",children:f?"Cuc gi nhm":"Cuc gi n"}),o.jsxs("div",{className:"incoming-call-body",children:[o.jsx("div",{className:`incoming-call-avatar ${f?"incoming-call-avatar--group":""}`,children:r?o.jsx("img",{src:r,alt:E,onError:O=>{O.currentTarget.style.display="none"}}):o.jsx("div",{className:"incoming-call-avatar-fallback",children:f?"":E.charAt(0).toUpperCase()})}),o.jsxs("div",{className:"incoming-call-info",children:[o.jsx("div",{className:"incoming-call-name",children:E}),o.jsx("div",{className:"incoming-call-type",children:_})]})]}),o.jsxs("div",{className:"incoming-call-actions",children:[o.jsxs("button",{className:"incoming-call-btn incoming-call-btn--reject",onClick:k,disabled:u,children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"T chi"]}),o.jsxs("button",{className:"incoming-call-btn incoming-call-btn--accept",onClick:S,disabled:u,children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Tham gia"]})]})]})})}function qA(){const[t,e]=b.useState(!0),[n,i]=b.useState(!1);if(b.useEffect(()=>{console.log(" App component mounted"),(async()=>{try{const f=localStorage.getItem("auth_token"),m=localStorage.getItem("user_id");console.log(" App.tsx - Restored token from storage:",f?"Present":"Missing"),console.log(" App.tsx - Restored user ID from storage:",m?"Present":"Missing"),f?(Pu(f),i(!0),m&&(window.__currentUserId=m)):i(!1)}catch(f){console.error("Error restoring token:",f),i(!1)}finally{e(!1)}})();const u=f=>{f.key==="auth_token"&&i(!!f.newValue)},d=()=>{const f=localStorage.getItem("auth_token");i(!!f)};return window.addEventListener("storage",u),window.addEventListener("auth:login",d),()=>{window.removeEventListener("storage",u),window.removeEventListener("auth:login",d)}},[]),b.useEffect(()=>{if(n){const l=localStorage.getItem("auth_token");if(l){console.log("[App] Connecting socket...");const u=AC(l);u instanceof Promise&&u.catch(d=>{console.error("[App] Error connecting socket:",d)})}}},[n]),console.log(" App render - isLoading:",t,"isLoggedIn:",n),t)return o.jsxs("div",{style:{width:"100%",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#1a1a1a",color:"#fff",flexDirection:"column",gap:"20px"},children:[o.jsx("div",{style:{fontSize:"24px"},children:"Loading Day2 Desktop..."}),o.jsx("div",{style:{fontSize:"14px",color:"#999"},children:"Please wait"})]});console.log(" Current route should be:",n?"/":"/login"),console.log(" isLoggedIn:",n),console.log(" Login component type:",typeof ob);const r=()=>{const l=Fn();return console.log(" LoginWithLogging wrapper rendering..."),console.log(" Current location:",l.pathname),o.jsx(ob,{})};return o.jsx(d3,{children:o.jsxs(Jk,{children:[o.jsx(VA,{isLoggedIn:n}),o.jsx(jk,{children:n?o.jsxs(o.Fragment,{children:[o.jsx(Qt,{path:"/",element:o.jsx(cb,{})}),o.jsx(Qt,{path:"/feed",element:o.jsx(cb,{})}),o.jsx(Qt,{path:"/reels",element:o.jsx(BA,{})}),o.jsx(Qt,{path:"/hashtag/:tag",element:o.jsx(Q6,{})}),o.jsx(Qt,{path:"/post/:postId",element:o.jsx(FA,{})}),o.jsx(Qt,{path:"/profile",element:o.jsx(y2,{})}),o.jsx(Qt,{path:"/profile/:userId",element:o.jsx(y2,{})}),o.jsx(Qt,{path:"/friends",element:o.jsx(I6,{})}),o.jsx(Qt,{path:"/search",element:o.jsx(B6,{})}),o.jsx(Qt,{path:"/saved",element:o.jsx(LA,{})}),o.jsx(Qt,{path:"/conversations",element:o.jsx(R6,{})}),o.jsx(Qt,{path:"/chat/:conversationId",element:o.jsx(N6,{})}),o.jsx(Qt,{path:"/settings",element:o.jsx(q6,{})}),o.jsx(Qt,{path:"/call/:callId",element:o.jsx(TA,{})}),o.jsx(Qt,{path:"/login",element:o.jsx(r,{})}),o.jsx(Qt,{path:"*",element:o.jsx(vy,{to:"/",replace:!0})})]}):o.jsxs(o.Fragment,{children:[o.jsx(Qt,{path:"/login",element:o.jsx(r,{})}),o.jsx(Qt,{path:"/register",element:o.jsx(O8,{})}),o.jsx(Qt,{path:"/otp-verification",element:o.jsx(D8,{})}),o.jsx(Qt,{path:"*",element:o.jsx(vy,{to:"/login",replace:!0})})]})}),n&&o.jsx(zA,{})]})})}function VA({isLoggedIn:t}){const e=yn(),n=b.useCallback(async i=>{if(!i)return;if(!localStorage.getItem("auth_token")){localStorage.setItem("pending_invite_code",i);return}try{console.log("[DeepLink] Joining via invite code:",i);const l=await cE(i),u=l==null?void 0:l.conversation;u!=null&&u._id?(window.dispatchEvent(new CustomEvent("conversation:joined",{detail:{conversation:u}})),e("/",{replace:!0})):console.warn("[DeepLink] No conversation returned for invite code",i)}catch(l){console.error("[DeepLink] Failed to join conversation via invite",l)}},[e]);return b.useEffect(()=>{var r,l,u,d;if(!window.electronAPI)return;(l=(r=window.electronAPI).consumePendingInvites)==null||l.call(r).then(f=>{f==null||f.forEach(m=>n(m==null?void 0:m.inviteCode))}).catch(f=>console.error("[DeepLink] Failed to consume pending invites",f));const i=(d=(u=window.electronAPI).onDeepLinkInvite)==null?void 0:d.call(u,f=>{n(f==null?void 0:f.inviteCode)});return()=>{typeof i=="function"&&i()}},[n]),b.useEffect(()=>{if(!t)return;const i=localStorage.getItem("pending_invite_code");i&&(localStorage.removeItem("pending_invite_code"),n(i))},[t,n]),null}LS.createRoot(document.getElementById("root")).render(o.jsx(Ou.StrictMode,{children:o.jsx(qA,{})}));
