"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/layout",{

/***/ "(app-pages-browser)/../../packages/app/components/GlobalIncomingCall.web.js":
/*!***************************************************************!*\
  !*** ../../packages/app/components/GlobalIncomingCall.web.js ***!
  \***************************************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GlobalIncomingCall: function() { return /* binding */ GlobalIncomingCall; }\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ \"(app-pages-browser)/../../node_modules/.pnpm/next@14.0.4_@babel+core@7.2_e51c94e397bd2e219e1912d446a17ff6/node_modules/next/dist/compiled/react/jsx-runtime.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(app-pages-browser)/../../node_modules/.pnpm/next@14.0.4_@babel+core@7.2_e51c94e397bd2e219e1912d446a17ff6/node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _socket__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../socket */ \"(app-pages-browser)/../../packages/app/socket.js\");\n/* harmony import */ var _api__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../api */ \"(app-pages-browser)/../../packages/app/api.js\");\n/* harmony import */ var _styles_floating_chat_css__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../styles/floating-chat.css */ \"(app-pages-browser)/../../packages/app/styles/floating-chat.css\");\n/* __next_internal_client_entry_do_not_use__ GlobalIncomingCall auto */ var _s = $RefreshSig$();\n\n\n\n\n\nfunction GlobalIncomingCall() {\n    _s();\n    const [incomingCall, setIncomingCall] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    const [callerName, setCallerName] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(\"Ai đ\\xf3\");\n    const [callerAvatar, setCallerAvatar] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    const [isProcessing, setIsProcessing] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);\n    const [isGroupCall, setIsGroupCall] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);\n    const [groupName, setGroupName] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    // Listen for socket events globally\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{\n        const socket = (0,_socket__WEBPACK_IMPORTED_MODULE_2__.getSocket)();\n        if (!socket) {\n            console.warn(\"[GlobalIncomingCall] Socket not available\");\n            return;\n        }\n        const handleIncomingCall = (data)=>{\n            console.log(\"[GlobalIncomingCall] Received call:incoming\", data);\n            const currentUserId =  true ? window.localStorage.getItem(\"user_id\") : 0;\n            // Bỏ qua cuộc gọi do chính mình tạo\n            if (currentUserId && data.initiatorId === currentUserId) {\n                console.log(\"[GlobalIncomingCall] Skip own outgoing call\");\n                return;\n            }\n            // Nếu đang xử lý cuộc gọi khác thì bỏ qua\n            if (incomingCall || isProcessing) {\n                console.log(\"[GlobalIncomingCall] Already handling a call, ignoring new one\");\n                return;\n            }\n            setIncomingCall(data);\n        };\n        console.log(\"[GlobalIncomingCall] Subscribing to call:incoming\");\n        socket.on(\"call:incoming\", handleIncomingCall);\n        return ()=>{\n            console.log(\"[GlobalIncomingCall] Cleanup call:incoming listener\");\n            socket.off(\"call:incoming\", handleIncomingCall);\n        };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [\n        incomingCall,\n        isProcessing\n    ]);\n    // Load caller/group info and call details\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{\n        if (!incomingCall) return;\n        let cancelled = false;\n        const loadInfo = async ()=>{\n            try {\n                // Fetch call info to get callType and livekitRoomName if not provided\n                if (!incomingCall.callType || !incomingCall.livekitRoomName) {\n                    try {\n                        const callInfo = await (0,_api__WEBPACK_IMPORTED_MODULE_3__.getCall)(incomingCall.callId);\n                        if (!cancelled && callInfo) {\n                            var _callInfo_metadata;\n                            // Update incomingCall with call info\n                            setIncomingCall((prev)=>{\n                                var _callInfo_metadata;\n                                return prev ? {\n                                    ...prev,\n                                    callType: callInfo.callType || prev.callType,\n                                    livekitRoomName: ((_callInfo_metadata = callInfo.metadata) === null || _callInfo_metadata === void 0 ? void 0 : _callInfo_metadata.livekitRoomName) || prev.livekitRoomName\n                                } : prev;\n                            });\n                            console.log(\"[GlobalIncomingCall] Call info loaded:\", {\n                                callType: callInfo.callType,\n                                livekitRoomName: (_callInfo_metadata = callInfo.metadata) === null || _callInfo_metadata === void 0 ? void 0 : _callInfo_metadata.livekitRoomName\n                            });\n                        }\n                    } catch (err) {\n                        console.warn(\"[GlobalIncomingCall] Could not fetch call info:\", err);\n                    }\n                }\n                // Check if this is a group call by getting conversation info\n                const conversations = await (0,_api__WEBPACK_IMPORTED_MODULE_3__.getConversations)();\n                const conversation = conversations.find((c)=>c._id === incomingCall.conversationId);\n                if (cancelled) return;\n                if (conversation === null || conversation === void 0 ? void 0 : conversation.isGroup) {\n                    var _conversation_members;\n                    // Group call\n                    setIsGroupCall(true);\n                    setGroupName(conversation.title || \"Nh\\xf3m (\".concat(((_conversation_members = conversation.members) === null || _conversation_members === void 0 ? void 0 : _conversation_members.length) || 0, \" th\\xe0nh vi\\xean)\"));\n                    setCallerAvatar(conversation.avatar || null);\n                    // Also try to get the initiator's name\n                    try {\n                        var _info_user;\n                        const info = await (0,_api__WEBPACK_IMPORTED_MODULE_3__.getOpponentInfo)(incomingCall.conversationId);\n                        if (!cancelled && (info === null || info === void 0 ? void 0 : (_info_user = info.user) === null || _info_user === void 0 ? void 0 : _info_user.name)) {\n                            setCallerName(info.user.name);\n                        }\n                    } catch (e) {\n                    // Ignore error, use group name\n                    }\n                } else {\n                    var _info_user1, _info_user2, _info_user3;\n                    // 1-1 call\n                    setIsGroupCall(false);\n                    setGroupName(null);\n                    const info = await (0,_api__WEBPACK_IMPORTED_MODULE_3__.getOpponentInfo)(incomingCall.conversationId);\n                    if (cancelled) return;\n                    setCallerName((info === null || info === void 0 ? void 0 : (_info_user1 = info.user) === null || _info_user1 === void 0 ? void 0 : _info_user1.name) || (info === null || info === void 0 ? void 0 : (_info_user2 = info.user) === null || _info_user2 === void 0 ? void 0 : _info_user2.email) || \"Ai đ\\xf3\");\n                    setCallerAvatar((info === null || info === void 0 ? void 0 : (_info_user3 = info.user) === null || _info_user3 === void 0 ? void 0 : _info_user3.avatar) || null);\n                }\n            } catch (err) {\n                console.error(\"[GlobalIncomingCall] Failed to load caller info\", err);\n                if (!cancelled) {\n                    setCallerName(\"Ai đ\\xf3\");\n                    setCallerAvatar(null);\n                    setIsGroupCall(false);\n                }\n            }\n        };\n        loadInfo();\n        return ()=>{\n            cancelled = true;\n        };\n    }, [\n        incomingCall === null || incomingCall === void 0 ? void 0 : incomingCall.callId,\n        incomingCall === null || incomingCall === void 0 ? void 0 : incomingCall.conversationId\n    ]);\n    const clearState = ()=>{\n        setIncomingCall(null);\n        setIsProcessing(false);\n        setIsGroupCall(false);\n        setGroupName(null);\n        setCallerName(\"Ai đ\\xf3\");\n        setCallerAvatar(null);\n    };\n    const handleAccept = async ()=>{\n        if (!incomingCall || isProcessing) return;\n        setIsProcessing(true);\n        try {\n            await (0,_api__WEBPACK_IMPORTED_MODULE_3__.acceptCall)(incomingCall.callId);\n        } catch (err) {\n            console.error(\"[GlobalIncomingCall] Error accepting call (will still navigate)\", err);\n        }\n        // Điều hướng sang màn hình call\n        if (true) {\n            // Detect Electron: check electronAPI hoặc hash trong URL hoặc userAgent\n            const isElectron = !!(window.electronAPI || window.location.hash.includes(\"#/\") || window.location.href.includes(\"/#/\") || navigator.userAgent.toLowerCase().includes(\"electron\"));\n            console.log(\"[GlobalIncomingCall] isElectron:\", isElectron, \"hash:\", window.location.hash);\n            if (isElectron) {\n                // Electron dùng HashRouter\n                const target = \"#/call/\".concat(incomingCall.callId);\n                console.log(\"[GlobalIncomingCall] Navigating via hash to call screen:\", target);\n                window.location.hash = target;\n            } else {\n                // Web dùng BrowserRouter\n                const params = new URLSearchParams({\n                    callId: incomingCall.callId,\n                    conversationId: incomingCall.conversationId,\n                    acceptedFromModal: \"true\",\n                    isIncoming: \"true\"\n                });\n                // Add call type params if available\n                if (incomingCall.callType) {\n                    params.set(\"callType\", incomingCall.callType);\n                } else if (isGroupCall) {\n                    // Group calls use SFU\n                    params.set(\"callType\", \"sfu\");\n                }\n                if (incomingCall.livekitRoomName) {\n                    params.set(\"livekitRoomName\", incomingCall.livekitRoomName);\n                }\n                console.log(\"[GlobalIncomingCall] Navigating to call screen with params:\", Object.fromEntries(params));\n                window.location.href = \"/call?\".concat(params.toString());\n            }\n        }\n        clearState();\n    };\n    const handleReject = async ()=>{\n        if (!incomingCall || isProcessing) return;\n        setIsProcessing(true);\n        try {\n            await (0,_api__WEBPACK_IMPORTED_MODULE_3__.rejectCall)(incomingCall.callId);\n        } catch (err) {\n            console.error(\"[GlobalIncomingCall] Error rejecting call\", err);\n        }\n        clearState();\n    };\n    // Auto dismiss after 30s\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{\n        if (!incomingCall) return;\n        const timer = setTimeout(()=>{\n            console.log(\"[GlobalIncomingCall] Auto dismiss incoming call toast\");\n            clearState();\n        }, 30000);\n        return ()=>clearTimeout(timer);\n    }, [\n        incomingCall\n    ]);\n    if (!incomingCall) return null;\n    const displayName = isGroupCall ? groupName || \"Nh\\xf3m\" : callerName;\n    const displaySubtitle = isGroupCall ? \"\".concat(callerName, \" đang gọi \").concat(incomingCall.type === \"video\" ? \"video\" : \"thoại\", \" nh\\xf3m\") : incomingCall.type === \"video\" ? \"Gọi video\" : \"Gọi thoại\";\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n        className: \"global-incoming-call-overlay\",\n        onClick: (e)=>{\n            // chặn click xuyên qua\n            e.stopPropagation();\n        },\n        children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", {\n            className: \"global-incoming-call-card \".concat(isGroupCall ? \"global-incoming-call-card--group\" : \"\"),\n            onClick: (e)=>e.stopPropagation(),\n            children: [\n                (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                    className: \"global-incoming-call-header\",\n                    children: isGroupCall ? \"Cuộc gọi nh\\xf3m\" : \"Cuộc gọi đến\"\n                }),\n                (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", {\n                    className: \"global-incoming-call-body\",\n                    children: [\n                        (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                            className: \"global-incoming-call-avatar \".concat(isGroupCall ? \"global-incoming-call-avatar--group\" : \"\"),\n                            children: callerAvatar ? // eslint-disable-next-line @next/next/no-img-element\n                            (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"img\", {\n                                src: callerAvatar,\n                                alt: displayName\n                            }) : (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                                className: \"global-incoming-call-avatar-fallback\",\n                                children: isGroupCall ? \"\\uD83D\\uDC65\" : displayName.charAt(0).toUpperCase()\n                            })\n                        }),\n                        (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", {\n                            className: \"global-incoming-call-info\",\n                            children: [\n                                (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                                    className: \"global-incoming-call-name\",\n                                    children: displayName\n                                }),\n                                (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                                    className: \"global-incoming-call-type\",\n                                    children: displaySubtitle\n                                })\n                            ]\n                        })\n                    ]\n                }),\n                (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", {\n                    className: \"global-incoming-call-actions\",\n                    children: [\n                        (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"button\", {\n                            className: \"global-incoming-call-btn global-incoming-call-btn--reject\",\n                            onClick: handleReject,\n                            disabled: isProcessing,\n                            children: \"Từ chối\"\n                        }),\n                        (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"button\", {\n                            className: \"global-incoming-call-btn global-incoming-call-btn--accept\",\n                            onClick: handleAccept,\n                            disabled: isProcessing,\n                            children: \"Tham gia\"\n                        })\n                    ]\n                })\n            ]\n        })\n    });\n}\n_s(GlobalIncomingCall, \"WsZA3k0NXC6zcx0KDea7ttVj9pI=\");\n_c = GlobalIncomingCall;\nvar _c;\n$RefreshReg$(_c, \"GlobalIncomingCall\");\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uLi8uLi9wYWNrYWdlcy9hcHAvY29tcG9uZW50cy9HbG9iYWxJbmNvbWluZ0NhbGwud2ViLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQytEO0FBQ25CO0FBQ047QUFDc0Q7QUFDdkQ7QUFDOUIsU0FBU1k7O0lBQ1osTUFBTSxDQUFDQyxjQUFjQyxnQkFBZ0IsR0FBR1QsK0NBQVFBLENBQUM7SUFDakQsTUFBTSxDQUFDVSxZQUFZQyxjQUFjLEdBQUdYLCtDQUFRQSxDQUFDO0lBQzdDLE1BQU0sQ0FBQ1ksY0FBY0MsZ0JBQWdCLEdBQUdiLCtDQUFRQSxDQUFDO0lBQ2pELE1BQU0sQ0FBQ2MsY0FBY0MsZ0JBQWdCLEdBQUdmLCtDQUFRQSxDQUFDO0lBQ2pELE1BQU0sQ0FBQ2dCLGFBQWFDLGVBQWUsR0FBR2pCLCtDQUFRQSxDQUFDO0lBQy9DLE1BQU0sQ0FBQ2tCLFdBQVdDLGFBQWEsR0FBR25CLCtDQUFRQSxDQUFDO0lBQzNDLG9DQUFvQztJQUNwQ0QsZ0RBQVNBLENBQUM7UUFDTixNQUFNcUIsU0FBU25CLGtEQUFTQTtRQUN4QixJQUFJLENBQUNtQixRQUFRO1lBQ1RDLFFBQVFDLElBQUksQ0FBQztZQUNiO1FBQ0o7UUFDQSxNQUFNQyxxQkFBcUIsQ0FBQ0M7WUFDeEJILFFBQVFJLEdBQUcsQ0FBQywrQ0FBK0NEO1lBQzNELE1BQU1FLGdCQUFnQixLQUE2QixHQUFHQyxPQUFPQyxZQUFZLENBQUNDLE9BQU8sQ0FBQyxhQUFhLENBQUk7WUFDbkcsb0NBQW9DO1lBQ3BDLElBQUlILGlCQUFpQkYsS0FBS00sV0FBVyxLQUFLSixlQUFlO2dCQUNyREwsUUFBUUksR0FBRyxDQUFDO2dCQUNaO1lBQ0o7WUFDQSwwQ0FBMEM7WUFDMUMsSUFBSWpCLGdCQUFnQk0sY0FBYztnQkFDOUJPLFFBQVFJLEdBQUcsQ0FBQztnQkFDWjtZQUNKO1lBQ0FoQixnQkFBZ0JlO1FBQ3BCO1FBQ0FILFFBQVFJLEdBQUcsQ0FBQztRQUNaTCxPQUFP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VztvQ0FBNkJJLFVBQVVQO2dDQUFZO2dDQUFJdEYsc0RBQUlBLENBQUMsT0FBTztvQ0FBRXlGLFdBQVc7b0NBQTZCSSxVQUFVTjtnQ0FBZ0I7NkJBQUc7d0JBQUM7cUJBQUc7Z0JBQUM7Z0JBQUlyRix1REFBS0EsQ0FBQyxPQUFPO29CQUFFdUYsV0FBVztvQkFBZ0NJLFVBQVU7d0JBQUM3RixzREFBSUEsQ0FBQyxVQUFVOzRCQUFFeUYsV0FBVzs0QkFBNkRDLFNBQVNSOzRCQUFjZ0IsVUFBVWhGOzRCQUFjMkUsVUFBVTt3QkFBb0I7d0JBQUk3RixzREFBSUEsQ0FBQyxVQUFVOzRCQUFFeUYsV0FBVzs0QkFBNkRDLFNBQVMzQjs0QkFBY21DLFVBQVVoRjs0QkFBYzJFLFVBQVU7d0JBQVc7cUJBQUc7Z0JBQUM7YUFBRztRQUFDO0lBQUc7QUFDdDJCO0dBMU1nQmxGO0tBQUFBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uLi8uLi9wYWNrYWdlcy9hcHAvY29tcG9uZW50cy9HbG9iYWxJbmNvbWluZ0NhbGwud2ViLmpzPzExMjUiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCI7XG5pbXBvcnQgeyBqc3ggYXMgX2pzeCwganN4cyBhcyBfanN4cyB9IGZyb20gXCJyZWFjdC9qc3gtcnVudGltZVwiO1xuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgZ2V0U29ja2V0IH0gZnJvbSBcIi4uL3NvY2tldFwiO1xuaW1wb3J0IHsgYWNjZXB0Q2FsbCwgcmVqZWN0Q2FsbCwgZ2V0T3Bwb25lbnRJbmZvLCBnZXRDb252ZXJzYXRpb25zLCBnZXRDYWxsIH0gZnJvbSBcIi4uL2FwaVwiO1xuaW1wb3J0IFwiLi4vc3R5bGVzL2Zsb2F0aW5nLWNoYXQuY3NzXCI7XG5leHBvcnQgZnVuY3Rpb24gR2xvYmFsSW5jb21pbmdDYWxsKCkge1xuICAgIGNvbnN0IFtpbmNvbWluZ0NhbGwsIHNldEluY29taW5nQ2FsbF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICBjb25zdCBbY2FsbGVyTmFtZSwgc2V0Q2FsbGVyTmFtZV0gPSB1c2VTdGF0ZShcIkFpIMSRw7NcIik7XG4gICAgY29uc3QgW2NhbGxlckF2YXRhciwgc2V0Q2FsbGVyQXZhdGFyXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IFtpc1Byb2Nlc3NpbmcsIHNldElzUHJvY2Vzc2luZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2lzR3JvdXBDYWxsLCBzZXRJc0dyb3VwQ2FsbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2dyb3VwTmFtZSwgc2V0R3JvdXBOYW1lXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIC8vIExpc3RlbiBmb3Igc29ja2V0IGV2ZW50cyBnbG9iYWxseVxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNvY2tldCA9IGdldFNvY2tldCgpO1xuICAgICAgICBpZiAoIXNvY2tldCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiW0dsb2JhbEluY29taW5nQ2FsbF0gU29ja2V0IG5vdCBhdmFpbGFibGVcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGFuZGxlSW5jb21pbmdDYWxsID0gKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0dsb2JhbEluY29taW5nQ2FsbF0gUmVjZWl2ZWQgY2FsbDppbmNvbWluZ1wiLCBkYXRhKTtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VySWQgPSB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlcl9pZFwiKSA6IG51bGw7XG4gICAgICAgICAgICAvLyBC4buPIHF1YSBjdeG7mWMgZ+G7jWkgZG8gY2jDrW5oIG3DrG5oIHThuqFvXG4gICAgICAgICAgICBpZiAoY3VycmVudFVzZXJJZCAmJiBkYXRhLmluaXRpYXRvcklkID09PSBjdXJyZW50VXNlcklkKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJbR2xvYmFsSW5jb21pbmdDYWxsXSBTa2lwIG93biBvdXRnb2luZyBjYWxsXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE7hur91IMSRYW5nIHjhu60gbMO9IGN14buZYyBn4buNaSBraMOhYyB0aMOsIGLhu48gcXVhXG4gICAgICAgICAgICBpZiAoaW5jb21pbmdDYWxsIHx8IGlzUHJvY2Vzc2luZykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0dsb2JhbEluY29taW5nQ2FsbF0gQWxyZWFkeSBoYW5kbGluZyBhIGNhbGwsIGlnbm9yaW5nIG5ldyBvbmVcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0SW5jb21pbmdDYWxsKGRhdGEpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zb2xlLmxvZyhcIltHbG9iYWxJbmNvbWluZ0NhbGxdIFN1YnNjcmliaW5nIHRvIGNhbGw6aW5jb21pbmdcIik7XG4gICAgICAgIHNvY2tldC5vbihcImNhbGw6aW5jb21pbmdcIiwgaGFuZGxlSW5jb21pbmdDYWxsKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0dsb2JhbEluY29taW5nQ2FsbF0gQ2xlYW51cCBjYWxsOmluY29taW5nIGxpc3RlbmVyXCIpO1xuICAgICAgICAgICAgc29ja2V0Lm9mZihcImNhbGw6aW5jb21pbmdcIiwgaGFuZGxlSW5jb21pbmdDYWxsKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICAgIH0sIFtpbmNvbWluZ0NhbGwsIGlzUHJvY2Vzc2luZ10pO1xuICAgIC8vIExvYWQgY2FsbGVyL2dyb3VwIGluZm8gYW5kIGNhbGwgZGV0YWlsc1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghaW5jb21pbmdDYWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgY2FuY2VsbGVkID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGxvYWRJbmZvID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAvLyBGZXRjaCBjYWxsIGluZm8gdG8gZ2V0IGNhbGxUeXBlIGFuZCBsaXZla2l0Um9vbU5hbWUgaWYgbm90IHByb3ZpZGVkXG4gICAgICAgICAgICAgICAgaWYgKCFpbmNvbWluZ0NhbGwuY2FsbFR5cGUgfHwgIWluY29taW5nQ2FsbC5saXZla2l0Um9vbU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxJbmZvID0gYXdhaXQgZ2V0Q2FsbChpbmNvbWluZ0NhbGwuY2FsbElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2FuY2VsbGVkICYmIGNhbGxJbmZvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGluY29taW5nQ2FsbCB3aXRoIGNhbGwgaW5mb1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEluY29taW5nQ2FsbChwcmV2ID0+IHByZXYgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxUeXBlOiBjYWxsSW5mby5jYWxsVHlwZSB8fCBwcmV2LmNhbGxUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXZla2l0Um9vbU5hbWU6IGNhbGxJbmZvLm1ldGFkYXRhPy5saXZla2l0Um9vbU5hbWUgfHwgcHJldi5saXZla2l0Um9vbU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHByZXYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0dsb2JhbEluY29taW5nQ2FsbF0gQ2FsbCBpbmZvIGxvYWRlZDpcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsVHlwZTogY2FsbEluZm8uY2FsbFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpdmVraXRSb29tTmFtZTogY2FsbEluZm8ubWV0YWRhdGE/LmxpdmVraXRSb29tTmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIltHbG9iYWxJbmNvbWluZ0NhbGxdIENvdWxkIG5vdCBmZXRjaCBjYWxsIGluZm86XCIsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIGdyb3VwIGNhbGwgYnkgZ2V0dGluZyBjb252ZXJzYXRpb24gaW5mb1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnZlcnNhdGlvbnMgPSBhd2FpdCBnZXRDb252ZXJzYXRpb25zKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udmVyc2F0aW9uID0gY29udmVyc2F0aW9ucy5maW5kKChjKSA9PiBjLl9pZCA9PT0gaW5jb21pbmdDYWxsLmNvbnZlcnNhdGlvbklkKTtcbiAgICAgICAgICAgICAgICBpZiAoY2FuY2VsbGVkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNhdGlvbj8uaXNHcm91cCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBHcm91cCBjYWxsXG4gICAgICAgICAgICAgICAgICAgIHNldElzR3JvdXBDYWxsKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBzZXRHcm91cE5hbWUoY29udmVyc2F0aW9uLnRpdGxlIHx8IGBOaMOzbSAoJHtjb252ZXJzYXRpb24ubWVtYmVycz8ubGVuZ3RoIHx8IDB9IHRow6BuaCB2acOqbilgKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0Q2FsbGVyQXZhdGFyKGNvbnZlcnNhdGlvbi5hdmF0YXIgfHwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFsc28gdHJ5IHRvIGdldCB0aGUgaW5pdGlhdG9yJ3MgbmFtZVxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IGF3YWl0IGdldE9wcG9uZW50SW5mbyhpbmNvbWluZ0NhbGwuY29udmVyc2F0aW9uSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjYW5jZWxsZWQgJiYgaW5mbz8udXNlcj8ubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldENhbGxlck5hbWUoaW5mby51c2VyLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBlcnJvciwgdXNlIGdyb3VwIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gMS0xIGNhbGxcbiAgICAgICAgICAgICAgICAgICAgc2V0SXNHcm91cENhbGwoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBzZXRHcm91cE5hbWUobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSBhd2FpdCBnZXRPcHBvbmVudEluZm8oaW5jb21pbmdDYWxsLmNvbnZlcnNhdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbmNlbGxlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgc2V0Q2FsbGVyTmFtZShpbmZvPy51c2VyPy5uYW1lIHx8IGluZm8/LnVzZXI/LmVtYWlsIHx8IFwiQWkgxJHDs1wiKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0Q2FsbGVyQXZhdGFyKGluZm8/LnVzZXI/LmF2YXRhciB8fCBudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIltHbG9iYWxJbmNvbWluZ0NhbGxdIEZhaWxlZCB0byBsb2FkIGNhbGxlciBpbmZvXCIsIGVycik7XG4gICAgICAgICAgICAgICAgaWYgKCFjYW5jZWxsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0Q2FsbGVyTmFtZShcIkFpIMSRw7NcIik7XG4gICAgICAgICAgICAgICAgICAgIHNldENhbGxlckF2YXRhcihudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0SXNHcm91cENhbGwoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgbG9hZEluZm8oKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNhbmNlbGxlZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgfSwgW2luY29taW5nQ2FsbD8uY2FsbElkLCBpbmNvbWluZ0NhbGw/LmNvbnZlcnNhdGlvbklkXSk7XG4gICAgY29uc3QgY2xlYXJTdGF0ZSA9ICgpID0+IHtcbiAgICAgICAgc2V0SW5jb21pbmdDYWxsKG51bGwpO1xuICAgICAgICBzZXRJc1Byb2Nlc3NpbmcoZmFsc2UpO1xuICAgICAgICBzZXRJc0dyb3VwQ2FsbChmYWxzZSk7XG4gICAgICAgIHNldEdyb3VwTmFtZShudWxsKTtcbiAgICAgICAgc2V0Q2FsbGVyTmFtZShcIkFpIMSRw7NcIik7XG4gICAgICAgIHNldENhbGxlckF2YXRhcihudWxsKTtcbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZUFjY2VwdCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKCFpbmNvbWluZ0NhbGwgfHwgaXNQcm9jZXNzaW5nKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBzZXRJc1Byb2Nlc3NpbmcodHJ1ZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBhY2NlcHRDYWxsKGluY29taW5nQ2FsbC5jYWxsSWQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbR2xvYmFsSW5jb21pbmdDYWxsXSBFcnJvciBhY2NlcHRpbmcgY2FsbCAod2lsbCBzdGlsbCBuYXZpZ2F0ZSlcIiwgZXJyKTtcbiAgICAgICAgfVxuICAgICAgICAvLyDEkGnhu4F1IGjGsOG7m25nIHNhbmcgbcOgbiBow6xuaCBjYWxsXG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAvLyBEZXRlY3QgRWxlY3Ryb246IGNoZWNrIGVsZWN0cm9uQVBJIGhv4bq3YyBoYXNoIHRyb25nIFVSTCBob+G6t2MgdXNlckFnZW50XG4gICAgICAgICAgICBjb25zdCBpc0VsZWN0cm9uID0gISEod2luZG93LmVsZWN0cm9uQVBJIHx8XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2guaW5jbHVkZXMoXCIjL1wiKSB8fFxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKFwiLyMvXCIpIHx8XG4gICAgICAgICAgICAgICAgbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZWxlY3Ryb25cIikpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbR2xvYmFsSW5jb21pbmdDYWxsXSBpc0VsZWN0cm9uOlwiLCBpc0VsZWN0cm9uLCBcImhhc2g6XCIsIHdpbmRvdy5sb2NhdGlvbi5oYXNoKTtcbiAgICAgICAgICAgIGlmIChpc0VsZWN0cm9uKSB7XG4gICAgICAgICAgICAgICAgLy8gRWxlY3Ryb24gZMO5bmcgSGFzaFJvdXRlclxuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGAjL2NhbGwvJHtpbmNvbWluZ0NhbGwuY2FsbElkfWA7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJbR2xvYmFsSW5jb21pbmdDYWxsXSBOYXZpZ2F0aW5nIHZpYSBoYXNoIHRvIGNhbGwgc2NyZWVuOlwiLCB0YXJnZXQpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gdGFyZ2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gV2ViIGTDuW5nIEJyb3dzZXJSb3V0ZXJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbElkOiBpbmNvbWluZ0NhbGwuY2FsbElkLFxuICAgICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25JZDogaW5jb21pbmdDYWxsLmNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgICAgICAgICAgICBhY2NlcHRlZEZyb21Nb2RhbDogJ3RydWUnLFxuICAgICAgICAgICAgICAgICAgICBpc0luY29taW5nOiAndHJ1ZScsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gQWRkIGNhbGwgdHlwZSBwYXJhbXMgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgaWYgKGluY29taW5nQ2FsbC5jYWxsVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuc2V0KCdjYWxsVHlwZScsIGluY29taW5nQ2FsbC5jYWxsVHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzR3JvdXBDYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdyb3VwIGNhbGxzIHVzZSBTRlVcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnNldCgnY2FsbFR5cGUnLCAnc2Z1Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbmNvbWluZ0NhbGwubGl2ZWtpdFJvb21OYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5zZXQoJ2xpdmVraXRSb29tTmFtZScsIGluY29taW5nQ2FsbC5saXZla2l0Um9vbU5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIltHbG9iYWxJbmNvbWluZ0NhbGxdIE5hdmlnYXRpbmcgdG8gY2FsbCBzY3JlZW4gd2l0aCBwYXJhbXM6XCIsIE9iamVjdC5mcm9tRW50cmllcyhwYXJhbXMpKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGAvY2FsbD8ke3BhcmFtcy50b1N0cmluZygpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2xlYXJTdGF0ZSgpO1xuICAgIH07XG4gICAgY29uc3QgaGFuZGxlUmVqZWN0ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoIWluY29taW5nQ2FsbCB8fCBpc1Byb2Nlc3NpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHNldElzUHJvY2Vzc2luZyh0cnVlKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHJlamVjdENhbGwoaW5jb21pbmdDYWxsLmNhbGxJZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIltHbG9iYWxJbmNvbWluZ0NhbGxdIEVycm9yIHJlamVjdGluZyBjYWxsXCIsIGVycik7XG4gICAgICAgIH1cbiAgICAgICAgY2xlYXJTdGF0ZSgpO1xuICAgIH07XG4gICAgLy8gQXV0byBkaXNtaXNzIGFmdGVyIDMwc1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghaW5jb21pbmdDYWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbR2xvYmFsSW5jb21pbmdDYWxsXSBBdXRvIGRpc21pc3MgaW5jb21pbmcgY2FsbCB0b2FzdFwiKTtcbiAgICAgICAgICAgIGNsZWFyU3RhdGUoKTtcbiAgICAgICAgfSwgMzAwMDApO1xuICAgICAgICByZXR1cm4gKCkgPT4gY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICB9LCBbaW5jb21pbmdDYWxsXSk7XG4gICAgaWYgKCFpbmNvbWluZ0NhbGwpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gaXNHcm91cENhbGwgPyAoZ3JvdXBOYW1lIHx8IFwiTmjDs21cIikgOiBjYWxsZXJOYW1lO1xuICAgIGNvbnN0IGRpc3BsYXlTdWJ0aXRsZSA9IGlzR3JvdXBDYWxsXG4gICAgICAgID8gYCR7Y2FsbGVyTmFtZX0gxJFhbmcgZ+G7jWkgJHtpbmNvbWluZ0NhbGwudHlwZSA9PT0gXCJ2aWRlb1wiID8gXCJ2aWRlb1wiIDogXCJ0aG/huqFpXCJ9IG5ow7NtYFxuICAgICAgICA6IChpbmNvbWluZ0NhbGwudHlwZSA9PT0gXCJ2aWRlb1wiID8gXCJH4buNaSB2aWRlb1wiIDogXCJH4buNaSB0aG/huqFpXCIpO1xuICAgIHJldHVybiAoX2pzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJnbG9iYWwtaW5jb21pbmctY2FsbC1vdmVybGF5XCIsIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgICAgICAvLyBjaOG6t24gY2xpY2sgeHV5w6puIHF1YVxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfSwgY2hpbGRyZW46IF9qc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBgZ2xvYmFsLWluY29taW5nLWNhbGwtY2FyZCAke2lzR3JvdXBDYWxsID8gXCJnbG9iYWwtaW5jb21pbmctY2FsbC1jYXJkLS1ncm91cFwiIDogXCJcIn1gLCBvbkNsaWNrOiAoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSwgY2hpbGRyZW46IFtfanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImdsb2JhbC1pbmNvbWluZy1jYWxsLWhlYWRlclwiLCBjaGlsZHJlbjogaXNHcm91cENhbGwgPyBcIkN14buZYyBn4buNaSBuaMOzbVwiIDogXCJDdeG7mWMgZ+G7jWkgxJHhur9uXCIgfSksIF9qc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImdsb2JhbC1pbmNvbWluZy1jYWxsLWJvZHlcIiwgY2hpbGRyZW46IFtfanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBgZ2xvYmFsLWluY29taW5nLWNhbGwtYXZhdGFyICR7aXNHcm91cENhbGwgPyBcImdsb2JhbC1pbmNvbWluZy1jYWxsLWF2YXRhci0tZ3JvdXBcIiA6IFwiXCJ9YCwgY2hpbGRyZW46IGNhbGxlckF2YXRhciA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQG5leHQvbmV4dC9uby1pbWctZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9qc3goXCJpbWdcIiwgeyBzcmM6IGNhbGxlckF2YXRhciwgYWx0OiBkaXNwbGF5TmFtZSB9KSkgOiAoX2pzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJnbG9iYWwtaW5jb21pbmctY2FsbC1hdmF0YXItZmFsbGJhY2tcIiwgY2hpbGRyZW46IGlzR3JvdXBDYWxsID8gXCLwn5GlXCIgOiBkaXNwbGF5TmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSB9KSkgfSksIF9qc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImdsb2JhbC1pbmNvbWluZy1jYWxsLWluZm9cIiwgY2hpbGRyZW46IFtfanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImdsb2JhbC1pbmNvbWluZy1jYWxsLW5hbWVcIiwgY2hpbGRyZW46IGRpc3BsYXlOYW1lIH0pLCBfanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImdsb2JhbC1pbmNvbWluZy1jYWxsLXR5cGVcIiwgY2hpbGRyZW46IGRpc3BsYXlTdWJ0aXRsZSB9KV0gfSldIH0pLCBfanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJnbG9iYWwtaW5jb21pbmctY2FsbC1hY3Rpb25zXCIsIGNoaWxkcmVuOiBbX2pzeChcImJ1dHRvblwiLCB7IGNsYXNzTmFtZTogXCJnbG9iYWwtaW5jb21pbmctY2FsbC1idG4gZ2xvYmFsLWluY29taW5nLWNhbGwtYnRuLS1yZWplY3RcIiwgb25DbGljazogaGFuZGxlUmVqZWN0LCBkaXNhYmxlZDogaXNQcm9jZXNzaW5nLCBjaGlsZHJlbjogXCJUXFx1MUVFQiBjaFxcdTFFRDFpXCIgfSksIF9qc3goXCJidXR0b25cIiwgeyBjbGFzc05hbWU6IFwiZ2xvYmFsLWluY29taW5nLWNhbGwtYnRuIGdsb2JhbC1pbmNvbWluZy1jYWxsLWJ0bi0tYWNjZXB0XCIsIG9uQ2xpY2s6IGhhbmRsZUFjY2VwdCwgZGlzYWJsZWQ6IGlzUHJvY2Vzc2luZywgY2hpbGRyZW46IFwiVGhhbSBnaWFcIiB9KV0gfSldIH0pIH0pKTtcbn1cbiJdLCJuYW1lcyI6WyJqc3giLCJfanN4IiwianN4cyIsIl9qc3hzIiwidXNlRWZmZWN0IiwidXNlU3RhdGUiLCJnZXRTb2NrZXQiLCJhY2NlcHRDYWxsIiwicmVqZWN0Q2FsbCIsImdldE9wcG9uZW50SW5mbyIsImdldENvbnZlcnNhdGlvbnMiLCJnZXRDYWxsIiwiR2xvYmFsSW5jb21pbmdDYWxsIiwiaW5jb21pbmdDYWxsIiwic2V0SW5jb21pbmdDYWxsIiwiY2FsbGVyTmFtZSIsInNldENhbGxlck5hbWUiLCJjYWxsZXJBdmF0YXIiLCJzZXRDYWxsZXJBdmF0YXIiLCJpc1Byb2Nlc3NpbmciLCJzZXRJc1Byb2Nlc3NpbmciLCJpc0dyb3VwQ2FsbCIsInNldElzR3JvdXBDYWxsIiwiZ3JvdXBOYW1lIiwic2V0R3JvdXBOYW1lIiwic29ja2V0IiwiY29uc29sZSIsIndhcm4iLCJoYW5kbGVJbmNvbWluZ0NhbGwiLCJkYXRhIiwibG9nIiwiY3VycmVudFVzZXJJZCIsIndpbmRvdyIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJpbml0aWF0b3JJZCIsIm9uIiwib2ZmIiwiY2FuY2VsbGVkIiwibG9hZEluZm8iLCJjYWxsVHlwZSIsImxpdmVraXRSb29tTmFtZSIsImNhbGxJbmZvIiwiY2FsbElkIiwicHJldiIsIm1ldGFkYXRhIiwiZXJyIiwiY29udmVyc2F0aW9ucyIsImNvbnZlcnNhdGlvbiIsImZpbmQiLCJjIiwiX2lkIiwiY29udmVyc2F0aW9uSWQiLCJpc0dyb3VwIiwidGl0bGUiLCJtZW1iZXJzIiwibGVuZ3RoIiwiYXZhdGFyIiwiaW5mbyIsInVzZXIiLCJuYW1lIiwiZW1haWwiLCJlcnJvciIsImNsZWFyU3RhdGUiLCJoYW5kbGVBY2NlcHQiLCJpc0VsZWN0cm9uIiwiZWxlY3Ryb25BUEkiLCJsb2NhdGlvbiIsImhhc2giLCJpbmNsdWRlcyIsImhyZWYiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJ0b0xvd2VyQ2FzZSIsInRhcmdldCIsInBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsImFjY2VwdGVkRnJvbU1vZGFsIiwiaXNJbmNvbWluZyIsInNldCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwidG9TdHJpbmciLCJoYW5kbGVSZWplY3QiLCJ0aW1lciIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJkaXNwbGF5TmFtZSIsImRpc3BsYXlTdWJ0aXRsZSIsInR5cGUiLCJjbGFzc05hbWUiLCJvbkNsaWNrIiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsImNoaWxkcmVuIiwic3JjIiwiYWx0IiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJkaXNhYmxlZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/../../packages/app/components/GlobalIncomingCall.web.js\n"));

/***/ })

});