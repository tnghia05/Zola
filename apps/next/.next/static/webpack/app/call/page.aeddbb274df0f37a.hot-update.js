"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/call/page",{

/***/ "(app-pages-browser)/../../packages/app/hooks/useLiveKit.ts":
/*!**********************************************!*\
  !*** ../../packages/app/hooks/useLiveKit.ts ***!
  \**********************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useLiveKit: function() { return /* binding */ useLiveKit; }\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(app-pages-browser)/../../node_modules/.pnpm/next@14.0.4_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var livekit_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! livekit-client */ \"(app-pages-browser)/../../node_modules/.pnpm/livekit-client@2.16.0_@types+dom-mediacapture-record@1.0.22/node_modules/livekit-client/dist/livekit-client.esm.mjs\");\n\n\nfunction useLiveKit(param) {\n    let { roomName, token, url, autoSubscribe = true } = param;\n    const [room, setRoom] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n    const [localStream, setLocalStream] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n    const [remoteStreams, setRemoteStreams] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(new Map());\n    const [remoteTracks, setRemoteTracks] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(new Map());\n    const [isConnected, setIsConnected] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n    const [isVideoEnabled, setIsVideoEnabled] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(true);\n    const [isAudioEnabled, setIsAudioEnabled] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(true);\n    const roomRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const connectPromiseRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const latestOptionsRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)({\n        roomName,\n        token,\n        url\n    });\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        latestOptionsRef.current = {\n            roomName,\n            token,\n            url\n        };\n    }, [\n        roomName,\n        token,\n        url\n    ]);\n    const buildMediaStreamFromLocal = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((currentRoom)=>{\n        try {\n            const publications = Array.from(currentRoom.localParticipant.trackPublications.values());\n            const tracks = [];\n            publications.forEach((pub)=>{\n                const lkTrack = pub.track;\n                if (lkTrack && (lkTrack instanceof livekit_client__WEBPACK_IMPORTED_MODULE_1__.LocalVideoTrack || lkTrack instanceof livekit_client__WEBPACK_IMPORTED_MODULE_1__.LocalAudioTrack)) {\n                    const mediaTrack = lkTrack.mediaStreamTrack;\n                    if (mediaTrack) {\n                        tracks.push(mediaTrack);\n                    }\n                }\n            });\n            if (tracks.length > 0) {\n                const stream = new MediaStream(tracks);\n                setLocalStream(stream);\n            }\n        } catch (err) {\n            console.warn(\"[LiveKit] Failed to build local stream:\", err);\n        }\n    }, []);\n    const addRemoteTrack = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((participantId, mediaTrack)=>{\n        setRemoteStreams((prev)=>{\n            const next = new Map(prev);\n            const existing = next.get(participantId);\n            // Create a NEW MediaStream with all existing tracks + new track\n            // This ensures React detects the state change\n            const allTracks = [];\n            if (existing) {\n                existing.getTracks().forEach((t)=>{\n                    if (t.id !== mediaTrack.id) {\n                        allTracks.push(t);\n                    }\n                });\n            }\n            allTracks.push(mediaTrack);\n            const newStream = new MediaStream(allTracks);\n            next.set(participantId, newStream);\n            console.log(\"[LiveKit] Remote streams updated:\", {\n                participantId,\n                newTrackKind: mediaTrack.kind,\n                totalTracks: newStream.getTracks().length,\n                mapSize: next.size\n            });\n            return next;\n        });\n    }, []);\n    const removeRemoteTrack = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((participantId, mediaTrack)=>{\n        setRemoteStreams((prev)=>{\n            const next = new Map(prev);\n            const existing = next.get(participantId);\n            if (!existing) return prev;\n            if (mediaTrack) {\n                existing.removeTrack(mediaTrack);\n            }\n            if (existing.getTracks().length === 0) {\n                next.delete(participantId);\n            } else {\n                next.set(participantId, existing);\n            }\n            return next;\n        });\n    }, []);\n    const disconnect = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        if (roomRef.current) {\n            roomRef.current.disconnect();\n            roomRef.current = null;\n        }\n        connectPromiseRef.current = null;\n        setRoom(null);\n        setIsConnected(false);\n        setLocalStream(null);\n        setRemoteStreams(new Map());\n        setError(null);\n    }, []);\n    const connect = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async ()=>{\n        const { roomName: currentRoomName, token: currentToken, url: currentUrl } = latestOptionsRef.current;\n        if (!currentRoomName || !currentToken || !currentUrl) {\n            setError(\"Thiếu th\\xf4ng tin LiveKit (room/token/url)\");\n            return;\n        }\n        if (roomRef.current && roomRef.current.state === \"connected\") {\n            return;\n        }\n        if (connectPromiseRef.current) {\n            return connectPromiseRef.current;\n        }\n        const promise = (async ()=>{\n            try {\n                setError(null);\n                // Optimized room options for better performance\n                const roomOptions = {\n                    adaptiveStream: true,\n                    dynacast: true,\n                    // Video capture settings - use 720p for better performance\n                    videoCaptureDefaults: {\n                        resolution: livekit_client__WEBPACK_IMPORTED_MODULE_1__.VideoPresets.h720.resolution,\n                        facingMode: \"user\"\n                    },\n                    // Video publish settings - lower bitrate for smoother streaming\n                    publishDefaults: {\n                        videoSimulcastLayers: [\n                            livekit_client__WEBPACK_IMPORTED_MODULE_1__.VideoPresets.h180,\n                            livekit_client__WEBPACK_IMPORTED_MODULE_1__.VideoPresets.h360\n                        ],\n                        videoCodec: \"vp8\",\n                        dtx: true,\n                        red: true,\n                        stopMicTrackOnMute: false\n                    }\n                };\n                const newRoom = new livekit_client__WEBPACK_IMPORTED_MODULE_1__.Room(roomOptions);\n                roomRef.current = newRoom;\n                setRoom(newRoom);\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.Connected, ()=>{\n                    setIsConnected(true);\n                });\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.Disconnected, ()=>{\n                    setIsConnected(false);\n                    setLocalStream(null);\n                    setRemoteStreams(new Map());\n                    setRemoteTracks(new Map());\n                });\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.TrackSubscribed, (track, publication, participant)=>{\n                    console.log(\"[LiveKit] TrackSubscribed:\", {\n                        trackKind: track.kind,\n                        participantId: participant.identity,\n                        participantSid: participant.sid,\n                        trackSid: track.sid,\n                        isMuted: publication.isMuted,\n                        isSubscribed: publication.isSubscribed\n                    });\n                    if (track instanceof livekit_client__WEBPACK_IMPORTED_MODULE_1__.RemoteTrack) {\n                        // Store the RemoteTrack for direct attachment in components\n                        setRemoteTracks((prev)=>{\n                            const next = new Map(prev);\n                            const existing = next.get(participant.identity) || {};\n                            if (track.kind === \"video\") {\n                                next.set(participant.identity, {\n                                    ...existing,\n                                    videoTrack: track\n                                });\n                            } else if (track.kind === \"audio\") {\n                                next.set(participant.identity, {\n                                    ...existing,\n                                    audioTrack: track\n                                });\n                            }\n                            console.log(\"[LiveKit] Updated remoteTracks:\", {\n                                participantId: participant.identity,\n                                trackKind: track.kind,\n                                totalParticipants: next.size\n                            });\n                            return next;\n                        });\n                        // Also add to remoteStreams for backward compatibility\n                        const mediaTrack = track.mediaStreamTrack;\n                        if (mediaTrack) {\n                            console.log(\"[LiveKit] Adding remote MediaStreamTrack:\", {\n                                participantId: participant.identity,\n                                trackId: mediaTrack.id,\n                                trackKind: mediaTrack.kind,\n                                trackEnabled: mediaTrack.enabled,\n                                trackMuted: mediaTrack.muted\n                            });\n                            addRemoteTrack(participant.identity, mediaTrack);\n                        }\n                    }\n                });\n                // Handle track muted/unmuted events from remote participants\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.TrackMuted, (publication, participant)=>{\n                    console.log(\"[LiveKit] TrackMuted:\", {\n                        trackKind: publication.kind,\n                        participantId: participant.identity,\n                        source: publication.source\n                    });\n                });\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.TrackUnmuted, (publication, participant)=>{\n                    console.log(\"[LiveKit] TrackUnmuted:\", {\n                        trackKind: publication.kind,\n                        participantId: participant.identity,\n                        source: publication.source\n                    });\n                    // Re-add track when unmuted\n                    if (publication.track instanceof livekit_client__WEBPACK_IMPORTED_MODULE_1__.RemoteTrack) {\n                        const mediaTrack = publication.track.mediaStreamTrack;\n                        if (mediaTrack) {\n                            addRemoteTrack(participant.identity, mediaTrack);\n                        }\n                    }\n                });\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.ParticipantConnected, (participant)=>{\n                    console.log(\"[LiveKit] ParticipantConnected:\", {\n                        participantId: participant.identity,\n                        participantSid: participant.sid,\n                        trackCount: participant.trackPublications.size\n                    });\n                });\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.TrackUnsubscribed, (track, publication, participant)=>{\n                    if (track instanceof livekit_client__WEBPACK_IMPORTED_MODULE_1__.RemoteTrack) {\n                        // Remove from remoteTracks\n                        setRemoteTracks((prev)=>{\n                            const next = new Map(prev);\n                            const existing = next.get(participant.identity);\n                            if (existing) {\n                                if (track.kind === \"video\") {\n                                    next.set(participant.identity, {\n                                        ...existing,\n                                        videoTrack: undefined\n                                    });\n                                } else if (track.kind === \"audio\") {\n                                    next.set(participant.identity, {\n                                        ...existing,\n                                        audioTrack: undefined\n                                    });\n                                }\n                            }\n                            return next;\n                        });\n                        const mediaTrack = track.mediaStreamTrack;\n                        removeRemoteTrack(participant.identity, mediaTrack);\n                    }\n                });\n                newRoom.on(livekit_client__WEBPACK_IMPORTED_MODULE_1__.RoomEvent.ParticipantDisconnected, (participant)=>{\n                    setRemoteStreams((prev)=>{\n                        const next = new Map(prev);\n                        next.delete(participant.identity);\n                        return next;\n                    });\n                    setRemoteTracks((prev)=>{\n                        const next = new Map(prev);\n                        next.delete(participant.identity);\n                        return next;\n                    });\n                });\n                console.log(\"[LiveKit] Connecting to room:\", currentRoomName, \"at URL:\", currentUrl);\n                await newRoom.connect(currentUrl, currentToken);\n                console.log(\"[LiveKit] Connected! Room state:\", newRoom.state);\n                console.log(\"[LiveKit] Remote participants:\", newRoom.remoteParticipants.size);\n                // Log existing remote participants\n                newRoom.remoteParticipants.forEach((participant, sid)=>{\n                    console.log(\"[LiveKit] Existing remote participant:\", {\n                        identity: participant.identity,\n                        sid: sid,\n                        trackCount: participant.trackPublications.size\n                    });\n                    // Subscribe to any existing tracks\n                    participant.trackPublications.forEach((pub)=>{\n                        if (pub.track && pub.track instanceof livekit_client__WEBPACK_IMPORTED_MODULE_1__.RemoteTrack) {\n                            const mediaTrack = pub.track.mediaStreamTrack;\n                            if (mediaTrack) {\n                                console.log(\"[LiveKit] Found existing remote track:\", {\n                                    participantId: participant.identity,\n                                    trackId: mediaTrack.id,\n                                    trackKind: mediaTrack.kind\n                                });\n                                addRemoteTrack(participant.identity, mediaTrack);\n                            }\n                        }\n                    });\n                });\n                await newRoom.localParticipant.enableCameraAndMicrophone();\n                console.log(\"[LiveKit] Camera and microphone enabled\");\n                buildMediaStreamFromLocal(newRoom);\n            } catch (err) {\n                console.error(\"[LiveKit] Error connecting:\", err);\n                setError((err === null || err === void 0 ? void 0 : err.message) || \"Kh\\xf4ng thể kết nối LiveKit\");\n                disconnect();\n            } finally{\n                connectPromiseRef.current = null;\n            }\n        })();\n        connectPromiseRef.current = promise;\n        return promise;\n    }, [\n        addRemoteTrack,\n        autoSubscribe,\n        buildMediaStreamFromLocal,\n        disconnect,\n        removeRemoteTrack\n    ]);\n    const toggleVideo = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        if (!roomRef.current) return;\n        const enabled = !isVideoEnabled;\n        roomRef.current.localParticipant.setCameraEnabled(enabled);\n        setIsVideoEnabled(enabled);\n    }, [\n        isVideoEnabled\n    ]);\n    const toggleAudio = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        if (!roomRef.current) return;\n        const enabled = !isAudioEnabled;\n        roomRef.current.localParticipant.setMicrophoneEnabled(enabled);\n        setIsAudioEnabled(enabled);\n    }, [\n        isAudioEnabled\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        return ()=>{\n            disconnect();\n        };\n    }, [\n        disconnect\n    ]);\n    return {\n        room,\n        localStream,\n        remoteStreams,\n        remoteTracks,\n        isConnected,\n        error,\n        connect,\n        disconnect,\n        toggleVideo,\n        toggleAudio,\n        isVideoEnabled,\n        isAudioEnabled\n    };\n}\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uLi8uLi9wYWNrYWdlcy9hcHAvaG9va3MvdXNlTGl2ZUtpdC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQWlFO0FBVXpDO0FBaUNqQixTQUFTVSxXQUFXLEtBS1A7UUFMTyxFQUN6QkMsUUFBUSxFQUNSQyxLQUFLLEVBQ0xDLEdBQUcsRUFDSEMsZ0JBQWdCLElBQUksRUFDRixHQUxPO0lBTXpCLE1BQU0sQ0FBQ0MsTUFBTUMsUUFBUSxHQUFHYiwrQ0FBUUEsQ0FBYztJQUM5QyxNQUFNLENBQUNjLGFBQWFDLGVBQWUsR0FBR2YsK0NBQVFBLENBQXFCO0lBQ25FLE1BQU0sQ0FBQ2dCLGVBQWVDLGlCQUFpQixHQUFHakIsK0NBQVFBLENBQTJCLElBQUlrQjtJQUNqRixNQUFNLENBQUNDLGNBQWNDLGdCQUFnQixHQUFHcEIsK0NBQVFBLENBQXVDLElBQUlrQjtJQUMzRixNQUFNLENBQUNHLGFBQWFDLGVBQWUsR0FBR3RCLCtDQUFRQSxDQUFDO0lBQy9DLE1BQU0sQ0FBQ3VCLE9BQU9DLFNBQVMsR0FBR3hCLCtDQUFRQSxDQUFnQjtJQUNsRCxNQUFNLENBQUN5QixnQkFBZ0JDLGtCQUFrQixHQUFHMUIsK0NBQVFBLENBQUM7SUFDckQsTUFBTSxDQUFDMkIsZ0JBQWdCQyxrQkFBa0IsR0FBRzVCLCtDQUFRQSxDQUFDO0lBRXJELE1BQU02QixVQUFVOUIsNkNBQU1BLENBQWM7SUFDcEMsTUFBTStCLG9CQUFvQi9CLDZDQUFNQSxDQUF1QjtJQUN2RCxNQUFNZ0MsbUJBQW1CaEMsNkNBQU1BLENBQUM7UUFBRVM7UUFBVUM7UUFBT0M7SUFBSTtJQUV2RFosZ0RBQVNBLENBQUM7UUFDUmlDLGlCQUFpQkMsT0FBTyxHQUFHO1lBQUV4QjtZQUFVQztZQUFPQztRQUFJO0lBQ3BELEdBQUc7UUFBQ0Y7UUFBVUM7UUFBT0M7S0FBSTtJQUV6QixNQUFNdUIsNEJBQTRCcEMsa0RBQVdBLENBQUMsQ0FBQ3FDO1FBQzdDLElBQUk7WUFDRixNQUFNQyxl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a0JFLE9BQU8sR0FBR2tEO1FBQzVCLE9BQU9BO0lBQ1QsR0FBRztRQUFDM0I7UUFBZ0I1QztRQUFlc0I7UUFBMkIyQztRQUFZSDtLQUFrQjtJQUU1RixNQUFNMEQsY0FBY3RJLGtEQUFXQSxDQUFDO1FBQzlCLElBQUksQ0FBQ2dDLFFBQVFHLE9BQU8sRUFBRTtRQUN0QixNQUFNcUYsVUFBVSxDQUFDNUY7UUFDakJJLFFBQVFHLE9BQU8sQ0FBQ00sZ0JBQWdCLENBQUM4RixnQkFBZ0IsQ0FBQ2Y7UUFDbEQzRixrQkFBa0IyRjtJQUNwQixHQUFHO1FBQUM1RjtLQUFlO0lBRW5CLE1BQU00RyxjQUFjeEksa0RBQVdBLENBQUM7UUFDOUIsSUFBSSxDQUFDZ0MsUUFBUUcsT0FBTyxFQUFFO1FBQ3RCLE1BQU1xRixVQUFVLENBQUMxRjtRQUNqQkUsUUFBUUcsT0FBTyxDQUFDTSxnQkFBZ0IsQ0FBQ2dHLG9CQUFvQixDQUFDakI7UUFDdER6RixrQkFBa0J5RjtJQUNwQixHQUFHO1FBQUMxRjtLQUFlO0lBRW5CN0IsZ0RBQVNBLENBQUM7UUFDUixPQUFPO1lBQ0w4RTtRQUNGO0lBQ0YsR0FBRztRQUFDQTtLQUFXO0lBRWYsT0FBTztRQUNMaEU7UUFDQUU7UUFDQUU7UUFDQUc7UUFDQUU7UUFDQUU7UUFDQXNEO1FBQ0FEO1FBQ0F1RDtRQUNBRTtRQUNBNUc7UUFDQUU7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uLi8uLi9wYWNrYWdlcy9hcHAvaG9va3MvdXNlTGl2ZUtpdC50cz8xZTIxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBcbiAgUm9vbSwgXG4gIFJvb21FdmVudCwgXG4gIFJlbW90ZVRyYWNrLCBcbiAgTG9jYWxWaWRlb1RyYWNrLCBcbiAgTG9jYWxBdWRpb1RyYWNrLFxuICBWaWRlb1ByZXNldHMsXG4gIFJvb21PcHRpb25zLFxuICBWaWRlb0NvZGVjXG59IGZyb20gJ2xpdmVraXQtY2xpZW50JztcblxuLy8gTk9URTogVGhpcyBob29rIGlzIG5vdyB3ZWItZmlyc3QuIFJlYWN0IE5hdGl2ZSBnbG9iYWxzIHJlZ2lzdHJhdGlvbiBoYXMgYmVlblxuLy8gcmVtb3ZlZCB0byBhdm9pZCBidW5kbGluZyAncmVhY3QtbmF0aXZlJyBpbiBOZXh0LmpzLiBJZiB5b3UgbmVlZCBuYXRpdmVcbi8vIHN1cHBvcnQgbGF0ZXIsIGNyZWF0ZSBhIHNlcGFyYXRlICd1c2VMaXZlS2l0Lm5hdGl2ZS50cycgaW1wbGVtZW50YXRpb24uXG5cbmludGVyZmFjZSBVc2VMaXZlS2l0T3B0aW9ucyB7XG4gIHJvb21OYW1lPzogc3RyaW5nO1xuICB0b2tlbj86IHN0cmluZztcbiAgdXJsPzogc3RyaW5nO1xuICBhdXRvU3Vic2NyaWJlPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZW1vdGVQYXJ0aWNpcGFudFRyYWNrcyB7XG4gIGF1ZGlvVHJhY2s/OiBSZW1vdGVUcmFjaztcbiAgdmlkZW9UcmFjaz86IFJlbW90ZVRyYWNrO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZUxpdmVLaXRSZXN1bHQge1xuICByb29tOiBSb29tIHwgbnVsbDtcbiAgbG9jYWxTdHJlYW06IE1lZGlhU3RyZWFtIHwgbnVsbDtcbiAgcmVtb3RlU3RyZWFtczogTWFwPHN0cmluZywgTWVkaWFTdHJlYW0+O1xuICByZW1vdGVUcmFja3M6IE1hcDxzdHJpbmcsIFJlbW90ZVBhcnRpY2lwYW50VHJhY2tzPjsgLy8gTmV3OiBmb3IgZGlyZWN0IHRyYWNrIGF0dGFjaG1lbnRcbiAgaXNDb25uZWN0ZWQ6IGJvb2xlYW47XG4gIGVycm9yOiBzdHJpbmcgfCBudWxsO1xuICBjb25uZWN0OiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBkaXNjb25uZWN0OiAoKSA9PiB2b2lkO1xuICB0b2dnbGVWaWRlbzogKCkgPT4gdm9pZDtcbiAgdG9nZ2xlQXVkaW86ICgpID0+IHZvaWQ7XG4gIGlzVmlkZW9FbmFibGVkOiBib29sZWFuO1xuICBpc0F1ZGlvRW5hYmxlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZUxpdmVLaXQoe1xuICByb29tTmFtZSxcbiAgdG9rZW4sXG4gIHVybCxcbiAgYXV0b1N1YnNjcmliZSA9IHRydWUsXG59OiBVc2VMaXZlS2l0T3B0aW9ucyk6IFVzZUxpdmVLaXRSZXN1bHQge1xuICBjb25zdCBbcm9vbSwgc2V0Um9vbV0gPSB1c2VTdGF0ZTxSb29tIHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtsb2NhbFN0cmVhbSwgc2V0TG9jYWxTdHJlYW1dID0gdXNlU3RhdGU8TWVkaWFTdHJlYW0gfCBudWxsPihudWxsKTtcbiAgY29uc3QgW3JlbW90ZVN0cmVhbXMsIHNldFJlbW90ZVN0cmVhbXNdID0gdXNlU3RhdGU8TWFwPHN0cmluZywgTWVkaWFTdHJlYW0+PihuZXcgTWFwKCkpO1xuICBjb25zdCBbcmVtb3RlVHJhY2tzLCBzZXRSZW1vdGVUcmFja3NdID0gdXNlU3RhdGU8TWFwPHN0cmluZywgUmVtb3RlUGFydGljaXBhbnRUcmFja3M+PihuZXcgTWFwKCkpO1xuICBjb25zdCBbaXNDb25uZWN0ZWQsIHNldElzQ29ubmVjdGVkXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgY29uc3QgW2lzVmlkZW9FbmFibGVkLCBzZXRJc1ZpZGVvRW5hYmxlZF0gPSB1c2VTdGF0ZSh0cnVlKTtcbiAgY29uc3QgW2lzQXVkaW9FbmFibGVkLCBzZXRJc0F1ZGlvRW5hYmxlZF0gPSB1c2VTdGF0ZSh0cnVlKTtcblxuICBjb25zdCByb29tUmVmID0gdXNlUmVmPFJvb20gfCBudWxsPihudWxsKTtcbiAgY29uc3QgY29ubmVjdFByb21pc2VSZWYgPSB1c2VSZWY8UHJvbWlzZTx2b2lkPiB8IG51bGw+KG51bGwpO1xuICBjb25zdCBsYXRlc3RPcHRpb25zUmVmID0gdXNlUmVmKHsgcm9vbU5hbWUsIHRva2VuLCB1cmwgfSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBsYXRlc3RPcHRpb25zUmVmLmN1cnJlbnQgPSB7IHJvb21OYW1lLCB0b2tlbiwgdXJsIH07XG4gIH0sIFtyb29tTmFtZSwgdG9rZW4sIHVybF0pO1xuXG4gIGNvbnN0IGJ1aWxkTWVkaWFTdHJlYW1Gcm9tTG9jYWwgPSB1c2VDYWxsYmFjaygoY3VycmVudFJvb206IFJvb20pID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcHVibGljYXRpb25zID0gQXJyYXkuZnJvbShjdXJyZW50Um9vbS5sb2NhbFBhcnRpY2lwYW50LnRyYWNrUHVibGljYXRpb25zLnZhbHVlcygpKTtcbiAgICAgIGNvbnN0IHRyYWNrczogTWVkaWFTdHJlYW1UcmFja1tdID0gW107XG4gICAgICBwdWJsaWNhdGlvbnMuZm9yRWFjaCgocHViKSA9PiB7XG4gICAgICAgIGNvbnN0IGxrVHJhY2sgPSBwdWIudHJhY2s7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBsa1RyYWNrICYmXG4gICAgICAgICAgKGxrVHJhY2sgaW5zdGFuY2VvZiBMb2NhbFZpZGVvVHJhY2sgfHwgbGtUcmFjayBpbnN0YW5jZW9mIExvY2FsQXVkaW9UcmFjaylcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29uc3QgbWVkaWFUcmFjayA9IChsa1RyYWNrIGFzIGFueSkubWVkaWFTdHJlYW1UcmFjayBhcyBNZWRpYVN0cmVhbVRyYWNrIHwgdW5kZWZpbmVkO1xuICAgICAgICAgIGlmIChtZWRpYVRyYWNrKSB7XG4gICAgICAgICAgICB0cmFja3MucHVzaChtZWRpYVRyYWNrKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKHRyYWNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBNZWRpYVN0cmVhbSh0cmFja3MpO1xuICAgICAgICBzZXRMb2NhbFN0cmVhbShzdHJlYW0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS53YXJuKCdbTGl2ZUtpdF0gRmFpbGVkIHRvIGJ1aWxkIGxvY2FsIHN0cmVhbTonLCBlcnIpO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIGNvbnN0IGFkZFJlbW90ZVRyYWNrID0gdXNlQ2FsbGJhY2soKHBhcnRpY2lwYW50SWQ6IHN0cmluZywgbWVkaWFUcmFjazogTWVkaWFTdHJlYW1UcmFjaykgPT4ge1xuICAgIHNldFJlbW90ZVN0cmVhbXMoKHByZXYpID0+IHtcbiAgICAgIGNvbnN0IG5leHQgPSBuZXcgTWFwKHByZXYpO1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBuZXh0LmdldChwYXJ0aWNpcGFudElkKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGEgTkVXIE1lZGlhU3RyZWFtIHdpdGggYWxsIGV4aXN0aW5nIHRyYWNrcyArIG5ldyB0cmFja1xuICAgICAgLy8gVGhpcyBlbnN1cmVzIFJlYWN0IGRldGVjdHMgdGhlIHN0YXRlIGNoYW5nZVxuICAgICAgY29uc3QgYWxsVHJhY2tzOiBNZWRpYVN0cmVhbVRyYWNrW10gPSBbXTtcbiAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICBleGlzdGluZy5nZXRUcmFja3MoKS5mb3JFYWNoKHQgPT4ge1xuICAgICAgICAgIGlmICh0LmlkICE9PSBtZWRpYVRyYWNrLmlkKSB7XG4gICAgICAgICAgICBhbGxUcmFja3MucHVzaCh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYWxsVHJhY2tzLnB1c2gobWVkaWFUcmFjayk7XG4gICAgICBcbiAgICAgIGNvbnN0IG5ld1N0cmVhbSA9IG5ldyBNZWRpYVN0cmVhbShhbGxUcmFja3MpO1xuICAgICAgbmV4dC5zZXQocGFydGljaXBhbnRJZCwgbmV3U3RyZWFtKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ1tMaXZlS2l0XSBSZW1vdGUgc3RyZWFtcyB1cGRhdGVkOicsIHtcbiAgICAgICAgcGFydGljaXBhbnRJZCxcbiAgICAgICAgbmV3VHJhY2tLaW5kOiBtZWRpYVRyYWNrLmtpbmQsXG4gICAgICAgIHRvdGFsVHJhY2tzOiBuZXdTdHJlYW0uZ2V0VHJhY2tzKCkubGVuZ3RoLFxuICAgICAgICBtYXBTaXplOiBuZXh0LnNpemVcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9KTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IHJlbW92ZVJlbW90ZVRyYWNrID0gdXNlQ2FsbGJhY2soKHBhcnRpY2lwYW50SWQ6IHN0cmluZywgbWVkaWFUcmFjaz86IE1lZGlhU3RyZWFtVHJhY2spID0+IHtcbiAgICBzZXRSZW1vdGVTdHJlYW1zKChwcmV2KSA9PiB7XG4gICAgICBjb25zdCBuZXh0ID0gbmV3IE1hcChwcmV2KTtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gbmV4dC5nZXQocGFydGljaXBhbnRJZCk7XG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gcHJldjtcbiAgICAgIGlmIChtZWRpYVRyYWNrKSB7XG4gICAgICAgIGV4aXN0aW5nLnJlbW92ZVRyYWNrKG1lZGlhVHJhY2spO1xuICAgICAgfVxuICAgICAgaWYgKGV4aXN0aW5nLmdldFRyYWNrcygpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBuZXh0LmRlbGV0ZShwYXJ0aWNpcGFudElkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5leHQuc2V0KHBhcnRpY2lwYW50SWQsIGV4aXN0aW5nKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH0pO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgZGlzY29ubmVjdCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAocm9vbVJlZi5jdXJyZW50KSB7XG4gICAgICByb29tUmVmLmN1cnJlbnQuZGlzY29ubmVjdCgpO1xuICAgICAgcm9vbVJlZi5jdXJyZW50ID0gbnVsbDtcbiAgICB9XG4gICAgY29ubmVjdFByb21pc2VSZWYuY3VycmVudCA9IG51bGw7XG4gICAgc2V0Um9vbShudWxsKTtcbiAgICBzZXRJc0Nvbm5lY3RlZChmYWxzZSk7XG4gICAgc2V0TG9jYWxTdHJlYW0obnVsbCk7XG4gICAgc2V0UmVtb3RlU3RyZWFtcyhuZXcgTWFwKCkpO1xuICAgIHNldEVycm9yKG51bGwpO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgY29ubmVjdCA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IHJvb21OYW1lOiBjdXJyZW50Um9vbU5hbWUsIHRva2VuOiBjdXJyZW50VG9rZW4sIHVybDogY3VycmVudFVybCB9ID1cbiAgICAgIGxhdGVzdE9wdGlvbnNSZWYuY3VycmVudDtcblxuICAgIGlmICghY3VycmVudFJvb21OYW1lIHx8ICFjdXJyZW50VG9rZW4gfHwgIWN1cnJlbnRVcmwpIHtcbiAgICAgIHNldEVycm9yKCdUaGnhur91IHRow7RuZyB0aW4gTGl2ZUtpdCAocm9vbS90b2tlbi91cmwpJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHJvb21SZWYuY3VycmVudCAmJiByb29tUmVmLmN1cnJlbnQuc3RhdGUgPT09ICdjb25uZWN0ZWQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNvbm5lY3RQcm9taXNlUmVmLmN1cnJlbnQpIHtcbiAgICAgIHJldHVybiBjb25uZWN0UHJvbWlzZVJlZi5jdXJyZW50O1xuICAgIH1cblxuICAgIGNvbnN0IHByb21pc2UgPSAoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc2V0RXJyb3IobnVsbCk7XG4gICAgICAgIFxuICAgICAgICAvLyBPcHRpbWl6ZWQgcm9vbSBvcHRpb25zIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgICAgICAgY29uc3Qgcm9vbU9wdGlvbnM6IFJvb21PcHRpb25zID0ge1xuICAgICAgICAgIGFkYXB0aXZlU3RyZWFtOiB0cnVlLFxuICAgICAgICAgIGR5bmFjYXN0OiB0cnVlLFxuICAgICAgICAgIC8vIFZpZGVvIGNhcHR1cmUgc2V0dGluZ3MgLSB1c2UgNzIwcCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gICAgICAgICAgdmlkZW9DYXB0dXJlRGVmYXVsdHM6IHtcbiAgICAgICAgICAgIHJlc29sdXRpb246IFZpZGVvUHJlc2V0cy5oNzIwLnJlc29sdXRpb24sXG4gICAgICAgICAgICBmYWNpbmdNb2RlOiAndXNlcicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICAvLyBWaWRlbyBwdWJsaXNoIHNldHRpbmdzIC0gbG93ZXIgYml0cmF0ZSBmb3Igc21vb3RoZXIgc3RyZWFtaW5nXG4gICAgICAgICAgcHVibGlzaERlZmF1bHRzOiB7XG4gICAgICAgICAgICB2aWRlb1NpbXVsY2FzdExheWVyczogW1ZpZGVvUHJlc2V0cy5oMTgwLCBWaWRlb1ByZXNldHMuaDM2MF0sXG4gICAgICAgICAgICB2aWRlb0NvZGVjOiAndnA4JyBhcyBWaWRlb0NvZGVjLCAvLyBWUDggaGFzIGJldHRlciBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBkdHg6IHRydWUsIC8vIERpc2NvbnRpbnVvdXMgdHJhbnNtaXNzaW9uIGZvciBhdWRpbyAtIHNhdmVzIGJhbmR3aWR0aFxuICAgICAgICAgICAgcmVkOiB0cnVlLCAvLyBSZWR1bmRhbnQgZW5jb2RpbmcgZm9yIGF1ZGlvIC0gYmV0dGVyIHF1YWxpdHlcbiAgICAgICAgICAgIHN0b3BNaWNUcmFja09uTXV0ZTogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG5ld1Jvb20gPSBuZXcgUm9vbShyb29tT3B0aW9ucyk7XG5cbiAgICAgICAgcm9vbVJlZi5jdXJyZW50ID0gbmV3Um9vbTtcbiAgICAgICAgc2V0Um9vbShuZXdSb29tKTtcblxuICAgICAgICBuZXdSb29tLm9uKFJvb21FdmVudC5Db25uZWN0ZWQsICgpID0+IHtcbiAgICAgICAgICBzZXRJc0Nvbm5lY3RlZCh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3Um9vbS5vbihSb29tRXZlbnQuRGlzY29ubmVjdGVkLCAoKSA9PiB7XG4gICAgICAgICAgc2V0SXNDb25uZWN0ZWQoZmFsc2UpO1xuICAgICAgICAgIHNldExvY2FsU3RyZWFtKG51bGwpO1xuICAgICAgICAgIHNldFJlbW90ZVN0cmVhbXMobmV3IE1hcCgpKTtcbiAgICAgICAgICBzZXRSZW1vdGVUcmFja3MobmV3IE1hcCgpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3Um9vbS5vbihSb29tRXZlbnQuVHJhY2tTdWJzY3JpYmVkLCAodHJhY2ssIHB1YmxpY2F0aW9uLCBwYXJ0aWNpcGFudCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdbTGl2ZUtpdF0gVHJhY2tTdWJzY3JpYmVkOicsIHtcbiAgICAgICAgICAgIHRyYWNrS2luZDogdHJhY2sua2luZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYW50SWQ6IHBhcnRpY2lwYW50LmlkZW50aXR5LFxuICAgICAgICAgICAgcGFydGljaXBhbnRTaWQ6IHBhcnRpY2lwYW50LnNpZCxcbiAgICAgICAgICAgIHRyYWNrU2lkOiB0cmFjay5zaWQsXG4gICAgICAgICAgICBpc011dGVkOiBwdWJsaWNhdGlvbi5pc011dGVkLFxuICAgICAgICAgICAgaXNTdWJzY3JpYmVkOiBwdWJsaWNhdGlvbi5pc1N1YnNjcmliZWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAodHJhY2sgaW5zdGFuY2VvZiBSZW1vdGVUcmFjaykge1xuICAgICAgICAgICAgLy8gU3RvcmUgdGhlIFJlbW90ZVRyYWNrIGZvciBkaXJlY3QgYXR0YWNobWVudCBpbiBjb21wb25lbnRzXG4gICAgICAgICAgICBzZXRSZW1vdGVUcmFja3MoKHByZXYpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IG5ldyBNYXAocHJldik7XG4gICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gbmV4dC5nZXQocGFydGljaXBhbnQuaWRlbnRpdHkpIHx8IHt9O1xuICAgICAgICAgICAgICBpZiAodHJhY2sua2luZCA9PT0gJ3ZpZGVvJykge1xuICAgICAgICAgICAgICAgIG5leHQuc2V0KHBhcnRpY2lwYW50LmlkZW50aXR5LCB7IC4uLmV4aXN0aW5nLCB2aWRlb1RyYWNrOiB0cmFjayB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cmFjay5raW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgICAgICAgICAgbmV4dC5zZXQocGFydGljaXBhbnQuaWRlbnRpdHksIHsgLi4uZXhpc3RpbmcsIGF1ZGlvVHJhY2s6IHRyYWNrIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbTGl2ZUtpdF0gVXBkYXRlZCByZW1vdGVUcmFja3M6Jywge1xuICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50SWQ6IHBhcnRpY2lwYW50LmlkZW50aXR5LFxuICAgICAgICAgICAgICAgIHRyYWNrS2luZDogdHJhY2sua2luZCxcbiAgICAgICAgICAgICAgICB0b3RhbFBhcnRpY2lwYW50czogbmV4dC5zaXplXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBbHNvIGFkZCB0byByZW1vdGVTdHJlYW1zIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBjb25zdCBtZWRpYVRyYWNrID0gKHRyYWNrIGFzIGFueSkubWVkaWFTdHJlYW1UcmFjayBhcyBNZWRpYVN0cmVhbVRyYWNrIHwgdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKG1lZGlhVHJhY2spIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tMaXZlS2l0XSBBZGRpbmcgcmVtb3RlIE1lZGlhU3RyZWFtVHJhY2s6Jywge1xuICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50SWQ6IHBhcnRpY2lwYW50LmlkZW50aXR5LFxuICAgICAgICAgICAgICAgIHRyYWNrSWQ6IG1lZGlhVHJhY2suaWQsXG4gICAgICAgICAgICAgICAgdHJhY2tLaW5kOiBtZWRpYVRyYWNrLmtpbmQsXG4gICAgICAgICAgICAgICAgdHJhY2tFbmFibGVkOiBtZWRpYVRyYWNrLmVuYWJsZWQsXG4gICAgICAgICAgICAgICAgdHJhY2tNdXRlZDogbWVkaWFUcmFjay5tdXRlZFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgYWRkUmVtb3RlVHJhY2socGFydGljaXBhbnQuaWRlbnRpdHksIG1lZGlhVHJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBIYW5kbGUgdHJhY2sgbXV0ZWQvdW5tdXRlZCBldmVudHMgZnJvbSByZW1vdGUgcGFydGljaXBhbnRzXG4gICAgICAgIG5ld1Jvb20ub24oUm9vbUV2ZW50LlRyYWNrTXV0ZWQsIChwdWJsaWNhdGlvbiwgcGFydGljaXBhbnQpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW0xpdmVLaXRdIFRyYWNrTXV0ZWQ6Jywge1xuICAgICAgICAgICAgdHJhY2tLaW5kOiBwdWJsaWNhdGlvbi5raW5kLFxuICAgICAgICAgICAgcGFydGljaXBhbnRJZDogcGFydGljaXBhbnQuaWRlbnRpdHksXG4gICAgICAgICAgICBzb3VyY2U6IHB1YmxpY2F0aW9uLnNvdXJjZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIG5ld1Jvb20ub24oUm9vbUV2ZW50LlRyYWNrVW5tdXRlZCwgKHB1YmxpY2F0aW9uLCBwYXJ0aWNpcGFudCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdbTGl2ZUtpdF0gVHJhY2tVbm11dGVkOicsIHtcbiAgICAgICAgICAgIHRyYWNrS2luZDogcHVibGljYXRpb24ua2luZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYW50SWQ6IHBhcnRpY2lwYW50LmlkZW50aXR5LFxuICAgICAgICAgICAgc291cmNlOiBwdWJsaWNhdGlvbi5zb3VyY2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBSZS1hZGQgdHJhY2sgd2hlbiB1bm11dGVkXG4gICAgICAgICAgaWYgKHB1YmxpY2F0aW9uLnRyYWNrIGluc3RhbmNlb2YgUmVtb3RlVHJhY2spIHtcbiAgICAgICAgICAgIGNvbnN0IG1lZGlhVHJhY2sgPSAocHVibGljYXRpb24udHJhY2sgYXMgYW55KS5tZWRpYVN0cmVhbVRyYWNrIGFzIE1lZGlhU3RyZWFtVHJhY2sgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAobWVkaWFUcmFjaykge1xuICAgICAgICAgICAgICBhZGRSZW1vdGVUcmFjayhwYXJ0aWNpcGFudC5pZGVudGl0eSwgbWVkaWFUcmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIG5ld1Jvb20ub24oUm9vbUV2ZW50LlBhcnRpY2lwYW50Q29ubmVjdGVkLCAocGFydGljaXBhbnQpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW0xpdmVLaXRdIFBhcnRpY2lwYW50Q29ubmVjdGVkOicsIHtcbiAgICAgICAgICAgIHBhcnRpY2lwYW50SWQ6IHBhcnRpY2lwYW50LmlkZW50aXR5LFxuICAgICAgICAgICAgcGFydGljaXBhbnRTaWQ6IHBhcnRpY2lwYW50LnNpZCxcbiAgICAgICAgICAgIHRyYWNrQ291bnQ6IHBhcnRpY2lwYW50LnRyYWNrUHVibGljYXRpb25zLnNpemVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3Um9vbS5vbihSb29tRXZlbnQuVHJhY2tVbnN1YnNjcmliZWQsICh0cmFjaywgcHVibGljYXRpb24sIHBhcnRpY2lwYW50KSA9PiB7XG4gICAgICAgICAgaWYgKHRyYWNrIGluc3RhbmNlb2YgUmVtb3RlVHJhY2spIHtcbiAgICAgICAgICAgIC8vIFJlbW92ZSBmcm9tIHJlbW90ZVRyYWNrc1xuICAgICAgICAgICAgc2V0UmVtb3RlVHJhY2tzKChwcmV2KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBuZXcgTWFwKHByZXYpO1xuICAgICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IG5leHQuZ2V0KHBhcnRpY2lwYW50LmlkZW50aXR5KTtcbiAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRyYWNrLmtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgICAgICAgIG5leHQuc2V0KHBhcnRpY2lwYW50LmlkZW50aXR5LCB7IC4uLmV4aXN0aW5nLCB2aWRlb1RyYWNrOiB1bmRlZmluZWQgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cmFjay5raW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgICAgICAgICAgICBuZXh0LnNldChwYXJ0aWNpcGFudC5pZGVudGl0eSwgeyAuLi5leGlzdGluZywgYXVkaW9UcmFjazogdW5kZWZpbmVkIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBtZWRpYVRyYWNrID0gKHRyYWNrIGFzIGFueSkubWVkaWFTdHJlYW1UcmFjayBhcyBNZWRpYVN0cmVhbVRyYWNrIHwgdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmVtb3ZlUmVtb3RlVHJhY2socGFydGljaXBhbnQuaWRlbnRpdHksIG1lZGlhVHJhY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3Um9vbS5vbihSb29tRXZlbnQuUGFydGljaXBhbnREaXNjb25uZWN0ZWQsIChwYXJ0aWNpcGFudCkgPT4ge1xuICAgICAgICAgIHNldFJlbW90ZVN0cmVhbXMoKHByZXYpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5leHQgPSBuZXcgTWFwKHByZXYpO1xuICAgICAgICAgICAgbmV4dC5kZWxldGUocGFydGljaXBhbnQuaWRlbnRpdHkpO1xuICAgICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc2V0UmVtb3RlVHJhY2tzKChwcmV2KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuZXh0ID0gbmV3IE1hcChwcmV2KTtcbiAgICAgICAgICAgIG5leHQuZGVsZXRlKHBhcnRpY2lwYW50LmlkZW50aXR5KTtcbiAgICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zb2xlLmxvZygnW0xpdmVLaXRdIENvbm5lY3RpbmcgdG8gcm9vbTonLCBjdXJyZW50Um9vbU5hbWUsICdhdCBVUkw6JywgY3VycmVudFVybCk7XG4gICAgICAgIGF3YWl0IG5ld1Jvb20uY29ubmVjdChjdXJyZW50VXJsLCBjdXJyZW50VG9rZW4pO1xuICAgICAgICBjb25zb2xlLmxvZygnW0xpdmVLaXRdIENvbm5lY3RlZCEgUm9vbSBzdGF0ZTonLCBuZXdSb29tLnN0YXRlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1tMaXZlS2l0XSBSZW1vdGUgcGFydGljaXBhbnRzOicsIG5ld1Jvb20ucmVtb3RlUGFydGljaXBhbnRzLnNpemUpO1xuICAgICAgICBcbiAgICAgICAgLy8gTG9nIGV4aXN0aW5nIHJlbW90ZSBwYXJ0aWNpcGFudHNcbiAgICAgICAgbmV3Um9vbS5yZW1vdGVQYXJ0aWNpcGFudHMuZm9yRWFjaCgocGFydGljaXBhbnQsIHNpZCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdbTGl2ZUtpdF0gRXhpc3RpbmcgcmVtb3RlIHBhcnRpY2lwYW50OicsIHtcbiAgICAgICAgICAgIGlkZW50aXR5OiBwYXJ0aWNpcGFudC5pZGVudGl0eSxcbiAgICAgICAgICAgIHNpZDogc2lkLFxuICAgICAgICAgICAgdHJhY2tDb3VudDogcGFydGljaXBhbnQudHJhY2tQdWJsaWNhdGlvbnMuc2l6ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIC8vIFN1YnNjcmliZSB0byBhbnkgZXhpc3RpbmcgdHJhY2tzXG4gICAgICAgICAgcGFydGljaXBhbnQudHJhY2tQdWJsaWNhdGlvbnMuZm9yRWFjaCgocHViKSA9PiB7XG4gICAgICAgICAgICBpZiAocHViLnRyYWNrICYmIHB1Yi50cmFjayBpbnN0YW5jZW9mIFJlbW90ZVRyYWNrKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1lZGlhVHJhY2sgPSAocHViLnRyYWNrIGFzIGFueSkubWVkaWFTdHJlYW1UcmFjayBhcyBNZWRpYVN0cmVhbVRyYWNrIHwgdW5kZWZpbmVkO1xuICAgICAgICAgICAgICBpZiAobWVkaWFUcmFjaykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbTGl2ZUtpdF0gRm91bmQgZXhpc3RpbmcgcmVtb3RlIHRyYWNrOicsIHtcbiAgICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50SWQ6IHBhcnRpY2lwYW50LmlkZW50aXR5LFxuICAgICAgICAgICAgICAgICAgdHJhY2tJZDogbWVkaWFUcmFjay5pZCxcbiAgICAgICAgICAgICAgICAgIHRyYWNrS2luZDogbWVkaWFUcmFjay5raW5kXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYWRkUmVtb3RlVHJhY2socGFydGljaXBhbnQuaWRlbnRpdHksIG1lZGlhVHJhY2spO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgYXdhaXQgbmV3Um9vbS5sb2NhbFBhcnRpY2lwYW50LmVuYWJsZUNhbWVyYUFuZE1pY3JvcGhvbmUoKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1tMaXZlS2l0XSBDYW1lcmEgYW5kIG1pY3JvcGhvbmUgZW5hYmxlZCcpO1xuICAgICAgICBidWlsZE1lZGlhU3RyZWFtRnJvbUxvY2FsKG5ld1Jvb20pO1xuICAgICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW0xpdmVLaXRdIEVycm9yIGNvbm5lY3Rpbmc6JywgZXJyKTtcbiAgICAgICAgc2V0RXJyb3IoZXJyPy5tZXNzYWdlIHx8ICdLaMO0bmcgdGjhu4Mga+G6v3QgbuG7kWkgTGl2ZUtpdCcpO1xuICAgICAgICBkaXNjb25uZWN0KCk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBjb25uZWN0UHJvbWlzZVJlZi5jdXJyZW50ID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KSgpO1xuXG4gICAgY29ubmVjdFByb21pc2VSZWYuY3VycmVudCA9IHByb21pc2U7XG4gICAgcmV0dXJuIHByb21pc2U7XG4gIH0sIFthZGRSZW1vdGVUcmFjaywgYXV0b1N1YnNjcmliZSwgYnVpbGRNZWRpYVN0cmVhbUZyb21Mb2NhbCwgZGlzY29ubmVjdCwgcmVtb3ZlUmVtb3RlVHJhY2tdKTtcblxuICBjb25zdCB0b2dnbGVWaWRlbyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoIXJvb21SZWYuY3VycmVudCkgcmV0dXJuO1xuICAgIGNvbnN0IGVuYWJsZWQgPSAhaXNWaWRlb0VuYWJsZWQ7XG4gICAgcm9vbVJlZi5jdXJyZW50LmxvY2FsUGFydGljaXBhbnQuc2V0Q2FtZXJhRW5hYmxlZChlbmFibGVkKTtcbiAgICBzZXRJc1ZpZGVvRW5hYmxlZChlbmFibGVkKTtcbiAgfSwgW2lzVmlkZW9FbmFibGVkXSk7XG5cbiAgY29uc3QgdG9nZ2xlQXVkaW8gPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKCFyb29tUmVmLmN1cnJlbnQpIHJldHVybjtcbiAgICBjb25zdCBlbmFibGVkID0gIWlzQXVkaW9FbmFibGVkO1xuICAgIHJvb21SZWYuY3VycmVudC5sb2NhbFBhcnRpY2lwYW50LnNldE1pY3JvcGhvbmVFbmFibGVkKGVuYWJsZWQpO1xuICAgIHNldElzQXVkaW9FbmFibGVkKGVuYWJsZWQpO1xuICB9LCBbaXNBdWRpb0VuYWJsZWRdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBkaXNjb25uZWN0KCk7XG4gICAgfTtcbiAgfSwgW2Rpc2Nvbm5lY3RdKTtcblxuICByZXR1cm4ge1xuICAgIHJvb20sXG4gICAgbG9jYWxTdHJlYW0sXG4gICAgcmVtb3RlU3RyZWFtcyxcbiAgICByZW1vdGVUcmFja3MsXG4gICAgaXNDb25uZWN0ZWQsXG4gICAgZXJyb3IsXG4gICAgY29ubmVjdCxcbiAgICBkaXNjb25uZWN0LFxuICAgIHRvZ2dsZVZpZGVvLFxuICAgIHRvZ2dsZUF1ZGlvLFxuICAgIGlzVmlkZW9FbmFibGVkLFxuICAgIGlzQXVkaW9FbmFibGVkLFxuICB9O1xufVxuXG4iXSwibmFtZXMiOlsidXNlQ2FsbGJhY2siLCJ1c2VFZmZlY3QiLCJ1c2VSZWYiLCJ1c2VTdGF0ZSIsIlJvb20iLCJSb29tRXZlbnQiLCJSZW1vdGVUcmFjayIsIkxvY2FsVmlkZW9UcmFjayIsIkxvY2FsQXVkaW9UcmFjayIsIlZpZGVvUHJlc2V0cyIsInVzZUxpdmVLaXQiLCJyb29tTmFtZSIsInRva2VuIiwidXJsIiwiYXV0b1N1YnNjcmliZSIsInJvb20iLCJzZXRSb29tIiwibG9jYWxTdHJlYW0iLCJzZXRMb2NhbFN0cmVhbSIsInJlbW90ZVN0cmVhbXMiLCJzZXRSZW1vdGVTdHJlYW1zIiwiTWFwIiwicmVtb3RlVHJhY2tzIiwic2V0UmVtb3RlVHJhY2tzIiwiaXNDb25uZWN0ZWQiLCJzZXRJc0Nvbm5lY3RlZCIsImVycm9yIiwic2V0RXJyb3IiLCJpc1ZpZGVvRW5hYmxlZCIsInNldElzVmlkZW9FbmFibGVkIiwiaXNBdWRpb0VuYWJsZWQiLCJzZXRJc0F1ZGlvRW5hYmxlZCIsInJvb21SZWYiLCJjb25uZWN0UHJvbWlzZVJlZiIsImxhdGVzdE9wdGlvbnNSZWYiLCJjdXJyZW50IiwiYnVpbGRNZWRpYVN0cmVhbUZyb21Mb2NhbCIsImN1cnJlbnRSb29tIiwicHVibGljYXRpb25zIiwiQXJyYXkiLCJmcm9tIiwibG9jYWxQYXJ0aWNpcGFudCIsInRyYWNrUHVibGljYXRpb25zIiwidmFsdWVzIiwidHJhY2tzIiwiZm9yRWFjaCIsInB1YiIsImxrVHJhY2siLCJ0cmFjayIsIm1lZGlhVHJhY2siLCJtZWRpYVN0cmVhbVRyYWNrIiwicHVzaCIsImxlbmd0aCIsInN0cmVhbSIsIk1lZGlhU3RyZWFtIiwiZXJyIiwiY29uc29sZSIsIndhcm4iLCJhZGRSZW1vdGVUcmFjayIsInBhcnRpY2lwYW50SWQiLCJwcmV2IiwibmV4dCIsImV4aXN0aW5nIiwiZ2V0IiwiYWxsVHJhY2tzIiwiZ2V0VHJhY2tzIiwidCIsImlkIiwibmV3U3RyZWFtIiwic2V0IiwibG9nIiwibmV3VHJhY2tLaW5kIiwia2luZCIsInRvdGFsVHJhY2tzIiwibWFwU2l6ZSIsInNpemUiLCJyZW1vdmVSZW1vdGVUcmFjayIsInJlbW92ZVRyYWNrIiwiZGVsZXRlIiwiZGlzY29ubmVjdCIsImNvbm5lY3QiLCJjdXJyZW50Um9vbU5hbWUiLCJjdXJyZW50VG9rZW4iLCJjdXJyZW50VXJsIiwic3RhdGUiLCJwcm9taXNlIiwicm9vbU9wdGlvbnMiLCJhZGFwdGl2ZVN0cmVhbSIsImR5bmFjYXN0IiwidmlkZW9DYXB0dXJlRGVmYXVsdHMiLCJyZXNvbHV0aW9uIiwiaDcyMCIsImZhY2luZ01vZGUiLCJwdWJsaXNoRGVmYXVsdHMiLCJ2aWRlb1NpbXVsY2FzdExheWVycyIsImgxODAiLCJoMzYwIiwidmlkZW9Db2RlYyIsImR0eCIsInJlZCIsInN0b3BNaWNUcmFja09uTXV0ZSIsIm5ld1Jvb20iLCJvbiIsIkNvbm5lY3RlZCIsIkRpc2Nvbm5lY3RlZCIsIlRyYWNrU3Vic2NyaWJlZCIsInB1YmxpY2F0aW9uIiwicGFydGljaXBhbnQiLCJ0cmFja0tpbmQiLCJpZGVudGl0eSIsInBhcnRpY2lwYW50U2lkIiwic2lkIiwidHJhY2tTaWQiLCJpc011dGVkIiwiaXNTdWJzY3JpYmVkIiwidmlkZW9UcmFjayIsImF1ZGlvVHJhY2siLCJ0b3RhbFBhcnRpY2lwYW50cyIsInRyYWNrSWQiLCJ0cmFja0VuYWJsZWQiLCJlbmFibGVkIiwidHJhY2tNdXRlZCIsIm11dGVkIiwiVHJhY2tNdXRlZCIsInNvdXJjZSIsIlRyYWNrVW5tdXRlZCIsIlBhcnRpY2lwYW50Q29ubmVjdGVkIiwidHJhY2tDb3VudCIsIlRyYWNrVW5zdWJzY3JpYmVkIiwidW5kZWZpbmVkIiwiUGFydGljaXBhbnREaXNjb25uZWN0ZWQiLCJyZW1vdGVQYXJ0aWNpcGFudHMiLCJlbmFibGVDYW1lcmFBbmRNaWNyb3Bob25lIiwibWVzc2FnZSIsInRvZ2dsZVZpZGVvIiwic2V0Q2FtZXJhRW5hYmxlZCIsInRvZ2dsZUF1ZGlvIiwic2V0TWljcm9waG9uZUVuYWJsZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-pages-browser)/../../packages/app/hooks/useLiveKit.ts\n"));

/***/ })

});